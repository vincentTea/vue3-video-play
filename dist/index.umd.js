(function(ae,B){typeof exports=="object"&&typeof module!="undefined"?B(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],B):(ae=typeof globalThis!="undefined"?globalThis:ae||self,B(ae.index={},ae.Vue))})(this,function(ae,B){"use strict";var Mr=Object.defineProperty,_r=Object.defineProperties;var Fr=Object.getOwnPropertyDescriptors;var et=Object.getOwnPropertySymbols;var Br=Object.prototype.hasOwnProperty,Ur=Object.prototype.propertyIsEnumerable;var tt=(ae,B,le)=>B in ae?Mr(ae,B,{enumerable:!0,configurable:!0,writable:!0,value:le}):ae[B]=le,Ke=(ae,B)=>{for(var le in B||(B={}))Br.call(B,le)&&tt(ae,le,B[le]);if(et)for(var le of et(B))Ur.call(B,le)&&tt(ae,le,B[le]);return ae},We=(ae,B)=>_r(ae,Fr(B));function le(G,H,K,C){var E,M=!1,O=0;function L(){E&&clearTimeout(E)}function R(){L(),M=!0}typeof H!="boolean"&&(C=K,K=H,H=void 0);function I(){for(var b=arguments.length,A=new Array(b),c=0;c<b;c++)A[c]=arguments[c];var S=this,y=Date.now()-O;if(M)return;function T(){O=Date.now(),K.apply(S,A)}function p(){E=void 0}C&&!E&&T(),L(),C===void 0&&y>G?T():H!==!0&&(E=setTimeout(C?p:T,C===void 0?G-y:G))}return I.cancel=R,I}function ze(G,H,K){return K===void 0?le(G,H,!1):le(G,K,H!==!1)}var rt=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function it(G){return G&&G.__esModule&&Object.prototype.hasOwnProperty.call(G,"default")?G.default:G}var Xe={exports:{}};(function(G,H){typeof window!="undefined"&&function(C,E){G.exports=E()}(rt,function(){return function(K){var C={};function E(M){if(C[M])return C[M].exports;var O=C[M]={i:M,l:!1,exports:{}};return K[M].call(O.exports,O,O.exports,E),O.l=!0,O.exports}return E.m=K,E.c=C,E.d=function(M,O,L){E.o(M,O)||Object.defineProperty(M,O,{enumerable:!0,get:L})},E.r=function(M){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(M,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(M,"__esModule",{value:!0})},E.t=function(M,O){if(O&1&&(M=E(M)),O&8||O&4&&typeof M=="object"&&M&&M.__esModule)return M;var L=Object.create(null);if(E.r(L),Object.defineProperty(L,"default",{enumerable:!0,value:M}),O&2&&typeof M!="string")for(var R in M)E.d(L,R,function(I){return M[I]}.bind(null,R));return L},E.n=function(M){var O=M&&M.__esModule?function(){return M.default}:function(){return M};return E.d(O,"a",O),O},E.o=function(M,O){return Object.prototype.hasOwnProperty.call(M,O)},E.p="/dist/",E(E.s="./src/hls.ts")}({"./node_modules/eventemitter3/index.js":function(K,C,E){var M=Object.prototype.hasOwnProperty,O="~";function L(){}Object.create&&(L.prototype=Object.create(null),new L().__proto__||(O=!1));function R(c,S,y){this.fn=c,this.context=S,this.once=y||!1}function I(c,S,y,T,p){if(typeof y!="function")throw new TypeError("The listener must be a function");var v=new R(y,T||c,p),s=O?O+S:S;return c._events[s]?c._events[s].fn?c._events[s]=[c._events[s],v]:c._events[s].push(v):(c._events[s]=v,c._eventsCount++),c}function b(c,S){--c._eventsCount===0?c._events=new L:delete c._events[S]}function A(){this._events=new L,this._eventsCount=0}A.prototype.eventNames=function(){var S=[],y,T;if(this._eventsCount===0)return S;for(T in y=this._events)M.call(y,T)&&S.push(O?T.slice(1):T);return Object.getOwnPropertySymbols?S.concat(Object.getOwnPropertySymbols(y)):S},A.prototype.listeners=function(S){var y=O?O+S:S,T=this._events[y];if(!T)return[];if(T.fn)return[T.fn];for(var p=0,v=T.length,s=new Array(v);p<v;p++)s[p]=T[p].fn;return s},A.prototype.listenerCount=function(S){var y=O?O+S:S,T=this._events[y];return T?T.fn?1:T.length:0},A.prototype.emit=function(S,y,T,p,v,s){var t=O?O+S:S;if(!this._events[t])return!1;var r=this._events[t],e=arguments.length,f,a;if(r.fn){switch(r.once&&this.removeListener(S,r.fn,void 0,!0),e){case 1:return r.fn.call(r.context),!0;case 2:return r.fn.call(r.context,y),!0;case 3:return r.fn.call(r.context,y,T),!0;case 4:return r.fn.call(r.context,y,T,p),!0;case 5:return r.fn.call(r.context,y,T,p,v),!0;case 6:return r.fn.call(r.context,y,T,p,v,s),!0}for(a=1,f=new Array(e-1);a<e;a++)f[a-1]=arguments[a];r.fn.apply(r.context,f)}else{var i=r.length,l;for(a=0;a<i;a++)switch(r[a].once&&this.removeListener(S,r[a].fn,void 0,!0),e){case 1:r[a].fn.call(r[a].context);break;case 2:r[a].fn.call(r[a].context,y);break;case 3:r[a].fn.call(r[a].context,y,T);break;case 4:r[a].fn.call(r[a].context,y,T,p);break;default:if(!f)for(l=1,f=new Array(e-1);l<e;l++)f[l-1]=arguments[l];r[a].fn.apply(r[a].context,f)}}return!0},A.prototype.on=function(S,y,T){return I(this,S,y,T,!1)},A.prototype.once=function(S,y,T){return I(this,S,y,T,!0)},A.prototype.removeListener=function(S,y,T,p){var v=O?O+S:S;if(!this._events[v])return this;if(!y)return b(this,v),this;var s=this._events[v];if(s.fn)s.fn===y&&(!p||s.once)&&(!T||s.context===T)&&b(this,v);else{for(var t=0,r=[],e=s.length;t<e;t++)(s[t].fn!==y||p&&!s[t].once||T&&s[t].context!==T)&&r.push(s[t]);r.length?this._events[v]=r.length===1?r[0]:r:b(this,v)}return this},A.prototype.removeAllListeners=function(S){var y;return S?(y=O?O+S:S,this._events[y]&&b(this,y)):(this._events=new L,this._eventsCount=0),this},A.prototype.off=A.prototype.removeListener,A.prototype.addListener=A.prototype.on,A.prefixed=O,A.EventEmitter=A,K.exports=A},"./node_modules/url-toolkit/src/url-toolkit.js":function(K,C,E){(function(M){var O=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/?#]*\/)*[^;?#]*)?(;[^?#]*)?(\?[^#]*)?(#[^]*)?$/,L=/^([^\/?#]*)([^]*)$/,R=/(?:\/|^)\.(?=\/)/g,I=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,b={buildAbsoluteURL:function(A,c,S){if(S=S||{},A=A.trim(),c=c.trim(),!c){if(!S.alwaysNormalize)return A;var y=b.parseURL(A);if(!y)throw new Error("Error trying to parse base URL.");return y.path=b.normalizePath(y.path),b.buildURLFromParts(y)}var T=b.parseURL(c);if(!T)throw new Error("Error trying to parse relative URL.");if(T.scheme)return S.alwaysNormalize?(T.path=b.normalizePath(T.path),b.buildURLFromParts(T)):c;var p=b.parseURL(A);if(!p)throw new Error("Error trying to parse base URL.");if(!p.netLoc&&p.path&&p.path[0]!=="/"){var v=L.exec(p.path);p.netLoc=v[1],p.path=v[2]}p.netLoc&&!p.path&&(p.path="/");var s={scheme:p.scheme,netLoc:T.netLoc,path:null,params:T.params,query:T.query,fragment:T.fragment};if(!T.netLoc&&(s.netLoc=p.netLoc,T.path[0]!=="/"))if(!T.path)s.path=p.path,T.params||(s.params=p.params,T.query||(s.query=p.query));else{var t=p.path,r=t.substring(0,t.lastIndexOf("/")+1)+T.path;s.path=b.normalizePath(r)}return s.path===null&&(s.path=S.alwaysNormalize?b.normalizePath(T.path):T.path),b.buildURLFromParts(s)},parseURL:function(A){var c=O.exec(A);return c?{scheme:c[1]||"",netLoc:c[2]||"",path:c[3]||"",params:c[4]||"",query:c[5]||"",fragment:c[6]||""}:null},normalizePath:function(A){for(A=A.split("").reverse().join("").replace(R,"");A.length!==(A=A.replace(I,"")).length;);return A.split("").reverse().join("")},buildURLFromParts:function(A){return A.scheme+A.netLoc+A.path+A.params+A.query+A.fragment}};K.exports=b})()},"./node_modules/webworkify-webpack/index.js":function(K,C,E){function M(S){var y={};function T(v){if(y[v])return y[v].exports;var s=y[v]={i:v,l:!1,exports:{}};return S[v].call(s.exports,s,s.exports,T),s.l=!0,s.exports}T.m=S,T.c=y,T.i=function(v){return v},T.d=function(v,s,t){T.o(v,s)||Object.defineProperty(v,s,{configurable:!1,enumerable:!0,get:t})},T.r=function(v){Object.defineProperty(v,"__esModule",{value:!0})},T.n=function(v){var s=v&&v.__esModule?function(){return v.default}:function(){return v};return T.d(s,"a",s),s},T.o=function(v,s){return Object.prototype.hasOwnProperty.call(v,s)},T.p="/",T.oe=function(v){throw console.error(v),v};var p=T(T.s=ENTRY_MODULE);return p.default||p}var O="[\\.|\\-|\\+|\\w|/|@]+",L="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+O+").*?\\)";function R(S){return(S+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function I(S){return!isNaN(1*S)}function b(S,y,T){var p={};p[T]=[];var v=y.toString(),s=v.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!s)return p;for(var t=s[1],r=new RegExp("(\\\\n|\\W)"+R(t)+L,"g"),e;e=r.exec(v);)e[3]!=="dll-reference"&&p[T].push(e[3]);for(r=new RegExp("\\("+R(t)+'\\("(dll-reference\\s('+O+'))"\\)\\)'+L,"g");e=r.exec(v);)S[e[2]]||(p[T].push(e[1]),S[e[2]]=E(e[1]).m),p[e[2]]=p[e[2]]||[],p[e[2]].push(e[4]);for(var f=Object.keys(p),a=0;a<f.length;a++)for(var i=0;i<p[f[a]].length;i++)I(p[f[a]][i])&&(p[f[a]][i]=1*p[f[a]][i]);return p}function A(S){var y=Object.keys(S);return y.reduce(function(T,p){return T||S[p].length>0},!1)}function c(S,y){for(var T={main:[y]},p={main:[]},v={main:{}};A(T);)for(var s=Object.keys(T),t=0;t<s.length;t++){var r=s[t],e=T[r],f=e.pop();if(v[r]=v[r]||{},!(v[r][f]||!S[r][f])){v[r][f]=!0,p[r]=p[r]||[],p[r].push(f);for(var a=b(S,S[r][f],r),i=Object.keys(a),l=0;l<i.length;l++)T[i[l]]=T[i[l]]||[],T[i[l]]=T[i[l]].concat(a[i[l]])}}return p}K.exports=function(S,y){y=y||{};var T={main:E.m},p=y.all?{main:Object.keys(T.main)}:c(T,S),v="";Object.keys(p).filter(function(f){return f!=="main"}).forEach(function(f){for(var a=0;p[f][a];)a++;p[f].push(a),T[f][a]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",v=v+"var "+f+" = ("+M.toString().replace("ENTRY_MODULE",JSON.stringify(a))+")({"+p[f].map(function(i){return""+JSON.stringify(i)+": "+T[f][i].toString()}).join(",")+`});
`}),v=v+"new (("+M.toString().replace("ENTRY_MODULE",JSON.stringify(S))+")({"+p.main.map(function(f){return""+JSON.stringify(f)+": "+T.main[f].toString()}).join(",")+"}))(self);";var s=new window.Blob([v],{type:"text/javascript"});if(y.bare)return s;var t=window.URL||window.webkitURL||window.mozURL||window.msURL,r=t.createObjectURL(s),e=new window.Worker(r);return e.objectURL=r,e}},"./src/config.ts":function(K,C,E){E.r(C),E.d(C,"hlsDefaultConfig",function(){return i}),E.d(C,"mergeConfig",function(){return g}),E.d(C,"enableStreamingMode",function(){return h});var M=E("./src/controller/abr-controller.ts"),O=E("./src/controller/audio-stream-controller.ts"),L=E("./src/controller/audio-track-controller.ts"),R=E("./src/controller/subtitle-stream-controller.ts"),I=E("./src/controller/subtitle-track-controller.ts"),b=E("./src/controller/buffer-controller.ts"),A=E("./src/controller/timeline-controller.ts"),c=E("./src/controller/cap-level-controller.ts"),S=E("./src/controller/fps-controller.ts"),y=E("./src/controller/eme-controller.ts"),T=E("./src/utils/xhr-loader.ts"),p=E("./src/utils/fetch-loader.ts"),v=E("./src/utils/cues.ts"),s=E("./src/utils/mediakeys-helper.ts"),t=E("./src/utils/logger.ts");function r(){return r=Object.assign||function(o){for(var n=1;n<arguments.length;n++){var d=arguments[n];for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(o[u]=d[u])}return o},r.apply(this,arguments)}function e(o,n){var d=Object.keys(o);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(o);n&&(u=u.filter(function(m){return Object.getOwnPropertyDescriptor(o,m).enumerable})),d.push.apply(d,u)}return d}function f(o){for(var n=1;n<arguments.length;n++){var d=arguments[n]!=null?arguments[n]:{};n%2?e(Object(d),!0).forEach(function(u){a(o,u,d[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(d)):e(Object(d)).forEach(function(u){Object.defineProperty(o,u,Object.getOwnPropertyDescriptor(d,u))})}return o}function a(o,n,d){return n in o?Object.defineProperty(o,n,{value:d,enumerable:!0,configurable:!0,writable:!0}):o[n]=d,o}var i=f(f({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:60*1e3*1e3,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:T.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:M.default,bufferController:b.default,capLevelController:c.default,fpsController:S.default,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:s.requestMediaKeySystemAccess,testBandwidth:!0,progressive:!1,lowLatencyMode:!0},l()),{},{subtitleStreamController:R.SubtitleStreamController,subtitleTrackController:I.default,timelineController:A.TimelineController,audioStreamController:O.default,audioTrackController:L.default,emeController:y.default});function l(){return{cueHandler:v.default,enableCEA708Captions:!0,enableWebVTT:!0,enableIMSC1:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function g(o,n){if((n.liveSyncDurationCount||n.liveMaxLatencyDurationCount)&&(n.liveSyncDuration||n.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(n.liveMaxLatencyDurationCount!==void 0&&(n.liveSyncDurationCount===void 0||n.liveMaxLatencyDurationCount<=n.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(n.liveMaxLatencyDuration!==void 0&&(n.liveSyncDuration===void 0||n.liveMaxLatencyDuration<=n.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return r({},o,n)}function h(o){var n=o.loader;if(n!==p.default&&n!==T.default)t.logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),o.progressive=!1;else{var d=Object(p.fetchSupported)();d&&(o.loader=p.default,o.progressive=!0,o.enableSoftwareAES=!0,t.logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}}},"./src/controller/abr-controller.ts":function(K,C,E){E.r(C);var M=E("./src/polyfills/number.ts"),O=E("./src/utils/ewma-bandwidth-estimator.ts"),L=E("./src/events.ts"),R=E("./src/utils/buffer-helper.ts"),I=E("./src/errors.ts"),b=E("./src/types/loader.ts"),A=E("./src/utils/logger.ts");function c(T,p){for(var v=0;v<p.length;v++){var s=p[v];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(T,s.key,s)}}function S(T,p,v){return p&&c(T.prototype,p),v&&c(T,v),T}var y=function(){function T(v){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=v;var s=v.config;this.bwEstimator=new O.default(s.abrEwmaSlowVoD,s.abrEwmaFastVoD,s.abrEwmaDefaultEstimate),this.registerListeners()}var p=T.prototype;return p.registerListeners=function(){var s=this.hls;s.on(L.Events.FRAG_LOADING,this.onFragLoading,this),s.on(L.Events.FRAG_LOADED,this.onFragLoaded,this),s.on(L.Events.FRAG_BUFFERED,this.onFragBuffered,this),s.on(L.Events.LEVEL_LOADED,this.onLevelLoaded,this),s.on(L.Events.ERROR,this.onError,this)},p.unregisterListeners=function(){var s=this.hls;s.off(L.Events.FRAG_LOADING,this.onFragLoading,this),s.off(L.Events.FRAG_LOADED,this.onFragLoaded,this),s.off(L.Events.FRAG_BUFFERED,this.onFragBuffered,this),s.off(L.Events.LEVEL_LOADED,this.onLevelLoaded,this),s.off(L.Events.ERROR,this.onError,this)},p.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},p.onFragLoading=function(s,t){var r=t.frag;if(r.type===b.PlaylistLevelType.MAIN&&!this.timer){var e;this.fragCurrent=r,this.partCurrent=(e=t.part)!=null?e:null,this.timer=self.setInterval(this.onCheck,100)}},p.onLevelLoaded=function(s,t){var r=this.hls.config;t.details.live?this.bwEstimator.update(r.abrEwmaSlowLive,r.abrEwmaFastLive):this.bwEstimator.update(r.abrEwmaSlowVoD,r.abrEwmaFastVoD)},p._abandonRulesCheck=function(){var s=this.fragCurrent,t=this.partCurrent,r=this.hls,e=r.autoLevelEnabled,f=r.config,a=r.media;if(!(!s||!a)){var i=t?t.stats:s.stats,l=t?t.duration:s.duration;if(i.aborted){A.logger.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),this._nextAutoLevel=-1;return}if(!(!e||a.paused||!a.playbackRate||!a.readyState)){var g=performance.now()-i.loading.start,h=Math.abs(a.playbackRate);if(!(g<=500*l/h)){var o=r.levels,n=r.minAutoLevel,d=o[s.level],u=i.total||Math.max(i.loaded,Math.round(l*d.maxBitrate/8)),m=Math.max(1,i.bwEstimate?i.bwEstimate/8:i.loaded*1e3/g),x=(u-i.loaded)/m,D=a.currentTime,P=(R.BufferHelper.bufferInfo(a,D,f.maxBufferHole).end-D)/h;if(!(P>=2*l/h||x<=P)){var _=Number.POSITIVE_INFINITY,F;for(F=s.level-1;F>n;F--){var U=o[F].maxBitrate;if(_=l*U/(8*.8*m),_<P)break}if(!(_>=x)){var k=this.bwEstimator.getEstimate();A.logger.warn("Fragment "+s.sn+(t?" part "+t.index:"")+" of level "+s.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+F+`
      Current BW estimate: `+(Object(M.isFiniteNumber)(k)?(k/1024).toFixed(3):"Unknown")+` Kb/s
      Estimated load time for current fragment: `+x.toFixed(3)+` s
      Estimated load time for the next fragment: `+_.toFixed(3)+` s
      Time to underbuffer: `+P.toFixed(3)+" s"),r.nextLoadLevel=F,this.bwEstimator.sample(g,i.loaded),this.clearTimer(),s.loader&&(this.fragCurrent=this.partCurrent=null,s.loader.abort()),r.trigger(L.Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:s,part:t,stats:i})}}}}}},p.onFragLoaded=function(s,t){var r=t.frag,e=t.part;if(r.type===b.PlaylistLevelType.MAIN&&Object(M.isFiniteNumber)(r.sn)){var f=e?e.stats:r.stats,a=e?e.duration:r.duration;if(this.clearTimer(),this.lastLoadedFragLevel=r.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var i=this.hls.levels[r.level],l=(i.loaded?i.loaded.bytes:0)+f.loaded,g=(i.loaded?i.loaded.duration:0)+a;i.loaded={bytes:l,duration:g},i.realBitrate=Math.round(8*l/g)}if(r.bitrateTest){var h={stats:f,frag:r,part:e,id:r.type};this.onFragBuffered(L.Events.FRAG_BUFFERED,h),r.bitrateTest=!1}}},p.onFragBuffered=function(s,t){var r=t.frag,e=t.part,f=e?e.stats:r.stats;if(!f.aborted&&!(r.type!==b.PlaylistLevelType.MAIN||r.sn==="initSegment")){var a=f.parsing.end-f.loading.start;this.bwEstimator.sample(a,f.loaded),f.bwEstimate=this.bwEstimator.getEstimate(),r.bitrateTest?this.bitrateTestDelay=a/1e3:this.bitrateTestDelay=0}},p.onError=function(s,t){switch(t.details){case I.ErrorDetails.FRAG_LOAD_ERROR:case I.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer();break}},p.clearTimer=function(){self.clearInterval(this.timer),this.timer=void 0},p.getNextABRAutoLevel=function(){var s=this.fragCurrent,t=this.partCurrent,r=this.hls,e=r.maxAutoLevel,f=r.config,a=r.minAutoLevel,i=r.media,l=t?t.duration:s?s.duration:0,g=i?i.currentTime:0,h=i&&i.playbackRate!==0?Math.abs(i.playbackRate):1,o=this.bwEstimator?this.bwEstimator.getEstimate():f.abrEwmaDefaultEstimate,n=(R.BufferHelper.bufferInfo(i,g,f.maxBufferHole).end-g)/h,d=this.findBestLevel(o,a,e,n,f.abrBandWidthFactor,f.abrBandWidthUpFactor);if(d>=0)return d;A.logger.trace((n?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var u=l?Math.min(l,f.maxStarvationDelay):f.maxStarvationDelay,m=f.abrBandWidthFactor,x=f.abrBandWidthUpFactor;if(!n){var D=this.bitrateTestDelay;if(D){var P=l?Math.min(l,f.maxLoadingDelay):f.maxLoadingDelay;u=P-D,A.logger.trace("bitrate test took "+Math.round(1e3*D)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*u)+" ms"),m=x=1}}return d=this.findBestLevel(o,a,e,n+u,m,x),Math.max(d,0)},p.findBestLevel=function(s,t,r,e,f,a){for(var i,l=this.fragCurrent,g=this.partCurrent,h=this.lastLoadedFragLevel,o=this.hls.levels,n=o[h],d=!!(n!=null&&(i=n.details)!==null&&i!==void 0&&i.live),u=n==null?void 0:n.codecSet,m=g?g.duration:l?l.duration:0,x=r;x>=t;x--){var D=o[x];if(!(!D||u&&D.codecSet!==u)){var P=D.details,_=(g?P==null?void 0:P.partTarget:P==null?void 0:P.averagetargetduration)||m,F=void 0;x<=h?F=f*s:F=a*s;var U=o[x].maxBitrate,k=U*_/F;if(A.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+x+"/"+Math.round(F)+"/"+U+"/"+_+"/"+e+"/"+k),F>U&&(!k||d&&!this.bitrateTestDelay||k<e))return x}}return-1},S(T,[{key:"nextAutoLevel",get:function(){var s=this._nextAutoLevel,t=this.bwEstimator;if(s!==-1&&(!t||!t.canEstimate()))return s;var r=this.getNextABRAutoLevel();return s!==-1&&(r=Math.min(s,r)),r},set:function(s){this._nextAutoLevel=s}}]),T}();C.default=y},"./src/controller/audio-stream-controller.ts":function(K,C,E){E.r(C);var M=E("./src/polyfills/number.ts"),O=E("./src/controller/base-stream-controller.ts"),L=E("./src/events.ts"),R=E("./src/utils/buffer-helper.ts"),I=E("./src/controller/fragment-tracker.ts"),b=E("./src/types/level.ts"),A=E("./src/types/loader.ts"),c=E("./src/loader/fragment.ts"),S=E("./src/demux/chunk-cache.ts"),y=E("./src/demux/transmuxer-interface.ts"),T=E("./src/types/transmuxer.ts"),p=E("./src/controller/fragment-finders.ts"),v=E("./src/utils/discontinuities.ts"),s=E("./src/errors.ts"),t=E("./src/utils/logger.ts");function r(){return r=Object.assign||function(l){for(var g=1;g<arguments.length;g++){var h=arguments[g];for(var o in h)Object.prototype.hasOwnProperty.call(h,o)&&(l[o]=h[o])}return l},r.apply(this,arguments)}function e(l,g){l.prototype=Object.create(g.prototype),l.prototype.constructor=l,f(l,g)}function f(l,g){return f=Object.setPrototypeOf||function(o,n){return o.__proto__=n,o},f(l,g)}var a=100,i=function(l){e(g,l);function g(o,n){var d;return d=l.call(this,o,n,"[audio-stream-controller]")||this,d.videoBuffer=null,d.videoTrackCC=-1,d.waitingVideoCC=-1,d.audioSwitch=!1,d.trackId=-1,d.waitingData=null,d.mainDetails=null,d.bufferFlushed=!1,d._registerListeners(),d}var h=g.prototype;return h.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},h._registerListeners=function(){var n=this.hls;n.on(L.Events.MEDIA_ATTACHED,this.onMediaAttached,this),n.on(L.Events.MEDIA_DETACHING,this.onMediaDetaching,this),n.on(L.Events.MANIFEST_LOADING,this.onManifestLoading,this),n.on(L.Events.LEVEL_LOADED,this.onLevelLoaded,this),n.on(L.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),n.on(L.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),n.on(L.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),n.on(L.Events.ERROR,this.onError,this),n.on(L.Events.BUFFER_RESET,this.onBufferReset,this),n.on(L.Events.BUFFER_CREATED,this.onBufferCreated,this),n.on(L.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),n.on(L.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),n.on(L.Events.FRAG_BUFFERED,this.onFragBuffered,this)},h._unregisterListeners=function(){var n=this.hls;n.off(L.Events.MEDIA_ATTACHED,this.onMediaAttached,this),n.off(L.Events.MEDIA_DETACHING,this.onMediaDetaching,this),n.off(L.Events.MANIFEST_LOADING,this.onManifestLoading,this),n.off(L.Events.LEVEL_LOADED,this.onLevelLoaded,this),n.off(L.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),n.off(L.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),n.off(L.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),n.off(L.Events.ERROR,this.onError,this),n.off(L.Events.BUFFER_RESET,this.onBufferReset,this),n.off(L.Events.BUFFER_CREATED,this.onBufferCreated,this),n.off(L.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),n.off(L.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),n.off(L.Events.FRAG_BUFFERED,this.onFragBuffered,this)},h.onInitPtsFound=function(n,d){var u=d.frag,m=d.id,x=d.initPTS;if(m==="main"){var D=u.cc;this.initPTS[u.cc]=x,this.log("InitPTS for cc: "+D+" found from main: "+x),this.videoTrackCC=D,this.state===O.State.WAITING_INIT_PTS&&this.tick()}},h.startLoad=function(n){if(!this.levels){this.startPosition=n,this.state=O.State.STOPPED;return}var d=this.lastCurrentTime;this.stopLoad(),this.setInterval(a),this.fragLoadError=0,d>0&&n===-1?(this.log("Override startPosition with lastCurrentTime @"+d.toFixed(3)),this.state=O.State.IDLE):(this.loadedmetadata=!1,this.state=O.State.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=n,this.tick()},h.doTick=function(){switch(this.state){case O.State.IDLE:this.doTickIdle();break;case O.State.WAITING_TRACK:{var n,d=this.levels,u=this.trackId,m=d==null||(n=d[u])===null||n===void 0?void 0:n.details;if(m){if(this.waitForCdnTuneIn(m))break;this.state=O.State.WAITING_INIT_PTS}break}case O.State.FRAG_LOADING_WAITING_RETRY:{var x,D=performance.now(),P=this.retryDate;(!P||D>=P||(x=this.media)!==null&&x!==void 0&&x.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.state=O.State.IDLE);break}case O.State.WAITING_INIT_PTS:{var _=this.waitingData;if(_){var F=_.frag,U=_.part,k=_.cache,N=_.complete;if(this.initPTS[F.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=O.State.FRAG_LOADING;var w=k.flush(),V={frag:F,part:U,payload:w,networkDetails:null};this._handleFragmentLoadProgress(V),N&&l.prototype._handleFragmentLoadComplete.call(this,V)}else if(this.videoTrackCC!==this.waitingVideoCC)t.logger.log("Waiting fragment cc ("+F.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var W=this.getLoadPosition(),Y=R.BufferHelper.bufferInfo(this.mediaBuffer,W,this.config.maxBufferHole),j=Object(p.fragmentWithinToleranceTest)(Y.end,this.config.maxFragLookUpTolerance,F);j<0&&(t.logger.log("Waiting fragment cc ("+F.cc+") @ "+F.start+" cancelled because another fragment at "+Y.end+" is needed"),this.clearWaitingFragment())}}else this.state=O.State.IDLE}}this.onTickEnd()},h.clearWaitingFragment=function(){var n=this.waitingData;n&&(this.fragmentTracker.removeFragment(n.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=O.State.IDLE)},h.onTickEnd=function(){var n=this.media;if(!(!n||!n.readyState)){var d=this.mediaBuffer?this.mediaBuffer:n,u=d.buffered;!this.loadedmetadata&&u.length&&(this.loadedmetadata=!0),this.lastCurrentTime=n.currentTime}},h.doTickIdle=function(){var n,d,u=this.hls,m=this.levels,x=this.media,D=this.trackId,P=u.config;if(!(!m||!m[D])&&!(!x&&(this.startFragRequested||!P.startFragPrefetch))){var _=m[D],F=_.details;if(!F||F.live&&this.levelLastLoaded!==D||this.waitForCdnTuneIn(F)){this.state=O.State.WAITING_TRACK;return}this.bufferFlushed&&(this.bufferFlushed=!1,this.afterBufferFlushed(this.mediaBuffer?this.mediaBuffer:this.media,c.ElementaryStreamTypes.AUDIO,A.PlaylistLevelType.AUDIO));var U=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,A.PlaylistLevelType.AUDIO);if(U!==null){var k=U.len,N=this.getMaxBufferLength(),w=this.audioSwitch;if(!(k>=N&&!w)){if(!w&&this._streamEnded(U,F)){u.trigger(L.Events.BUFFER_EOS,{type:"audio"}),this.state=O.State.ENDED;return}var V=F.fragments,W=V[0].start,Y=U.end;if(w){var j=this.getLoadPosition();Y=j,F.PTSKnown&&j<W&&(U.end>W||U.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),x.currentTime=W+.05)}var X=this.getNextFragment(Y,F);if(!X){this.bufferFlushed=!0;return}((n=X.decryptdata)===null||n===void 0?void 0:n.keyFormat)==="identity"&&!((d=X.decryptdata)!==null&&d!==void 0&&d.key)?this.loadKey(X,F):this.loadFragment(X,F,Y)}}}},h.getMaxBufferLength=function(){var n=l.prototype.getMaxBufferLength.call(this),d=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,A.PlaylistLevelType.MAIN);return d===null?n:Math.max(n,d.len)},h.onMediaDetaching=function(){this.videoBuffer=null,l.prototype.onMediaDetaching.call(this)},h.onAudioTracksUpdated=function(n,d){var u=d.audioTracks;this.resetTransmuxer(),this.levels=u.map(function(m){return new b.Level(m)})},h.onAudioTrackSwitching=function(n,d){var u=!!d.url;this.trackId=d.id;var m=this.fragCurrent;m!=null&&m.loader&&m.loader.abort(),this.fragCurrent=null,this.clearWaitingFragment(),u?this.setInterval(a):this.resetTransmuxer(),u?(this.audioSwitch=!0,this.state=O.State.IDLE):this.state=O.State.STOPPED,this.tick()},h.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1},h.onLevelLoaded=function(n,d){this.mainDetails=d.details},h.onAudioTrackLoaded=function(n,d){var u,m=this.levels,x=d.details,D=d.id;if(!m){this.warn("Audio tracks were reset while loading level "+D);return}this.log("Track "+D+" loaded ["+x.startSN+","+x.endSN+"],duration:"+x.totalduration);var P=m[D],_=0;if(x.live||(u=P.details)!==null&&u!==void 0&&u.live){var F=this.mainDetails;if(x.fragments[0]||(x.deltaUpdateFailed=!0),x.deltaUpdateFailed||!F)return;!P.details&&x.hasProgramDateTime&&F.hasProgramDateTime?(Object(v.alignPDT)(x,F),_=x.fragments[0].start):_=this.alignPlaylists(x,P.details)}P.details=x,this.levelLastLoaded=D,!this.startFragRequested&&(this.mainDetails||!x.live)&&this.setStartPosition(P.details,_),this.state===O.State.WAITING_TRACK&&!this.waitForCdnTuneIn(x)&&(this.state=O.State.IDLE),this.tick()},h._handleFragmentLoadProgress=function(n){var d,u=n.frag,m=n.part,x=n.payload,D=this.config,P=this.trackId,_=this.levels;if(!_){this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+u.sn+" of level "+u.level+" will not be buffered");return}var F=_[P];console.assert(F,"Audio track is defined on fragment load progress");var U=F.details;console.assert(U,"Audio track details are defined on fragment load progress");var k=D.defaultAudioCodec||F.audioCodec||"mp4a.40.2",N=this.transmuxer;N||(N=this.transmuxer=new y.default(this.hls,A.PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var w=this.initPTS[u.cc],V=(d=u.initSegment)===null||d===void 0?void 0:d.data;if(w!==void 0){var W=!1,Y=m?m.index:-1,j=Y!==-1,X=new T.ChunkMetadata(u.level,u.sn,u.stats.chunkCount,x.byteLength,Y,j);N.push(x,V,k,"",u,m,U.totalduration,W,X,w)}else{t.logger.log("Unknown video PTS for cc "+u.cc+", waiting for video PTS before demuxing audio frag "+u.sn+" of ["+U.startSN+" ,"+U.endSN+"],track "+P);var $=this.waitingData=this.waitingData||{frag:u,part:m,cache:new S.default,complete:!1},Q=$.cache;Q.push(new Uint8Array(x)),this.waitingVideoCC=this.videoTrackCC,this.state=O.State.WAITING_INIT_PTS}},h._handleFragmentLoadComplete=function(n){if(this.waitingData){this.waitingData.complete=!0;return}l.prototype._handleFragmentLoadComplete.call(this,n)},h.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},h.onBufferCreated=function(n,d){var u=d.tracks.audio;u&&(this.mediaBuffer=u.buffer),d.tracks.video&&(this.videoBuffer=d.tracks.video.buffer)},h.onFragBuffered=function(n,d){var u=d.frag,m=d.part;if(u.type===A.PlaylistLevelType.AUDIO){if(this.fragContextChanged(u)){this.warn("Fragment "+u.sn+(m?" p: "+m.index:"")+" of level "+u.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch);return}u.sn!=="initSegment"&&(this.fragPrevious=u,this.audioSwitch&&(this.audioSwitch=!1,this.hls.trigger(L.Events.AUDIO_TRACK_SWITCHED,{id:this.trackId}))),this.fragBufferedComplete(u,m)}},h.onError=function(n,d){switch(d.details){case s.ErrorDetails.FRAG_LOAD_ERROR:case s.ErrorDetails.FRAG_LOAD_TIMEOUT:case s.ErrorDetails.KEY_LOAD_ERROR:case s.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(A.PlaylistLevelType.AUDIO,d);break;case s.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case s.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:this.state!==O.State.ERROR&&this.state!==O.State.STOPPED&&(this.state=d.fatal?O.State.ERROR:O.State.IDLE,this.warn(d.details+" while loading frag, switching to "+this.state+" state"));break;case s.ErrorDetails.BUFFER_FULL_ERROR:if(d.parent==="audio"&&(this.state===O.State.PARSING||this.state===O.State.PARSED)){var u=!0,m=this.getFwdBufferInfo(this.mediaBuffer,A.PlaylistLevelType.AUDIO);m&&m.len>.5&&(u=!this.reduceMaxBufferLength(m.len)),u&&(this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,l.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.resetLoadingState()}break}},h.onBufferFlushed=function(n,d){var u=d.type;u===c.ElementaryStreamTypes.AUDIO&&(this.bufferFlushed=!0)},h._handleTransmuxComplete=function(n){var d,u="audio",m=this.hls,x=n.remuxResult,D=n.chunkMeta,P=this.getCurrentContext(D);if(!P){this.warn("The loading context changed while buffering fragment "+D.sn+" of level "+D.level+". This chunk will not be buffered."),this.resetLiveStartWhenNotLoaded(D.level);return}var _=P.frag,F=P.part,U=x.audio,k=x.text,N=x.id3,w=x.initSegment;if(!this.fragContextChanged(_)){if(this.state=O.State.PARSING,this.audioSwitch&&U&&this.completeAudioSwitch(),w!=null&&w.tracks&&(this._bufferInitSegment(w.tracks,_,D),m.trigger(L.Events.FRAG_PARSING_INIT_SEGMENT,{frag:_,id:u,tracks:w.tracks})),U){var V=U.startPTS,W=U.endPTS,Y=U.startDTS,j=U.endDTS;F&&(F.elementaryStreams[c.ElementaryStreamTypes.AUDIO]={startPTS:V,endPTS:W,startDTS:Y,endDTS:j}),_.setElementaryStreamInfo(c.ElementaryStreamTypes.AUDIO,V,W,Y,j),this.bufferFragmentData(U,_,F,D)}if(N!=null&&(d=N.samples)!==null&&d!==void 0&&d.length){var X=r({frag:_,id:u},N);m.trigger(L.Events.FRAG_PARSING_METADATA,X)}if(k){var $=r({frag:_,id:u},k);m.trigger(L.Events.FRAG_PARSING_USERDATA,$)}}},h._bufferInitSegment=function(n,d,u){if(this.state===O.State.PARSING){n.video&&delete n.video;var m=n.audio;if(!!m){m.levelCodec=m.codec,m.id="audio",this.log("Init audio buffer, container:"+m.container+", codecs[parsed]=["+m.codec+"]"),this.hls.trigger(L.Events.BUFFER_CODECS,n);var x=m.initSegment;if(x!=null&&x.byteLength){var D={type:"audio",frag:d,part:null,chunkMeta:u,parent:d.type,data:x};this.hls.trigger(L.Events.BUFFER_APPENDING,D)}this.tick()}}},h.loadFragment=function(n,d,u){var m=this.fragmentTracker.getState(n);this.fragCurrent=n,(this.audioSwitch||m===I.FragmentState.NOT_LOADED||m===I.FragmentState.PARTIAL)&&(n.sn==="initSegment"?this._loadInitSegment(n):d.live&&!Object(M.isFiniteNumber)(this.initPTS[n.cc])?(this.log("Waiting for video PTS in continuity counter "+n.cc+" of live stream before loading audio fragment "+n.sn+" of level "+this.trackId),this.state=O.State.WAITING_INIT_PTS):(this.startFragRequested=!0,l.prototype.loadFragment.call(this,n,d,u)))},h.completeAudioSwitch=function(){var n=this.hls,d=this.media,u=this.trackId;d&&(this.log("Switching audio track : flushing all audio"),l.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.audioSwitch=!1,n.trigger(L.Events.AUDIO_TRACK_SWITCHED,{id:u})},g}(O.default);C.default=i},"./src/controller/audio-track-controller.ts":function(K,C,E){E.r(C);var M=E("./src/events.ts"),O=E("./src/errors.ts"),L=E("./src/controller/base-playlist-controller.ts"),R=E("./src/types/loader.ts");function I(y,T){for(var p=0;p<T.length;p++){var v=T[p];v.enumerable=v.enumerable||!1,v.configurable=!0,"value"in v&&(v.writable=!0),Object.defineProperty(y,v.key,v)}}function b(y,T,p){return T&&I(y.prototype,T),p&&I(y,p),y}function A(y,T){y.prototype=Object.create(T.prototype),y.prototype.constructor=y,c(y,T)}function c(y,T){return c=Object.setPrototypeOf||function(v,s){return v.__proto__=s,v},c(y,T)}var S=function(y){A(T,y);function T(v){var s;return s=y.call(this,v,"[audio-track-controller]")||this,s.tracks=[],s.groupId=null,s.tracksInGroup=[],s.trackId=-1,s.trackName="",s.selectDefaultTrack=!0,s.registerListeners(),s}var p=T.prototype;return p.registerListeners=function(){var s=this.hls;s.on(M.Events.MANIFEST_LOADING,this.onManifestLoading,this),s.on(M.Events.MANIFEST_PARSED,this.onManifestParsed,this),s.on(M.Events.LEVEL_LOADING,this.onLevelLoading,this),s.on(M.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),s.on(M.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),s.on(M.Events.ERROR,this.onError,this)},p.unregisterListeners=function(){var s=this.hls;s.off(M.Events.MANIFEST_LOADING,this.onManifestLoading,this),s.off(M.Events.MANIFEST_PARSED,this.onManifestParsed,this),s.off(M.Events.LEVEL_LOADING,this.onLevelLoading,this),s.off(M.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),s.off(M.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),s.off(M.Events.ERROR,this.onError,this)},p.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,y.prototype.destroy.call(this)},p.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.trackName="",this.selectDefaultTrack=!0},p.onManifestParsed=function(s,t){this.tracks=t.audioTracks||[]},p.onAudioTrackLoaded=function(s,t){var r=t.id,e=t.details,f=this.tracksInGroup[r];if(!f){this.warn("Invalid audio track id "+r);return}var a=f.details;f.details=t.details,this.log("audioTrack "+r+" loaded ["+e.startSN+"-"+e.endSN+"]"),r===this.trackId&&(this.retryCount=0,this.playlistLoaded(r,t,a))},p.onLevelLoading=function(s,t){this.switchLevel(t.level)},p.onLevelSwitching=function(s,t){this.switchLevel(t.level)},p.switchLevel=function(s){var t=this.hls.levels[s];if(!!(t!=null&&t.audioGroupIds)){var r=t.audioGroupIds[t.urlId];if(this.groupId!==r){this.groupId=r;var e=this.tracks.filter(function(a){return!r||a.groupId===r});this.selectDefaultTrack&&!e.some(function(a){return a.default})&&(this.selectDefaultTrack=!1),this.tracksInGroup=e;var f={audioTracks:e};this.log("Updating audio tracks, "+e.length+' track(s) found in "'+r+'" group-id'),this.hls.trigger(M.Events.AUDIO_TRACKS_UPDATED,f),this.selectInitialTrack()}}},p.onError=function(s,t){y.prototype.onError.call(this,s,t),!(t.fatal||!t.context)&&t.context.type===R.PlaylistContextType.AUDIO_TRACK&&t.context.id===this.trackId&&t.context.groupId===this.groupId&&this.retryLoadingOrFail(t)},p.setAudioTrack=function(s){var t=this.tracksInGroup;if(s<0||s>=t.length){this.warn("Invalid id passed to audio-track controller");return}this.clearTimer();var r=t[this.trackId];this.log("Now switching to audio-track index "+s);var e=t[s],f=e.id,a=e.groupId,i=a===void 0?"":a,l=e.name,g=e.type,h=e.url;if(this.trackId=s,this.trackName=l,this.selectDefaultTrack=!1,this.hls.trigger(M.Events.AUDIO_TRACK_SWITCHING,{id:f,groupId:i,name:l,type:g,url:h}),!(e.details&&!e.details.live)){var o=this.switchParams(e.url,r==null?void 0:r.details);this.loadPlaylist(o)}},p.selectInitialTrack=function(){var s=this.tracksInGroup;console.assert(s.length,"Initial audio track should be selected when tracks are known");var t=this.trackName,r=this.findTrackId(t)||this.findTrackId();r!==-1?this.setAudioTrack(r):(this.warn("No track found for running audio group-ID: "+this.groupId),this.hls.trigger(M.Events.ERROR,{type:O.ErrorTypes.MEDIA_ERROR,details:O.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))},p.findTrackId=function(s){for(var t=this.tracksInGroup,r=0;r<t.length;r++){var e=t[r];if((!this.selectDefaultTrack||e.default)&&(!s||s===e.name))return e.id}return-1},p.loadPlaylist=function(s){var t=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(t)){var r=t.id,e=t.groupId,f=t.url;if(s)try{f=s.addDirectives(f)}catch(a){this.warn("Could not construct new URL with HLS Delivery Directives: "+a)}this.log("loading audio-track playlist for id: "+r),this.clearTimer(),this.hls.trigger(M.Events.AUDIO_TRACK_LOADING,{url:f,id:r,groupId:e,deliveryDirectives:s||null})}},b(T,[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(s){this.selectDefaultTrack=!1,this.setAudioTrack(s)}}]),T}(L.default);C.default=S},"./src/controller/base-playlist-controller.ts":function(K,C,E){E.r(C),E.d(C,"default",function(){return b});var M=E("./src/polyfills/number.ts"),O=E("./src/types/level.ts"),L=E("./src/controller/level-helper.ts"),R=E("./src/utils/logger.ts"),I=E("./src/errors.ts"),b=function(){function A(S,y){this.hls=void 0,this.timer=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=R.logger.log.bind(R.logger,y+":"),this.warn=R.logger.warn.bind(R.logger,y+":"),this.hls=S}var c=A.prototype;return c.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},c.onError=function(y,T){T.fatal&&T.type===I.ErrorTypes.NETWORK_ERROR&&this.clearTimer()},c.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},c.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.loadPlaylist()},c.stopLoad=function(){this.canLoad=!1,this.clearTimer()},c.switchParams=function(y,T){var p=T==null?void 0:T.renditionReports;if(p)for(var v=0;v<p.length;v++){var s=p[v],t=""+s.URI;if(t===y.substr(-t.length)){var r=parseInt(s["LAST-MSN"]),e=parseInt(s["LAST-PART"]);if(T&&this.hls.config.lowLatencyMode){var f=Math.min(T.age-T.partTarget,T.targetduration);e!==void 0&&f>T.partTarget&&(e+=1)}if(Object(M.isFiniteNumber)(r))return new O.HlsUrlParameters(r,Object(M.isFiniteNumber)(e)?e:void 0,O.HlsSkip.No)}}},c.loadPlaylist=function(y){},c.shouldLoadTrack=function(y){return this.canLoad&&y&&!!y.url&&(!y.details||y.details.live)},c.playlistLoaded=function(y,T,p){var v=this,s=T.details,t=T.stats,r=t.loading.end?Math.max(0,self.performance.now()-t.loading.end):0;if(s.advancedDateTime=Date.now()-r,s.live||p!=null&&p.live){if(s.reloaded(p),p&&this.log("live playlist "+y+" "+(s.advanced?"REFRESHED "+s.lastPartSn+"-"+s.lastPartIndex:"MISSED")),p&&s.fragments.length>0&&Object(L.mergeDetails)(p,s),!this.canLoad||!s.live)return;var e,f=void 0,a=void 0;if(s.canBlockReload&&s.endSN&&s.advanced){var i=this.hls.config.lowLatencyMode,l=s.lastPartSn,g=s.endSN,h=s.lastPartIndex,o=h!==-1,n=l===g,d=i?0:h;o?(f=n?g+1:l,a=n?d:h+1):f=g+1;var u=s.age,m=u+s.ageHeader,x=Math.min(m-s.partTarget,s.targetduration*1.5);if(x>0){if(p&&x>p.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+p.tuneInGoal+" to: "+x+" with playlist age: "+s.age),x=0;else{var D=Math.floor(x/s.targetduration);if(f+=D,a!==void 0){var P=Math.round(x%s.targetduration/s.partTarget);a+=P}this.log("CDN Tune-in age: "+s.ageHeader+"s last advanced "+u.toFixed(2)+"s goal: "+x+" skip sn "+D+" to part "+a)}s.tuneInGoal=x}if(e=this.getDeliveryDirectives(s,T.deliveryDirectives,f,a),i||!n){this.loadPlaylist(e);return}}else e=this.getDeliveryDirectives(s,T.deliveryDirectives,f,a);var _=Object(L.computeReloadInterval)(s,t);f!==void 0&&s.canBlockReload&&(_-=s.partTarget||1),this.log("reload live playlist "+y+" in "+Math.round(_)+" ms"),this.timer=self.setTimeout(function(){return v.loadPlaylist(e)},_)}else this.clearTimer()},c.getDeliveryDirectives=function(y,T,p,v){var s=Object(O.getSkipValue)(y,p);return T!=null&&T.skip&&y.deltaUpdateFailed&&(p=T.msn,v=T.part,s=O.HlsSkip.No),new O.HlsUrlParameters(p,v,s)},c.retryLoadingOrFail=function(y){var T=this,p=this.hls.config,v=this.retryCount<p.levelLoadingMaxRetry;if(v){var s;if(this.retryCount++,y.details.indexOf("LoadTimeOut")>-1&&(s=y.context)!==null&&s!==void 0&&s.deliveryDirectives)this.warn("retry playlist loading #"+this.retryCount+' after "'+y.details+'"'),this.loadPlaylist();else{var t=Math.min(Math.pow(2,this.retryCount)*p.levelLoadingRetryDelay,p.levelLoadingMaxRetryTimeout);this.timer=self.setTimeout(function(){return T.loadPlaylist()},t),this.warn("retry playlist loading #"+this.retryCount+" in "+t+' ms after "'+y.details+'"')}}else this.warn('cannot recover from error "'+y.details+'"'),this.clearTimer(),y.fatal=!0;return v},A}()},"./src/controller/base-stream-controller.ts":function(K,C,E){E.r(C),E.d(C,"State",function(){return g}),E.d(C,"default",function(){return h});var M=E("./src/polyfills/number.ts"),O=E("./src/task-loop.ts"),L=E("./src/controller/fragment-tracker.ts"),R=E("./src/utils/buffer-helper.ts"),I=E("./src/utils/logger.ts"),b=E("./src/events.ts"),A=E("./src/errors.ts"),c=E("./src/types/transmuxer.ts"),S=E("./src/utils/mp4-tools.ts"),y=E("./src/utils/discontinuities.ts"),T=E("./src/controller/fragment-finders.ts"),p=E("./src/controller/level-helper.ts"),v=E("./src/loader/fragment-loader.ts"),s=E("./src/crypt/decrypter.ts"),t=E("./src/utils/time-ranges.ts"),r=E("./src/types/loader.ts");function e(o,n){for(var d=0;d<n.length;d++){var u=n[d];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(o,u.key,u)}}function f(o,n,d){return n&&e(o.prototype,n),d&&e(o,d),o}function a(o){if(o===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o}function i(o,n){o.prototype=Object.create(n.prototype),o.prototype.constructor=o,l(o,n)}function l(o,n){return l=Object.setPrototypeOf||function(u,m){return u.__proto__=m,u},l(o,n)}var g={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BACKTRACKING:"BACKTRACKING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},h=function(o){i(n,o);function n(u,m,x){var D;return D=o.call(this)||this,D.hls=void 0,D.fragPrevious=null,D.fragCurrent=null,D.fragmentTracker=void 0,D.transmuxer=null,D._state=g.STOPPED,D.media=void 0,D.mediaBuffer=void 0,D.config=void 0,D.bitrateTest=!1,D.lastCurrentTime=0,D.nextLoadPosition=0,D.startPosition=0,D.loadedmetadata=!1,D.fragLoadError=0,D.retryDate=0,D.levels=null,D.fragmentLoader=void 0,D.levelLastLoaded=null,D.startFragRequested=!1,D.decrypter=void 0,D.initPTS=[],D.onvseeking=null,D.onvended=null,D.logPrefix="",D.log=void 0,D.warn=void 0,D.logPrefix=x,D.log=I.logger.log.bind(I.logger,x+":"),D.warn=I.logger.warn.bind(I.logger,x+":"),D.hls=u,D.fragmentLoader=new v.default(u.config),D.fragmentTracker=m,D.config=u.config,D.decrypter=new s.default(u,u.config),u.on(b.Events.KEY_LOADED,D.onKeyLoaded,a(D)),D}var d=n.prototype;return d.doTick=function(){this.onTickEnd()},d.onTickEnd=function(){},d.startLoad=function(m){},d.stopLoad=function(){this.fragmentLoader.abort();var m=this.fragCurrent;m&&this.fragmentTracker.removeFragment(m),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=g.STOPPED},d._streamEnded=function(m,x){var D=this.fragCurrent,P=this.fragmentTracker;if(!x.live&&D&&D.sn===x.endSN&&!m.nextStart){var _=P.getState(D);return _===L.FragmentState.PARTIAL||_===L.FragmentState.OK}return!1},d.onMediaAttached=function(m,x){var D=this.media=this.mediaBuffer=x.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),D.addEventListener("seeking",this.onvseeking),D.addEventListener("ended",this.onvended);var P=this.config;this.levels&&P.autoStartLoad&&this.state===g.STOPPED&&this.startLoad(P.startPosition)},d.onMediaDetaching=function(){var m=this.media;m!=null&&m.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),m&&(m.removeEventListener("seeking",this.onvseeking),m.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},d.onMediaSeeking=function(){var m=this.config,x=this.fragCurrent,D=this.media,P=this.mediaBuffer,_=this.state,F=D?D.currentTime:0,U=R.BufferHelper.bufferInfo(P||D,F,m.maxBufferHole);if(this.log("media seeking to "+(Object(M.isFiniteNumber)(F)?F.toFixed(3):F)+", state: "+_),_===g.ENDED)this.resetLoadingState();else if(x&&!U.len){var k=m.maxFragLookUpTolerance,N=x.start-k,w=x.start+x.duration+k,V=F>w;(F<N||V)&&(V&&x.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),x.loader.abort()),this.resetLoadingState())}D&&(this.lastCurrentTime=F),!this.loadedmetadata&&!U.len&&(this.nextLoadPosition=this.startPosition=F),this.tickImmediate()},d.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},d.onKeyLoaded=function(m,x){if(!(this.state!==g.KEY_LOADING||x.frag!==this.fragCurrent||!this.levels)){this.state=g.IDLE;var D=this.levels[x.frag.level].details;D&&this.loadFragment(x.frag,D,x.frag.start)}},d.onHandlerDestroying=function(){this.stopLoad(),o.prototype.onHandlerDestroying.call(this)},d.onHandlerDestroyed=function(){this.state=g.STOPPED,this.hls.off(b.Events.KEY_LOADED,this.onKeyLoaded,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.fragmentLoader=this.fragmentTracker=null,o.prototype.onHandlerDestroyed.call(this)},d.loadKey=function(m,x){this.log("Loading key for "+m.sn+" of ["+x.startSN+"-"+x.endSN+"], "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+m.level),this.state=g.KEY_LOADING,this.fragCurrent=m,this.hls.trigger(b.Events.KEY_LOADING,{frag:m})},d.loadFragment=function(m,x,D){this._loadFragForPlayback(m,x,D)},d._loadFragForPlayback=function(m,x,D){var P=this,_=function(U){if(P.fragContextChanged(m)){P.warn("Fragment "+m.sn+(U.part?" p: "+U.part.index:"")+" of level "+m.level+" was dropped during download."),P.fragmentTracker.removeFragment(m);return}m.stats.chunkCount++,P._handleFragmentLoadProgress(U)};this._doFragLoad(m,x,D,_).then(function(F){if(!!F){P.fragLoadError=0;var U=P.state;if(P.fragContextChanged(m)){(U===g.FRAG_LOADING||U===g.BACKTRACKING||!P.fragCurrent&&U===g.PARSING)&&(P.fragmentTracker.removeFragment(m),P.state=g.IDLE);return}if("payload"in F&&(P.log("Loaded fragment "+m.sn+" of level "+m.level),P.hls.trigger(b.Events.FRAG_LOADED,F),P.state===g.BACKTRACKING)){P.fragmentTracker.backtrack(m,F),P.resetFragmentLoading(m);return}P._handleFragmentLoadComplete(F)}}).catch(function(F){P.warn(F),P.resetFragmentLoading(m)})},d.flushMainBuffer=function(m,x,D){if(D===void 0&&(D=null),!!(m-x)){var P={startOffset:m,endOffset:x,type:D};this.fragLoadError=0,this.hls.trigger(b.Events.BUFFER_FLUSHING,P)}},d._loadInitSegment=function(m){var x=this;this._doFragLoad(m).then(function(D){if(!D||x.fragContextChanged(m)||!x.levels)throw new Error("init load aborted");return D}).then(function(D){var P=x.hls,_=D.payload,F=m.decryptdata;if(_&&_.byteLength>0&&F&&F.key&&F.iv&&F.method==="AES-128"){var U=self.performance.now();return x.decrypter.webCryptoDecrypt(new Uint8Array(_),F.key.buffer,F.iv.buffer).then(function(k){var N=self.performance.now();return P.trigger(b.Events.FRAG_DECRYPTED,{frag:m,payload:k,stats:{tstart:U,tdecrypt:N}}),D.payload=k,D})}return D}).then(function(D){var P=x.fragCurrent,_=x.hls,F=x.levels;if(!F)throw new Error("init load aborted, missing levels");var U=F[m.level].details;console.assert(U,"Level details are defined when init segment is loaded");var k=m.stats;x.state=g.IDLE,x.fragLoadError=0,m.data=new Uint8Array(D.payload),k.parsing.start=k.buffering.start=self.performance.now(),k.parsing.end=k.buffering.end=self.performance.now(),D.frag===P&&_.trigger(b.Events.FRAG_BUFFERED,{stats:k,frag:P,part:null,id:m.type}),x.tick()}).catch(function(D){x.warn(D),x.resetFragmentLoading(m)})},d.fragContextChanged=function(m){var x=this.fragCurrent;return!m||!x||m.level!==x.level||m.sn!==x.sn||m.urlId!==x.urlId},d.fragBufferedComplete=function(m,x){var D=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+m.type+" sn: "+m.sn+(x?" part: "+x.index:"")+" of "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+m.level+" "+t.default.toString(R.BufferHelper.getBuffered(D))),this.state=g.IDLE,this.tick()},d._handleFragmentLoadComplete=function(m){var x=this.transmuxer;if(!!x){var D=m.frag,P=m.part,_=m.partsLoaded,F=!_||_.length===0||_.some(function(k){return!k}),U=new c.ChunkMetadata(D.level,D.sn,D.stats.chunkCount+1,0,P?P.index:-1,!F);x.flush(U)}},d._handleFragmentLoadProgress=function(m){},d._doFragLoad=function(m,x,D,P){var _=this;if(D===void 0&&(D=null),!this.levels)throw new Error("frag load aborted, missing levels");if(D=Math.max(m.start,D||0),this.config.lowLatencyMode&&x){var F=x.partList;if(F&&P){D>m.end&&x.fragmentHint&&(m=x.fragmentHint);var U=this.getNextPart(F,m,D);if(U>-1){var k=F[U];return this.log("Loading part sn: "+m.sn+" p: "+k.index+" cc: "+m.cc+" of playlist ["+x.startSN+"-"+x.endSN+"] parts [0-"+U+"-"+(F.length-1)+"] "+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+m.level+", target: "+parseFloat(D.toFixed(3))),this.nextLoadPosition=k.start+k.duration,this.state=g.FRAG_LOADING,this.hls.trigger(b.Events.FRAG_LOADING,{frag:m,part:F[U],targetBufferTime:D}),this.doFragPartsLoad(m,F,U,P).catch(function(N){return _.handleFragLoadError(N)})}else if(!m.url||this.loadedEndOfParts(F,D))return Promise.resolve(null)}}return this.log("Loading fragment "+m.sn+" cc: "+m.cc+" "+(x?"of ["+x.startSN+"-"+x.endSN+"] ":"")+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+m.level+", target: "+parseFloat(D.toFixed(3))),Object(M.isFiniteNumber)(m.sn)&&!this.bitrateTest&&(this.nextLoadPosition=m.start+m.duration),this.state=g.FRAG_LOADING,this.hls.trigger(b.Events.FRAG_LOADING,{frag:m,targetBufferTime:D}),this.fragmentLoader.load(m,P).catch(function(N){return _.handleFragLoadError(N)})},d.doFragPartsLoad=function(m,x,D,P){var _=this;return new Promise(function(F,U){var k=[],N=function w(V){var W=x[V];_.fragmentLoader.loadPart(m,W,P).then(function(Y){k[W.index]=Y;var j=Y.part;_.hls.trigger(b.Events.FRAG_LOADED,Y);var X=x[V+1];if(X&&X.fragment===m)w(V+1);else return F({frag:m,part:j,partsLoaded:k})}).catch(U)};N(D)})},d.handleFragLoadError=function(m){var x=m.data;return x&&x.details===A.ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(x.frag,x.part):this.hls.trigger(b.Events.ERROR,x),null},d._handleTransmuxerFlush=function(m){var x=this.getCurrentContext(m);if(!x||this.state!==g.PARSING){this.fragCurrent||(this.state=g.IDLE);return}var D=x.frag,P=x.part,_=x.level,F=self.performance.now();D.stats.parsing.end=F,P&&(P.stats.parsing.end=F),this.updateLevelTiming(D,P,_,m.partial)},d.getCurrentContext=function(m){var x=this.levels,D=m.level,P=m.sn,_=m.part;if(!x||!x[D])return this.warn("Levels object was unset while buffering fragment "+P+" of level "+D+". The current chunk will not be buffered."),null;var F=x[D],U=_>-1?Object(p.getPartWith)(F,P,_):null,k=U?U.fragment:Object(p.getFragmentWithSN)(F,P,this.fragCurrent);return k?{frag:k,part:U,level:F}:null},d.bufferFragmentData=function(m,x,D,P){if(!(!m||this.state!==g.PARSING)){var _=m.data1,F=m.data2,U=_;if(_&&F&&(U=Object(S.appendUint8Array)(_,F)),!(!U||!U.length)){var k={type:m.type,frag:x,part:D,chunkMeta:P,parent:x.type,data:U};this.hls.trigger(b.Events.BUFFER_APPENDING,k),m.dropped&&m.independent&&!D&&this.flushBufferGap(x)}}},d.flushBufferGap=function(m){var x=this.media;if(!!x){if(!R.BufferHelper.isBuffered(x,x.currentTime)){this.flushMainBuffer(0,m.start);return}var D=x.currentTime,P=R.BufferHelper.bufferInfo(x,D,0),_=m.duration,F=Math.min(this.config.maxFragLookUpTolerance*2,_*.25),U=Math.max(Math.min(m.start-F,P.end-F),D+F);m.start-U>F&&this.flushMainBuffer(U,m.start)}},d.getFwdBufferInfo=function(m,x){var D=this.config,P=this.getLoadPosition();if(!Object(M.isFiniteNumber)(P))return null;var _=R.BufferHelper.bufferInfo(m,P,D.maxBufferHole);if(_.len===0&&_.nextStart!==void 0){var F=this.fragmentTracker.getBufferedFrag(P,x);if(F&&_.nextStart<F.end)return R.BufferHelper.bufferInfo(m,P,Math.max(_.nextStart,D.maxBufferHole))}return _},d.getMaxBufferLength=function(m){var x=this.config,D;return m?D=Math.max(8*x.maxBufferSize/m,x.maxBufferLength):D=x.maxBufferLength,Math.min(D,x.maxMaxBufferLength)},d.reduceMaxBufferLength=function(m){var x=this.config,D=m||x.maxBufferLength;return x.maxMaxBufferLength>=D?(x.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+x.maxMaxBufferLength+"s"),!0):!1},d.getNextFragment=function(m,x){var D,P,_=x.fragments,F=_.length;if(!F)return null;var U=this.config,k=_[0].start,N;if(x.live){var w=U.initialLiveManifestSize;if(F<w)return this.warn("Not enough fragments to start playback (have: "+F+", need: "+w+")"),null;!x.PTSKnown&&!this.startFragRequested&&this.startPosition===-1&&(N=this.getInitialLiveFragment(x,_),this.startPosition=N?this.hls.liveSyncPosition||N.start:m)}else m<=k&&(N=_[0]);if(!N){var V=U.lowLatencyMode?x.partEnd:x.fragmentEnd;N=this.getFragmentAtPosition(m,V,x)}return(D=N)!==null&&D!==void 0&&D.initSegment&&!((P=N)!==null&&P!==void 0&&P.initSegment.data)&&!this.bitrateTest&&(N=N.initSegment),N},d.getNextPart=function(m,x,D){for(var P=-1,_=!1,F=!0,U=0,k=m.length;U<k;U++){var N=m[U];if(F=F&&!N.independent,P>-1&&D<N.start)break;var w=N.loaded;!w&&(_||N.independent||F)&&N.fragment===x&&(P=U),_=w}return P},d.loadedEndOfParts=function(m,x){var D=m[m.length-1];return D&&x>D.start&&D.loaded},d.getInitialLiveFragment=function(m,x){var D=this.fragPrevious,P=null;if(D){if(m.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+D.programDateTime),P=Object(T.findFragmentByPDT)(x,D.endProgramDateTime,this.config.maxFragLookUpTolerance)),!P){var _=D.sn+1;if(_>=m.startSN&&_<=m.endSN){var F=x[_-m.startSN];D.cc===F.cc&&(P=F,this.log("Live playlist, switching playlist, load frag with next SN: "+P.sn))}P||(P=Object(T.findFragWithCC)(x,D.cc),P&&this.log("Live playlist, switching playlist, load frag with same CC: "+P.sn))}}else{var U=this.hls.liveSyncPosition;U!==null&&(P=this.getFragmentAtPosition(U,this.bitrateTest?m.fragmentEnd:m.edge,m))}return P},d.getFragmentAtPosition=function(m,x,D){var P=this.config,_=this.fragPrevious,F=D.fragments,U=D.endSN,k=D.fragmentHint,N=P.maxFragLookUpTolerance,w=!!(P.lowLatencyMode&&D.partList&&k);w&&k&&!this.bitrateTest&&(F=F.concat(k),U=k.sn);var V;if(m<x){var W=m>x-N?0:N;V=Object(T.findFragmentByPTS)(_,F,m,W)}else V=F[F.length-1];if(V){var Y=V.sn-D.startSN,j=_&&V.level===_.level,X=F[Y+1],$=this.fragmentTracker.getState(V);if($===L.FragmentState.BACKTRACKED){V=null;for(var Q=Y;F[Q]&&this.fragmentTracker.getState(F[Q])===L.FragmentState.BACKTRACKED;)_?V=F[Q--]:V=F[--Q];V||(V=X)}else _&&V.sn===_.sn&&!w&&j&&(V.sn<U&&this.fragmentTracker.getState(X)!==L.FragmentState.OK?(this.log("SN "+V.sn+" just loaded, load next one: "+X.sn),V=X):V=null)}return V},d.synchronizeToLiveEdge=function(m){var x=this.config,D=this.media;if(!!D){var P=this.hls.liveSyncPosition,_=D.currentTime,F=m.fragments[0].start,U=m.edge,k=_>=F-x.maxFragLookUpTolerance&&_<=U;if(P!==null&&D.duration>P&&(_<P||!k)){var N=x.liveMaxLatencyDuration!==void 0?x.liveMaxLatencyDuration:x.liveMaxLatencyDurationCount*m.targetduration;(!k&&D.readyState<4||_<U-N)&&(this.loadedmetadata||(this.nextLoadPosition=P),D.readyState&&(this.warn("Playback: "+_.toFixed(3)+" is located too far from the end of live sliding playlist: "+U+", reset currentTime to : "+P.toFixed(3)),D.currentTime=P))}}},d.alignPlaylists=function(m,x){var D=this.levels,P=this.levelLastLoaded,_=this.fragPrevious,F=P!==null?D[P]:null,U=m.fragments.length;if(!U)return this.warn("No fragments in live playlist"),0;var k=m.fragments[0].start,N=!x,w=m.alignedSliding&&Object(M.isFiniteNumber)(k);if(N||!w&&!k){Object(y.alignStream)(_,F,m);var V=m.fragments[0].start;return this.log("Live playlist sliding: "+V.toFixed(2)+" start-sn: "+(x?x.startSN:"na")+"->"+m.startSN+" prev-sn: "+(_?_.sn:"na")+" fragments: "+U),V}return k},d.waitForCdnTuneIn=function(m){var x=3;return m.live&&m.canBlockReload&&m.tuneInGoal>Math.max(m.partHoldBack,m.partTarget*x)},d.setStartPosition=function(m,x){var D=this.startPosition;if(D<x&&(D=-1),D===-1||this.lastCurrentTime===-1){var P=m.startTimeOffset;Object(M.isFiniteNumber)(P)?(D=x+P,P<0&&(D+=m.totalduration),D=Math.min(Math.max(x,D),x+m.totalduration),this.log("Start time offset "+P+" found in playlist, adjust startPosition to "+D),this.startPosition=D):m.live?D=this.hls.liveSyncPosition||x:this.startPosition=D=0,this.lastCurrentTime=D}this.nextLoadPosition=D},d.getLoadPosition=function(){var m=this.media,x=0;return this.loadedmetadata&&m?x=m.currentTime:this.nextLoadPosition&&(x=this.nextLoadPosition),x},d.handleFragLoadAborted=function(m,x){this.transmuxer&&m.sn!=="initSegment"&&m.stats.aborted&&(this.warn("Fragment "+m.sn+(x?" part"+x.index:"")+" of level "+m.level+" was aborted"),this.resetFragmentLoading(m))},d.resetFragmentLoading=function(m){(!this.fragCurrent||!this.fragContextChanged(m))&&(this.state=g.IDLE)},d.onFragmentOrKeyLoadError=function(m,x){if(!x.fatal){var D=x.frag;if(!(!D||D.type!==m)){var P=this.fragCurrent;console.assert(P&&D.sn===P.sn&&D.level===P.level&&D.urlId===P.urlId,"Frag load error must match current frag to retry");var _=this.config;if(this.fragLoadError+1<=_.fragLoadingMaxRetry){if(this.resetLiveStartWhenNotLoaded(D.level))return;var F=Math.min(Math.pow(2,this.fragLoadError)*_.fragLoadingRetryDelay,_.fragLoadingMaxRetryTimeout);this.warn("Fragment "+D.sn+" of "+m+" "+D.level+" failed to load, retrying in "+F+"ms"),this.retryDate=self.performance.now()+F,this.fragLoadError++,this.state=g.FRAG_LOADING_WAITING_RETRY}else x.levelRetry?(m===r.PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=g.IDLE):(I.logger.error(x.details+" reaches max retry, redispatch as fatal ..."),x.fatal=!0,this.hls.stopLoad(),this.state=g.ERROR)}}},d.afterBufferFlushed=function(m,x,D){if(!!m){var P=R.BufferHelper.getBuffered(m);this.fragmentTracker.detectEvictedFragments(x,P,D),this.state===g.ENDED&&this.resetLoadingState()}},d.resetLoadingState=function(){this.fragCurrent=null,this.fragPrevious=null,this.state=g.IDLE},d.resetLiveStartWhenNotLoaded=function(m){if(!this.loadedmetadata){this.startFragRequested=!1;var x=this.levels?this.levels[m].details:null;if(x!=null&&x.live)return this.startPosition=-1,this.setStartPosition(x,0),this.resetLoadingState(),!0;this.nextLoadPosition=this.startPosition}return!1},d.updateLevelTiming=function(m,x,D,P){var _=this,F=D.details;console.assert(!!F,"level.details must be defined");var U=Object.keys(m.elementaryStreams).reduce(function(k,N){var w=m.elementaryStreams[N];if(w){var V=w.endPTS-w.startPTS;if(V<=0)return _.warn("Could not parse fragment "+m.sn+" "+N+" duration reliably ("+V+") resetting transmuxer to fallback to playlist timing"),_.resetTransmuxer(),k||!1;var W=P?0:Object(p.updateFragPTSDTS)(F,m,w.startPTS,w.endPTS,w.startDTS,w.endDTS);return _.hls.trigger(b.Events.LEVEL_PTS_UPDATED,{details:F,level:D,drift:W,type:N,frag:m,start:w.startPTS,end:w.endPTS}),!0}return k},!1);U?(this.state=g.PARSED,this.hls.trigger(b.Events.FRAG_PARSED,{frag:m,part:x})):this.resetLoadingState()},d.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},f(n,[{key:"state",get:function(){return this._state},set:function(m){var x=this._state;x!==m&&(this._state=m,this.log(x+"->"+m))}}]),n}(O.default)},"./src/controller/buffer-controller.ts":function(K,C,E){E.r(C),E.d(C,"default",function(){return T});var M=E("./src/polyfills/number.ts"),O=E("./src/events.ts"),L=E("./src/utils/logger.ts"),R=E("./src/errors.ts"),I=E("./src/utils/buffer-helper.ts"),b=E("./src/utils/mediasource-helper.ts"),A=E("./src/loader/fragment.ts"),c=E("./src/controller/buffer-operation-queue.ts"),S=Object(b.getMediaSource)(),y=/([ha]vc.)(?:\.[^.,]+)+/,T=function(){function p(s){var t=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var r=t.hls,e=t.media,f=t.mediaSource;L.logger.log("[buffer-controller]: Media source opened"),e&&(t.updateMediaElementDuration(),r.trigger(O.Events.MEDIA_ATTACHED,{media:e})),f&&f.removeEventListener("sourceopen",t._onMediaSourceOpen),t.checkPendingTracks()},this._onMediaSourceClose=function(){L.logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){L.logger.log("[buffer-controller]: Media source ended")},this.hls=s,this._initSourceBuffer(),this.registerListeners()}var v=p.prototype;return v.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},v.destroy=function(){this.unregisterListeners(),this.details=null},v.registerListeners=function(){var t=this.hls;t.on(O.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(O.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(O.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.on(O.Events.BUFFER_RESET,this.onBufferReset,this),t.on(O.Events.BUFFER_APPENDING,this.onBufferAppending,this),t.on(O.Events.BUFFER_CODECS,this.onBufferCodecs,this),t.on(O.Events.BUFFER_EOS,this.onBufferEos,this),t.on(O.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(O.Events.LEVEL_UPDATED,this.onLevelUpdated,this),t.on(O.Events.FRAG_PARSED,this.onFragParsed,this),t.on(O.Events.FRAG_CHANGED,this.onFragChanged,this)},v.unregisterListeners=function(){var t=this.hls;t.off(O.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(O.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(O.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.off(O.Events.BUFFER_RESET,this.onBufferReset,this),t.off(O.Events.BUFFER_APPENDING,this.onBufferAppending,this),t.off(O.Events.BUFFER_CODECS,this.onBufferCodecs,this),t.off(O.Events.BUFFER_EOS,this.onBufferEos,this),t.off(O.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(O.Events.LEVEL_UPDATED,this.onLevelUpdated,this),t.off(O.Events.FRAG_PARSED,this.onFragParsed,this),t.off(O.Events.FRAG_CHANGED,this.onFragChanged,this)},v._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new c.default(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]}},v.onManifestParsed=function(t,r){var e=2;(r.audio&&!r.video||!r.altAudio)&&(e=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=e,this.details=null,L.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},v.onMediaAttaching=function(t,r){var e=this.media=r.media;if(e&&S){var f=this.mediaSource=new S;f.addEventListener("sourceopen",this._onMediaSourceOpen),f.addEventListener("sourceended",this._onMediaSourceEnded),f.addEventListener("sourceclose",this._onMediaSourceClose),e.src=self.URL.createObjectURL(f),this._objectUrl=e.src}},v.onMediaDetaching=function(){var t=this.media,r=this.mediaSource,e=this._objectUrl;if(r){if(L.logger.log("[buffer-controller]: media source detaching"),r.readyState==="open")try{r.endOfStream()}catch(f){L.logger.warn("[buffer-controller]: onMediaDetaching: "+f.message+" while calling endOfStream")}this.onBufferReset(),r.removeEventListener("sourceopen",this._onMediaSourceOpen),r.removeEventListener("sourceended",this._onMediaSourceEnded),r.removeEventListener("sourceclose",this._onMediaSourceClose),t&&(e&&self.URL.revokeObjectURL(e),t.src===e?(t.removeAttribute("src"),t.load()):L.logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(O.Events.MEDIA_DETACHED,void 0)},v.onBufferReset=function(){var t=this;this.getSourceBufferTypes().forEach(function(r){var e=t.sourceBuffer[r];try{e&&(t.removeBufferListeners(r),t.mediaSource&&t.mediaSource.removeSourceBuffer(e),t.sourceBuffer[r]=void 0)}catch(f){L.logger.warn("[buffer-controller]: Failed to reset the "+r+" buffer",f)}}),this._initSourceBuffer()},v.onBufferCodecs=function(t,r){var e=this,f=this.getSourceBufferTypes().length;Object.keys(r).forEach(function(a){if(f){var i=e.tracks[a];if(i&&typeof i.buffer.changeType=="function"){var l=r[a],g=l.codec,h=l.levelCodec,o=l.container,n=(i.levelCodec||i.codec).replace(y,"$1"),d=(h||g).replace(y,"$1");if(n!==d){var u=o+";codecs="+(h||g);e.appendChangeType(a,u)}}}else e.pendingTracks[a]=r[a]}),!f&&(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks())},v.appendChangeType=function(t,r){var e=this,f=this.operationQueue,a={execute:function(){var l=e.sourceBuffer[t];l&&(L.logger.log("[buffer-controller]: changing "+t+" sourceBuffer type to "+r),l.changeType(r)),f.shiftAndExecuteNext(t)},onStart:function(){},onComplete:function(){},onError:function(l){L.logger.warn("[buffer-controller]: Failed to change "+t+" SourceBuffer type",l)}};f.append(a,t)},v.onBufferAppending=function(t,r){var e=this,f=this.hls,a=this.operationQueue,i=this.tracks,l=r.data,g=r.type,h=r.frag,o=r.part,n=r.chunkMeta,d=n.buffering[g],u=self.performance.now();d.start=u;var m=h.stats.buffering,x=o?o.stats.buffering:null;m.start===0&&(m.start=u),x&&x.start===0&&(x.start=u);var D=i.audio,P=g==="audio"&&n.id===1&&(D==null?void 0:D.container)==="audio/mpeg",_={execute:function(){if(d.executeStart=self.performance.now(),P){var U=e.sourceBuffer[g];if(U){var k=h.start-U.timestampOffset;Math.abs(k)>=.1&&(L.logger.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+h.start+" (delta: "+k+") sn: "+h.sn+")"),U.timestampOffset=h.start)}}e.appendExecutor(l,g)},onStart:function(){},onComplete:function(){var U=self.performance.now();d.executeEnd=d.end=U,m.first===0&&(m.first=U),x&&x.first===0&&(x.first=U);var k=e.sourceBuffer,N={};for(var w in k)N[w]=I.BufferHelper.getBuffered(k[w]);e.appendError=0,e.hls.trigger(O.Events.BUFFER_APPENDED,{type:g,frag:h,part:o,chunkMeta:n,parent:h.type,timeRanges:N})},onError:function(U){L.logger.error("[buffer-controller]: Error encountered while trying to append to the "+g+" SourceBuffer",U);var k={type:R.ErrorTypes.MEDIA_ERROR,parent:h.type,details:R.ErrorDetails.BUFFER_APPEND_ERROR,err:U,fatal:!1};U.code===DOMException.QUOTA_EXCEEDED_ERR?k.details=R.ErrorDetails.BUFFER_FULL_ERROR:(e.appendError++,k.details=R.ErrorDetails.BUFFER_APPEND_ERROR,e.appendError>f.config.appendErrorMaxRetry&&(L.logger.error("[buffer-controller]: Failed "+f.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),k.fatal=!0)),f.trigger(O.Events.ERROR,k)}};a.append(_,g)},v.onBufferFlushing=function(t,r){var e=this,f=this.operationQueue,a=function(l){return{execute:e.removeExecutor.bind(e,l,r.startOffset,r.endOffset),onStart:function(){},onComplete:function(){e.hls.trigger(O.Events.BUFFER_FLUSHED,{type:l})},onError:function(h){L.logger.warn("[buffer-controller]: Failed to remove from "+l+" SourceBuffer",h)}}};r.type?f.append(a(r.type),r.type):this.getSourceBufferTypes().forEach(function(i){f.append(a(i),i)})},v.onFragParsed=function(t,r){var e=this,f=r.frag,a=r.part,i=[],l=a?a.elementaryStreams:f.elementaryStreams;l[A.ElementaryStreamTypes.AUDIOVIDEO]?i.push("audiovideo"):(l[A.ElementaryStreamTypes.AUDIO]&&i.push("audio"),l[A.ElementaryStreamTypes.VIDEO]&&i.push("video"));var g=function(){var o=self.performance.now();f.stats.buffering.end=o,a&&(a.stats.buffering.end=o);var n=a?a.stats:f.stats;e.hls.trigger(O.Events.FRAG_BUFFERED,{frag:f,part:a,stats:n,id:f.type})};i.length===0&&L.logger.warn("Fragments must have at least one ElementaryStreamType set. type: "+f.type+" level: "+f.level+" sn: "+f.sn),this.blockBuffers(g,i)},v.onFragChanged=function(t,r){this.flushBackBuffer()},v.onBufferEos=function(t,r){var e=this,f=this.getSourceBufferTypes().reduce(function(a,i){var l=e.sourceBuffer[i];return(!r.type||r.type===i)&&l&&!l.ended&&(l.ended=!0,L.logger.log("[buffer-controller]: "+i+" sourceBuffer now EOS")),a&&!!(!l||l.ended)},!0);f&&this.blockBuffers(function(){var a=e.mediaSource;!a||a.readyState!=="open"||a.endOfStream()})},v.onLevelUpdated=function(t,r){var e=r.details;!e.fragments.length||(this.details=e,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},v.flushBackBuffer=function(){var t=this.hls,r=this.details,e=this.media,f=this.sourceBuffer;if(!(!e||r===null)){var a=this.getSourceBufferTypes();if(!!a.length){var i=r.live&&t.config.liveBackBufferLength!==null?t.config.liveBackBufferLength:t.config.backBufferLength;if(!(!Object(M.isFiniteNumber)(i)||i<0)){var l=e.currentTime,g=r.levelTargetDuration,h=Math.max(i,g),o=Math.floor(l/g)*g-h;a.forEach(function(n){var d=f[n];if(d){var u=I.BufferHelper.getBuffered(d);u.length>0&&o>u.start(0)&&(t.trigger(O.Events.BACK_BUFFER_REACHED,{bufferEnd:o}),r.live&&t.trigger(O.Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:o}),t.trigger(O.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:o,type:n}))}})}}}},v.updateMediaElementDuration=function(){if(!(!this.details||!this.media||!this.mediaSource||this.mediaSource.readyState!=="open")){var t=this.details,r=this.hls,e=this.media,f=this.mediaSource,a=t.fragments[0].start+t.totalduration,i=e.duration,l=Object(M.isFiniteNumber)(f.duration)?f.duration:0;t.live&&r.config.liveDurationInfinity?(L.logger.log("[buffer-controller]: Media Source duration is set to Infinity"),f.duration=1/0,this.updateSeekableRange(t)):(a>l&&a>i||!Object(M.isFiniteNumber)(i))&&(L.logger.log("[buffer-controller]: Updating Media Source duration to "+a.toFixed(3)),f.duration=a)}},v.updateSeekableRange=function(t){var r=this.mediaSource,e=t.fragments,f=e.length;if(f&&t.live&&r!==null&&r!==void 0&&r.setLiveSeekableRange){var a=Math.max(0,e[0].start),i=Math.max(a,a+t.totalduration);r.setLiveSeekableRange(a,i)}},v.checkPendingTracks=function(){var t=this.bufferCodecEventsExpected,r=this.operationQueue,e=this.pendingTracks,f=Object.keys(e).length;if(f&&!t||f===2){this.createSourceBuffers(e),this.pendingTracks={};var a=this.getSourceBufferTypes();if(a.length===0){this.hls.trigger(O.Events.ERROR,{type:R.ErrorTypes.MEDIA_ERROR,details:R.ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"});return}a.forEach(function(i){r.executeNext(i)})}},v.createSourceBuffers=function(t){var r=this.sourceBuffer,e=this.mediaSource;if(!e)throw Error("createSourceBuffers called when mediaSource was null");var f=0;for(var a in t)if(!r[a]){var i=t[a];if(!i)throw Error("source buffer exists for track "+a+", however track does not");var l=i.levelCodec||i.codec,g=i.container+";codecs="+l;L.logger.log("[buffer-controller]: creating sourceBuffer("+g+")");try{var h=r[a]=e.addSourceBuffer(g),o=a;this.addBufferListener(o,"updatestart",this._onSBUpdateStart),this.addBufferListener(o,"updateend",this._onSBUpdateEnd),this.addBufferListener(o,"error",this._onSBUpdateError),this.tracks[a]={buffer:h,codec:l,container:i.container,levelCodec:i.levelCodec,id:i.id},f++}catch(n){L.logger.error("[buffer-controller]: error while trying to add sourceBuffer: "+n.message),this.hls.trigger(O.Events.ERROR,{type:R.ErrorTypes.MEDIA_ERROR,details:R.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:n,mimeType:g})}}f&&this.hls.trigger(O.Events.BUFFER_CREATED,{tracks:this.tracks})},v._onSBUpdateStart=function(t){var r=this.operationQueue,e=r.current(t);e.onStart()},v._onSBUpdateEnd=function(t){var r=this.operationQueue,e=r.current(t);e.onComplete(),r.shiftAndExecuteNext(t)},v._onSBUpdateError=function(t,r){L.logger.error("[buffer-controller]: "+t+" SourceBuffer error",r),this.hls.trigger(O.Events.ERROR,{type:R.ErrorTypes.MEDIA_ERROR,details:R.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1});var e=this.operationQueue.current(t);e&&e.onError(r)},v.removeExecutor=function(t,r,e){var f=this.media,a=this.mediaSource,i=this.operationQueue,l=this.sourceBuffer,g=l[t];if(!f||!a||!g){L.logger.warn("[buffer-controller]: Attempting to remove from the "+t+" SourceBuffer, but it does not exist"),i.shiftAndExecuteNext(t);return}var h=Object(M.isFiniteNumber)(f.duration)?f.duration:1/0,o=Object(M.isFiniteNumber)(a.duration)?a.duration:1/0,n=Math.max(0,r),d=Math.min(e,h,o);d>n?(L.logger.log("[buffer-controller]: Removing ["+n+","+d+"] from the "+t+" SourceBuffer"),console.assert(!g.updating,t+" sourceBuffer must not be updating"),g.remove(n,d)):i.shiftAndExecuteNext(t)},v.appendExecutor=function(t,r){var e=this.operationQueue,f=this.sourceBuffer,a=f[r];if(!a){L.logger.warn("[buffer-controller]: Attempting to append to the "+r+" SourceBuffer, but it does not exist"),e.shiftAndExecuteNext(r);return}a.ended=!1,console.assert(!a.updating,r+" sourceBuffer must not be updating"),a.appendBuffer(t)},v.blockBuffers=function(t,r){var e=this;if(r===void 0&&(r=this.getSourceBufferTypes()),!r.length){L.logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),Promise.resolve(t);return}var f=this.operationQueue,a=r.map(function(i){return f.appendBlocker(i)});Promise.all(a).then(function(){t(),r.forEach(function(i){var l=e.sourceBuffer[i];(!l||!l.updating)&&f.shiftAndExecuteNext(i)})})},v.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},v.addBufferListener=function(t,r,e){var f=this.sourceBuffer[t];if(!!f){var a=e.bind(this,t);this.listeners[t].push({event:r,listener:a}),f.addEventListener(r,a)}},v.removeBufferListeners=function(t){var r=this.sourceBuffer[t];!r||this.listeners[t].forEach(function(e){r.removeEventListener(e.event,e.listener)})},p}()},"./src/controller/buffer-operation-queue.ts":function(K,C,E){E.r(C),E.d(C,"default",function(){return O});var M=E("./src/utils/logger.ts"),O=function(){function L(I){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=I}var R=L.prototype;return R.append=function(b,A){var c=this.queues[A];c.push(b),c.length===1&&this.buffers[A]&&this.executeNext(A)},R.insertAbort=function(b,A){var c=this.queues[A];c.unshift(b),this.executeNext(A)},R.appendBlocker=function(b){var A,c=new Promise(function(y){A=y}),S={execute:A,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(S,b),c},R.executeNext=function(b){var A=this.buffers,c=this.queues,S=A[b],y=c[b];if(y.length){var T=y[0];try{T.execute()}catch(p){M.logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),T.onError(p),(!S||!S.updating)&&(y.shift(),this.executeNext(b))}}},R.shiftAndExecuteNext=function(b){this.queues[b].shift(),this.executeNext(b)},R.current=function(b){return this.queues[b][0]},L}()},"./src/controller/cap-level-controller.ts":function(K,C,E){E.r(C);var M=E("./src/events.ts");function O(I,b){for(var A=0;A<b.length;A++){var c=b[A];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(I,c.key,c)}}function L(I,b,A){return b&&O(I.prototype,b),A&&O(I,A),I}var R=function(){function I(A){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=A,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var b=I.prototype;return b.setStreamController=function(c){this.streamController=c},b.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},b.registerListeners=function(){var c=this.hls;c.on(M.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),c.on(M.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),c.on(M.Events.MANIFEST_PARSED,this.onManifestParsed,this),c.on(M.Events.BUFFER_CODECS,this.onBufferCodecs,this),c.on(M.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},b.unregisterListener=function(){var c=this.hls;c.off(M.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),c.off(M.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),c.off(M.Events.MANIFEST_PARSED,this.onManifestParsed,this),c.off(M.Events.BUFFER_CODECS,this.onBufferCodecs,this),c.off(M.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},b.onFpsDropLevelCapping=function(c,S){I.isLevelAllowed(S.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(S.droppedLevel)},b.onMediaAttaching=function(c,S){this.media=S.media instanceof HTMLVideoElement?S.media:null},b.onManifestParsed=function(c,S){var y=this.hls;this.restrictedLevels=[],this.firstLevel=S.firstLevel,y.config.capLevelToPlayerSize&&S.video&&this.startCapping()},b.onBufferCodecs=function(c,S){var y=this.hls;y.config.capLevelToPlayerSize&&S.video&&this.startCapping()},b.onMediaDetaching=function(){this.stopCapping()},b.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var c=this.hls.levels;if(c.length){var S=this.hls;S.autoLevelCapping=this.getMaxLevel(c.length-1),S.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=S.autoLevelCapping}}},b.getMaxLevel=function(c){var S=this,y=this.hls.levels;if(!y.length)return-1;var T=y.filter(function(p,v){return I.isLevelAllowed(v,S.restrictedLevels)&&v<=c});return this.clientRect=null,I.getMaxLevelByMediaSize(T,this.mediaWidth,this.mediaHeight)},b.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},b.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},b.getDimensions=function(){if(this.clientRect)return this.clientRect;var c=this.media,S={width:0,height:0};if(c){var y=c.getBoundingClientRect();S.width=y.width,S.height=y.height,!S.width&&!S.height&&(S.width=y.right-y.left||c.width||0,S.height=y.bottom-y.top||c.height||0)}return this.clientRect=S,S},I.isLevelAllowed=function(c,S){return S===void 0&&(S=[]),S.indexOf(c)===-1},I.getMaxLevelByMediaSize=function(c,S,y){if(!c||!c.length)return-1;for(var T=function(r,e){return e?r.width!==e.width||r.height!==e.height:!0},p=c.length-1,v=0;v<c.length;v+=1){var s=c[v];if((s.width>=S||s.height>=y)&&T(s,c[v+1])){p=v;break}}return p},L(I,[{key:"mediaWidth",get:function(){return this.getDimensions().width*I.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*I.contentScaleFactor}}],[{key:"contentScaleFactor",get:function(){var c=1;try{c=self.devicePixelRatio}catch{}return c}}]),I}();C.default=R},"./src/controller/eme-controller.ts":function(K,C,E){E.r(C);var M=E("./src/events.ts"),O=E("./src/errors.ts"),L=E("./src/utils/logger.ts"),R=E("./src/utils/mediakeys-helper.ts");function I(T,p){for(var v=0;v<p.length;v++){var s=p[v];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(T,s.key,s)}}function b(T,p,v){return p&&I(T.prototype,p),v&&I(T,v),T}var A=3,c=function(p,v,s){var t={audioCapabilities:[],videoCapabilities:[]};return p.forEach(function(r){t.audioCapabilities.push({contentType:'audio/mp4; codecs="'+r+'"',robustness:s.audioRobustness||""})}),v.forEach(function(r){t.videoCapabilities.push({contentType:'video/mp4; codecs="'+r+'"',robustness:s.videoRobustness||""})}),[t]},S=function(p,v,s,t){switch(p){case R.KeySystems.WIDEVINE:return c(v,s,t);default:throw new Error("Unknown key-system: "+p)}},y=function(){function T(v){this.hls=void 0,this._widevineLicenseUrl=void 0,this._licenseXhrSetup=void 0,this._licenseResponseCallback=void 0,this._emeEnabled=void 0,this._requestMediaKeySystemAccess=void 0,this._drmSystemOptions=void 0,this._config=void 0,this._mediaKeysList=[],this._media=null,this._hasSetMediaKeys=!1,this._requestLicenseFailureCount=0,this.mediaKeysPromise=null,this._onMediaEncrypted=this.onMediaEncrypted.bind(this),this.hls=v,this._config=v.config,this._widevineLicenseUrl=this._config.widevineLicenseUrl,this._licenseXhrSetup=this._config.licenseXhrSetup,this._licenseResponseCallback=this._config.licenseResponseCallback,this._emeEnabled=this._config.emeEnabled,this._requestMediaKeySystemAccess=this._config.requestMediaKeySystemAccessFunc,this._drmSystemOptions=this._config.drmSystemOptions,this._registerListeners()}var p=T.prototype;return p.destroy=function(){this._unregisterListeners(),this.hls=this._onMediaEncrypted=null,this._requestMediaKeySystemAccess=null},p._registerListeners=function(){this.hls.on(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(M.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(M.Events.MANIFEST_PARSED,this.onManifestParsed,this)},p._unregisterListeners=function(){this.hls.off(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(M.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(M.Events.MANIFEST_PARSED,this.onManifestParsed,this)},p.getLicenseServerUrl=function(s){switch(s){case R.KeySystems.WIDEVINE:if(!this._widevineLicenseUrl)break;return this._widevineLicenseUrl}throw new Error('no license server URL configured for key-system "'+s+'"')},p._attemptKeySystemAccess=function(s,t,r){var e=this,f=S(s,t,r,this._drmSystemOptions);L.logger.log("Requesting encrypted media key-system access");var a=this.requestMediaKeySystemAccess(s,f);this.mediaKeysPromise=a.then(function(i){return e._onMediaKeySystemAccessObtained(s,i)}),a.catch(function(i){L.logger.error('Failed to obtain key-system "'+s+'" access:',i)})},p._onMediaKeySystemAccessObtained=function(s,t){var r=this;L.logger.log('Access for key-system "'+s+'" obtained');var e={mediaKeysSessionInitialized:!1,mediaKeySystemAccess:t,mediaKeySystemDomain:s};this._mediaKeysList.push(e);var f=Promise.resolve().then(function(){return t.createMediaKeys()}).then(function(a){return e.mediaKeys=a,L.logger.log('Media-keys created for key-system "'+s+'"'),r._onMediaKeysCreated(),a});return f.catch(function(a){L.logger.error("Failed to create media-keys:",a)}),f},p._onMediaKeysCreated=function(){var s=this;this._mediaKeysList.forEach(function(t){t.mediaKeysSession||(t.mediaKeysSession=t.mediaKeys.createSession(),s._onNewMediaKeySession(t.mediaKeysSession))})},p._onNewMediaKeySession=function(s){var t=this;L.logger.log("New key-system session "+s.sessionId),s.addEventListener("message",function(r){t._onKeySessionMessage(s,r.message)},!1)},p._onKeySessionMessage=function(s,t){L.logger.log("Got EME message event, creating license request"),this._requestLicense(t,function(r){L.logger.log("Received license data (length: "+(r&&r.byteLength)+"), updating key-session"),s.update(r)})},p.onMediaEncrypted=function(s){var t=this;if(L.logger.log('Media is encrypted using "'+s.initDataType+'" init data type'),!this.mediaKeysPromise){L.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been requested"),this.hls.trigger(M.Events.ERROR,{type:O.ErrorTypes.KEY_SYSTEM_ERROR,details:O.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});return}var r=function(f){!t._media||(t._attemptSetMediaKeys(f),t._generateRequestWithPreferredKeySession(s.initDataType,s.initData))};this.mediaKeysPromise.then(r).catch(r)},p._attemptSetMediaKeys=function(s){if(!this._media)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var t=this._mediaKeysList[0];if(!t||!t.mediaKeys){L.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),this.hls.trigger(M.Events.ERROR,{type:O.ErrorTypes.KEY_SYSTEM_ERROR,details:O.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});return}L.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(t.mediaKeys),this._hasSetMediaKeys=!0}},p._generateRequestWithPreferredKeySession=function(s,t){var r=this,e=this._mediaKeysList[0];if(!e){L.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),this.hls.trigger(M.Events.ERROR,{type:O.ErrorTypes.KEY_SYSTEM_ERROR,details:O.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});return}if(e.mediaKeysSessionInitialized){L.logger.warn("Key-Session already initialized but requested again");return}var f=e.mediaKeysSession;if(!f){L.logger.error("Fatal: Media is encrypted but no key-session existing"),this.hls.trigger(M.Events.ERROR,{type:O.ErrorTypes.KEY_SYSTEM_ERROR,details:O.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0});return}if(!t){L.logger.warn("Fatal: initData required for generating a key session is null"),this.hls.trigger(M.Events.ERROR,{type:O.ErrorTypes.KEY_SYSTEM_ERROR,details:O.ErrorDetails.KEY_SYSTEM_NO_INIT_DATA,fatal:!0});return}L.logger.log('Generating key-session request for "'+s+'" init data type'),e.mediaKeysSessionInitialized=!0,f.generateRequest(s,t).then(function(){L.logger.debug("Key-session generation succeeded")}).catch(function(a){L.logger.error("Error generating key-session request:",a),r.hls.trigger(M.Events.ERROR,{type:O.ErrorTypes.KEY_SYSTEM_ERROR,details:O.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})})},p._createLicenseXhr=function(s,t,r){var e=new XMLHttpRequest;e.responseType="arraybuffer",e.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,e,s,t,r);var f=this._licenseXhrSetup;if(f)try{f.call(this.hls,e,s),f=void 0}catch(a){L.logger.error(a)}try{e.readyState||e.open("POST",s,!0),f&&f.call(this.hls,e,s)}catch(a){throw new Error("issue setting up KeySystem license XHR "+a)}return e},p._onLicenseRequestReadyStageChange=function(s,t,r,e){switch(s.readyState){case 4:if(s.status===200){this._requestLicenseFailureCount=0,L.logger.log("License request succeeded");var f=s.response,a=this._licenseResponseCallback;if(a)try{f=a.call(this.hls,s,t)}catch(l){L.logger.error(l)}e(f)}else{if(L.logger.error("License Request XHR failed ("+t+"). Status: "+s.status+" ("+s.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount>A){this.hls.trigger(M.Events.ERROR,{type:O.ErrorTypes.KEY_SYSTEM_ERROR,details:O.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0});return}var i=A-this._requestLicenseFailureCount+1;L.logger.warn("Retrying license request, "+i+" attempts left"),this._requestLicense(r,e)}break}},p._generateLicenseRequestChallenge=function(s,t){switch(s.mediaKeySystemDomain){case R.KeySystems.WIDEVINE:return t}throw new Error("unsupported key-system: "+s.mediaKeySystemDomain)},p._requestLicense=function(s,t){L.logger.log("Requesting content license for key-system");var r=this._mediaKeysList[0];if(!r){L.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),this.hls.trigger(M.Events.ERROR,{type:O.ErrorTypes.KEY_SYSTEM_ERROR,details:O.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});return}try{var e=this.getLicenseServerUrl(r.mediaKeySystemDomain),f=this._createLicenseXhr(e,s,t);L.logger.log("Sending license request to URL: "+e);var a=this._generateLicenseRequestChallenge(r,s);f.send(a)}catch(i){L.logger.error("Failure requesting DRM license: "+i),this.hls.trigger(M.Events.ERROR,{type:O.ErrorTypes.KEY_SYSTEM_ERROR,details:O.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}},p.onMediaAttached=function(s,t){if(!!this._emeEnabled){var r=t.media;this._media=r,r.addEventListener("encrypted",this._onMediaEncrypted)}},p.onMediaDetached=function(){var s=this._media,t=this._mediaKeysList;!s||(s.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null,this._mediaKeysList=[],Promise.all(t.map(function(r){if(r.mediaKeysSession)return r.mediaKeysSession.close().catch(function(){})})).then(function(){return s.setMediaKeys(null)}).catch(function(){}))},p.onManifestParsed=function(s,t){if(!!this._emeEnabled){var r=t.levels.map(function(f){return f.audioCodec}).filter(function(f){return!!f}),e=t.levels.map(function(f){return f.videoCodec}).filter(function(f){return!!f});this._attemptKeySystemAccess(R.KeySystems.WIDEVINE,r,e)}},b(T,[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}]),T}();C.default=y},"./src/controller/fps-controller.ts":function(K,C,E){E.r(C);var M=E("./src/events.ts"),O=E("./src/utils/logger.ts"),L=function(){function R(b){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=b,this.registerListeners()}var I=R.prototype;return I.setStreamController=function(A){this.streamController=A},I.registerListeners=function(){this.hls.on(M.Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},I.unregisterListeners=function(){this.hls.off(M.Events.MEDIA_ATTACHING,this.onMediaAttaching)},I.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},I.onMediaAttaching=function(A,c){var S=this.hls.config;if(S.capLevelOnFPSDrop){var y=c.media instanceof self.HTMLVideoElement?c.media:null;this.media=y,y&&typeof y.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),S.fpsDroppedMonitoringPeriod)}},I.checkFPS=function(A,c,S){var y=performance.now();if(c){if(this.lastTime){var T=y-this.lastTime,p=S-this.lastDroppedFrames,v=c-this.lastDecodedFrames,s=1e3*p/T,t=this.hls;if(t.trigger(M.Events.FPS_DROP,{currentDropped:p,currentDecoded:v,totalDroppedFrames:S}),s>0&&p>t.config.fpsDroppedMonitoringThreshold*v){var r=t.currentLevel;O.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+r),r>0&&(t.autoLevelCapping===-1||t.autoLevelCapping>=r)&&(r=r-1,t.trigger(M.Events.FPS_DROP_LEVEL_CAPPING,{level:r,droppedLevel:t.currentLevel}),t.autoLevelCapping=r,this.streamController.nextLevelSwitch())}}this.lastTime=y,this.lastDroppedFrames=S,this.lastDecodedFrames=c}},I.checkFPSInterval=function(){var A=this.media;if(A)if(this.isVideoPlaybackQualityAvailable){var c=A.getVideoPlaybackQuality();this.checkFPS(A,c.totalVideoFrames,c.droppedVideoFrames)}else this.checkFPS(A,A.webkitDecodedFrameCount,A.webkitDroppedFrameCount)},R}();C.default=L},"./src/controller/fragment-finders.ts":function(K,C,E){E.r(C),E.d(C,"findFragmentByPDT",function(){return L}),E.d(C,"findFragmentByPTS",function(){return R}),E.d(C,"fragmentWithinToleranceTest",function(){return I}),E.d(C,"pdtWithinToleranceTest",function(){return b}),E.d(C,"findFragWithCC",function(){return A});var M=E("./src/polyfills/number.ts"),O=E("./src/utils/binary-search.ts");function L(c,S,y){if(S===null||!Array.isArray(c)||!c.length||!Object(M.isFiniteNumber)(S))return null;var T=c[0].programDateTime;if(S<(T||0))return null;var p=c[c.length-1].endProgramDateTime;if(S>=(p||0))return null;y=y||0;for(var v=0;v<c.length;++v){var s=c[v];if(b(S,y,s))return s}return null}function R(c,S,y,T){y===void 0&&(y=0),T===void 0&&(T=0);var p=null;if(c?p=S[c.sn-S[0].sn+1]||null:y===0&&S[0].start===0&&(p=S[0]),p&&I(y,T,p)===0)return p;var v=O.default.search(S,I.bind(null,y,T));return v||p}function I(c,S,y){c===void 0&&(c=0),S===void 0&&(S=0);var T=Math.min(S,y.duration+(y.deltaPTS?y.deltaPTS:0));return y.start+y.duration-T<=c?1:y.start-T>c&&y.start?-1:0}function b(c,S,y){var T=Math.min(S,y.duration+(y.deltaPTS?y.deltaPTS:0))*1e3,p=y.endProgramDateTime||0;return p-T>c}function A(c,S){return O.default.search(c,function(y){return y.cc<S?1:y.cc>S?-1:0})}},"./src/controller/fragment-tracker.ts":function(K,C,E){E.r(C),E.d(C,"FragmentState",function(){return L}),E.d(C,"FragmentTracker",function(){return R});var M=E("./src/events.ts"),O=E("./src/types/loader.ts"),L;(function(A){A.NOT_LOADED="NOT_LOADED",A.BACKTRACKED="BACKTRACKED",A.APPENDING="APPENDING",A.PARTIAL="PARTIAL",A.OK="OK"})(L||(L={}));var R=function(){function A(S){this.activeFragment=null,this.activeParts=null,this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=S,this._registerListeners()}var c=A.prototype;return c._registerListeners=function(){var y=this.hls;y.on(M.Events.BUFFER_APPENDED,this.onBufferAppended,this),y.on(M.Events.FRAG_BUFFERED,this.onFragBuffered,this),y.on(M.Events.FRAG_LOADED,this.onFragLoaded,this)},c._unregisterListeners=function(){var y=this.hls;y.off(M.Events.BUFFER_APPENDED,this.onBufferAppended,this),y.off(M.Events.FRAG_BUFFERED,this.onFragBuffered,this),y.off(M.Events.FRAG_LOADED,this.onFragLoaded,this)},c.destroy=function(){this._unregisterListeners(),this.fragments=this.timeRanges=null},c.getAppendedFrag=function(y,T){if(T===O.PlaylistLevelType.MAIN){var p=this.activeFragment,v=this.activeParts;if(!p)return null;if(v)for(var s=v.length;s--;){var t=v[s],r=t?t.end:p.appendedPTS;if(t.start<=y&&r!==void 0&&y<=r)return s>9&&(this.activeParts=v.slice(s-9)),t}else if(p.start<=y&&p.appendedPTS!==void 0&&y<=p.appendedPTS)return p}return this.getBufferedFrag(y,T)},c.getBufferedFrag=function(y,T){for(var p=this.fragments,v=Object.keys(p),s=v.length;s--;){var t=p[v[s]];if((t==null?void 0:t.body.type)===T&&t.buffered){var r=t.body;if(r.start<=y&&y<=r.end)return r}}return null},c.detectEvictedFragments=function(y,T,p){var v=this;Object.keys(this.fragments).forEach(function(s){var t=v.fragments[s];if(!!t){if(!t.buffered){t.body.type===p&&v.removeFragment(t.body);return}var r=t.range[y];!r||r.time.some(function(e){var f=!v.isTimeBuffered(e.startPTS,e.endPTS,T);return f&&v.removeFragment(t.body),f})}})},c.detectPartialFragments=function(y){var T=this,p=this.timeRanges,v=y.frag,s=y.part;if(!(!p||v.sn==="initSegment")){var t=b(v),r=this.fragments[t];!r||(Object.keys(p).forEach(function(e){var f=v.elementaryStreams[e];if(!!f){var a=p[e],i=s!==null||f.partial===!0;r.range[e]=T.getBufferedTimes(v,s,i,a)}}),r.backtrack=r.loaded=null,Object.keys(r.range).length?r.buffered=!0:this.removeFragment(r.body))}},c.fragBuffered=function(y){var T=b(y),p=this.fragments[T];p&&(p.backtrack=p.loaded=null,p.buffered=!0)},c.getBufferedTimes=function(y,T,p,v){for(var s={time:[],partial:p},t=T?T.start:y.start,r=T?T.end:y.end,e=y.minEndPTS||r,f=y.maxStartPTS||t,a=0;a<v.length;a++){var i=v.start(a)-this.bufferPadding,l=v.end(a)+this.bufferPadding;if(f>=i&&e<=l){s.time.push({startPTS:Math.max(t,v.start(a)),endPTS:Math.min(r,v.end(a))});break}else if(t<l&&r>i)s.partial=!0,s.time.push({startPTS:Math.max(t,v.start(a)),endPTS:Math.min(r,v.end(a))});else if(r<=i)break}return s},c.getPartialFragment=function(y){var T=null,p,v,s,t=0,r=this.bufferPadding,e=this.fragments;return Object.keys(e).forEach(function(f){var a=e[f];!a||I(a)&&(v=a.body.start-r,s=a.body.end+r,y>=v&&y<=s&&(p=Math.min(y-v,s-y),t<=p&&(T=a.body,t=p)))}),T},c.getState=function(y){var T=b(y),p=this.fragments[T];return p?p.buffered?I(p)?L.PARTIAL:L.OK:p.backtrack?L.BACKTRACKED:L.APPENDING:L.NOT_LOADED},c.backtrack=function(y,T){var p=b(y),v=this.fragments[p];if(!v||v.backtrack)return null;var s=v.backtrack=T||v.loaded;return v.loaded=null,s},c.getBacktrackData=function(y){var T=b(y),p=this.fragments[T];if(p){var v,s=p.backtrack;if(s!=null&&(v=s.payload)!==null&&v!==void 0&&v.byteLength)return s;this.removeFragment(y)}return null},c.isTimeBuffered=function(y,T,p){for(var v,s,t=0;t<p.length;t++){if(v=p.start(t)-this.bufferPadding,s=p.end(t)+this.bufferPadding,y>=v&&T<=s)return!0;if(T<=v)return!1}return!1},c.onFragLoaded=function(y,T){var p=T.frag,v=T.part;if(!(p.sn==="initSegment"||p.bitrateTest||v)){var s=b(p);this.fragments[s]={body:p,loaded:T,backtrack:null,buffered:!1,range:Object.create(null)}}},c.onBufferAppended=function(y,T){var p=this,v=T.frag,s=T.part,t=T.timeRanges;if(v.type===O.PlaylistLevelType.MAIN)if(this.activeFragment=v,s){var r=this.activeParts;r||(this.activeParts=r=[]),r.push(s)}else this.activeParts=null;this.timeRanges=t,Object.keys(t).forEach(function(e){var f=t[e];if(p.detectEvictedFragments(e,f),!s)for(var a=0;a<f.length;a++)v.appendedPTS=Math.max(f.end(a),v.appendedPTS||0)})},c.onFragBuffered=function(y,T){this.detectPartialFragments(T)},c.hasFragment=function(y){var T=b(y);return!!this.fragments[T]},c.removeFragmentsInRange=function(y,T,p){var v=this;Object.keys(this.fragments).forEach(function(s){var t=v.fragments[s];if(!!t&&t.buffered){var r=t.body;r.type===p&&r.start<T&&r.end>y&&v.removeFragment(r)}})},c.removeFragment=function(y){var T=b(y);y.stats.loaded=0,y.clearElementaryStreamInfo(),delete this.fragments[T]},c.removeAllFragments=function(){this.fragments=Object.create(null),this.activeFragment=null,this.activeParts=null},A}();function I(A){var c,S;return A.buffered&&(((c=A.range.video)===null||c===void 0?void 0:c.partial)||((S=A.range.audio)===null||S===void 0?void 0:S.partial))}function b(A){return A.type+"_"+A.level+"_"+A.urlId+"_"+A.sn}},"./src/controller/gap-controller.ts":function(K,C,E){E.r(C),E.d(C,"STALL_MINIMUM_DURATION_MS",function(){return I}),E.d(C,"MAX_START_GAP_JUMP",function(){return b}),E.d(C,"SKIP_BUFFER_HOLE_STEP_SECONDS",function(){return A}),E.d(C,"SKIP_BUFFER_RANGE_START",function(){return c}),E.d(C,"default",function(){return S});var M=E("./src/utils/buffer-helper.ts"),O=E("./src/errors.ts"),L=E("./src/events.ts"),R=E("./src/utils/logger.ts"),I=250,b=2,A=.1,c=.05,S=function(){function y(p,v,s,t){this.config=void 0,this.media=void 0,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=p,this.media=v,this.fragmentTracker=s,this.hls=t}var T=y.prototype;return T.destroy=function(){this.hls=this.fragmentTracker=this.media=null},T.poll=function(v){var s=this.config,t=this.media,r=this.stalled,e=t.currentTime,f=t.seeking,a=this.seeking&&!f,i=!this.seeking&&f;if(this.seeking=f,e!==v){if(this.moved=!0,r!==null){if(this.stallReported){var l=self.performance.now()-r;R.logger.warn("playback not stuck anymore @"+e+", after "+Math.round(l)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}return}if((i||a)&&(this.stalled=null),!(t.paused||t.ended||t.playbackRate===0||!M.BufferHelper.getBuffered(t).length)){var g=M.BufferHelper.bufferInfo(t,e,0),h=g.len>0,o=g.nextStart||0;if(!(!h&&!o)){if(f){var n=g.len>b,d=!o||o-e>b&&!this.fragmentTracker.getPartialFragment(e);if(n||d)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var u,m=Math.max(o,g.start||0)-e,x=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,D=x==null||(u=x.details)===null||u===void 0?void 0:u.live,P=D?x.details.targetduration*2:b;if(m>0&&m<=P){this._trySkipBufferHole(null);return}}var _=self.performance.now();if(r===null){this.stalled=_;return}var F=_-r;!f&&F>=I&&this._reportStall(g.len);var U=M.BufferHelper.bufferInfo(t,e,s.maxBufferHole);this._tryFixBufferStall(U,F)}}},T._tryFixBufferStall=function(v,s){var t=this.config,r=this.fragmentTracker,e=this.media,f=e.currentTime,a=r.getPartialFragment(f);if(a){var i=this._trySkipBufferHole(a);if(i)return}v.len>t.maxBufferHole&&s>t.highBufferWatchdogPeriod*1e3&&(R.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())},T._reportStall=function(v){var s=this.hls,t=this.media,r=this.stallReported;r||(this.stallReported=!0,R.logger.warn("Playback stalling at @"+t.currentTime+" due to low buffer (buffer="+v+")"),s.trigger(L.Events.ERROR,{type:O.ErrorTypes.MEDIA_ERROR,details:O.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:v}))},T._trySkipBufferHole=function(v){for(var s=this.config,t=this.hls,r=this.media,e=r.currentTime,f=0,a=M.BufferHelper.getBuffered(r),i=0;i<a.length;i++){var l=a.start(i);if(e+s.maxBufferHole>=f&&e<l){var g=Math.max(l+c,r.currentTime+A);return R.logger.warn("skipping hole, adjusting currentTime from "+e+" to "+g),this.moved=!0,this.stalled=null,r.currentTime=g,v&&t.trigger(L.Events.ERROR,{type:O.ErrorTypes.MEDIA_ERROR,details:O.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+e+" to "+g,frag:v}),g}f=a.end(i)}return 0},T._tryNudgeBuffer=function(){var v=this.config,s=this.hls,t=this.media,r=t.currentTime,e=(this.nudgeRetry||0)+1;if(this.nudgeRetry=e,e<v.nudgeMaxRetry){var f=r+e*v.nudgeOffset;R.logger.warn("Nudging 'currentTime' from "+r+" to "+f),t.currentTime=f,s.trigger(L.Events.ERROR,{type:O.ErrorTypes.MEDIA_ERROR,details:O.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else R.logger.error("Playhead still not moving while enough data buffered @"+r+" after "+v.nudgeMaxRetry+" nudges"),s.trigger(L.Events.ERROR,{type:O.ErrorTypes.MEDIA_ERROR,details:O.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})},y}()},"./src/controller/id3-track-controller.ts":function(K,C,E){E.r(C);var M=E("./src/events.ts"),O=E("./src/utils/texttrack-utils.ts"),L=E("./src/demux/id3.ts"),R=.25,I=function(){function b(c){this.hls=void 0,this.id3Track=null,this.media=null,this.hls=c,this._registerListeners()}var A=b.prototype;return A.destroy=function(){this._unregisterListeners()},A._registerListeners=function(){var S=this.hls;S.on(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),S.on(M.Events.MEDIA_DETACHING,this.onMediaDetaching,this),S.on(M.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),S.on(M.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},A._unregisterListeners=function(){var S=this.hls;S.off(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),S.off(M.Events.MEDIA_DETACHING,this.onMediaDetaching,this),S.off(M.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),S.off(M.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},A.onMediaAttached=function(S,y){this.media=y.media},A.onMediaDetaching=function(){!this.id3Track||(Object(O.clearCurrentCues)(this.id3Track),this.id3Track=null,this.media=null)},A.getID3Track=function(S){if(!!this.media){for(var y=0;y<S.length;y++){var T=S[y];if(T.kind==="metadata"&&T.label==="id3")return Object(O.sendAddTrackEvent)(T,this.media),T}return this.media.addTextTrack("metadata","id3")}},A.onFragParsingMetadata=function(S,y){if(!!this.media){var T=y.frag,p=y.samples;this.id3Track||(this.id3Track=this.getID3Track(this.media.textTracks),this.id3Track.mode="hidden");for(var v=self.WebKitDataCue||self.VTTCue||self.TextTrackCue,s=0;s<p.length;s++){var t=L.getID3Frames(p[s].data);if(t){var r=p[s].pts,e=s<p.length-1?p[s+1].pts:T.end,f=e-r;f<=0&&(e=r+R);for(var a=0;a<t.length;a++){var i=t[a];if(!L.isTimeStampFrame(i)){var l=new v(r,e,"");l.value=i,this.id3Track.addCue(l)}}}}}},A.onBufferFlushing=function(S,y){var T=y.startOffset,p=y.endOffset,v=y.type;if(!v||v==="audio"){var s=this.id3Track;s&&Object(O.removeCuesInRange)(s,T,p)}},b}();C.default=I},"./src/controller/latency-controller.ts":function(K,C,E){E.r(C),E.d(C,"default",function(){return b});var M=E("./src/errors.ts"),O=E("./src/events.ts"),L=E("./src/utils/logger.ts");function R(A,c){for(var S=0;S<c.length;S++){var y=c[S];y.enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(A,y.key,y)}}function I(A,c,S){return c&&R(A.prototype,c),S&&R(A,S),A}var b=function(){function A(S){var y=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return y.timeupdate()},this.hls=S,this.config=S.config,this.registerListeners()}var c=A.prototype;return c.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},c.registerListeners=function(){this.hls.on(O.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(O.Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(O.Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(O.Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(O.Events.ERROR,this.onError,this)},c.unregisterListeners=function(){this.hls.off(O.Events.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(O.Events.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(O.Events.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(O.Events.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(O.Events.ERROR,this.onError)},c.onMediaAttached=function(y,T){this.media=T.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},c.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},c.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},c.onLevelUpdated=function(y,T){var p=T.details;this.levelDetails=p,p.advanced&&this.timeupdate(),!p.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},c.onError=function(y,T){T.details===M.ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,L.logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},c.timeupdate=function(){var y=this.media,T=this.levelDetails;if(!(!y||!T)){this.currentTime=y.currentTime;var p=this.computeLatency();if(p!==null){this._latency=p;var v=this.config,s=v.lowLatencyMode,t=v.maxLiveSyncPlaybackRate;if(!(!s||t===1)){var r=this.targetLatency;if(r!==null){var e=p-r,f=Math.min(this.maxLatency,r+T.targetduration),a=e<f;if(T.live&&a&&e>.05&&this.forwardBufferLength>1){var i=Math.min(2,Math.max(1,t)),l=Math.round(2/(1+Math.exp(-.75*e-this.edgeStalled))*20)/20;y.playbackRate=Math.min(i,Math.max(1,l))}else y.playbackRate!==1&&y.playbackRate!==0&&(y.playbackRate=1)}}}}},c.estimateLiveEdge=function(){var y=this.levelDetails;return y===null?null:y.edge+y.age},c.computeLatency=function(){var y=this.estimateLiveEdge();return y===null?null:y-this.currentTime},I(A,[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var y=this.config,T=this.levelDetails;return y.liveMaxLatencyDuration!==void 0?y.liveMaxLatencyDuration:T?y.liveMaxLatencyDurationCount*T.targetduration:0}},{key:"targetLatency",get:function(){var y=this.levelDetails;if(y===null)return null;var T=y.holdBack,p=y.partHoldBack,v=y.targetduration,s=this.config,t=s.liveSyncDuration,r=s.liveSyncDurationCount,e=s.lowLatencyMode,f=this.hls.userConfig,a=e&&p||T;(f.liveSyncDuration||f.liveSyncDurationCount||a===0)&&(a=t!==void 0?t:r*v);var i=v,l=1;return a+Math.min(this.stallCount*l,i)}},{key:"liveSyncPosition",get:function(){var y=this.estimateLiveEdge(),T=this.targetLatency,p=this.levelDetails;if(y===null||T===null||p===null)return null;var v=p.edge,s=y-T-this.edgeStalled,t=v-p.totalduration,r=v-(this.config.lowLatencyMode&&p.partTarget||p.targetduration);return Math.min(Math.max(t,s),r)}},{key:"drift",get:function(){var y=this.levelDetails;return y===null?1:y.drift}},{key:"edgeStalled",get:function(){var y=this.levelDetails;if(y===null)return 0;var T=(this.config.lowLatencyMode&&y.partTarget||y.targetduration)*3;return Math.max(y.age-T,0)}},{key:"forwardBufferLength",get:function(){var y=this.media,T=this.levelDetails;if(!y||!T)return 0;var p=y.buffered.length;return p?y.buffered.end(p-1):T.edge-this.currentTime}}]),A}()},"./src/controller/level-controller.ts":function(K,C,E){E.r(C),E.d(C,"default",function(){return s});var M=E("./src/types/level.ts"),O=E("./src/events.ts"),L=E("./src/errors.ts"),R=E("./src/utils/codecs.ts"),I=E("./src/controller/level-helper.ts"),b=E("./src/controller/base-playlist-controller.ts"),A=E("./src/types/loader.ts");function c(){return c=Object.assign||function(t){for(var r=1;r<arguments.length;r++){var e=arguments[r];for(var f in e)Object.prototype.hasOwnProperty.call(e,f)&&(t[f]=e[f])}return t},c.apply(this,arguments)}function S(t,r){for(var e=0;e<r.length;e++){var f=r[e];f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(t,f.key,f)}}function y(t,r,e){return r&&S(t.prototype,r),e&&S(t,e),t}function T(t,r){t.prototype=Object.create(r.prototype),t.prototype.constructor=t,p(t,r)}function p(t,r){return p=Object.setPrototypeOf||function(f,a){return f.__proto__=a,f},p(t,r)}var v=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),s=function(t){T(r,t);function r(f){var a;return a=t.call(this,f,"[level-controller]")||this,a._levels=[],a._firstLevel=-1,a._startLevel=void 0,a.currentLevelIndex=-1,a.manualLevelIndex=-1,a.onParsedComplete=void 0,a._registerListeners(),a}var e=r.prototype;return e._registerListeners=function(){var a=this.hls;a.on(O.Events.MANIFEST_LOADED,this.onManifestLoaded,this),a.on(O.Events.LEVEL_LOADED,this.onLevelLoaded,this),a.on(O.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),a.on(O.Events.FRAG_LOADED,this.onFragLoaded,this),a.on(O.Events.ERROR,this.onError,this)},e._unregisterListeners=function(){var a=this.hls;a.off(O.Events.MANIFEST_LOADED,this.onManifestLoaded,this),a.off(O.Events.LEVEL_LOADED,this.onLevelLoaded,this),a.off(O.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),a.off(O.Events.FRAG_LOADED,this.onFragLoaded,this),a.off(O.Events.ERROR,this.onError,this)},e.destroy=function(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,t.prototype.destroy.call(this)},e.startLoad=function(){var a=this._levels;a.forEach(function(i){i.loadError=0}),t.prototype.startLoad.call(this)},e.onManifestLoaded=function(a,i){var l=[],g=[],h=[],o,n={},d,u=!1,m=!1,x=!1;if(i.levels.forEach(function(F){var U=F.attrs;u=u||!!(F.width&&F.height),m=m||!!F.videoCodec,x=x||!!F.audioCodec,v&&F.audioCodec&&F.audioCodec.indexOf("mp4a.40.34")!==-1&&(F.audioCodec=void 0);var k=F.bitrate+"-"+F.attrs.RESOLUTION+"-"+F.attrs.CODECS;d=n[k],d?d.url.push(F.url):(d=new M.Level(F),n[k]=d,l.push(d)),U&&(U.AUDIO&&Object(I.addGroupId)(d,"audio",U.AUDIO),U.SUBTITLES&&Object(I.addGroupId)(d,"text",U.SUBTITLES))}),(u||m)&&x&&(l=l.filter(function(F){var U=F.videoCodec,k=F.width,N=F.height;return!!U||!!(k&&N)})),l=l.filter(function(F){var U=F.audioCodec,k=F.videoCodec;return(!U||Object(R.isCodecSupportedInMp4)(U,"audio"))&&(!k||Object(R.isCodecSupportedInMp4)(k,"video"))}),i.audioTracks&&(g=i.audioTracks.filter(function(F){return!F.audioCodec||Object(R.isCodecSupportedInMp4)(F.audioCodec,"audio")}),Object(I.assignTrackIdsByGroup)(g)),i.subtitles&&(h=i.subtitles,Object(I.assignTrackIdsByGroup)(h)),l.length>0){o=l[0].bitrate,l.sort(function(F,U){return F.bitrate-U.bitrate}),this._levels=l;for(var D=0;D<l.length;D++)if(l[D].bitrate===o){this._firstLevel=D,this.log("manifest loaded, "+l.length+" level(s) found, first bitrate: "+o);break}var P=x&&!m,_={levels:l,audioTracks:g,subtitleTracks:h,firstLevel:this._firstLevel,stats:i.stats,audio:x,video:m,altAudio:!P&&g.some(function(F){return!!F.url})};this.hls.trigger(O.Events.MANIFEST_PARSED,_),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(O.Events.ERROR,{type:L.ErrorTypes.MEDIA_ERROR,details:L.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:i.url,reason:"no level with compatible codecs found in manifest"})},e.onError=function(a,i){if(t.prototype.onError.call(this,a,i),!i.fatal){var l=i.context,g=this._levels[this.currentLevelIndex];if(l&&(l.type===A.PlaylistContextType.AUDIO_TRACK&&g.audioGroupIds&&l.groupId===g.audioGroupIds[g.urlId]||l.type===A.PlaylistContextType.SUBTITLE_TRACK&&g.textGroupIds&&l.groupId===g.textGroupIds[g.urlId])){this.redundantFailover(this.currentLevelIndex);return}var h=!1,o=!0,n;switch(i.details){case L.ErrorDetails.FRAG_LOAD_ERROR:case L.ErrorDetails.FRAG_LOAD_TIMEOUT:case L.ErrorDetails.KEY_LOAD_ERROR:case L.ErrorDetails.KEY_LOAD_TIMEOUT:if(i.frag){var d=this._levels[i.frag.level];d?(d.fragmentError++,d.fragmentError>this.hls.config.fragLoadingMaxRetry&&(n=i.frag.level)):n=i.frag.level}break;case L.ErrorDetails.LEVEL_LOAD_ERROR:case L.ErrorDetails.LEVEL_LOAD_TIMEOUT:l&&(l.deliveryDirectives&&(o=!1),n=l.level),h=!0;break;case L.ErrorDetails.REMUX_ALLOC_ERROR:n=i.level,h=!0;break}n!==void 0&&this.recoverLevel(i,n,h,o)}},e.recoverLevel=function(a,i,l,g){var h=a.details,o=this._levels[i];if(o.loadError++,l){var n=this.retryLoadingOrFail(a);if(n)a.levelRetry=!0;else{this.currentLevelIndex=-1;return}}if(g){var d=o.url.length;if(d>1&&o.loadError<d)a.levelRetry=!0,this.redundantFailover(i);else if(this.manualLevelIndex===-1){var u=i===0?this._levels.length-1:i-1;this.currentLevelIndex!==u&&this._levels[u].loadError===0&&(this.warn(h+": switch to "+u),a.levelRetry=!0,this.hls.nextAutoLevel=u)}}},e.redundantFailover=function(a){var i=this._levels[a],l=i.url.length;if(l>1){var g=(i.urlId+1)%l;this.warn("Switching to redundant URL-id "+g),this._levels.forEach(function(h){h.urlId=g}),this.level=a}},e.onFragLoaded=function(a,i){var l=i.frag;if(l!==void 0&&l.type===A.PlaylistLevelType.MAIN){var g=this._levels[l.level];g!==void 0&&(g.fragmentError=0,g.loadError=0)}},e.onLevelLoaded=function(a,i){var l,g=i.level,h=i.details,o=this._levels[g];if(!o){var n;this.warn("Invalid level index "+g),(n=i.deliveryDirectives)!==null&&n!==void 0&&n.skip&&(h.deltaUpdateFailed=!0);return}g===this.currentLevelIndex?(o.fragmentError===0&&(o.loadError=0,this.retryCount=0),this.playlistLoaded(g,i,o.details)):(l=i.deliveryDirectives)!==null&&l!==void 0&&l.skip&&(h.deltaUpdateFailed=!0)},e.onAudioTrackSwitched=function(a,i){var l=this.hls.levels[this.currentLevelIndex];if(!!l&&l.audioGroupIds){for(var g=-1,h=this.hls.audioTracks[i.id].groupId,o=0;o<l.audioGroupIds.length;o++)if(l.audioGroupIds[o]===h){g=o;break}g!==l.urlId&&(l.urlId=g,this.startLoad())}},e.loadPlaylist=function(a){var i=this.currentLevelIndex,l=this._levels[i];if(this.canLoad&&l&&l.url.length>0){var g=l.urlId,h=l.url[g];if(a)try{h=a.addDirectives(h)}catch(o){this.warn("Could not construct new URL with HLS Delivery Directives: "+o)}this.log("Attempt loading level index "+i+(a?" at sn "+a.msn+" part "+a.part:"")+" with URL-id "+g+" "+h),this.clearTimer(),this.hls.trigger(O.Events.LEVEL_LOADING,{url:h,level:i,id:g,deliveryDirectives:a||null})}},e.removeLevel=function(a,i){var l=function(o,n){return n!==i},g=this._levels.filter(function(h,o){return o!==a?!0:h.url.length>1&&i!==void 0?(h.url=h.url.filter(l),h.audioGroupIds&&(h.audioGroupIds=h.audioGroupIds.filter(l)),h.textGroupIds&&(h.textGroupIds=h.textGroupIds.filter(l)),h.urlId=0,!0):!1}).map(function(h,o){var n=h.details;return n!=null&&n.fragments&&n.fragments.forEach(function(d){d.level=o}),h});this._levels=g,this.hls.trigger(O.Events.LEVELS_UPDATED,{levels:g})},y(r,[{key:"levels",get:function(){return this._levels.length===0?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(a){var i,l=this._levels;if(l.length!==0&&!(this.currentLevelIndex===a&&(i=l[a])!==null&&i!==void 0&&i.details)){if(a<0||a>=l.length){var g=a<0;if(this.hls.trigger(O.Events.ERROR,{type:L.ErrorTypes.OTHER_ERROR,details:L.ErrorDetails.LEVEL_SWITCH_ERROR,level:a,fatal:g,reason:"invalid level idx"}),g)return;a=Math.min(a,l.length-1)}this.clearTimer();var h=this.currentLevelIndex,o=l[h],n=l[a];this.log("switching to level "+a+" from "+h),this.currentLevelIndex=a;var d=c({},n,{level:a,maxBitrate:n.maxBitrate,uri:n.uri,urlId:n.urlId});delete d._urlId,this.hls.trigger(O.Events.LEVEL_SWITCHING,d);var u=n.details;if(!u||u.live){var m=this.switchParams(n.uri,o==null?void 0:o.details);this.loadPlaylist(m)}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(a){this.manualLevelIndex=a,this._startLevel===void 0&&(this._startLevel=a),a!==-1&&(this.level=a)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(a){this._firstLevel=a}},{key:"startLevel",get:function(){if(this._startLevel===void 0){var a=this.hls.config.startLevel;return a!==void 0?a:this._firstLevel}else return this._startLevel},set:function(a){this._startLevel=a}},{key:"nextLoadLevel",get:function(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(a){this.level=a,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=a)}}]),r}(b.default)},"./src/controller/level-helper.ts":function(K,C,E){E.r(C),E.d(C,"addGroupId",function(){return L}),E.d(C,"assignTrackIdsByGroup",function(){return R}),E.d(C,"updatePTS",function(){return I}),E.d(C,"updateFragPTSDTS",function(){return A}),E.d(C,"mergeDetails",function(){return c}),E.d(C,"mapPartIntersection",function(){return S}),E.d(C,"mapFragmentIntersection",function(){return y}),E.d(C,"adjustSliding",function(){return T}),E.d(C,"addSliding",function(){return p}),E.d(C,"computeReloadInterval",function(){return v}),E.d(C,"getFragmentWithSN",function(){return s}),E.d(C,"getPartWith",function(){return t});var M=E("./src/polyfills/number.ts"),O=E("./src/utils/logger.ts");function L(r,e,f){switch(e){case"audio":r.audioGroupIds||(r.audioGroupIds=[]),r.audioGroupIds.push(f);break;case"text":r.textGroupIds||(r.textGroupIds=[]),r.textGroupIds.push(f);break}}function R(r){var e={};r.forEach(function(f){var a=f.groupId||"";f.id=e[a]=e[a]||0,e[a]++})}function I(r,e,f){var a=r[e],i=r[f];b(a,i)}function b(r,e){var f=e.startPTS;if(Object(M.isFiniteNumber)(f)){var a=0,i;e.sn>r.sn?(a=f-r.start,i=r):(a=r.start-f,i=e),i.duration!==a&&(i.duration=a)}else if(e.sn>r.sn){var l=r.cc===e.cc;l&&r.minEndPTS?e.start=r.start+(r.minEndPTS-r.start):e.start=r.start+r.duration}else e.start=Math.max(r.start-e.duration,0)}function A(r,e,f,a,i,l){var g=a-f;g<=0&&(O.logger.warn("Fragment should have a positive duration",e),a=f+e.duration,l=i+e.duration);var h=f,o=a,n=e.startPTS,d=e.endPTS;if(Object(M.isFiniteNumber)(n)){var u=Math.abs(n-f);Object(M.isFiniteNumber)(e.deltaPTS)?e.deltaPTS=Math.max(u,e.deltaPTS):e.deltaPTS=u,h=Math.max(f,n),f=Math.min(f,n),i=Math.min(i,e.startDTS),o=Math.min(a,d),a=Math.max(a,d),l=Math.max(l,e.endDTS)}e.duration=a-f;var m=f-e.start;e.appendedPTS=a,e.start=e.startPTS=f,e.maxStartPTS=h,e.startDTS=i,e.endPTS=a,e.minEndPTS=o,e.endDTS=l;var x=e.sn;if(!r||x<r.startSN||x>r.endSN)return 0;var D,P=x-r.startSN,_=r.fragments;for(_[P]=e,D=P;D>0;D--)b(_[D],_[D-1]);for(D=P;D<_.length-1;D++)b(_[D],_[D+1]);return r.fragmentHint&&b(_[_.length-1],r.fragmentHint),r.PTSKnown=r.alignedSliding=!0,m}function c(r,e){for(var f=null,a=r.fragments,i=a.length-1;i>=0;i--){var l=a[i].initSegment;if(l){f=l;break}}r.fragmentHint&&delete r.fragmentHint.endPTS;var g=0,h;if(y(r,e,function(x,D){var P;x.relurl&&(g=x.cc-D.cc),Object(M.isFiniteNumber)(x.startPTS)&&Object(M.isFiniteNumber)(x.endPTS)&&(D.start=D.startPTS=x.startPTS,D.startDTS=x.startDTS,D.appendedPTS=x.appendedPTS,D.maxStartPTS=x.maxStartPTS,D.endPTS=x.endPTS,D.endDTS=x.endDTS,D.minEndPTS=x.minEndPTS,D.duration=x.endPTS-x.startPTS,D.duration&&(h=D),e.PTSKnown=e.alignedSliding=!0),D.elementaryStreams=x.elementaryStreams,D.loader=x.loader,D.stats=x.stats,D.urlId=x.urlId,x.initSegment?(D.initSegment=x.initSegment,f=x.initSegment):(!D.initSegment||D.initSegment.relurl==((P=f)===null||P===void 0?void 0:P.relurl))&&(D.initSegment=f)}),e.skippedSegments&&(e.deltaUpdateFailed=e.fragments.some(function(x){return!x}),e.deltaUpdateFailed)){O.logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var o=e.skippedSegments;o--;)e.fragments.shift();e.startSN=e.fragments[0].sn,e.startCC=e.fragments[0].cc}var n=e.fragments;if(g){O.logger.warn("discontinuity sliding from playlist, take drift into account");for(var d=0;d<n.length;d++)n[d].cc+=g}e.skippedSegments&&(e.startCC=e.fragments[0].cc),S(r.partList,e.partList,function(x,D){D.elementaryStreams=x.elementaryStreams,D.stats=x.stats}),h?A(e,h,h.startPTS,h.endPTS,h.startDTS,h.endDTS):T(r,e),n.length&&(e.totalduration=e.edge-n[0].start),e.driftStartTime=r.driftStartTime,e.driftStart=r.driftStart;var u=e.advancedDateTime;if(e.advanced&&u){var m=e.edge;e.driftStart||(e.driftStartTime=u,e.driftStart=m),e.driftEndTime=u,e.driftEnd=m}else e.driftEndTime=r.driftEndTime,e.driftEnd=r.driftEnd,e.advancedDateTime=r.advancedDateTime}function S(r,e,f){if(r&&e)for(var a=0,i=0,l=r.length;i<=l;i++){var g=r[i],h=e[i+a];g&&h&&g.index===h.index&&g.fragment.sn===h.fragment.sn?f(g,h):a--}}function y(r,e,f){for(var a=e.skippedSegments,i=Math.max(r.startSN,e.startSN)-e.startSN,l=(r.fragmentHint?1:0)+(a?e.endSN:Math.min(r.endSN,e.endSN))-e.startSN,g=e.startSN-r.startSN,h=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,o=r.fragmentHint?r.fragments.concat(r.fragmentHint):r.fragments,n=i;n<=l;n++){var d=o[g+n],u=h[n];a&&!u&&n<a&&(u=e.fragments[n]=d),d&&u&&f(d,u)}}function T(r,e){var f=e.startSN+e.skippedSegments-r.startSN,a=r.fragments;f<0||f>=a.length||p(e,a[f].start)}function p(r,e){if(e){for(var f=r.fragments,a=r.skippedSegments;a<f.length;a++)f[a].start+=e;r.fragmentHint&&(r.fragmentHint.start+=e)}}function v(r,e){var f=1e3*r.levelTargetDuration,a=f/2,i=r.age,l=i>0&&i<f*3,g=e.loading.end-e.loading.start,h,o=r.availabilityDelay;if(r.updated===!1)if(l){var n=333*r.misses;h=Math.max(Math.min(a,g*2),n),r.availabilityDelay=(r.availabilityDelay||0)+h}else h=a;else l?(o=Math.min(o||f/2,i),r.availabilityDelay=o,h=o+f-i):h=f-g;return Math.round(h)}function s(r,e,f){if(!r||!r.details)return null;var a=r.details,i=a.fragments[e-a.startSN];return i||(i=a.fragmentHint,i&&i.sn===e)?i:e<a.startSN&&f&&f.sn===e?f:null}function t(r,e,f){if(!r||!r.details)return null;var a=r.details.partList;if(a)for(var i=a.length;i--;){var l=a[i];if(l.index===f&&l.fragment.sn===e)return l}return null}},"./src/controller/stream-controller.ts":function(K,C,E){E.r(C),E.d(C,"default",function(){return a});var M=E("./src/polyfills/number.ts"),O=E("./src/controller/base-stream-controller.ts"),L=E("./src/is-supported.ts"),R=E("./src/events.ts"),I=E("./src/utils/buffer-helper.ts"),b=E("./src/controller/fragment-tracker.ts"),A=E("./src/types/loader.ts"),c=E("./src/loader/fragment.ts"),S=E("./src/demux/transmuxer-interface.ts"),y=E("./src/types/transmuxer.ts"),T=E("./src/controller/gap-controller.ts"),p=E("./src/errors.ts"),v=E("./src/utils/logger.ts");function s(i,l){for(var g=0;g<l.length;g++){var h=l[g];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(i,h.key,h)}}function t(i,l,g){return l&&s(i.prototype,l),g&&s(i,g),i}function r(i,l){i.prototype=Object.create(l.prototype),i.prototype.constructor=i,e(i,l)}function e(i,l){return e=Object.setPrototypeOf||function(h,o){return h.__proto__=o,h},e(i,l)}var f=100,a=function(i){r(l,i);function l(h,o){var n;return n=i.call(this,h,o,"[stream-controller]")||this,n.audioCodecSwap=!1,n.gapController=null,n.level=-1,n._forceStartLoad=!1,n.altAudio=!1,n.audioOnly=!1,n.fragPlaying=null,n.onvplaying=null,n.onvseeked=null,n.fragLastKbps=0,n.stalled=!1,n.couldBacktrack=!1,n.audioCodecSwitch=!1,n.videoBuffer=null,n._registerListeners(),n}var g=l.prototype;return g._registerListeners=function(){var o=this.hls;o.on(R.Events.MEDIA_ATTACHED,this.onMediaAttached,this),o.on(R.Events.MEDIA_DETACHING,this.onMediaDetaching,this),o.on(R.Events.MANIFEST_LOADING,this.onManifestLoading,this),o.on(R.Events.MANIFEST_PARSED,this.onManifestParsed,this),o.on(R.Events.LEVEL_LOADING,this.onLevelLoading,this),o.on(R.Events.LEVEL_LOADED,this.onLevelLoaded,this),o.on(R.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),o.on(R.Events.ERROR,this.onError,this),o.on(R.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),o.on(R.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),o.on(R.Events.BUFFER_CREATED,this.onBufferCreated,this),o.on(R.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),o.on(R.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),o.on(R.Events.FRAG_BUFFERED,this.onFragBuffered,this)},g._unregisterListeners=function(){var o=this.hls;o.off(R.Events.MEDIA_ATTACHED,this.onMediaAttached,this),o.off(R.Events.MEDIA_DETACHING,this.onMediaDetaching,this),o.off(R.Events.MANIFEST_LOADING,this.onManifestLoading,this),o.off(R.Events.MANIFEST_PARSED,this.onManifestParsed,this),o.off(R.Events.LEVEL_LOADED,this.onLevelLoaded,this),o.off(R.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),o.off(R.Events.ERROR,this.onError,this),o.off(R.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),o.off(R.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),o.off(R.Events.BUFFER_CREATED,this.onBufferCreated,this),o.off(R.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),o.off(R.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),o.off(R.Events.FRAG_BUFFERED,this.onFragBuffered,this)},g.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},g.startLoad=function(o){if(this.levels){var n=this.lastCurrentTime,d=this.hls;if(this.stopLoad(),this.setInterval(f),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var u=d.startLevel;u===-1&&(d.config.testBandwidth?(u=0,this.bitrateTest=!0):u=d.nextAutoLevel),this.level=d.nextLoadLevel=u,this.loadedmetadata=!1}n>0&&o===-1&&(this.log("Override startPosition with lastCurrentTime @"+n.toFixed(3)),o=n),this.state=O.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=o,this.tick()}else this._forceStartLoad=!0,this.state=O.State.STOPPED},g.stopLoad=function(){this._forceStartLoad=!1,i.prototype.stopLoad.call(this)},g.doTick=function(){switch(this.state){case O.State.IDLE:this.doTickIdle();break;case O.State.WAITING_LEVEL:{var o,n=this.levels,d=this.level,u=n==null||(o=n[d])===null||o===void 0?void 0:o.details;if(u&&(!u.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(u))break;this.state=O.State.IDLE;break}break}case O.State.FRAG_LOADING_WAITING_RETRY:{var m,x=self.performance.now(),D=this.retryDate;(!D||x>=D||(m=this.media)!==null&&m!==void 0&&m.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.state=O.State.IDLE)}break}this.onTickEnd()},g.onTickEnd=function(){i.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},g.doTickIdle=function(){var o,n,d=this.hls,u=this.levelLastLoaded,m=this.levels,x=this.media,D=d.config,P=d.nextLoadLevel;if(!(u===null||!x&&(this.startFragRequested||!D.startFragPrefetch))&&!(this.altAudio&&this.audioOnly)&&!(!m||!m[P])){var _=m[P];this.level=d.nextLoadLevel=P;var F=_.details;if(!F||this.state===O.State.WAITING_LEVEL||F.live&&this.levelLastLoaded!==P){this.state=O.State.WAITING_LEVEL;return}var U=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:x,A.PlaylistLevelType.MAIN);if(U!==null){var k=U.len,N=this.getMaxBufferLength(_.maxBitrate);if(!(k>=N)){if(this._streamEnded(U,F)){var w={};this.altAudio&&(w.type="video"),this.hls.trigger(R.Events.BUFFER_EOS,w),this.state=O.State.ENDED;return}var V=U.end,W=this.getNextFragment(V,F);if(this.couldBacktrack&&!this.fragPrevious&&W&&W.sn!=="initSegment"){var Y=W.sn-F.startSN;Y>1&&(W=F.fragments[Y-1],this.fragmentTracker.removeFragment(W))}if(W&&this.fragmentTracker.getState(W)===b.FragmentState.OK&&this.nextLoadPosition>V){var j=this.audioOnly&&!this.altAudio?c.ElementaryStreamTypes.AUDIO:c.ElementaryStreamTypes.VIDEO;this.afterBufferFlushed(x,j,A.PlaylistLevelType.MAIN),W=this.getNextFragment(this.nextLoadPosition,F)}!W||(W.initSegment&&!W.initSegment.data&&!this.bitrateTest&&(W=W.initSegment),((o=W.decryptdata)===null||o===void 0?void 0:o.keyFormat)==="identity"&&!((n=W.decryptdata)!==null&&n!==void 0&&n.key)?this.loadKey(W,F):this.loadFragment(W,F,V))}}}},g.loadFragment=function(o,n,d){var u,m=this.fragmentTracker.getState(o);if(this.fragCurrent=o,m===b.FragmentState.BACKTRACKED){var x=this.fragmentTracker.getBacktrackData(o);if(x){this._handleFragmentLoadProgress(x),this._handleFragmentLoadComplete(x);return}else m=b.FragmentState.NOT_LOADED}m===b.FragmentState.NOT_LOADED||m===b.FragmentState.PARTIAL?o.sn==="initSegment"?this._loadInitSegment(o):this.bitrateTest?(o.bitrateTest=!0,this.log("Fragment "+o.sn+" of level "+o.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(o)):(this.startFragRequested=!0,i.prototype.loadFragment.call(this,o,n,d)):m===b.FragmentState.APPENDING?this.reduceMaxBufferLength(o.duration)&&this.fragmentTracker.removeFragment(o):((u=this.media)===null||u===void 0?void 0:u.buffered.length)===0&&this.fragmentTracker.removeAllFragments()},g.getAppendedFrag=function(o){var n=this.fragmentTracker.getAppendedFrag(o,A.PlaylistLevelType.MAIN);return n&&"fragment"in n?n.fragment:n},g.getBufferedFrag=function(o){return this.fragmentTracker.getBufferedFrag(o,A.PlaylistLevelType.MAIN)},g.followingBufferedFrag=function(o){return o?this.getBufferedFrag(o.end+.5):null},g.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},g.nextLevelSwitch=function(){var o=this.levels,n=this.media;if(n!=null&&n.readyState){var d,u=this.getAppendedFrag(n.currentTime);if(u&&u.start>1&&this.flushMainBuffer(0,u.start-1),!n.paused&&o){var m=this.hls.nextLoadLevel,x=o[m],D=this.fragLastKbps;D&&this.fragCurrent?d=this.fragCurrent.duration*x.maxBitrate/(1e3*D)+1:d=0}else d=0;var P=this.getBufferedFrag(n.currentTime+d);if(P){var _=this.followingBufferedFrag(P);if(_){this.abortCurrentFrag();var F=_.maxStartPTS?_.maxStartPTS:_.start,U=_.duration,k=Math.max(P.end,F+Math.min(Math.max(U-this.config.maxFragLookUpTolerance,U*.5),U*.75));this.flushMainBuffer(k,Number.POSITIVE_INFINITY)}}}},g.abortCurrentFrag=function(){var o=this.fragCurrent;this.fragCurrent=null,o!=null&&o.loader&&o.loader.abort(),this.state===O.State.KEY_LOADING&&(this.state=O.State.IDLE),this.nextLoadPosition=this.getLoadPosition()},g.flushMainBuffer=function(o,n){i.prototype.flushMainBuffer.call(this,o,n,this.altAudio?"video":null)},g.onMediaAttached=function(o,n){i.prototype.onMediaAttached.call(this,o,n);var d=n.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),d.addEventListener("playing",this.onvplaying),d.addEventListener("seeked",this.onvseeked),this.gapController=new T.default(this.config,d,this.fragmentTracker,this.hls)},g.onMediaDetaching=function(){var o=this.media;o&&(o.removeEventListener("playing",this.onvplaying),o.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),i.prototype.onMediaDetaching.call(this)},g.onMediaPlaying=function(){this.tick()},g.onMediaSeeked=function(){var o=this.media,n=o?o.currentTime:null;Object(M.isFiniteNumber)(n)&&this.log("Media seeked to "+n.toFixed(3)),this.tick()},g.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(R.Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=this.stalled=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null},g.onManifestParsed=function(o,n){var d=!1,u=!1,m;n.levels.forEach(function(x){m=x.audioCodec,m&&(m.indexOf("mp4a.40.2")!==-1&&(d=!0),m.indexOf("mp4a.40.5")!==-1&&(u=!0))}),this.audioCodecSwitch=d&&u&&!Object(L.changeTypeSupported)(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=n.levels,this.startFragRequested=!1},g.onLevelLoading=function(o,n){var d=this.levels;if(!(!d||this.state!==O.State.IDLE)){var u=d[n.level];(!u.details||u.details.live&&this.levelLastLoaded!==n.level||this.waitForCdnTuneIn(u.details))&&(this.state=O.State.WAITING_LEVEL)}},g.onLevelLoaded=function(o,n){var d,u=this.levels,m=n.level,x=n.details,D=x.totalduration;if(!u){this.warn("Levels were reset while loading level "+m);return}this.log("Level "+m+" loaded ["+x.startSN+","+x.endSN+"], cc ["+x.startCC+", "+x.endCC+"] duration:"+D);var P=this.fragCurrent;P&&(this.state===O.State.FRAG_LOADING||this.state===O.State.FRAG_LOADING_WAITING_RETRY)&&P.level!==n.level&&P.loader&&(this.state=O.State.IDLE,P.loader.abort());var _=u[m],F=0;if(x.live||(d=_.details)!==null&&d!==void 0&&d.live){if(x.fragments[0]||(x.deltaUpdateFailed=!0),x.deltaUpdateFailed)return;F=this.alignPlaylists(x,_.details)}if(_.details=x,this.levelLastLoaded=m,this.hls.trigger(R.Events.LEVEL_UPDATED,{details:x,level:m}),this.state===O.State.WAITING_LEVEL){if(this.waitForCdnTuneIn(x))return;this.state=O.State.IDLE}this.startFragRequested?x.live&&this.synchronizeToLiveEdge(x):this.setStartPosition(x,F),this.tick()},g._handleFragmentLoadProgress=function(o){var n,d=o.frag,u=o.part,m=o.payload,x=this.levels;if(!x){this.warn("Levels were reset while fragment load was in progress. Fragment "+d.sn+" of level "+d.level+" will not be buffered");return}var D=x[d.level],P=D.details;if(!P){this.warn("Dropping fragment "+d.sn+" of level "+d.level+" after level details were reset");return}var _=D.videoCodec,F=P.PTSKnown||!P.live,U=(n=d.initSegment)===null||n===void 0?void 0:n.data,k=this._getAudioCodec(D),N=this.transmuxer=this.transmuxer||new S.default(this.hls,A.PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),w=u?u.index:-1,V=w!==-1,W=new y.ChunkMetadata(d.level,d.sn,d.stats.chunkCount,m.byteLength,w,V),Y=this.initPTS[d.cc];N.push(m,U,k,_,d,u,P.totalduration,F,W,Y)},g.onAudioTrackSwitching=function(o,n){var d=this.altAudio,u=!!n.url,m=n.id;if(!u){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var x=this.fragCurrent;x!=null&&x.loader&&(this.log("Switching to main audio track, cancel main fragment load"),x.loader.abort()),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var D=this.hls;d&&D.trigger(R.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),D.trigger(R.Events.AUDIO_TRACK_SWITCHED,{id:m})}},g.onAudioTrackSwitched=function(o,n){var d=n.id,u=!!this.hls.audioTracks[d].url;if(u){var m=this.videoBuffer;m&&this.mediaBuffer!==m&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=m)}this.altAudio=u,this.tick()},g.onBufferCreated=function(o,n){var d=n.tracks,u,m,x=!1;for(var D in d){var P=d[D];if(P.id==="main"){if(m=D,u=P,D==="video"){var _=d[D];_&&(this.videoBuffer=_.buffer)}}else x=!0}x&&u?(this.log("Alternate track found, use "+m+".buffered to schedule main fragment loading"),this.mediaBuffer=u.buffer):this.mediaBuffer=this.media},g.onFragBuffered=function(o,n){var d=n.frag,u=n.part;if(!(d&&d.type!==A.PlaylistLevelType.MAIN)){if(this.fragContextChanged(d)){this.warn("Fragment "+d.sn+(u?" p: "+u.index:"")+" of level "+d.level+" finished buffering, but was aborted. state: "+this.state),this.state===O.State.PARSED&&(this.state=O.State.IDLE);return}var m=u?u.stats:d.stats;this.fragLastKbps=Math.round(8*m.total/(m.buffering.end-m.loading.first)),d.sn!=="initSegment"&&(this.fragPrevious=d),this.fragBufferedComplete(d,u)}},g.onError=function(o,n){switch(n.details){case p.ErrorDetails.FRAG_LOAD_ERROR:case p.ErrorDetails.FRAG_LOAD_TIMEOUT:case p.ErrorDetails.KEY_LOAD_ERROR:case p.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(A.PlaylistLevelType.MAIN,n);break;case p.ErrorDetails.LEVEL_LOAD_ERROR:case p.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==O.State.ERROR&&(n.fatal?(this.warn(""+n.details),this.state=O.State.ERROR):!n.levelRetry&&this.state===O.State.WAITING_LEVEL&&(this.state=O.State.IDLE));break;case p.ErrorDetails.BUFFER_FULL_ERROR:if(n.parent==="main"&&(this.state===O.State.PARSING||this.state===O.State.PARSED)){var d=!0,u=this.getFwdBufferInfo(this.media,A.PlaylistLevelType.MAIN);u&&u.len>.5&&(d=!this.reduceMaxBufferLength(u.len)),d&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState()}break}},g.checkBuffer=function(){var o=this.media,n=this.gapController;if(!(!o||!n||!o.readyState)){var d=I.BufferHelper.getBuffered(o);!this.loadedmetadata&&d.length?(this.loadedmetadata=!0,this.seekToStartPos()):n.poll(this.lastCurrentTime),this.lastCurrentTime=o.currentTime}},g.onFragLoadEmergencyAborted=function(){this.state=O.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},g.onBufferFlushed=function(o,n){var d=n.type;if(d!==c.ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio){var u=(d===c.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(u,d,A.PlaylistLevelType.MAIN)}},g.onLevelsUpdated=function(o,n){this.levels=n.levels},g.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},g.seekToStartPos=function(){var o=this.media,n=o.currentTime,d=this.startPosition;if(d>=0&&n<d){if(o.seeking){v.logger.log("could not seek to "+d+", already seeking at "+n);return}var u=I.BufferHelper.getBuffered(o),m=u.length?u.start(0):0,x=m-d;x>0&&x<this.config.maxBufferHole&&(v.logger.log("adjusting start position by "+x+" to match buffer start"),d+=x,this.startPosition=d),this.log("seek to target start position "+d+" from current time "+n),o.currentTime=d}},g._getAudioCodec=function(o){var n=this.config.defaultAudioCodec||o.audioCodec;return this.audioCodecSwap&&n&&(this.log("Swapping audio codec"),n.indexOf("mp4a.40.5")!==-1?n="mp4a.40.2":n="mp4a.40.5"),n},g._loadBitrateTestFrag=function(o){var n=this;this._doFragLoad(o).then(function(d){var u=n.hls;if(!(!d||u.nextLoadLevel||n.fragContextChanged(o))){n.fragLoadError=0,n.state=O.State.IDLE,n.startFragRequested=!1,n.bitrateTest=!1;var m=o.stats;m.parsing.start=m.parsing.end=m.buffering.start=m.buffering.end=self.performance.now(),u.trigger(R.Events.FRAG_LOADED,d)}})},g._handleTransmuxComplete=function(o){var n,d="main",u=this.hls,m=o.remuxResult,x=o.chunkMeta,D=this.getCurrentContext(x);if(!D){this.warn("The loading context changed while buffering fragment "+x.sn+" of level "+x.level+". This chunk will not be buffered."),this.resetLiveStartWhenNotLoaded(x.level);return}var P=D.frag,_=D.part,F=D.level,U=m.video,k=m.text,N=m.id3,w=m.initSegment,V=this.altAudio?void 0:m.audio;if(!this.fragContextChanged(P)){if(this.state=O.State.PARSING,w){w.tracks&&(this._bufferInitSegment(F,w.tracks,P,x),u.trigger(R.Events.FRAG_PARSING_INIT_SEGMENT,{frag:P,id:d,tracks:w.tracks}));var W=w.initPTS,Y=w.timescale;Object(M.isFiniteNumber)(W)&&(this.initPTS[P.cc]=W,u.trigger(R.Events.INIT_PTS_FOUND,{frag:P,id:d,initPTS:W,timescale:Y}))}if(U&&m.independent!==!1){if(F.details){var j=U.startPTS,X=U.endPTS,$=U.startDTS,Q=U.endDTS;if(_)_.elementaryStreams[U.type]={startPTS:j,endPTS:X,startDTS:$,endDTS:Q};else if(U.firstKeyFrame&&U.independent&&(this.couldBacktrack=!0),U.dropped&&U.independent){var z=this.getLoadPosition()+this.config.maxBufferHole;if(z<j){this.backtrack(P);return}P.setElementaryStreamInfo(U.type,P.start,X,P.start,Q,!0)}P.setElementaryStreamInfo(U.type,j,X,$,Q),this.bufferFragmentData(U,P,_,x)}}else if(m.independent===!1){this.backtrack(P);return}if(V){var J=V.startPTS,Z=V.endPTS,q=V.startDTS,ee=V.endDTS;_&&(_.elementaryStreams[c.ElementaryStreamTypes.AUDIO]={startPTS:J,endPTS:Z,startDTS:q,endDTS:ee}),P.setElementaryStreamInfo(c.ElementaryStreamTypes.AUDIO,J,Z,q,ee),this.bufferFragmentData(V,P,_,x)}if(N!=null&&(n=N.samples)!==null&&n!==void 0&&n.length){var ne={frag:P,id:d,samples:N.samples};u.trigger(R.Events.FRAG_PARSING_METADATA,ne)}if(k){var te={frag:P,id:d,samples:k.samples};u.trigger(R.Events.FRAG_PARSING_USERDATA,te)}}},g._bufferInitSegment=function(o,n,d,u){var m=this;if(this.state===O.State.PARSING){this.audioOnly=!!n.audio&&!n.video,this.altAudio&&!this.audioOnly&&delete n.audio;var x=n.audio,D=n.video,P=n.audiovideo;if(x){var _=o.audioCodec,F=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(_&&(_.indexOf("mp4a.40.5")!==-1?_="mp4a.40.2":_="mp4a.40.5"),x.metadata.channelCount!==1&&F.indexOf("firefox")===-1&&(_="mp4a.40.5")),F.indexOf("android")!==-1&&x.container!=="audio/mpeg"&&(_="mp4a.40.2",this.log("Android: force audio codec to "+_)),o.audioCodec&&o.audioCodec!==_&&this.log('Swapping manifest audio codec "'+o.audioCodec+'" for "'+_+'"'),x.levelCodec=_,x.id="main",this.log("Init audio buffer, container:"+x.container+", codecs[selected/level/parsed]=["+(_||"")+"/"+(o.audioCodec||"")+"/"+x.codec+"]")}D&&(D.levelCodec=o.videoCodec,D.id="main",this.log("Init video buffer, container:"+D.container+", codecs[level/parsed]=["+(o.videoCodec||"")+"/"+D.codec+"]")),P&&this.log("Init audiovideo buffer, container:"+P.container+", codecs[level/parsed]=["+(o.attrs.CODECS||"")+"/"+P.codec+"]"),this.hls.trigger(R.Events.BUFFER_CODECS,n),Object.keys(n).forEach(function(U){var k=n[U],N=k.initSegment;N!=null&&N.byteLength&&m.hls.trigger(R.Events.BUFFER_APPENDING,{type:U,data:N,frag:d,part:null,chunkMeta:u,parent:d.type})}),this.tick()}},g.backtrack=function(o){this.couldBacktrack=!0,this.resetTransmuxer(),this.flushBufferGap(o);var n=this.fragmentTracker.backtrack(o);this.fragPrevious=null,this.nextLoadPosition=o.start,n?this.resetFragmentLoading(o):this.state=O.State.BACKTRACKING},g.checkFragmentChanged=function(){var o=this.media,n=null;if(o&&o.readyState>1&&o.seeking===!1){var d=o.currentTime;if(I.BufferHelper.isBuffered(o,d)?n=this.getAppendedFrag(d):I.BufferHelper.isBuffered(o,d+.1)&&(n=this.getAppendedFrag(d+.1)),n){var u=this.fragPlaying,m=n.level;(!u||n.sn!==u.sn||u.level!==m||n.urlId!==u.urlId)&&(this.hls.trigger(R.Events.FRAG_CHANGED,{frag:n}),(!u||u.level!==m)&&this.hls.trigger(R.Events.LEVEL_SWITCHED,{level:m}),this.fragPlaying=n)}}},t(l,[{key:"nextLevel",get:function(){var o=this.nextBufferedFrag;return o?o.level:-1}},{key:"currentLevel",get:function(){var o=this.media;if(o){var n=this.getAppendedFrag(o.currentTime);if(n)return n.level}return-1}},{key:"nextBufferedFrag",get:function(){var o=this.media;if(o){var n=this.getAppendedFrag(o.currentTime);return this.followingBufferedFrag(n)}else return null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}]),l}(O.default)},"./src/controller/subtitle-stream-controller.ts":function(K,C,E){E.r(C),E.d(C,"SubtitleStreamController",function(){return r});var M=E("./src/events.ts"),O=E("./src/utils/logger.ts"),L=E("./src/utils/buffer-helper.ts"),R=E("./src/controller/fragment-finders.ts"),I=E("./src/utils/discontinuities.ts"),b=E("./src/controller/level-helper.ts"),A=E("./src/controller/fragment-tracker.ts"),c=E("./src/controller/base-stream-controller.ts"),S=E("./src/types/loader.ts"),y=E("./src/types/level.ts");function T(e,f){for(var a=0;a<f.length;a++){var i=f[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function p(e,f,a){return f&&T(e.prototype,f),a&&T(e,a),e}function v(e,f){e.prototype=Object.create(f.prototype),e.prototype.constructor=e,s(e,f)}function s(e,f){return s=Object.setPrototypeOf||function(i,l){return i.__proto__=l,i},s(e,f)}var t=500,r=function(e){v(f,e);function f(i,l){var g;return g=e.call(this,i,l,"[subtitle-stream-controller]")||this,g.levels=[],g.currentTrackId=-1,g.tracksBuffered=[],g.mainDetails=null,g._registerListeners(),g}var a=f.prototype;return a.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},a._registerListeners=function(){var l=this.hls;l.on(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),l.on(M.Events.MEDIA_DETACHING,this.onMediaDetaching,this),l.on(M.Events.MANIFEST_LOADING,this.onManifestLoading,this),l.on(M.Events.LEVEL_LOADED,this.onLevelLoaded,this),l.on(M.Events.ERROR,this.onError,this),l.on(M.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),l.on(M.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),l.on(M.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),l.on(M.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),l.on(M.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},a._unregisterListeners=function(){var l=this.hls;l.off(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),l.off(M.Events.MEDIA_DETACHING,this.onMediaDetaching,this),l.off(M.Events.MANIFEST_LOADING,this.onManifestLoading,this),l.off(M.Events.LEVEL_LOADED,this.onLevelLoaded,this),l.off(M.Events.ERROR,this.onError,this),l.off(M.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),l.off(M.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),l.off(M.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),l.off(M.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),l.off(M.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},a.startLoad=function(){this.stopLoad(),this.state=c.State.IDLE,this.setInterval(t),this.tick()},a.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},a.onLevelLoaded=function(l,g){this.mainDetails=g.details},a.onSubtitleFragProcessed=function(l,g){var h=g.frag,o=g.success;if(this.fragPrevious=h,this.state=c.State.IDLE,!!o){var n=this.tracksBuffered[this.currentTrackId];if(!!n){for(var d,u=h.start,m=0;m<n.length;m++)if(u>=n[m].start&&u<=n[m].end){d=n[m];break}var x=h.start+h.duration;d?d.end=x:(d={start:u,end:x},n.push(d)),this.fragmentTracker.fragBuffered(h)}}},a.onBufferFlushing=function(l,g){var h=g.startOffset,o=g.endOffset;if(h===0&&o!==Number.POSITIVE_INFINITY){var n=this.currentTrackId,d=this.levels;if(!d.length||!d[n]||!d[n].details)return;var u=d[n].details,m=u.targetduration,x=o-m;if(x<=0)return;g.endOffsetSubtitles=Math.max(0,x),this.tracksBuffered.forEach(function(D){for(var P=0;P<D.length;){if(D[P].end<=x){D.shift();continue}else if(D[P].start<x)D[P].start=x;else break;P++}}),this.fragmentTracker.removeFragmentsInRange(h,x,S.PlaylistLevelType.SUBTITLE)}},a.onError=function(l,g){var h,o=g.frag;!o||o.type!==S.PlaylistLevelType.SUBTITLE||((h=this.fragCurrent)!==null&&h!==void 0&&h.loader&&this.fragCurrent.loader.abort(),this.state=c.State.IDLE)},a.onSubtitleTracksUpdated=function(l,g){var h=this,o=g.subtitleTracks;this.tracksBuffered=[],this.levels=o.map(function(n){return new y.Level(n)}),this.fragmentTracker.removeAllFragments(),this.fragPrevious=null,this.levels.forEach(function(n){h.tracksBuffered[n.id]=[]}),this.mediaBuffer=null},a.onSubtitleTrackSwitch=function(l,g){if(this.currentTrackId=g.id,!this.levels.length||this.currentTrackId===-1){this.clearInterval();return}var h=this.levels[this.currentTrackId];h!=null&&h.details?(this.mediaBuffer=this.mediaBufferTimeRanges,this.setInterval(t)):this.mediaBuffer=null},a.onSubtitleTrackLoaded=function(l,g){var h,o=g.details,n=g.id,d=this.currentTrackId,u=this.levels;if(!!u.length){var m=u[d];if(!(n>=u.length||n!==d||!m)){if(this.mediaBuffer=this.mediaBufferTimeRanges,o.live||(h=m.details)!==null&&h!==void 0&&h.live){var x=this.mainDetails;if(o.deltaUpdateFailed||!x)return;var D=x.fragments[0];if(!m.details)o.hasProgramDateTime&&x.hasProgramDateTime?Object(I.alignPDT)(o,x):D&&Object(b.addSliding)(o,D.start);else{var P=this.alignPlaylists(o,m.details);P===0&&D&&Object(b.addSliding)(o,D.start)}}if(m.details=o,this.levelLastLoaded=n,this.tick(),o.live&&!this.fragCurrent&&this.media&&this.state===c.State.IDLE){var _=Object(R.findFragmentByPTS)(null,o.fragments,this.media.currentTime,0);_||(this.warn("Subtitle playlist not aligned with playback"),m.details=void 0)}}}},a._handleFragmentLoadComplete=function(l){var g=l.frag,h=l.payload,o=g.decryptdata,n=this.hls;if(!this.fragContextChanged(g)&&h&&h.byteLength>0&&o&&o.key&&o.iv&&o.method==="AES-128"){var d=performance.now();this.decrypter.webCryptoDecrypt(new Uint8Array(h),o.key.buffer,o.iv.buffer).then(function(u){var m=performance.now();n.trigger(M.Events.FRAG_DECRYPTED,{frag:g,payload:u,stats:{tstart:d,tdecrypt:m}})})}},a.doTick=function(){if(!this.media){this.state=c.State.IDLE;return}if(this.state===c.State.IDLE){var l,g=this.currentTrackId,h=this.levels;if(!h.length||!h[g]||!h[g].details)return;var o=h[g].details,n=o.targetduration,d=this.config,u=this.media,m=L.BufferHelper.bufferedInfo(this.mediaBufferTimeRanges,u.currentTime-n,d.maxBufferHole),x=m.end,D=m.len,P=this.getMaxBufferLength()+n;if(D>P)return;console.assert(o,"Subtitle track details are defined on idle subtitle stream controller tick");var _=o.fragments,F=_.length,U=o.edge,k,N=this.fragPrevious;if(x<U){var w=d.maxFragLookUpTolerance;N&&o.hasProgramDateTime&&(k=Object(R.findFragmentByPDT)(_,N.endProgramDateTime,w)),k||(k=Object(R.findFragmentByPTS)(N,_,x,w),!k&&N&&N.start<_[0].start&&(k=_[0]))}else k=_[F-1];(l=k)!==null&&l!==void 0&&l.encrypted?(O.logger.log("Loading key for "+k.sn),this.state=c.State.KEY_LOADING,this.hls.trigger(M.Events.KEY_LOADING,{frag:k})):k&&this.fragmentTracker.getState(k)===A.FragmentState.NOT_LOADED&&this.loadFragment(k,o,x)}},a.loadFragment=function(l,g,h){this.fragCurrent=l,e.prototype.loadFragment.call(this,l,g,h)},p(f,[{key:"mediaBufferTimeRanges",get:function(){return this.tracksBuffered[this.currentTrackId]||[]}}]),f}(c.default)},"./src/controller/subtitle-track-controller.ts":function(K,C,E){E.r(C);var M=E("./src/events.ts"),O=E("./src/utils/texttrack-utils.ts"),L=E("./src/controller/base-playlist-controller.ts"),R=E("./src/types/loader.ts");function I(T,p){for(var v=0;v<p.length;v++){var s=p[v];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(T,s.key,s)}}function b(T,p,v){return p&&I(T.prototype,p),v&&I(T,v),T}function A(T,p){T.prototype=Object.create(p.prototype),T.prototype.constructor=T,c(T,p)}function c(T,p){return c=Object.setPrototypeOf||function(s,t){return s.__proto__=t,s},c(T,p)}var S=function(T){A(p,T);function p(s){var t;return t=T.call(this,s,"[subtitle-track-controller]")||this,t.media=null,t.tracks=[],t.groupId=null,t.tracksInGroup=[],t.trackId=-1,t.selectDefaultTrack=!0,t.queuedDefaultTrack=-1,t.trackChangeListener=function(){return t.onTextTracksChanged()},t.asyncPollTrackChange=function(){return t.pollTrackChange(0)},t.useTextTrackPolling=!1,t.subtitlePollingInterval=-1,t.subtitleDisplay=!0,t.registerListeners(),t}var v=p.prototype;return v.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,T.prototype.destroy.call(this)},v.registerListeners=function(){var t=this.hls;t.on(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(M.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(M.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(M.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.on(M.Events.LEVEL_LOADING,this.onLevelLoading,this),t.on(M.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(M.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.on(M.Events.ERROR,this.onError,this)},v.unregisterListeners=function(){var t=this.hls;t.off(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(M.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(M.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(M.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.off(M.Events.LEVEL_LOADING,this.onLevelLoading,this),t.off(M.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(M.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.off(M.Events.ERROR,this.onError,this)},v.onMediaAttached=function(t,r){this.media=r.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},v.pollTrackChange=function(t){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,t)},v.onMediaDetaching=function(){if(!!this.media){self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId);var t=y(this.media.textTracks);t.forEach(function(r){Object(O.clearCurrentCues)(r)}),this.subtitleTrack=-1,this.media=null}},v.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},v.onManifestParsed=function(t,r){this.tracks=r.subtitleTracks},v.onSubtitleTrackLoaded=function(t,r){var e=r.id,f=r.details,a=this.trackId,i=this.tracksInGroup[a];if(!i){this.warn("Invalid subtitle track id "+e);return}var l=i.details;i.details=r.details,this.log("subtitle track "+e+" loaded ["+f.startSN+"-"+f.endSN+"]"),e===this.trackId&&(this.retryCount=0,this.playlistLoaded(e,r,l))},v.onLevelLoading=function(t,r){this.switchLevel(r.level)},v.onLevelSwitching=function(t,r){this.switchLevel(r.level)},v.switchLevel=function(t){var r=this.hls.levels[t];if(!!(r!=null&&r.textGroupIds)){var e=r.textGroupIds[r.urlId];if(this.groupId!==e){var f=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,a=this.tracks.filter(function(g){return!e||g.groupId===e});this.tracksInGroup=a;var i=this.findTrackId(f==null?void 0:f.name)||this.findTrackId();this.groupId=e;var l={subtitleTracks:a};this.log("Updating subtitle tracks, "+a.length+' track(s) found in "'+e+'" group-id'),this.hls.trigger(M.Events.SUBTITLE_TRACKS_UPDATED,l),i!==-1&&this.setSubtitleTrack(i,f)}}},v.findTrackId=function(t){for(var r=this.tracksInGroup,e=0;e<r.length;e++){var f=r[e];if((!this.selectDefaultTrack||f.default)&&(!t||t===f.name))return f.id}return-1},v.onError=function(t,r){T.prototype.onError.call(this,t,r),!(r.fatal||!r.context)&&r.context.type===R.PlaylistContextType.SUBTITLE_TRACK&&r.context.id===this.trackId&&r.context.groupId===this.groupId&&this.retryLoadingOrFail(r)},v.loadPlaylist=function(t){var r=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(r)){var e=r.id,f=r.groupId,a=r.url;if(t)try{a=t.addDirectives(a)}catch(i){this.warn("Could not construct new URL with HLS Delivery Directives: "+i)}this.log("Loading subtitle playlist for id "+e),this.hls.trigger(M.Events.SUBTITLE_TRACK_LOADING,{url:a,id:e,groupId:f,deliveryDirectives:t||null})}},v.toggleTrackModes=function(t){var r=this,e=this.media,f=this.subtitleDisplay,a=this.trackId;if(!!e){var i=y(e.textTracks),l=i.filter(function(o){return o.groupId===r.groupId});if(t===-1)[].slice.call(i).forEach(function(o){o.mode="disabled"});else{var g=l[a];g&&(g.mode="disabled")}var h=l[t];h&&(h.mode=f?"showing":"hidden")}},v.setSubtitleTrack=function(t,r){var e,f=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=t;return}if(this.trackId!==t&&this.toggleTrackModes(t),!(this.trackId===t&&(t===-1||(e=f[t])!==null&&e!==void 0&&e.details)||t<-1||t>=f.length)){this.clearTimer();var a=f[t];if(this.log("Switching to subtitle track "+t),this.trackId=t,a){var i=a.id,l=a.groupId,g=l===void 0?"":l,h=a.name,o=a.type,n=a.url;this.hls.trigger(M.Events.SUBTITLE_TRACK_SWITCH,{id:i,groupId:g,name:h,type:o,url:n});var d=this.switchParams(a.url,r==null?void 0:r.details);this.loadPlaylist(d)}else this.hls.trigger(M.Events.SUBTITLE_TRACK_SWITCH,{id:t})}},v.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!(!this.media||!this.hls.config.renderTextTracksNatively)){for(var t=-1,r=y(this.media.textTracks),e=0;e<r.length;e++)if(r[e].mode==="hidden")t=e;else if(r[e].mode==="showing"){t=e;break}this.subtitleTrack!==t&&(this.subtitleTrack=t)}},b(p,[{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(t){this.selectDefaultTrack=!1;var r=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(t,r)}}]),p}(L.default);function y(T){for(var p=[],v=0;v<T.length;v++){var s=T[v];s.kind==="subtitles"&&s.label&&p.push(T[v])}return p}C.default=S},"./src/controller/timeline-controller.ts":function(K,C,E){E.r(C),E.d(C,"TimelineController",function(){return y});var M=E("./src/polyfills/number.ts"),O=E("./src/events.ts"),L=E("./src/utils/cea-608-parser.ts"),R=E("./src/utils/output-filter.ts"),I=E("./src/utils/webvtt-parser.ts"),b=E("./src/utils/texttrack-utils.ts"),A=E("./src/utils/imsc1-ttml-parser.ts"),c=E("./src/types/loader.ts"),S=E("./src/utils/logger.ts"),y=function(){function s(r){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.timescale=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.prevCC=-1,this.vttCCs=v(),this.captionsProperties=void 0,this.hls=r,this.config=r.config,this.Cues=r.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var e=new R.default(this,"textTrack1"),f=new R.default(this,"textTrack2"),a=new R.default(this,"textTrack3"),i=new R.default(this,"textTrack4");this.cea608Parser1=new L.default(1,e,f),this.cea608Parser2=new L.default(3,a,i)}r.on(O.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),r.on(O.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.on(O.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.on(O.Events.MANIFEST_LOADED,this.onManifestLoaded,this),r.on(O.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),r.on(O.Events.FRAG_LOADING,this.onFragLoading,this),r.on(O.Events.FRAG_LOADED,this.onFragLoaded,this),r.on(O.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),r.on(O.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),r.on(O.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),r.on(O.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),r.on(O.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}var t=s.prototype;return t.destroy=function(){var e=this.hls;e.off(O.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(O.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(O.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(O.Events.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(O.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(O.Events.FRAG_LOADING,this.onFragLoading,this),e.off(O.Events.FRAG_LOADED,this.onFragLoaded,this),e.off(O.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(O.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(O.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(O.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(O.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},t.addCues=function(e,f,a,i,l){for(var g=!1,h=l.length;h--;){var o=l[h],n=p(o[0],o[1],f,a);if(n>=0&&(o[0]=Math.min(o[0],f),o[1]=Math.max(o[1],a),g=!0,n/(a-f)>.5))return}if(g||l.push([f,a]),this.config.renderTextTracksNatively){var d=this.captionsTracks[e];this.Cues.newCue(d,f,a,i)}else{var u=this.Cues.newCue(null,f,a,i);this.hls.trigger(O.Events.CUES_PARSED,{type:"captions",cues:u,track:e})}},t.onInitPtsFound=function(e,f){var a=this,i=f.frag,l=f.id,g=f.initPTS,h=f.timescale,o=this.unparsedVttFrags;l==="main"&&(this.initPTS[i.cc]=g,this.timescale[i.cc]=h),o.length&&(this.unparsedVttFrags=[],o.forEach(function(n){a.onFragLoaded(O.Events.FRAG_LOADED,n)}))},t.getExistingTrack=function(e){var f=this.media;if(f)for(var a=0;a<f.textTracks.length;a++){var i=f.textTracks[a];if(i[e])return i}return null},t.createCaptionsTrack=function(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)},t.createNativeTrack=function(e){if(!this.captionsTracks[e]){var f=this.captionsProperties,a=this.captionsTracks,i=this.media,l=f[e],g=l.label,h=l.languageCode,o=this.getExistingTrack(e);if(o)a[e]=o,Object(b.clearCurrentCues)(a[e]),Object(b.sendAddTrackEvent)(a[e],i);else{var n=this.createTextTrack("captions",g,h);n&&(n[e]=!0,a[e]=n)}}},t.createNonNativeTrack=function(e){if(!this.nonNativeCaptionsTracks[e]){var f=this.captionsProperties[e];if(!!f){var a=f.label,i={_id:e,label:a,kind:"captions",default:f.media?!!f.media.default:!1,closedCaptions:f.media};this.nonNativeCaptionsTracks[e]=i,this.hls.trigger(O.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[i]})}}},t.createTextTrack=function(e,f,a){var i=this.media;if(!!i)return i.addTextTrack(e,f,a)},t.onMediaAttaching=function(e,f){this.media=f.media,this._cleanTracks()},t.onMediaDetaching=function(){var e=this.captionsTracks;Object.keys(e).forEach(function(f){Object(b.clearCurrentCues)(e[f]),delete e[f]}),this.nonNativeCaptionsTracks={}},t.onManifestLoading=function(){this.lastSn=-1,this.prevCC=-1,this.vttCCs=v(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.timescale=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},t._cleanTracks=function(){var e=this.media;if(!!e){var f=e.textTracks;if(f)for(var a=0;a<f.length;a++)Object(b.clearCurrentCues)(f[a])}},t.onSubtitleTracksUpdated=function(e,f){var a=this;this.textTracks=[];var i=f.subtitleTracks||[],l=i.some(function(n){return n.textCodec===A.IMSC1_CODEC});if(this.config.enableWebVTT||l&&this.config.enableIMSC1){var g=this.tracks&&i&&this.tracks.length===i.length;if(this.tracks=i||[],this.config.renderTextTracksNatively){var h=this.media?this.media.textTracks:[];this.tracks.forEach(function(n,d){var u;if(d<h.length){for(var m=null,x=0;x<h.length;x++)if(T(h[x],n)){m=h[x];break}m&&(u=m)}u?Object(b.clearCurrentCues)(u):(u=a.createTextTrack("subtitles",n.name,n.lang),u&&(u.mode="disabled")),u&&(u.groupId=n.groupId,a.textTracks.push(u))})}else if(!g&&this.tracks&&this.tracks.length){var o=this.tracks.map(function(n){return{label:n.name,kind:n.type.toLowerCase(),default:n.default,subtitleTrack:n}});this.hls.trigger(O.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:o})}}},t.onManifestLoaded=function(e,f){var a=this;this.config.enableCEA708Captions&&f.captions&&f.captions.forEach(function(i){var l=/(?:CC|SERVICE)([1-4])/.exec(i.instreamId);if(!!l){var g="textTrack"+l[1],h=a.captionsProperties[g];!h||(h.label=i.name,i.lang&&(h.languageCode=i.lang),h.media=i)}})},t.onFragLoading=function(e,f){var a=this.cea608Parser1,i=this.cea608Parser2,l=this.lastSn;if(!(!this.enabled||!(a&&i))&&f.frag.type===c.PlaylistLevelType.MAIN){var g=f.frag.sn;g!==l+1&&(a.reset(),i.reset()),this.lastSn=g}},t.onFragLoaded=function(e,f){var a=f.frag,i=f.payload,l=this.initPTS,g=this.unparsedVttFrags;if(a.type===c.PlaylistLevelType.SUBTITLE)if(i.byteLength){if(!Object(M.isFiniteNumber)(l[a.cc])){g.push(f),l.length&&this.hls.trigger(O.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:a,error:new Error("Missing initial subtitle PTS")});return}var h=a.decryptdata;if(h==null||h.key==null||h.method!=="AES-128"){var o=this.tracks[a.level],n=this.vttCCs;n[a.cc]||(n[a.cc]={start:a.start,prevCC:this.prevCC,new:!0},this.prevCC=a.cc),o&&o.textCodec===A.IMSC1_CODEC?this._parseIMSC1(a,i):this._parseVTTs(a,i,n)}}else this.hls.trigger(O.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:a,error:new Error("Empty subtitle payload")})},t._parseIMSC1=function(e,f){var a=this,i=this.hls;Object(A.parseIMSC1)(f,this.initPTS[e.cc],this.timescale[e.cc],function(l){a._appendCues(l,e.level),i.trigger(O.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},function(l){S.logger.log("Failed to parse IMSC1: "+l),i.trigger(O.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:l})})},t._parseVTTs=function(e,f,a){var i=this,l=this.hls;Object(I.parseWebVTT)(f,this.initPTS[e.cc],this.timescale[e.cc],a,e.cc,e.start,function(g){i._appendCues(g,e.level),l.trigger(O.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},function(g){i._fallbackToIMSC1(e,f),S.logger.log("Failed to parse VTT cue: "+g),l.trigger(O.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:g})})},t._fallbackToIMSC1=function(e,f){var a=this,i=this.tracks[e.level];i.textCodec||Object(A.parseIMSC1)(f,this.initPTS[e.cc],this.timescale[e.cc],function(){i.textCodec=A.IMSC1_CODEC,a._parseIMSC1(e,f)},function(){i.textCodec="wvtt"})},t._appendCues=function(e,f){var a=this.hls;if(this.config.renderTextTracksNatively){var i=this.textTracks[f];if(i.mode==="disabled")return;e.forEach(function(h){return Object(b.addCueToTrack)(i,h)})}else{var l=this.tracks[f],g=l.default?"default":"subtitles"+f;a.trigger(O.Events.CUES_PARSED,{type:"subtitles",cues:e,track:g})}},t.onFragDecrypted=function(e,f){var a=f.frag;if(a.type===c.PlaylistLevelType.SUBTITLE){if(!Object(M.isFiniteNumber)(this.initPTS[a.cc])){this.unparsedVttFrags.push(f);return}this.onFragLoaded(O.Events.FRAG_LOADED,f)}},t.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},t.onFragParsingUserdata=function(e,f){var a=this.cea608Parser1,i=this.cea608Parser2;if(!(!this.enabled||!(a&&i)))for(var l=0;l<f.samples.length;l++){var g=f.samples[l].bytes;if(g){var h=this.extractCea608Data(g);a.addData(f.samples[l].pts,h[0]),i.addData(f.samples[l].pts,h[1])}}},t.onBufferFlushing=function(e,f){var a=f.startOffset,i=f.endOffset,l=f.endOffsetSubtitles,g=f.type,h=this.media;if(!(!h||h.currentTime<i)){if(!g||g==="video"){var o=this.captionsTracks;Object.keys(o).forEach(function(d){return Object(b.removeCuesInRange)(o[d],a,i)})}if(this.config.renderTextTracksNatively&&a===0&&l!==void 0){var n=this.textTracks;Object.keys(n).forEach(function(d){return Object(b.removeCuesInRange)(n[d],a,l)})}}},t.extractCea608Data=function(e){for(var f=e[0]&31,a=2,i=[[],[]],l=0;l<f;l++){var g=e[a++],h=127&e[a++],o=127&e[a++],n=(4&g)!==0,d=3&g;h===0&&o===0||n&&(d===0||d===1)&&(i[d].push(h),i[d].push(o))}return i},s}();function T(s,t){return s&&s.label===t.name&&!(s.textTrack1||s.textTrack2)}function p(s,t,r,e){return Math.min(t,e)-Math.max(s,r)}function v(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}}}},"./src/crypt/aes-crypto.ts":function(K,C,E){E.r(C),E.d(C,"default",function(){return M});var M=function(){function O(R,I){this.subtle=void 0,this.aesIV=void 0,this.subtle=R,this.aesIV=I}var L=O.prototype;return L.decrypt=function(I,b){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},b,I)},O}()},"./src/crypt/aes-decryptor.ts":function(K,C,E){E.r(C),E.d(C,"removePadding",function(){return O}),E.d(C,"default",function(){return L});var M=E("./src/utils/typed-array.ts");function O(R){var I=R.byteLength,b=I&&new DataView(R.buffer).getUint8(I-1);return b?Object(M.sliceUint8)(R,0,I-b):R}var L=function(){function R(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var I=R.prototype;return I.uint8ArrayToUint32Array_=function(A){for(var c=new DataView(A),S=new Uint32Array(4),y=0;y<4;y++)S[y]=c.getUint32(y*4);return S},I.initTable=function(){var A=this.sBox,c=this.invSBox,S=this.subMix,y=S[0],T=S[1],p=S[2],v=S[3],s=this.invSubMix,t=s[0],r=s[1],e=s[2],f=s[3],a=new Uint32Array(256),i=0,l=0,g=0;for(g=0;g<256;g++)g<128?a[g]=g<<1:a[g]=g<<1^283;for(g=0;g<256;g++){var h=l^l<<1^l<<2^l<<3^l<<4;h=h>>>8^h&255^99,A[i]=h,c[h]=i;var o=a[i],n=a[o],d=a[n],u=a[h]*257^h*16843008;y[i]=u<<24|u>>>8,T[i]=u<<16|u>>>16,p[i]=u<<8|u>>>24,v[i]=u,u=d*16843009^n*65537^o*257^i*16843008,t[h]=u<<24|u>>>8,r[h]=u<<16|u>>>16,e[h]=u<<8|u>>>24,f[h]=u,i?(i=o^a[a[a[d^o]]],l^=a[a[l]]):i=l=1}},I.expandKey=function(A){for(var c=this.uint8ArrayToUint32Array_(A),S=!0,y=0;y<c.length&&S;)S=c[y]===this.key[y],y++;if(!S){this.key=c;var T=this.keySize=c.length;if(T!==4&&T!==6&&T!==8)throw new Error("Invalid aes key size="+T);var p=this.ksRows=(T+6+1)*4,v,s,t=this.keySchedule=new Uint32Array(p),r=this.invKeySchedule=new Uint32Array(p),e=this.sBox,f=this.rcon,a=this.invSubMix,i=a[0],l=a[1],g=a[2],h=a[3],o,n;for(v=0;v<p;v++){if(v<T){o=t[v]=c[v];continue}n=o,v%T===0?(n=n<<8|n>>>24,n=e[n>>>24]<<24|e[n>>>16&255]<<16|e[n>>>8&255]<<8|e[n&255],n^=f[v/T|0]<<24):T>6&&v%T===4&&(n=e[n>>>24]<<24|e[n>>>16&255]<<16|e[n>>>8&255]<<8|e[n&255]),t[v]=o=(t[v-T]^n)>>>0}for(s=0;s<p;s++)v=p-s,s&3?n=t[v]:n=t[v-4],s<4||v<=4?r[s]=n:r[s]=i[e[n>>>24]]^l[e[n>>>16&255]]^g[e[n>>>8&255]]^h[e[n&255]],r[s]=r[s]>>>0}},I.networkToHostOrderSwap=function(A){return A<<24|(A&65280)<<8|(A&16711680)>>8|A>>>24},I.decrypt=function(A,c,S){for(var y=this.keySize+6,T=this.invKeySchedule,p=this.invSBox,v=this.invSubMix,s=v[0],t=v[1],r=v[2],e=v[3],f=this.uint8ArrayToUint32Array_(S),a=f[0],i=f[1],l=f[2],g=f[3],h=new Int32Array(A),o=new Int32Array(h.length),n,d,u,m,x,D,P,_,F,U,k,N,w,V,W=this.networkToHostOrderSwap;c<h.length;){for(F=W(h[c]),U=W(h[c+1]),k=W(h[c+2]),N=W(h[c+3]),x=F^T[0],D=N^T[1],P=k^T[2],_=U^T[3],w=4,V=1;V<y;V++)n=s[x>>>24]^t[D>>16&255]^r[P>>8&255]^e[_&255]^T[w],d=s[D>>>24]^t[P>>16&255]^r[_>>8&255]^e[x&255]^T[w+1],u=s[P>>>24]^t[_>>16&255]^r[x>>8&255]^e[D&255]^T[w+2],m=s[_>>>24]^t[x>>16&255]^r[D>>8&255]^e[P&255]^T[w+3],x=n,D=d,P=u,_=m,w=w+4;n=p[x>>>24]<<24^p[D>>16&255]<<16^p[P>>8&255]<<8^p[_&255]^T[w],d=p[D>>>24]<<24^p[P>>16&255]<<16^p[_>>8&255]<<8^p[x&255]^T[w+1],u=p[P>>>24]<<24^p[_>>16&255]<<16^p[x>>8&255]<<8^p[D&255]^T[w+2],m=p[_>>>24]<<24^p[x>>16&255]<<16^p[D>>8&255]<<8^p[P&255]^T[w+3],o[c]=W(n^a),o[c+1]=W(m^i),o[c+2]=W(u^l),o[c+3]=W(d^g),a=F,i=U,l=k,g=N,c=c+4}return o.buffer},R}()},"./src/crypt/decrypter.ts":function(K,C,E){E.r(C),E.d(C,"default",function(){return c});var M=E("./src/crypt/aes-crypto.ts"),O=E("./src/crypt/fast-aes-key.ts"),L=E("./src/crypt/aes-decryptor.ts"),R=E("./src/utils/logger.ts"),I=E("./src/utils/mp4-tools.ts"),b=E("./src/utils/typed-array.ts"),A=16,c=function(){function S(T,p,v){var s=v===void 0?{}:v,t=s.removePKCS7Padding,r=t===void 0?!0:t;if(this.logEnabled=!0,this.observer=void 0,this.config=void 0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.observer=T,this.config=p,this.removePKCS7Padding=r,r)try{var e=self.crypto;e&&(this.subtle=e.subtle||e.webkitSubtle)}catch{}this.subtle===null&&(this.config.enableSoftwareAES=!0)}var y=S.prototype;return y.destroy=function(){this.observer=null},y.isSync=function(){return this.config.enableSoftwareAES},y.flush=function(){var p=this.currentResult;if(!p){this.reset();return}var v=new Uint8Array(p);return this.reset(),this.removePKCS7Padding?Object(L.removePadding)(v):v},y.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},y.decrypt=function(p,v,s,t){if(this.config.enableSoftwareAES){this.softwareDecrypt(new Uint8Array(p),v,s);var r=this.flush();r&&t(r.buffer)}else this.webCryptoDecrypt(new Uint8Array(p),v,s).then(t)},y.softwareDecrypt=function(p,v,s){var t=this.currentIV,r=this.currentResult,e=this.remainderData;this.logOnce("JS AES decrypt"),e&&(p=Object(I.appendUint8Array)(e,p),this.remainderData=null);var f=this.getValidChunk(p);if(!f.length)return null;t&&(s=t);var a=this.softwareDecrypter;a||(a=this.softwareDecrypter=new L.default),a.expandKey(v);var i=r;return this.currentResult=a.decrypt(f.buffer,0,s),this.currentIV=Object(b.sliceUint8)(f,-16).buffer,i||null},y.webCryptoDecrypt=function(p,v,s){var t=this,r=this.subtle;return(this.key!==v||!this.fastAesKey)&&(this.key=v,this.fastAesKey=new O.default(r,v)),this.fastAesKey.expandKey().then(function(e){if(!r)return Promise.reject(new Error("web crypto not initialized"));var f=new M.default(r,s);return f.decrypt(p.buffer,e)}).catch(function(e){return t.onWebCryptoError(e,p,v,s)})},y.onWebCryptoError=function(p,v,s,t){return R.logger.warn("[decrypter.ts]: WebCrypto Error, disable WebCrypto API:",p),this.config.enableSoftwareAES=!0,this.logEnabled=!0,this.softwareDecrypt(v,s,t)},y.getValidChunk=function(p){var v=p,s=p.length-p.length%A;return s!==p.length&&(v=Object(b.sliceUint8)(p,0,s),this.remainderData=Object(b.sliceUint8)(p,s)),v},y.logOnce=function(p){!this.logEnabled||(R.logger.log("[decrypter.ts]: "+p),this.logEnabled=!1)},S}()},"./src/crypt/fast-aes-key.ts":function(K,C,E){E.r(C),E.d(C,"default",function(){return M});var M=function(){function O(R,I){this.subtle=void 0,this.key=void 0,this.subtle=R,this.key=I}var L=O.prototype;return L.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},O}()},"./src/demux/aacdemuxer.ts":function(K,C,E){E.r(C);var M=E("./src/demux/base-audio-demuxer.ts"),O=E("./src/demux/adts.ts"),L=E("./src/utils/logger.ts"),R=E("./src/demux/id3.ts");function I(c,S){c.prototype=Object.create(S.prototype),c.prototype.constructor=c,b(c,S)}function b(c,S){return b=Object.setPrototypeOf||function(T,p){return T.__proto__=p,T},b(c,S)}var A=function(c){I(S,c);function S(T,p){var v;return v=c.call(this)||this,v.observer=void 0,v.config=void 0,v.observer=T,v.config=p,v}var y=S.prototype;return y.resetInitSegment=function(p,v,s){c.prototype.resetInitSegment.call(this,p,v,s),this._audioTrack={container:"audio/adts",type:"audio",id:0,pid:-1,sequenceNumber:0,isAAC:!0,samples:[],manifestCodec:p,duration:s,inputTimeScale:9e4,dropped:0}},S.probe=function(p){if(!p)return!1;for(var v=R.getID3Data(p,0)||[],s=v.length,t=p.length;s<t;s++)if(O.probe(p,s))return L.logger.log("ADTS sync word found !"),!0;return!1},y.canParse=function(p,v){return O.canParse(p,v)},y.appendFrame=function(p,v,s){O.initTrackConfig(p,this.observer,v,s,p.manifestCodec);var t=O.appendFrame(p,v,s,this.initPTS,this.frameIndex);if(t&&t.missing===0)return t},S}(M.default);A.minProbeByteLength=9,C.default=A},"./src/demux/adts.ts":function(K,C,E){E.r(C),E.d(C,"getAudioConfig",function(){return R}),E.d(C,"isHeaderPattern",function(){return I}),E.d(C,"getHeaderLength",function(){return b}),E.d(C,"getFullFrameLength",function(){return A}),E.d(C,"canGetFrameLength",function(){return c}),E.d(C,"isHeader",function(){return S}),E.d(C,"canParse",function(){return y}),E.d(C,"probe",function(){return T}),E.d(C,"initTrackConfig",function(){return p}),E.d(C,"getFrameDuration",function(){return v}),E.d(C,"parseFrameHeader",function(){return s}),E.d(C,"appendFrame",function(){return t});var M=E("./src/utils/logger.ts"),O=E("./src/errors.ts"),L=E("./src/events.ts");function R(r,e,f,a){var i,l,g,h,o=navigator.userAgent.toLowerCase(),n=a,d=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];i=((e[f+2]&192)>>>6)+1;var u=(e[f+2]&60)>>>2;if(u>d.length-1){r.trigger(L.Events.ERROR,{type:O.ErrorTypes.MEDIA_ERROR,details:O.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+u});return}return g=(e[f+2]&1)<<2,g|=(e[f+3]&192)>>>6,M.logger.log("manifest codec:"+a+", ADTS type:"+i+", samplingIndex:"+u),/firefox/i.test(o)?u>=6?(i=5,h=new Array(4),l=u-3):(i=2,h=new Array(2),l=u):o.indexOf("android")!==-1?(i=2,h=new Array(2),l=u):(i=5,h=new Array(4),a&&(a.indexOf("mp4a.40.29")!==-1||a.indexOf("mp4a.40.5")!==-1)||!a&&u>=6?l=u-3:((a&&a.indexOf("mp4a.40.2")!==-1&&(u>=6&&g===1||/vivaldi/i.test(o))||!a&&g===1)&&(i=2,h=new Array(2)),l=u)),h[0]=i<<3,h[0]|=(u&14)>>1,h[1]|=(u&1)<<7,h[1]|=g<<3,i===5&&(h[1]|=(l&14)>>1,h[2]=(l&1)<<7,h[2]|=2<<2,h[3]=0),{config:h,samplerate:d[u],channelCount:g,codec:"mp4a.40."+i,manifestCodec:n}}function I(r,e){return r[e]===255&&(r[e+1]&246)===240}function b(r,e){return r[e+1]&1?7:9}function A(r,e){return(r[e+3]&3)<<11|r[e+4]<<3|(r[e+5]&224)>>>5}function c(r,e){return e+5<r.length}function S(r,e){return e+1<r.length&&I(r,e)}function y(r,e){return c(r,e)&&I(r,e)&&A(r,e)<=r.length-e}function T(r,e){if(S(r,e)){var f=b(r,e);if(e+f>=r.length)return!1;var a=A(r,e);if(a<=f)return!1;var i=e+a;return i===r.length||S(r,i)}return!1}function p(r,e,f,a,i){if(!r.samplerate){var l=R(e,f,a,i);if(!l)return;r.config=l.config,r.samplerate=l.samplerate,r.channelCount=l.channelCount,r.codec=l.codec,r.manifestCodec=l.manifestCodec,M.logger.log("parsed codec:"+r.codec+", rate:"+l.samplerate+", channels:"+l.channelCount)}}function v(r){return 1024*9e4/r}function s(r,e,f,a,i){var l=b(r,e),g=A(r,e);if(g-=l,g>0){var h=f+a*i;return{headerLength:l,frameLength:g,stamp:h}}}function t(r,e,f,a,i){var l=v(r.samplerate),g=s(e,f,a,i,l);if(g){var h=g.frameLength,o=g.headerLength,n=g.stamp,d=o+h,u=Math.max(0,f+d-e.length),m;u?(m=new Uint8Array(d-o),m.set(e.subarray(f+o,e.length),0)):m=e.subarray(f+o,f+d);var x={unit:m,pts:n};return u||r.samples.push(x),{sample:x,length:d,missing:u}}}},"./src/demux/base-audio-demuxer.ts":function(K,C,E){E.r(C),E.d(C,"initPTSFn",function(){return A});var M=E("./src/polyfills/number.ts"),O=E("./src/demux/id3.ts"),L=E("./src/demux/dummy-demuxed-track.ts"),R=E("./src/utils/mp4-tools.ts"),I=E("./src/utils/typed-array.ts"),b=function(){function c(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.initPTS=null}var S=c.prototype;return S.resetInitSegment=function(T,p,v){this._id3Track={type:"id3",id:0,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},S.resetTimeStamp=function(){},S.resetContiguity=function(){},S.canParse=function(T,p){return!1},S.appendFrame=function(T,p,v){},S.demux=function(T,p){this.cachedData&&(T=Object(R.appendUint8Array)(this.cachedData,T),this.cachedData=null);var v=O.getID3Data(T,0),s=v?v.length:0,t,r,e=this._audioTrack,f=this._id3Track,a=v?O.getTimeStamp(v):void 0,i=T.length;for((this.frameIndex===0||this.initPTS===null)&&(this.initPTS=A(a,p)),v&&v.length>0&&f.samples.push({pts:this.initPTS,dts:this.initPTS,data:v}),r=this.initPTS;s<i;){if(this.canParse(T,s)){var l=this.appendFrame(e,T,s);l?(this.frameIndex++,r=l.sample.pts,s+=l.length,t=s):s=i}else O.canParse(T,s)?(v=O.getID3Data(T,s),f.samples.push({pts:r,dts:r,data:v}),s+=v.length,t=s):s++;if(s===i&&t!==i){var g=Object(I.sliceUint8)(T,t);this.cachedData?this.cachedData=Object(R.appendUint8Array)(this.cachedData,g):this.cachedData=g}}return{audioTrack:e,avcTrack:Object(L.dummyTrack)(),id3Track:f,textTrack:Object(L.dummyTrack)()}},S.demuxSampleAes=function(T,p,v){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},S.flush=function(T){var p=this.cachedData;return p&&(this.cachedData=null,this.demux(p,0)),this.frameIndex=0,{audioTrack:this._audioTrack,avcTrack:Object(L.dummyTrack)(),id3Track:this._id3Track,textTrack:Object(L.dummyTrack)()}},S.destroy=function(){},c}(),A=function(S,y){return Object(M.isFiniteNumber)(S)?S*90:y*9e4};C.default=b},"./src/demux/chunk-cache.ts":function(K,C,E){E.r(C),E.d(C,"default",function(){return M});var M=function(){function L(){this.chunks=[],this.dataLength=0}var R=L.prototype;return R.push=function(b){this.chunks.push(b),this.dataLength+=b.length},R.flush=function(){var b=this.chunks,A=this.dataLength,c;if(b.length)b.length===1?c=b[0]:c=O(b,A);else return new Uint8Array(0);return this.reset(),c},R.reset=function(){this.chunks.length=0,this.dataLength=0},L}();function O(L,R){for(var I=new Uint8Array(R),b=0,A=0;A<L.length;A++){var c=L[A];I.set(c,b),b+=c.length}return I}},"./src/demux/dummy-demuxed-track.ts":function(K,C,E){E.r(C),E.d(C,"dummyTrack",function(){return M});function M(){return{type:"",id:-1,pid:-1,inputTimeScale:9e4,sequenceNumber:-1,samples:[],dropped:0}}},"./src/demux/exp-golomb.ts":function(K,C,E){E.r(C);var M=E("./src/utils/logger.ts"),O=function(){function L(I){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=I,this.bytesAvailable=I.byteLength,this.word=0,this.bitsAvailable=0}var R=L.prototype;return R.loadWord=function(){var b=this.data,A=this.bytesAvailable,c=b.byteLength-A,S=new Uint8Array(4),y=Math.min(4,A);if(y===0)throw new Error("no bytes available");S.set(b.subarray(c,c+y)),this.word=new DataView(S.buffer).getUint32(0),this.bitsAvailable=y*8,this.bytesAvailable-=y},R.skipBits=function(b){var A;this.bitsAvailable>b?(this.word<<=b,this.bitsAvailable-=b):(b-=this.bitsAvailable,A=b>>3,b-=A>>3,this.bytesAvailable-=A,this.loadWord(),this.word<<=b,this.bitsAvailable-=b)},R.readBits=function(b){var A=Math.min(this.bitsAvailable,b),c=this.word>>>32-A;return b>32&&M.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=A,this.bitsAvailable>0?this.word<<=A:this.bytesAvailable>0&&this.loadWord(),A=b-A,A>0&&this.bitsAvailable?c<<A|this.readBits(A):c},R.skipLZ=function(){var b;for(b=0;b<this.bitsAvailable;++b)if((this.word&2147483648>>>b)!==0)return this.word<<=b,this.bitsAvailable-=b,b;return this.loadWord(),b+this.skipLZ()},R.skipUEG=function(){this.skipBits(1+this.skipLZ())},R.skipEG=function(){this.skipBits(1+this.skipLZ())},R.readUEG=function(){var b=this.skipLZ();return this.readBits(b+1)-1},R.readEG=function(){var b=this.readUEG();return 1&b?1+b>>>1:-1*(b>>>1)},R.readBoolean=function(){return this.readBits(1)===1},R.readUByte=function(){return this.readBits(8)},R.readUShort=function(){return this.readBits(16)},R.readUInt=function(){return this.readBits(32)},R.skipScalingList=function(b){for(var A=8,c=8,S,y=0;y<b;y++)c!==0&&(S=this.readEG(),c=(A+S+256)%256),A=c===0?A:c},R.readSPS=function(){var b=0,A=0,c=0,S=0,y,T,p,v=this.readUByte.bind(this),s=this.readBits.bind(this),t=this.readUEG.bind(this),r=this.readBoolean.bind(this),e=this.skipBits.bind(this),f=this.skipEG.bind(this),a=this.skipUEG.bind(this),i=this.skipScalingList.bind(this);v();var l=v();if(s(5),e(3),v(),a(),l===100||l===110||l===122||l===244||l===44||l===83||l===86||l===118||l===128){var g=t();if(g===3&&e(1),a(),a(),e(1),r())for(T=g!==3?8:12,p=0;p<T;p++)r()&&(p<6?i(16):i(64))}a();var h=t();if(h===0)t();else if(h===1)for(e(1),f(),f(),y=t(),p=0;p<y;p++)f();a(),e(1);var o=t(),n=t(),d=s(1);d===0&&e(1),e(1),r()&&(b=t(),A=t(),c=t(),S=t());var u=[1,1];if(r()&&r()){var m=v();switch(m){case 1:u=[1,1];break;case 2:u=[12,11];break;case 3:u=[10,11];break;case 4:u=[16,11];break;case 5:u=[40,33];break;case 6:u=[24,11];break;case 7:u=[20,11];break;case 8:u=[32,11];break;case 9:u=[80,33];break;case 10:u=[18,11];break;case 11:u=[15,11];break;case 12:u=[64,33];break;case 13:u=[160,99];break;case 14:u=[4,3];break;case 15:u=[3,2];break;case 16:u=[2,1];break;case 255:{u=[v()<<8|v(),v()<<8|v()];break}}}return{width:Math.ceil((o+1)*16-b*2-A*2),height:(2-d)*(n+1)*16-(d?2:4)*(c+S),pixelRatio:u}},R.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},L}();C.default=O},"./src/demux/id3.ts":function(K,C,E){E.r(C),E.d(C,"isHeader",function(){return M}),E.d(C,"isFooter",function(){return O}),E.d(C,"getID3Data",function(){return L}),E.d(C,"canParse",function(){return I}),E.d(C,"getTimeStamp",function(){return b}),E.d(C,"isTimeStampFrame",function(){return A}),E.d(C,"getID3Frames",function(){return S}),E.d(C,"decodeFrame",function(){return y}),E.d(C,"utf8ArrayToStr",function(){return t}),E.d(C,"testables",function(){return r});var M=function(i,l){return l+10<=i.length&&i[l]===73&&i[l+1]===68&&i[l+2]===51&&i[l+3]<255&&i[l+4]<255&&i[l+6]<128&&i[l+7]<128&&i[l+8]<128&&i[l+9]<128},O=function(i,l){return l+10<=i.length&&i[l]===51&&i[l+1]===68&&i[l+2]===73&&i[l+3]<255&&i[l+4]<255&&i[l+6]<128&&i[l+7]<128&&i[l+8]<128&&i[l+9]<128},L=function(i,l){for(var g=l,h=0;M(i,l);){h+=10;var o=R(i,l+6);h+=o,O(i,l+10)&&(h+=10),l+=h}if(h>0)return i.subarray(g,g+h)},R=function(i,l){var g=0;return g=(i[l]&127)<<21,g|=(i[l+1]&127)<<14,g|=(i[l+2]&127)<<7,g|=i[l+3]&127,g},I=function(i,l){return M(i,l)&&R(i,l+6)+10<=i.length-l},b=function(i){for(var l=S(i),g=0;g<l.length;g++){var h=l[g];if(A(h))return s(h)}},A=function(i){return i&&i.key==="PRIV"&&i.info==="com.apple.streaming.transportStreamTimestamp"},c=function(i){var l=String.fromCharCode(i[0],i[1],i[2],i[3]),g=R(i,4),h=10;return{type:l,size:g,data:i.subarray(h,h+g)}},S=function(i){for(var l=0,g=[];M(i,l);){var h=R(i,l+6);l+=10;for(var o=l+h;l+8<o;){var n=c(i.subarray(l)),d=y(n);d&&g.push(d),l+=n.size+10}O(i,l)&&(l+=10)}return g},y=function(i){return i.type==="PRIV"?T(i):i.type[0]==="W"?v(i):p(i)},T=function(i){if(!(i.size<2)){var l=t(i.data,!0),g=new Uint8Array(i.data.subarray(l.length+1));return{key:i.type,info:l,data:g.buffer}}},p=function(i){if(!(i.size<2)){if(i.type==="TXXX"){var l=1,g=t(i.data.subarray(l),!0);l+=g.length+1;var h=t(i.data.subarray(l));return{key:i.type,info:g,data:h}}var o=t(i.data.subarray(1));return{key:i.type,data:o}}},v=function(i){if(i.type==="WXXX"){if(i.size<2)return;var l=1,g=t(i.data.subarray(l),!0);l+=g.length+1;var h=t(i.data.subarray(l));return{key:i.type,info:g,data:h}}var o=t(i.data);return{key:i.type,data:o}},s=function(i){if(i.data.byteLength===8){var l=new Uint8Array(i.data),g=l[3]&1,h=(l[4]<<23)+(l[5]<<15)+(l[6]<<7)+l[7];return h/=45,g&&(h+=4772185884e-2),Math.round(h)}},t=function(i,l){l===void 0&&(l=!1);var g=f();if(g){var h=g.decode(i);if(l){var o=h.indexOf("\0");return o!==-1?h.substring(0,o):h}return h.replace(/\0/g,"")}for(var n=i.length,d,u,m,x="",D=0;D<n;){if(d=i[D++],d===0&&l)return x;if(d===0||d===3)continue;switch(d>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:x+=String.fromCharCode(d);break;case 12:case 13:u=i[D++],x+=String.fromCharCode((d&31)<<6|u&63);break;case 14:u=i[D++],m=i[D++],x+=String.fromCharCode((d&15)<<12|(u&63)<<6|(m&63)<<0);break}}return x},r={decodeTextFrame:p},e;function f(){return!e&&typeof self.TextDecoder!="undefined"&&(e=new self.TextDecoder("utf-8")),e}},"./src/demux/mp3demuxer.ts":function(K,C,E){E.r(C);var M=E("./src/demux/base-audio-demuxer.ts"),O=E("./src/demux/id3.ts"),L=E("./src/utils/logger.ts"),R=E("./src/demux/mpegaudio.ts");function I(c,S){c.prototype=Object.create(S.prototype),c.prototype.constructor=c,b(c,S)}function b(c,S){return b=Object.setPrototypeOf||function(T,p){return T.__proto__=p,T},b(c,S)}var A=function(c){I(S,c);function S(){return c.apply(this,arguments)||this}var y=S.prototype;return y.resetInitSegment=function(p,v,s){c.prototype.resetInitSegment.call(this,p,v,s),this._audioTrack={container:"audio/mpeg",type:"audio",id:0,pid:-1,sequenceNumber:0,isAAC:!1,samples:[],manifestCodec:p,duration:s,inputTimeScale:9e4,dropped:0}},S.probe=function(p){if(!p)return!1;for(var v=O.getID3Data(p,0)||[],s=v.length,t=p.length;s<t;s++)if(R.probe(p,s))return L.logger.log("MPEG Audio sync word found !"),!0;return!1},y.canParse=function(p,v){return R.canParse(p,v)},y.appendFrame=function(p,v,s){if(this.initPTS!==null)return R.appendFrame(p,v,s,this.initPTS,this.frameIndex)},S}(M.default);A.minProbeByteLength=4,C.default=A},"./src/demux/mp4demuxer.ts":function(K,C,E){E.r(C);var M=E("./src/utils/mp4-tools.ts"),O=E("./src/demux/dummy-demuxed-track.ts"),L=function(){function R(b,A){this.remainderData=null,this.config=void 0,this.config=A}var I=R.prototype;return I.resetTimeStamp=function(){},I.resetInitSegment=function(){},I.resetContiguity=function(){},R.probe=function(A){return Object(M.findBox)({data:A,start:0,end:Math.min(A.length,16384)},["moof"]).length>0},I.demux=function(A){var c=A,S=Object(O.dummyTrack)();if(this.config.progressive){this.remainderData&&(c=Object(M.appendUint8Array)(this.remainderData,A));var y=Object(M.segmentValidRange)(c);this.remainderData=y.remainder,S.samples=y.valid||new Uint8Array}else S.samples=c;return{audioTrack:Object(O.dummyTrack)(),avcTrack:S,id3Track:Object(O.dummyTrack)(),textTrack:Object(O.dummyTrack)()}},I.flush=function(){var A=Object(O.dummyTrack)();return A.samples=this.remainderData||new Uint8Array,this.remainderData=null,{audioTrack:Object(O.dummyTrack)(),avcTrack:A,id3Track:Object(O.dummyTrack)(),textTrack:Object(O.dummyTrack)()}},I.demuxSampleAes=function(A,c,S){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},I.destroy=function(){},R}();L.minProbeByteLength=1024,C.default=L},"./src/demux/mpegaudio.ts":function(K,C,E){E.r(C),E.d(C,"appendFrame",function(){return b}),E.d(C,"parseHeader",function(){return A}),E.d(C,"isHeaderPattern",function(){return c}),E.d(C,"isHeader",function(){return S}),E.d(C,"canParse",function(){return y}),E.d(C,"probe",function(){return T});var M=null,O=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],L=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],R=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],I=[0,1,1,4];function b(p,v,s,t,r){if(!(s+24>v.length)){var e=A(v,s);if(e&&s+e.frameLength<=v.length){var f=e.samplesPerFrame*9e4/e.sampleRate,a=t+r*f,i={unit:v.subarray(s,s+e.frameLength),pts:a,dts:a};return p.config=[],p.channelCount=e.channelCount,p.samplerate=e.sampleRate,p.samples.push(i),{sample:i,length:e.frameLength,missing:0}}}}function A(p,v){var s=p[v+1]>>3&3,t=p[v+1]>>1&3,r=p[v+2]>>4&15,e=p[v+2]>>2&3;if(s!==1&&r!==0&&r!==15&&e!==3){var f=p[v+2]>>1&1,a=p[v+3]>>6,i=s===3?3-t:t===3?3:4,l=O[i*14+r-1]*1e3,g=s===3?0:s===2?1:2,h=L[g*3+e],o=a===3?1:2,n=R[s][t],d=I[t],u=n*8*d,m=Math.floor(n*l/h+f)*d;if(M===null){var x=navigator.userAgent||"",D=x.match(/Chrome\/(\d+)/i);M=D?parseInt(D[1]):0}var P=!!M&&M<=87;return P&&t===2&&l>=224e3&&a===0&&(p[v+3]=p[v+3]|128),{sampleRate:h,channelCount:o,frameLength:m,samplesPerFrame:u}}}function c(p,v){return p[v]===255&&(p[v+1]&224)===224&&(p[v+1]&6)!==0}function S(p,v){return v+1<p.length&&c(p,v)}function y(p,v){var s=4;return c(p,v)&&s<=p.length-v}function T(p,v){if(v+1<p.length&&c(p,v)){var s=4,t=A(p,v),r=s;t!=null&&t.frameLength&&(r=t.frameLength);var e=v+r;return e===p.length||S(p,e)}return!1}},"./src/demux/sample-aes.ts":function(K,C,E){E.r(C);var M=E("./src/crypt/decrypter.ts"),O=E("./src/demux/tsdemuxer.ts"),L=function(){function R(b,A,c){this.keyData=void 0,this.decrypter=void 0,this.keyData=c,this.decrypter=new M.default(b,A,{removePKCS7Padding:!1})}var I=R.prototype;return I.decryptBuffer=function(A,c){this.decrypter.decrypt(A,this.keyData.key.buffer,this.keyData.iv.buffer,c)},I.decryptAacSample=function(A,c,S,y){var T=A[c].unit,p=T.subarray(16,T.length-T.length%16),v=p.buffer.slice(p.byteOffset,p.byteOffset+p.length),s=this;this.decryptBuffer(v,function(t){var r=new Uint8Array(t);T.set(r,16),y||s.decryptAacSamples(A,c+1,S)})},I.decryptAacSamples=function(A,c,S){for(;;c++){if(c>=A.length){S();return}if(!(A[c].unit.length<32)){var y=this.decrypter.isSync();if(this.decryptAacSample(A,c,S,y),!y)return}}},I.getAvcEncryptedData=function(A){for(var c=Math.floor((A.length-48)/160)*16+16,S=new Int8Array(c),y=0,T=32;T<=A.length-16;T+=160,y+=16)S.set(A.subarray(T,T+16),y);return S},I.getAvcDecryptedUnit=function(A,c){for(var S=new Uint8Array(c),y=0,T=32;T<=A.length-16;T+=160,y+=16)A.set(S.subarray(y,y+16),T);return A},I.decryptAvcSample=function(A,c,S,y,T,p){var v=Object(O.discardEPB)(T.data),s=this.getAvcEncryptedData(v),t=this;this.decryptBuffer(s.buffer,function(r){T.data=t.getAvcDecryptedUnit(v,r),p||t.decryptAvcSamples(A,c,S+1,y)})},I.decryptAvcSamples=function(A,c,S,y){if(A instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;c++,S=0){if(c>=A.length){y();return}for(var T=A[c].units;!(S>=T.length);S++){var p=T[S];if(!(p.data.length<=48||p.type!==1&&p.type!==5)){var v=this.decrypter.isSync();if(this.decryptAvcSample(A,c,S,y,p,v),!v)return}}}},R}();C.default=L},"./src/demux/transmuxer-interface.ts":function(K,C,E){E.r(C),E.d(C,"default",function(){return S});var M=E("./node_modules/webworkify-webpack/index.js"),O=E("./src/events.ts"),L=E("./src/demux/transmuxer.ts"),R=E("./src/utils/logger.ts"),I=E("./src/errors.ts"),b=E("./src/utils/mediasource-helper.ts"),A=E("./node_modules/eventemitter3/index.js"),c=Object(b.getMediaSource)()||{isTypeSupported:function(){return!1}},S=function(){function y(p,v,s,t){var r=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.hls=p,this.id=v,this.onTransmuxComplete=s,this.onFlush=t;var e=p.config,f=function(h,o){o=o||{},o.frag=r.frag,o.id=r.id,p.trigger(h,o)};this.observer=new A.EventEmitter,this.observer.on(O.Events.FRAG_DECRYPTED,f),this.observer.on(O.Events.ERROR,f);var a={mp4:c.isTypeSupported("video/mp4"),mpeg:c.isTypeSupported("audio/mpeg"),mp3:c.isTypeSupported('audio/mp4; codecs="mp3"')},i=navigator.vendor;if(e.enableWorker&&typeof Worker!="undefined"){R.logger.log("demuxing in webworker");var l;try{l=this.worker=M("./src/demux/transmuxer-worker.ts"),this.onwmsg=this.onWorkerMessage.bind(this),l.addEventListener("message",this.onwmsg),l.onerror=function(g){p.trigger(O.Events.ERROR,{type:I.ErrorTypes.OTHER_ERROR,details:I.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",error:new Error(g.message+"  ("+g.filename+":"+g.lineno+")")})},l.postMessage({cmd:"init",typeSupported:a,vendor:i,id:v,config:JSON.stringify(e)})}catch(g){R.logger.warn("Error in worker:",g),R.logger.error("Error while initializing DemuxerWorker, fallback to inline"),l&&self.URL.revokeObjectURL(l.objectURL),this.transmuxer=new L.default(this.observer,a,e,i,v),this.worker=null}}else this.transmuxer=new L.default(this.observer,a,e,i,v)}var T=y.prototype;return T.destroy=function(){var v=this.worker;if(v)v.removeEventListener("message",this.onwmsg),v.terminate(),this.worker=null;else{var s=this.transmuxer;s&&(s.destroy(),this.transmuxer=null)}var t=this.observer;t&&t.removeAllListeners(),this.observer=null},T.push=function(v,s,t,r,e,f,a,i,l,g){var h=this;l.transmuxing.start=self.performance.now();var o=this.transmuxer,n=this.worker,d=f?f.start:e.start,u=e.decryptdata,m=this.frag,x=!(m&&e.cc===m.cc),D=!(m&&l.level===m.level),P=m?l.sn-m.sn:-1,_=this.part?l.part-this.part.index:1,F=!D&&(P===1||P===0&&_===1),U=self.performance.now();(D||P||e.stats.parsing.start===0)&&(e.stats.parsing.start=U),f&&(_||!F)&&(f.stats.parsing.start=U);var k=new L.TransmuxState(x,F,i,D,d);if(!F||x){R.logger.log("[transmuxer-interface, "+e.type+"]: Starting new transmux session for sn: "+l.sn+" p: "+l.part+" level: "+l.level+" id: "+l.id+`
        discontinuity: `+x+`
        trackSwitch: `+D+`
        contiguous: `+F+`
        accurateTimeOffset: `+i+`
        timeOffset: `+d);var N=new L.TransmuxConfig(t,r,s,a,g);this.configureTransmuxer(N)}if(this.frag=e,this.part=f,n)n.postMessage({cmd:"demux",data:v,decryptdata:u,chunkMeta:l,state:k},v instanceof ArrayBuffer?[v]:[]);else if(o){var w=o.push(v,u,l,k);Object(L.isPromise)(w)?w.then(function(V){h.handleTransmuxComplete(V)}):this.handleTransmuxComplete(w)}},T.flush=function(v){var s=this;v.transmuxing.start=self.performance.now();var t=this.transmuxer,r=this.worker;if(r)r.postMessage({cmd:"flush",chunkMeta:v});else if(t){var e=t.flush(v);Object(L.isPromise)(e)?e.then(function(f){s.handleFlushResult(f,v)}):this.handleFlushResult(e,v)}},T.handleFlushResult=function(v,s){var t=this;v.forEach(function(r){t.handleTransmuxComplete(r)}),this.onFlush(s)},T.onWorkerMessage=function(v){var s=v.data,t=this.hls;switch(s.event){case"init":{self.URL.revokeObjectURL(this.worker.objectURL);break}case"transmuxComplete":{this.handleTransmuxComplete(s.data);break}case"flush":{this.onFlush(s.data);break}default:{s.data=s.data||{},s.data.frag=this.frag,s.data.id=this.id,t.trigger(s.event,s.data);break}}},T.configureTransmuxer=function(v){var s=this.worker,t=this.transmuxer;s?s.postMessage({cmd:"configure",config:v}):t&&t.configure(v)},T.handleTransmuxComplete=function(v){v.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(v)},y}()},"./src/demux/transmuxer-worker.ts":function(K,C,E){E.r(C),E.d(C,"default",function(){return I});var M=E("./src/demux/transmuxer.ts"),O=E("./src/events.ts"),L=E("./src/utils/logger.ts"),R=E("./node_modules/eventemitter3/index.js");function I(y){var T=new R.EventEmitter,p=function(s,t){y.postMessage({event:s,data:t})};T.on(O.Events.FRAG_DECRYPTED,p),T.on(O.Events.ERROR,p),y.addEventListener("message",function(v){var s=v.data;switch(s.cmd){case"init":{var t=JSON.parse(s.config);y.transmuxer=new M.default(T,s.typeSupported,t,s.vendor,s.id),Object(L.enableLogs)(t.debug),p("init",null);break}case"configure":{y.transmuxer.configure(s.config);break}case"demux":{var r=y.transmuxer.push(s.data,s.decryptdata,s.chunkMeta,s.state);Object(M.isPromise)(r)?r.then(function(a){b(y,a)}):b(y,r);break}case"flush":{var e=s.chunkMeta,f=y.transmuxer.flush(e);Object(M.isPromise)(f)?f.then(function(a){c(y,a,e)}):c(y,f,e);break}}})}function b(y,T){if(!S(T.remuxResult)){var p=[],v=T.remuxResult,s=v.audio,t=v.video;s&&A(p,s),t&&A(p,t),y.postMessage({event:"transmuxComplete",data:T},p)}}function A(y,T){T.data1&&y.push(T.data1.buffer),T.data2&&y.push(T.data2.buffer)}function c(y,T,p){T.forEach(function(v){b(y,v)}),y.postMessage({event:"flush",data:p})}function S(y){return!y.audio&&!y.video&&!y.text&&!y.id3&&!y.initSegment}},"./src/demux/transmuxer.ts":function(K,C,E){E.r(C),E.d(C,"default",function(){return r}),E.d(C,"isPromise",function(){return a}),E.d(C,"TransmuxConfig",function(){return i}),E.d(C,"TransmuxState",function(){return l});var M=E("./src/events.ts"),O=E("./src/errors.ts"),L=E("./src/crypt/decrypter.ts"),R=E("./src/demux/aacdemuxer.ts"),I=E("./src/demux/mp4demuxer.ts"),b=E("./src/demux/tsdemuxer.ts"),A=E("./src/demux/mp3demuxer.ts"),c=E("./src/remux/mp4-remuxer.ts"),S=E("./src/remux/passthrough-remuxer.ts"),y=E("./src/demux/chunk-cache.ts"),T=E("./src/utils/mp4-tools.ts"),p=E("./src/utils/logger.ts"),v;try{v=self.performance.now.bind(self.performance)}catch{p.logger.debug("Unable to use Performance API on this environment"),v=self.Date.now}var s=[{demux:b.default,remux:c.default},{demux:I.default,remux:S.default},{demux:R.default,remux:c.default},{demux:A.default,remux:c.default}],t=1024;s.forEach(function(g){var h=g.demux;t=Math.max(t,h.minProbeByteLength)});var r=function(){function g(o,n,d,u,m){this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.cache=new y.default,this.observer=o,this.typeSupported=n,this.config=d,this.vendor=u,this.id=m}var h=g.prototype;return h.configure=function(n){this.transmuxConfig=n,this.decrypter&&this.decrypter.reset()},h.push=function(n,d,u,m){var x=this,D=u.transmuxing;D.executeStart=v();var P=new Uint8Array(n),_=this.cache,F=this.config,U=this.currentTransmuxState,k=this.transmuxConfig;m&&(this.currentTransmuxState=m);var N=e(P,d);if(N&&N.method==="AES-128"){var w=this.getDecrypter();if(F.enableSoftwareAES){var V=w.softwareDecrypt(P,N.key.buffer,N.iv.buffer);if(!V)return D.executeEnd=v(),f(u);P=new Uint8Array(V)}else return this.decryptionPromise=w.webCryptoDecrypt(P,N.key.buffer,N.iv.buffer).then(function(ue){var se=x.push(ue,null,u);return x.decryptionPromise=null,se}),this.decryptionPromise}var W=m||U,Y=W.contiguous,j=W.discontinuity,X=W.trackSwitch,$=W.accurateTimeOffset,Q=W.timeOffset,z=k.audioCodec,J=k.videoCodec,Z=k.defaultInitPts,q=k.duration,ee=k.initSegmentData;if((j||X)&&this.resetInitSegment(ee,z,J,q),j&&this.resetInitialTimestamp(Z),Y||this.resetContiguity(),this.needsProbing(P,j,X)){if(_.dataLength){var ne=_.flush();P=Object(T.appendUint8Array)(ne,P)}this.configureTransmuxer(P,k)}var te=this.transmux(P,N,Q,$,u),ie=this.currentTransmuxState;return ie.contiguous=!0,ie.discontinuity=!1,ie.trackSwitch=!1,D.executeEnd=v(),te},h.flush=function(n){var d=this,u=n.transmuxing;u.executeStart=v();var m=this.decrypter,x=this.cache,D=this.currentTransmuxState,P=this.decryptionPromise;if(P)return P.then(function(){return d.flush(n)});var _=[],F=D.timeOffset;if(m){var U=m.flush();U&&_.push(this.push(U,null,n))}var k=x.dataLength;x.reset();var N=this.demuxer,w=this.remuxer;if(!N||!w)return k>=t&&this.observer.emit(M.Events.ERROR,M.Events.ERROR,{type:O.ErrorTypes.MEDIA_ERROR,details:O.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),u.executeEnd=v(),[f(n)];var V=N.flush(F);return a(V)?V.then(function(W){return d.flushRemux(_,W,n),_}):(this.flushRemux(_,V,n),_)},h.flushRemux=function(n,d,u){var m=d.audioTrack,x=d.avcTrack,D=d.id3Track,P=d.textTrack,_=this.currentTransmuxState,F=_.accurateTimeOffset,U=_.timeOffset;p.logger.log("[transmuxer.ts]: Flushed fragment "+u.sn+(u.part>-1?" p: "+u.part:"")+" of level "+u.level);var k=this.remuxer.remux(m,x,D,P,U,F,!0,this.id);n.push({remuxResult:k,chunkMeta:u}),u.transmuxing.executeEnd=v()},h.resetInitialTimestamp=function(n){var d=this.demuxer,u=this.remuxer;!d||!u||(d.resetTimeStamp(n),u.resetTimeStamp(n))},h.resetContiguity=function(){var n=this.demuxer,d=this.remuxer;!n||!d||(n.resetContiguity(),d.resetNextTimestamp())},h.resetInitSegment=function(n,d,u,m){var x=this.demuxer,D=this.remuxer;!x||!D||(x.resetInitSegment(d,u,m),D.resetInitSegment(n,d,u))},h.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},h.transmux=function(n,d,u,m,x){var D;return d&&d.method==="SAMPLE-AES"?D=this.transmuxSampleAes(n,d,u,m,x):D=this.transmuxUnencrypted(n,u,m,x),D},h.transmuxUnencrypted=function(n,d,u,m){var x=this.demuxer.demux(n,d,!1,!this.config.progressive),D=x.audioTrack,P=x.avcTrack,_=x.id3Track,F=x.textTrack,U=this.remuxer.remux(D,P,_,F,d,u,!1,this.id);return{remuxResult:U,chunkMeta:m}},h.transmuxSampleAes=function(n,d,u,m,x){var D=this;return this.demuxer.demuxSampleAes(n,d,u).then(function(P){var _=D.remuxer.remux(P.audioTrack,P.avcTrack,P.id3Track,P.textTrack,u,m,!1,D.id);return{remuxResult:_,chunkMeta:x}})},h.configureTransmuxer=function(n,d){for(var u=this.config,m=this.observer,x=this.typeSupported,D=this.vendor,P=d.audioCodec,_=d.defaultInitPts,F=d.duration,U=d.initSegmentData,k=d.videoCodec,N,w=0,V=s.length;w<V;w++)if(s[w].demux.probe(n)){N=s[w];break}N||(p.logger.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),N={demux:I.default,remux:S.default});var W=this.demuxer,Y=this.remuxer,j=N.remux,X=N.demux;(!Y||!(Y instanceof j))&&(this.remuxer=new j(m,u,x,D)),(!W||!(W instanceof X))&&(this.demuxer=new X(m,u,x),this.probe=X.probe),this.resetInitSegment(U,P,k,F),this.resetInitialTimestamp(_)},h.needsProbing=function(n,d,u){return!this.demuxer||!this.remuxer||d||u},h.getDecrypter=function(){var n=this.decrypter;return n||(n=this.decrypter=new L.default(this.observer,this.config)),n},g}();function e(g,h){var o=null;return g.byteLength>0&&h!=null&&h.key!=null&&h.iv!==null&&h.method!=null&&(o=h),o}var f=function(h){return{remuxResult:{},chunkMeta:h}};function a(g){return"then"in g&&g.then instanceof Function}var i=function(h,o,n,d,u){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=h,this.videoCodec=o,this.initSegmentData=n,this.duration=d,this.defaultInitPts=u},l=function(h,o,n,d,u){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.discontinuity=h,this.contiguous=o,this.accurateTimeOffset=n,this.trackSwitch=d,this.timeOffset=u}},"./src/demux/tsdemuxer.ts":function(K,C,E){E.r(C),E.d(C,"discardEPB",function(){return f});var M=E("./src/demux/adts.ts"),O=E("./src/demux/mpegaudio.ts"),L=E("./src/demux/exp-golomb.ts"),R=E("./src/demux/id3.ts"),I=E("./src/demux/sample-aes.ts"),b=E("./src/events.ts"),A=E("./src/utils/mp4-tools.ts"),c=E("./src/utils/logger.ts"),S=E("./src/errors.ts"),y={video:1,audio:2,id3:3,text:4},T=function(){function a(l,g,h){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this.aacLastPTS=null,this._initPTS=null,this._initDTS=null,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=l,this.config=g,this.typeSupported=h}a.probe=function(g){var h=a.syncOffset(g);return h<0?!1:(h&&c.logger.warn("MPEG2-TS detected but first sync word found @ offset "+h+", junk ahead ?"),!0)},a.syncOffset=function(g){for(var h=Math.min(1e3,g.length-564),o=0;o<h;){if(g[o]===71&&g[o+188]===71&&g[o+2*188]===71)return o;o++}return-1},a.createTrack=function(g,h){return{container:g==="video"||g==="audio"?"video/mp2t":void 0,type:g,id:y[g],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:g==="audio"?h:void 0}};var i=a.prototype;return i.resetInitSegment=function(g,h,o){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=a.createTrack("video",o),this._audioTrack=a.createTrack("audio",o),this._id3Track=a.createTrack("id3",o),this._txtTrack=a.createTrack("text",o),this._audioTrack.isAAC=!0,this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=g,this.videoCodec=h,this._duration=o},i.resetTimeStamp=function(){},i.resetContiguity=function(){var g=this._audioTrack,h=this._avcTrack,o=this._id3Track;g&&(g.pesData=null),h&&(h.pesData=null),o&&(o.pesData=null),this.aacOverFlow=null,this.aacLastPTS=null},i.demux=function(g,h,o,n){o===void 0&&(o=!1),n===void 0&&(n=!1),o||(this.sampleAes=null);var d,u=this._avcTrack,m=this._audioTrack,x=this._id3Track,D=u.pid,P=u.pesData,_=m.pid,F=x.pid,U=m.pesData,k=x.pesData,N=!1,w=this.pmtParsed,V=this._pmtId,W=g.length;if(this.remainderData&&(g=Object(A.appendUint8Array)(this.remainderData,g),W=g.length,this.remainderData=null),W<188&&!n)return this.remainderData=g,{audioTrack:m,avcTrack:u,id3Track:x,textTrack:this._txtTrack};var Y=Math.max(0,a.syncOffset(g));W-=(W+Y)%188,W<g.byteLength&&!n&&(this.remainderData=new Uint8Array(g.buffer,W,g.buffer.byteLength-W));for(var j=Y;j<W;j+=188)if(g[j]===71){var X=!!(g[j+1]&64),$=((g[j+1]&31)<<8)+g[j+2],Q=(g[j+3]&48)>>4,z=void 0;if(Q>1){if(z=j+5+g[j+4],z===j+188)continue}else z=j+4;switch($){case D:X&&(P&&(d=t(P))&&this.parseAVCPES(d,!1),P={data:[],size:0}),P&&(P.data.push(g.subarray(z,j+188)),P.size+=j+188-z);break;case _:X&&(U&&(d=t(U))&&(m.isAAC?this.parseAACPES(d):this.parseMPEGPES(d)),U={data:[],size:0}),U&&(U.data.push(g.subarray(z,j+188)),U.size+=j+188-z);break;case F:X&&(k&&(d=t(k))&&this.parseID3PES(d),k={data:[],size:0}),k&&(k.data.push(g.subarray(z,j+188)),k.size+=j+188-z);break;case 0:X&&(z+=g[z]+1),V=this._pmtId=v(g,z);break;case V:{X&&(z+=g[z]+1);var J=s(g,z,this.typeSupported.mpeg===!0||this.typeSupported.mp3===!0,o);D=J.avc,D>0&&(u.pid=D),_=J.audio,_>0&&(m.pid=_,m.isAAC=J.isAAC),F=J.id3,F>0&&(x.pid=F),N&&!w&&(c.logger.log("reparse from beginning"),N=!1,j=Y-188),w=this.pmtParsed=!0;break}case 17:case 8191:break;default:N=!0;break}}else this.observer.emit(b.Events.ERROR,b.Events.ERROR,{type:S.ErrorTypes.MEDIA_ERROR,details:S.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});u.pesData=P,m.pesData=U,x.pesData=k;var Z={audioTrack:m,avcTrack:u,id3Track:x,textTrack:this._txtTrack};return n&&this.extractRemainingSamples(Z),Z},i.flush=function(){var g=this.remainderData;this.remainderData=null;var h;return g?h=this.demux(g,-1,!1,!0):h={audioTrack:this._audioTrack,avcTrack:this._avcTrack,textTrack:this._txtTrack,id3Track:this._id3Track},this.extractRemainingSamples(h),this.sampleAes?this.decrypt(h,this.sampleAes):h},i.extractRemainingSamples=function(g){var h=g.audioTrack,o=g.avcTrack,n=g.id3Track,d=o.pesData,u=h.pesData,m=n.pesData,x;d&&(x=t(d))?(this.parseAVCPES(x,!0),o.pesData=null):o.pesData=d,u&&(x=t(u))?(h.isAAC?this.parseAACPES(x):this.parseMPEGPES(x),h.pesData=null):(u!=null&&u.size&&c.logger.log("last AAC PES packet truncated,might overlap between fragments"),h.pesData=u),m&&(x=t(m))?(this.parseID3PES(x),n.pesData=null):n.pesData=m},i.demuxSampleAes=function(g,h,o){var n=this.demux(g,o,!0,!this.config.progressive),d=this.sampleAes=new I.default(this.observer,this.config,h);return this.decrypt(n,d)},i.decrypt=function(g,h){return new Promise(function(o){var n=g.audioTrack,d=g.avcTrack;n.samples&&n.isAAC?h.decryptAacSamples(n.samples,0,function(){d.samples?h.decryptAvcSamples(d.samples,0,0,function(){o(g)}):o(g)}):d.samples&&h.decryptAvcSamples(d.samples,0,0,function(){o(g)})})},i.destroy=function(){this._initPTS=this._initDTS=null,this._duration=0},i.parseAVCPES=function(g,h){var o=this,n=this._avcTrack,d=this.parseAVCNALu(g.data),u=this.avcSample,m,x=!1;g.data=null,u&&d.length&&!n.audFound&&(r(u,n),u=this.avcSample=p(!1,g.pts,g.dts,"")),d.forEach(function(D){switch(D.type){case 1:{m=!0,u||(u=o.avcSample=p(!0,g.pts,g.dts,"")),u.frame=!0;var P=D.data;if(x&&P.length>4){var _=new L.default(P).readSliceType();(_===2||_===4||_===7||_===9)&&(u.key=!0)}break}case 5:m=!0,u||(u=o.avcSample=p(!0,g.pts,g.dts,"")),u.key=!0,u.frame=!0;break;case 6:{m=!0;var F=new L.default(f(D.data));F.readUByte();for(var U=0,k=0,N=!1,w=0;!N&&F.bytesAvailable>1;){U=0;do w=F.readUByte(),U+=w;while(w===255);k=0;do w=F.readUByte(),k+=w;while(w===255);if(U===4&&F.bytesAvailable!==0){N=!0;var V=F.readUByte();if(V===181){var W=F.readUShort();if(W===49){var Y=F.readUInt();if(Y===1195456820){var j=F.readUByte();if(j===3){for(var X=F.readUByte(),$=F.readUByte(),Q=31&X,z=[X,$],J=0;J<Q;J++)z.push(F.readUByte()),z.push(F.readUByte()),z.push(F.readUByte());e(o._txtTrack.samples,{type:3,pts:g.pts,bytes:z})}}}}}else if(U===5&&F.bytesAvailable!==0){if(N=!0,k>16){for(var Z=[],q=0;q<16;q++)Z.push(F.readUByte().toString(16)),(q===3||q===5||q===7||q===9)&&Z.push("-");for(var ee=k-16,ne=new Uint8Array(ee),te=0;te<ee;te++)ne[te]=F.readUByte();e(o._txtTrack.samples,{pts:g.pts,payloadType:U,uuid:Z.join(""),userData:Object(R.utf8ArrayToStr)(ne),userDataBytes:ne})}}else if(k<F.bytesAvailable)for(var ie=0;ie<k;ie++)F.readUByte()}break}case 7:if(m=!0,x=!0,!n.sps){var ue=new L.default(D.data),se=ue.readSPS();n.width=se.width,n.height=se.height,n.pixelRatio=se.pixelRatio,n.sps=[D.data],n.duration=o._duration;for(var fe=D.data.subarray(1,4),oe="avc1.",ce=0;ce<3;ce++){var re=fe[ce].toString(16);re.length<2&&(re="0"+re),oe+=re}n.codec=oe}break;case 8:m=!0,n.pps||(n.pps=[D.data]);break;case 9:m=!1,n.audFound=!0,u&&r(u,n),u=o.avcSample=p(!1,g.pts,g.dts,"");break;case 12:m=!1;break;default:m=!1,u&&(u.debug+="unknown NAL "+D.type+" ");break}if(u&&m){var Le=u.units;Le.push(D)}}),h&&u&&(r(u,n),this.avcSample=null)},i.getLastNalUnit=function(){var g,h=this.avcSample,o;if(!h||h.units.length===0){var n=this._avcTrack.samples;h=n[n.length-1]}if((g=h)!==null&&g!==void 0&&g.units){var d=h.units;o=d[d.length-1]}return o},i.parseAVCNALu=function(g){var h=g.byteLength,o=this._avcTrack,n=o.naluState||0,d=n,u=[],m=0,x,D,P,_=-1,F=0;for(n===-1&&(_=0,F=g[0]&31,n=0,m=1);m<h;){if(x=g[m++],!n){n=x?0:1;continue}if(n===1){n=x?0:2;continue}if(!x)n=3;else if(x===1){if(_>=0){var U={data:g.subarray(_,m-n-1),type:F};u.push(U)}else{var k=this.getLastNalUnit();if(k&&(d&&m<=4-d&&k.state&&(k.data=k.data.subarray(0,k.data.byteLength-d)),D=m-n-1,D>0)){var N=new Uint8Array(k.data.byteLength+D);N.set(k.data,0),N.set(g.subarray(0,D),k.data.byteLength),k.data=N}}m<h?(P=g[m]&31,_=m,F=P,n=0):n=-1}else n=0}if(_>=0&&n>=0){var w={data:g.subarray(_,h),type:F,state:n};u.push(w)}if(u.length===0){var V=this.getLastNalUnit();if(V){var W=new Uint8Array(V.data.byteLength+g.byteLength);W.set(V.data,0),W.set(g,V.data.byteLength),V.data=W}}return o.naluState=n,u},i.parseAACPES=function(g){var h=0,o=this._audioTrack,n=this.aacOverFlow,d=g.data;if(n){this.aacOverFlow=null;var u=n.sample.unit.byteLength,m=Math.min(n.missing,u),x=u-m;n.sample.unit.set(d.subarray(0,m),x),o.samples.push(n.sample),h=n.missing}var D,P;for(D=h,P=d.length;D<P-1&&!M.isHeader(d,D);D++);if(D!==h){var _,F;if(D<P-1?(_="AAC PES did not start with ADTS header,offset:"+D,F=!1):(_="no ADTS header found in AAC PES",F=!0),c.logger.warn("parsing error:"+_),this.observer.emit(b.Events.ERROR,b.Events.ERROR,{type:S.ErrorTypes.MEDIA_ERROR,details:S.ErrorDetails.FRAG_PARSING_ERROR,fatal:F,reason:_}),F)return}M.initTrackConfig(o,this.observer,d,D,this.audioCodec);var U;if(g.pts!==void 0)U=g.pts;else if(n){var k=M.getFrameDuration(o.samplerate);U=n.sample.pts+k}else{c.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}for(var N=0;D<P;)if(M.isHeader(d,D)){if(D+5<P){var w=M.appendFrame(o,d,D,U,N);if(w)if(w.missing)this.aacOverFlow=w;else{D+=w.length,N++;continue}}break}else D++},i.parseMPEGPES=function(g){var h=g.data,o=h.length,n=0,d=0,u=g.pts;if(u===void 0){c.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;d<o;)if(O.isHeader(h,d)){var m=O.appendFrame(this._audioTrack,h,d,u,n);if(m)d+=m.length,n++;else break}else d++},i.parseID3PES=function(g){if(g.pts===void 0){c.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}this._id3Track.samples.push(g)},a}();T.minProbeByteLength=188;function p(a,i,l,g){return{key:a,frame:!1,pts:i,dts:l,units:[],debug:g,length:0}}function v(a,i){return(a[i+10]&31)<<8|a[i+11]}function s(a,i,l,g){var h={audio:-1,avc:-1,id3:-1,isAAC:!0},o=(a[i+1]&15)<<8|a[i+2],n=i+3+o-4,d=(a[i+10]&15)<<8|a[i+11];for(i+=12+d;i<n;){var u=(a[i+1]&31)<<8|a[i+2];switch(a[i]){case 207:if(!g){c.logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:h.audio===-1&&(h.audio=u);break;case 21:h.id3===-1&&(h.id3=u);break;case 219:if(!g){c.logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:h.avc===-1&&(h.avc=u);break;case 3:case 4:l?h.audio===-1&&(h.audio=u,h.isAAC=!1):c.logger.log("MPEG audio found, not supported in this browser");break;case 36:c.logger.warn("Unsupported HEVC stream type found");break}i+=((a[i+3]&15)<<8|a[i+4])+5}return h}function t(a){var i=0,l,g,h,o,n,d=a.data;if(!a||a.size===0)return null;for(;d[0].length<19&&d.length>1;){var u=new Uint8Array(d[0].length+d[1].length);u.set(d[0]),u.set(d[1],d[0].length),d[0]=u,d.splice(1,1)}l=d[0];var m=(l[0]<<16)+(l[1]<<8)+l[2];if(m===1){if(g=(l[4]<<8)+l[5],g&&g>a.size-6)return null;var x=l[7];x&192&&(o=(l[9]&14)*536870912+(l[10]&255)*4194304+(l[11]&254)*16384+(l[12]&255)*128+(l[13]&254)/2,x&64?(n=(l[14]&14)*536870912+(l[15]&255)*4194304+(l[16]&254)*16384+(l[17]&255)*128+(l[18]&254)/2,o-n>60*9e4&&(c.logger.warn(Math.round((o-n)/9e4)+"s delta between PTS and DTS, align them"),o=n)):n=o),h=l[8];var D=h+9;if(a.size<=D)return null;a.size-=D;for(var P=new Uint8Array(a.size),_=0,F=d.length;_<F;_++){l=d[_];var U=l.byteLength;if(D)if(D>U){D-=U;continue}else l=l.subarray(D),U-=D,D=0;P.set(l,i),i+=U}return g&&(g-=h+3),{data:P,pts:o,dts:n,len:g}}return null}function r(a,i){if(a.units.length&&a.frame){if(a.pts===void 0){var l=i.samples,g=l.length;if(g){var h=l[g-1];a.pts=h.pts,a.dts=h.dts}else{i.dropped++;return}}i.samples.push(a)}a.debug.length&&c.logger.log(a.pts+"/"+a.dts+":"+a.debug)}function e(a,i){var l=a.length;if(l>0){if(i.pts>=a[l-1].pts)a.push(i);else for(var g=l-1;g>=0;g--)if(i.pts<a[g].pts){a.splice(g,0,i);break}}else a.push(i)}function f(a){for(var i=a.byteLength,l=[],g=1;g<i-2;)a[g]===0&&a[g+1]===0&&a[g+2]===3?(l.push(g+2),g+=2):g++;if(l.length===0)return a;var h=i-l.length,o=new Uint8Array(h),n=0;for(g=0;g<h;n++,g++)n===l[0]&&(n++,l.shift()),o[g]=a[n];return o}C.default=T},"./src/errors.ts":function(K,C,E){E.r(C),E.d(C,"ErrorTypes",function(){return M}),E.d(C,"ErrorDetails",function(){return O});var M;(function(L){L.NETWORK_ERROR="networkError",L.MEDIA_ERROR="mediaError",L.KEY_SYSTEM_ERROR="keySystemError",L.MUX_ERROR="muxError",L.OTHER_ERROR="otherError"})(M||(M={}));var O;(function(L){L.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",L.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",L.KEY_SYSTEM_NO_SESSION="keySystemNoSession",L.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",L.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",L.MANIFEST_LOAD_ERROR="manifestLoadError",L.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",L.MANIFEST_PARSING_ERROR="manifestParsingError",L.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",L.LEVEL_EMPTY_ERROR="levelEmptyError",L.LEVEL_LOAD_ERROR="levelLoadError",L.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",L.LEVEL_SWITCH_ERROR="levelSwitchError",L.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",L.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",L.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",L.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",L.FRAG_LOAD_ERROR="fragLoadError",L.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",L.FRAG_DECRYPT_ERROR="fragDecryptError",L.FRAG_PARSING_ERROR="fragParsingError",L.REMUX_ALLOC_ERROR="remuxAllocError",L.KEY_LOAD_ERROR="keyLoadError",L.KEY_LOAD_TIMEOUT="keyLoadTimeOut",L.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",L.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",L.BUFFER_APPEND_ERROR="bufferAppendError",L.BUFFER_APPENDING_ERROR="bufferAppendingError",L.BUFFER_STALLED_ERROR="bufferStalledError",L.BUFFER_FULL_ERROR="bufferFullError",L.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",L.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",L.INTERNAL_EXCEPTION="internalException",L.INTERNAL_ABORTED="aborted",L.UNKNOWN="unknown"})(O||(O={}))},"./src/events.ts":function(K,C,E){E.r(C),E.d(C,"Events",function(){return M});var M;(function(O){O.MEDIA_ATTACHING="hlsMediaAttaching",O.MEDIA_ATTACHED="hlsMediaAttached",O.MEDIA_DETACHING="hlsMediaDetaching",O.MEDIA_DETACHED="hlsMediaDetached",O.BUFFER_RESET="hlsBufferReset",O.BUFFER_CODECS="hlsBufferCodecs",O.BUFFER_CREATED="hlsBufferCreated",O.BUFFER_APPENDING="hlsBufferAppending",O.BUFFER_APPENDED="hlsBufferAppended",O.BUFFER_EOS="hlsBufferEos",O.BUFFER_FLUSHING="hlsBufferFlushing",O.BUFFER_FLUSHED="hlsBufferFlushed",O.MANIFEST_LOADING="hlsManifestLoading",O.MANIFEST_LOADED="hlsManifestLoaded",O.MANIFEST_PARSED="hlsManifestParsed",O.LEVEL_SWITCHING="hlsLevelSwitching",O.LEVEL_SWITCHED="hlsLevelSwitched",O.LEVEL_LOADING="hlsLevelLoading",O.LEVEL_LOADED="hlsLevelLoaded",O.LEVEL_UPDATED="hlsLevelUpdated",O.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",O.LEVELS_UPDATED="hlsLevelsUpdated",O.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",O.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",O.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",O.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",O.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",O.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",O.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",O.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",O.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",O.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",O.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",O.CUES_PARSED="hlsCuesParsed",O.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",O.INIT_PTS_FOUND="hlsInitPtsFound",O.FRAG_LOADING="hlsFragLoading",O.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",O.FRAG_LOADED="hlsFragLoaded",O.FRAG_DECRYPTED="hlsFragDecrypted",O.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",O.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",O.FRAG_PARSING_METADATA="hlsFragParsingMetadata",O.FRAG_PARSED="hlsFragParsed",O.FRAG_BUFFERED="hlsFragBuffered",O.FRAG_CHANGED="hlsFragChanged",O.FPS_DROP="hlsFpsDrop",O.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",O.ERROR="hlsError",O.DESTROYING="hlsDestroying",O.KEY_LOADING="hlsKeyLoading",O.KEY_LOADED="hlsKeyLoaded",O.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",O.BACK_BUFFER_REACHED="hlsBackBufferReached"})(M||(M={}))},"./src/hls.ts":function(K,C,E){E.r(C),E.d(C,"default",function(){return e});var M=E("./node_modules/url-toolkit/src/url-toolkit.js"),O=E("./src/loader/playlist-loader.ts"),L=E("./src/loader/key-loader.ts"),R=E("./src/controller/id3-track-controller.ts"),I=E("./src/controller/latency-controller.ts"),b=E("./src/controller/level-controller.ts"),A=E("./src/controller/fragment-tracker.ts"),c=E("./src/controller/stream-controller.ts"),S=E("./src/is-supported.ts"),y=E("./src/utils/logger.ts"),T=E("./src/config.ts"),p=E("./node_modules/eventemitter3/index.js"),v=E("./src/events.ts"),s=E("./src/errors.ts");function t(f,a){for(var i=0;i<a.length;i++){var l=a[i];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(f,l.key,l)}}function r(f,a,i){return a&&t(f.prototype,a),i&&t(f,i),f}var e=function(){f.isSupported=function(){return Object(S.isSupported)()};function f(i){i===void 0&&(i={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new p.EventEmitter,this._autoLevelCapping=void 0,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this._media=null,this.url=null;var l=this.config=Object(T.mergeConfig)(f.DefaultConfig,i);this.userConfig=i,Object(y.enableLogs)(l.debug),this._autoLevelCapping=-1,l.progressive&&Object(T.enableStreamingMode)(l);var g=l.abrController,h=l.bufferController,o=l.capLevelController,n=l.fpsController,d=this.abrController=new g(this),u=this.bufferController=new h(this),m=this.capLevelController=new o(this),x=new n(this),D=new O.default(this),P=new L.default(this),_=new R.default(this),F=this.levelController=new b.default(this),U=new A.FragmentTracker(this),k=this.streamController=new c.default(this,U);m.setStreamController(k),x.setStreamController(k);var N=[F,k];this.networkControllers=N;var w=[D,P,d,u,m,x,_,U];this.audioTrackController=this.createController(l.audioTrackController,null,N),this.createController(l.audioStreamController,U,N),this.subtitleTrackController=this.createController(l.subtitleTrackController,null,N),this.createController(l.subtitleStreamController,U,N),this.createController(l.timelineController,null,w),this.emeController=this.createController(l.emeController,null,w),this.latencyController=this.createController(I.default,null,w),this.coreComponents=w}var a=f.prototype;return a.createController=function(l,g,h){if(l){var o=g?new l(this,g):new l(this);return h&&h.push(o),o}return null},a.on=function(l,g,h){h===void 0&&(h=this),this._emitter.on(l,g,h)},a.once=function(l,g,h){h===void 0&&(h=this),this._emitter.once(l,g,h)},a.removeAllListeners=function(l){this._emitter.removeAllListeners(l)},a.off=function(l,g,h,o){h===void 0&&(h=this),this._emitter.off(l,g,h,o)},a.listeners=function(l){return this._emitter.listeners(l)},a.emit=function(l,g,h){return this._emitter.emit(l,g,h)},a.trigger=function(l,g){if(this.config.debug)return this.emit(l,l,g);try{return this.emit(l,l,g)}catch(h){y.logger.error("An internal error happened while handling event "+l+'. Error message: "'+h.message+'". Here is a stacktrace:',h),this.trigger(v.Events.ERROR,{type:s.ErrorTypes.OTHER_ERROR,details:s.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:l,error:h})}return!1},a.listenerCount=function(l){return this._emitter.listenerCount(l)},a.destroy=function(){y.logger.log("destroy"),this.trigger(v.Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(function(l){return l.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(l){return l.destroy()}),this.coreComponents.length=0},a.attachMedia=function(l){y.logger.log("attachMedia"),this._media=l,this.trigger(v.Events.MEDIA_ATTACHING,{media:l})},a.detachMedia=function(){y.logger.log("detachMedia"),this.trigger(v.Events.MEDIA_DETACHING,void 0),this._media=null},a.loadSource=function(l){this.stopLoad();var g=this.media,h=this.url,o=this.url=M.buildAbsoluteURL(self.location.href,l,{alwaysNormalize:!0});y.logger.log("loadSource:"+o),g&&h&&h!==o&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(g)),this.trigger(v.Events.MANIFEST_LOADING,{url:l})},a.startLoad=function(l){l===void 0&&(l=-1),y.logger.log("startLoad("+l+")"),this.networkControllers.forEach(function(g){g.startLoad(l)})},a.stopLoad=function(){y.logger.log("stopLoad"),this.networkControllers.forEach(function(l){l.stopLoad()})},a.swapAudioCodec=function(){y.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},a.recoverMediaError=function(){y.logger.log("recoverMediaError");var l=this._media;this.detachMedia(),l&&this.attachMedia(l)},a.removeLevel=function(l,g){g===void 0&&(g=0),this.levelController.removeLevel(l,g)},r(f,[{key:"levels",get:function(){var l=this.levelController.levels;return l||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(l){y.logger.log("set currentLevel:"+l),this.loadLevel=l,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(l){y.logger.log("set nextLevel:"+l),this.levelController.manualLevel=l,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(l){y.logger.log("set loadLevel:"+l),this.levelController.manualLevel=l}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(l){this.levelController.nextLoadLevel=l}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(l){y.logger.log("set firstLevel:"+l),this.levelController.firstLevel=l}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(l){y.logger.log("set startLevel:"+l),l!==-1&&(l=Math.max(l,this.minAutoLevel)),this.levelController.startLevel=l}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(l){var g=!!l;g!==this.config.capLevelToPlayerSize&&(g?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=g)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(l){this._autoLevelCapping!==l&&(y.logger.log("set autoLevelCapping:"+l),this._autoLevelCapping=l)}},{key:"bandwidthEstimate",get:function(){var l=this.abrController.bwEstimator;return l?l.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var l=this.levels,g=this.config.minAutoBitrate;if(!l)return 0;for(var h=l.length,o=0;o<h;o++)if(l[o].maxBitrate>g)return o;return 0}},{key:"maxAutoLevel",get:function(){var l=this.levels,g=this.autoLevelCapping,h;return g===-1&&l&&l.length?h=l.length-1:h=g,h}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(l){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,l)}},{key:"audioTracks",get:function(){var l=this.audioTrackController;return l?l.audioTracks:[]}},{key:"audioTrack",get:function(){var l=this.audioTrackController;return l?l.audioTrack:-1},set:function(l){var g=this.audioTrackController;g&&(g.audioTrack=l)}},{key:"subtitleTracks",get:function(){var l=this.subtitleTrackController;return l?l.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var l=this.subtitleTrackController;return l?l.subtitleTrack:-1},set:function(l){var g=this.subtitleTrackController;g&&(g.subtitleTrack=l)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var l=this.subtitleTrackController;return l?l.subtitleDisplay:!1},set:function(l){var g=this.subtitleTrackController;g&&(g.subtitleDisplay=l)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(l){this.config.lowLatencyMode=l}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}],[{key:"version",get:function(){return"1.0.10"}},{key:"Events",get:function(){return v.Events}},{key:"ErrorTypes",get:function(){return s.ErrorTypes}},{key:"ErrorDetails",get:function(){return s.ErrorDetails}},{key:"DefaultConfig",get:function(){return f.defaultConfig?f.defaultConfig:T.hlsDefaultConfig},set:function(l){f.defaultConfig=l}}]),f}();e.defaultConfig=void 0},"./src/is-supported.ts":function(K,C,E){E.r(C),E.d(C,"isSupported",function(){return L}),E.d(C,"changeTypeSupported",function(){return R});var M=E("./src/utils/mediasource-helper.ts");function O(){return self.SourceBuffer||self.WebKitSourceBuffer}function L(){var I=Object(M.getMediaSource)();if(!I)return!1;var b=O(),A=I&&typeof I.isTypeSupported=="function"&&I.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),c=!b||b.prototype&&typeof b.prototype.appendBuffer=="function"&&typeof b.prototype.remove=="function";return!!A&&!!c}function R(){var I,b=O();return typeof(b==null||(I=b.prototype)===null||I===void 0?void 0:I.changeType)=="function"}},"./src/loader/fragment-loader.ts":function(K,C,E){E.r(C),E.d(C,"default",function(){return T}),E.d(C,"LoadError",function(){return v});var M=E("./src/polyfills/number.ts"),O=E("./src/errors.ts");function L(s,t){s.prototype=Object.create(t.prototype),s.prototype.constructor=s,c(s,t)}function R(s){var t=typeof Map=="function"?new Map:void 0;return R=function(e){if(e===null||!A(e))return e;if(typeof e!="function")throw new TypeError("Super expression must either be null or a function");if(typeof t!="undefined"){if(t.has(e))return t.get(e);t.set(e,f)}function f(){return I(e,arguments,S(this).constructor)}return f.prototype=Object.create(e.prototype,{constructor:{value:f,enumerable:!1,writable:!0,configurable:!0}}),c(f,e)},R(s)}function I(s,t,r){return b()?I=Reflect.construct:I=function(f,a,i){var l=[null];l.push.apply(l,a);var g=Function.bind.apply(f,l),h=new g;return i&&c(h,i.prototype),h},I.apply(null,arguments)}function b(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function A(s){return Function.toString.call(s).indexOf("[native code]")!==-1}function c(s,t){return c=Object.setPrototypeOf||function(e,f){return e.__proto__=f,e},c(s,t)}function S(s){return S=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)},S(s)}var y=Math.pow(2,17),T=function(){function s(r){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=r}var t=s.prototype;return t.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},t.abort=function(){this.loader&&this.loader.abort()},t.load=function(e,f){var a=this,i=e.url;if(!i)return Promise.reject(new v({type:O.ErrorTypes.NETWORK_ERROR,details:O.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:e,networkDetails:null},"Fragment does not have a "+(i?"part list":"url")));this.abort();var l=this.config,g=l.fLoader,h=l.loader;return new Promise(function(o,n){a.loader&&a.loader.destroy();var d=a.loader=e.loader=g?new g(l):new h(l),u=p(e),m={timeout:l.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:l.fragLoadingMaxRetryTimeout,highWaterMark:y};e.stats=d.stats,d.load(u,m,{onSuccess:function(D,P,_,F){a.resetLoader(e,d),o({frag:e,part:null,payload:D.data,networkDetails:F})},onError:function(D,P,_){a.resetLoader(e,d),n(new v({type:O.ErrorTypes.NETWORK_ERROR,details:O.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:D,networkDetails:_}))},onAbort:function(D,P,_){a.resetLoader(e,d),n(new v({type:O.ErrorTypes.NETWORK_ERROR,details:O.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:e,networkDetails:_}))},onTimeout:function(D,P,_){a.resetLoader(e,d),n(new v({type:O.ErrorTypes.NETWORK_ERROR,details:O.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,networkDetails:_}))},onProgress:function(D,P,_,F){f&&f({frag:e,part:null,payload:_,networkDetails:F})}})})},t.loadPart=function(e,f,a){var i=this;this.abort();var l=this.config,g=l.fLoader,h=l.loader;return new Promise(function(o,n){i.loader&&i.loader.destroy();var d=i.loader=e.loader=g?new g(l):new h(l),u=p(e,f),m={timeout:l.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:l.fragLoadingMaxRetryTimeout,highWaterMark:y};f.stats=d.stats,d.load(u,m,{onSuccess:function(D,P,_,F){i.resetLoader(e,d),i.updateStatsFromPart(e,f);var U={frag:e,part:f,payload:D.data,networkDetails:F};a(U),o(U)},onError:function(D,P,_){i.resetLoader(e,d),n(new v({type:O.ErrorTypes.NETWORK_ERROR,details:O.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:f,response:D,networkDetails:_}))},onAbort:function(D,P,_){e.stats.aborted=f.stats.aborted,i.resetLoader(e,d),n(new v({type:O.ErrorTypes.NETWORK_ERROR,details:O.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:e,part:f,networkDetails:_}))},onTimeout:function(D,P,_){i.resetLoader(e,d),n(new v({type:O.ErrorTypes.NETWORK_ERROR,details:O.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:f,networkDetails:_}))}})})},t.updateStatsFromPart=function(e,f){var a=e.stats,i=f.stats,l=i.total;if(a.loaded+=i.loaded,l){var g=Math.round(e.duration/f.duration),h=Math.min(Math.round(a.loaded/l),g),o=g-h,n=o*Math.round(a.loaded/h);a.total=a.loaded+n}else a.total=Math.max(a.loaded,a.total);var d=a.loading,u=i.loading;d.start?d.first+=u.first-u.start:(d.start=u.start,d.first=u.first),d.end=u.end},t.resetLoader=function(e,f){e.loader=null,this.loader===f&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),f.destroy()},s}();function p(s,t){t===void 0&&(t=null);var r=t||s,e={frag:s,part:t,responseType:"arraybuffer",url:r.url,rangeStart:0,rangeEnd:0},f=r.byteRangeStartOffset,a=r.byteRangeEndOffset;return Object(M.isFiniteNumber)(f)&&Object(M.isFiniteNumber)(a)&&(e.rangeStart=f,e.rangeEnd=a),e}var v=function(s){L(t,s);function t(r){for(var e,f=arguments.length,a=new Array(f>1?f-1:0),i=1;i<f;i++)a[i-1]=arguments[i];return e=s.call.apply(s,[this].concat(a))||this,e.data=void 0,e.data=r,e}return t}(R(Error))},"./src/loader/fragment.ts":function(K,C,E){E.r(C),E.d(C,"ElementaryStreamTypes",function(){return y}),E.d(C,"BaseSegment",function(){return T}),E.d(C,"Fragment",function(){return p}),E.d(C,"Part",function(){return v});var M=E("./src/polyfills/number.ts"),O=E("./node_modules/url-toolkit/src/url-toolkit.js"),L=E("./src/utils/logger.ts"),R=E("./src/loader/level-key.ts"),I=E("./src/loader/load-stats.ts");function b(s,t){s.prototype=Object.create(t.prototype),s.prototype.constructor=s,A(s,t)}function A(s,t){return A=Object.setPrototypeOf||function(e,f){return e.__proto__=f,e},A(s,t)}function c(s,t){for(var r=0;r<t.length;r++){var e=t[r];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(s,e.key,e)}}function S(s,t,r){return t&&c(s.prototype,t),r&&c(s,r),s}var y;(function(s){s.AUDIO="audio",s.VIDEO="video",s.AUDIOVIDEO="audiovideo"})(y||(y={}));var T=function(){function s(r){var e;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=(e={},e[y.AUDIO]=null,e[y.VIDEO]=null,e[y.AUDIOVIDEO]=null,e),this.baseurl=r}var t=s.prototype;return t.setByteRange=function(e,f){var a=e.split("@",2),i=[];a.length===1?i[0]=f?f.byteRangeEndOffset:0:i[0]=parseInt(a[1]),i[1]=parseInt(a[0])+i[0],this._byteRange=i},S(s,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Object(O.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(e){this._url=e}}]),s}(),p=function(s){b(t,s);function t(e,f){var a;return a=s.call(this,f)||this,a._decryptdata=null,a.rawProgramDateTime=null,a.programDateTime=null,a.tagList=[],a.duration=0,a.sn=0,a.levelkey=void 0,a.type=void 0,a.loader=null,a.level=-1,a.cc=0,a.startPTS=void 0,a.endPTS=void 0,a.appendedPTS=void 0,a.startDTS=void 0,a.endDTS=void 0,a.start=0,a.deltaPTS=void 0,a.maxStartPTS=void 0,a.minEndPTS=void 0,a.stats=new I.LoadStats,a.urlId=0,a.data=void 0,a.bitrateTest=!1,a.title=null,a.initSegment=null,a.type=e,a}var r=t.prototype;return r.createInitializationVector=function(f){for(var a=new Uint8Array(16),i=12;i<16;i++)a[i]=f>>8*(15-i)&255;return a},r.setDecryptDataFromLevelKey=function(f,a){var i=f;return(f==null?void 0:f.method)==="AES-128"&&f.uri&&!f.iv&&(i=R.LevelKey.fromURI(f.uri),i.method=f.method,i.iv=this.createInitializationVector(a),i.keyFormat="identity"),i},r.setElementaryStreamInfo=function(f,a,i,l,g,h){h===void 0&&(h=!1);var o=this.elementaryStreams,n=o[f];if(!n){o[f]={startPTS:a,endPTS:i,startDTS:l,endDTS:g,partial:h};return}n.startPTS=Math.min(n.startPTS,a),n.endPTS=Math.max(n.endPTS,i),n.startDTS=Math.min(n.startDTS,l),n.endDTS=Math.max(n.endDTS,g)},r.clearElementaryStreamInfo=function(){var f=this.elementaryStreams;f[y.AUDIO]=null,f[y.VIDEO]=null,f[y.AUDIOVIDEO]=null},S(t,[{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var f=this.sn;typeof f!="number"&&(this.levelkey&&this.levelkey.method==="AES-128"&&!this.levelkey.iv&&L.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),f=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,f)}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(this.programDateTime===null||!Object(M.isFiniteNumber)(this.programDateTime))return null;var f=Object(M.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+f*1e3}},{key:"encrypted",get:function(){var f;return!!((f=this.decryptdata)!==null&&f!==void 0&&f.keyFormat&&this.decryptdata.uri)}}]),t}(T),v=function(s){b(t,s);function t(r,e,f,a,i){var l;l=s.call(this,f)||this,l.fragOffset=0,l.duration=0,l.gap=!1,l.independent=!1,l.relurl=void 0,l.fragment=void 0,l.index=void 0,l.stats=new I.LoadStats,l.duration=r.decimalFloatingPoint("DURATION"),l.gap=r.bool("GAP"),l.independent=r.bool("INDEPENDENT"),l.relurl=r.enumeratedString("URI"),l.fragment=e,l.index=a;var g=r.enumeratedString("BYTERANGE");return g&&l.setByteRange(g,i),i&&(l.fragOffset=i.fragOffset+i.duration),l}return S(t,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var e=this.elementaryStreams;return!!(e.audio||e.video||e.audiovideo)}}]),t}(T)},"./src/loader/key-loader.ts":function(K,C,E){E.r(C),E.d(C,"default",function(){return R});var M=E("./src/events.ts"),O=E("./src/errors.ts"),L=E("./src/utils/logger.ts"),R=function(){function I(A){this.hls=void 0,this.loaders={},this.decryptkey=null,this.decrypturl=null,this.hls=A,this._registerListeners()}var b=I.prototype;return b._registerListeners=function(){this.hls.on(M.Events.KEY_LOADING,this.onKeyLoading,this)},b._unregisterListeners=function(){this.hls.off(M.Events.KEY_LOADING,this.onKeyLoading)},b.destroy=function(){this._unregisterListeners();for(var c in this.loaders){var S=this.loaders[c];S&&S.destroy()}this.loaders={}},b.onKeyLoading=function(c,S){var y=S.frag,T=y.type,p=this.loaders[T];if(!y.decryptdata){L.logger.warn("Missing decryption data on fragment in onKeyLoading");return}var v=y.decryptdata.uri;if(v!==this.decrypturl||this.decryptkey===null){var s=this.hls.config;if(p&&(L.logger.warn("abort previous key loader for type:"+T),p.abort()),!v){L.logger.warn("key uri is falsy");return}var t=s.loader,r=y.loader=this.loaders[T]=new t(s);this.decrypturl=v,this.decryptkey=null;var e={url:v,frag:y,responseType:"arraybuffer"},f={timeout:s.fragLoadingTimeOut,maxRetry:0,retryDelay:s.fragLoadingRetryDelay,maxRetryDelay:s.fragLoadingMaxRetryTimeout,highWaterMark:0},a={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};r.load(e,f,a)}else this.decryptkey&&(y.decryptdata.key=this.decryptkey,this.hls.trigger(M.Events.KEY_LOADED,{frag:y}))},b.loadsuccess=function(c,S,y){var T=y.frag;if(!T.decryptdata){L.logger.error("after key load, decryptdata unset");return}this.decryptkey=T.decryptdata.key=new Uint8Array(c.data),T.loader=null,delete this.loaders[T.type],this.hls.trigger(M.Events.KEY_LOADED,{frag:T})},b.loaderror=function(c,S){var y=S.frag,T=y.loader;T&&T.abort(),delete this.loaders[y.type],this.hls.trigger(M.Events.ERROR,{type:O.ErrorTypes.NETWORK_ERROR,details:O.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:y,response:c})},b.loadtimeout=function(c,S){var y=S.frag,T=y.loader;T&&T.abort(),delete this.loaders[y.type],this.hls.trigger(M.Events.ERROR,{type:O.ErrorTypes.NETWORK_ERROR,details:O.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:y})},I}()},"./src/loader/level-details.ts":function(K,C,E){E.r(C),E.d(C,"LevelDetails",function(){return I});var M=E("./src/polyfills/number.ts");function O(b,A){for(var c=0;c<A.length;c++){var S=A[c];S.enumerable=S.enumerable||!1,S.configurable=!0,"value"in S&&(S.writable=!0),Object.defineProperty(b,S.key,S)}}function L(b,A,c){return A&&O(b.prototype,A),c&&O(b,c),b}var R=10,I=function(){function b(c){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.fragments=[],this.url=c}var A=b.prototype;return A.reloaded=function(S){if(!S){this.advanced=!0,this.updated=!0;return}var y=this.lastPartSn-S.lastPartSn,T=this.lastPartIndex-S.lastPartIndex;this.updated=this.endSN!==S.endSN||!!T||!!y,this.advanced=this.endSN>S.endSN||y>0||y===0&&T>0,this.updated||this.advanced?this.misses=Math.floor(S.misses*.6):this.misses=S.misses+1,this.availabilityDelay=S.availabilityDelay},L(b,[{key:"hasProgramDateTime",get:function(){return this.fragments.length?Object(M.isFiniteNumber)(this.fragments[this.fragments.length-1].programDateTime):!1}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||R}},{key:"drift",get:function(){var S=this.driftEndTime-this.driftStartTime;if(S>0){var y=this.driftEnd-this.driftStart;return y*1e3/S}return 1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var S;return(S=this.partList)!==null&&S!==void 0&&S.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var S;return(S=this.fragments)!==null&&S!==void 0&&S.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var S;return(S=this.partList)!==null&&S!==void 0&&S.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var S;return(S=this.partList)!==null&&S!==void 0&&S.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}]),b}()},"./src/loader/level-key.ts":function(K,C,E){E.r(C),E.d(C,"LevelKey",function(){return R});var M=E("./node_modules/url-toolkit/src/url-toolkit.js");function O(I,b){for(var A=0;A<b.length;A++){var c=b[A];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(I,c.key,c)}}function L(I,b,A){return b&&O(I.prototype,b),A&&O(I,A),I}var R=function(){I.fromURL=function(A,c){return new I(A,c)},I.fromURI=function(A){return new I(A)};function I(b,A){this._uri=null,this.method=null,this.keyFormat=null,this.keyFormatVersions=null,this.keyID=null,this.key=null,this.iv=null,A?this._uri=Object(M.buildAbsoluteURL)(b,A,{alwaysNormalize:!0}):this._uri=b}return L(I,[{key:"uri",get:function(){return this._uri}}]),I}()},"./src/loader/load-stats.ts":function(K,C,E){E.r(C),E.d(C,"LoadStats",function(){return M});var M=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},"./src/loader/m3u8-parser.ts":function(K,C,E){E.r(C),E.d(C,"default",function(){return t});var M=E("./src/polyfills/number.ts"),O=E("./node_modules/url-toolkit/src/url-toolkit.js"),L=E("./src/loader/fragment.ts"),R=E("./src/loader/level-details.ts"),I=E("./src/loader/level-key.ts"),b=E("./src/utils/attr-list.ts"),A=E("./src/utils/logger.ts"),c=E("./src/utils/codecs.ts"),S=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+/g,y=/#EXT-X-MEDIA:(.*)/g,T=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),p=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(PLAYLIST-TYPE):(.+)/.source,/#EXT-X-(MEDIA-SEQUENCE): *(\d+)/.source,/#EXT-X-(SKIP):(.+)/.source,/#EXT-X-(TARGETDURATION): *(\d+)/.source,/#EXT-X-(KEY):(.+)/.source,/#EXT-X-(START):(.+)/.source,/#EXT-X-(ENDLIST)/.source,/#EXT-X-(DISCONTINUITY-SEQ)UENCE: *(\d+)/.source,/#EXT-X-(DIS)CONTINUITY/.source,/#EXT-X-(VERSION):(\d+)/.source,/#EXT-X-(MAP):(.+)/.source,/#EXT-X-(SERVER-CONTROL):(.+)/.source,/#EXT-X-(PART-INF):(.+)/.source,/#EXT-X-(GAP)/.source,/#EXT-X-(BITRATE):\s*(\d+)/.source,/#EXT-X-(PART):(.+)/.source,/#EXT-X-(PRELOAD-HINT):(.+)/.source,/#EXT-X-(RENDITION-REPORT):(.+)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),v=/\.(mp4|m4s|m4v|m4a)$/i;function s(i){var l,g;return v.test((l=(g=O.parseURL(i))===null||g===void 0?void 0:g.path)!=null?l:"")}var t=function(){function i(){}return i.findGroup=function(g,h){for(var o=0;o<g.length;o++){var n=g[o];if(n.id===h)return n}},i.convertAVC1ToAVCOTI=function(g){var h=g.split(".");if(h.length>2){var o=h.shift()+".";return o+=parseInt(h.shift()).toString(16),o+=("000"+parseInt(h.shift()).toString(16)).substr(-4),o}return g},i.resolve=function(g,h){return O.buildAbsoluteURL(h,g,{alwaysNormalize:!0})},i.parseMasterPlaylist=function(g,h){var o=[],n={},d=!1;S.lastIndex=0;for(var u;(u=S.exec(g))!=null;)if(u[1]){var m=new b.AttrList(u[1]),x={attrs:m,bitrate:m.decimalInteger("AVERAGE-BANDWIDTH")||m.decimalInteger("BANDWIDTH"),name:m.NAME,url:i.resolve(u[2],h)},D=m.decimalResolution("RESOLUTION");D&&(x.width=D.width,x.height=D.height),r((m.CODECS||"").split(/[ ,]+/).filter(function(_){return _}),x),x.videoCodec&&x.videoCodec.indexOf("avc1")!==-1&&(x.videoCodec=i.convertAVC1ToAVCOTI(x.videoCodec)),o.push(x)}else if(u[3]){var P=new b.AttrList(u[3]);P["DATA-ID"]&&(d=!0,n[P["DATA-ID"]]=P)}return{levels:o,sessionData:d?n:null}},i.parseMasterPlaylistMedia=function(g,h,o,n){n===void 0&&(n=[]);var d,u=[],m=0;for(y.lastIndex=0;(d=y.exec(g))!==null;){var x=new b.AttrList(d[1]);if(x.TYPE===o){var D={attrs:x,bitrate:0,id:m++,groupId:x["GROUP-ID"],instreamId:x["INSTREAM-ID"],name:x.NAME||x.LANGUAGE||"",type:o,default:x.bool("DEFAULT"),autoselect:x.bool("AUTOSELECT"),forced:x.bool("FORCED"),lang:x.LANGUAGE,url:x.URI?i.resolve(x.URI,h):""};if(n.length){var P=i.findGroup(n,D.groupId)||n[0];e(D,P,"audioCodec"),e(D,P,"textCodec")}u.push(D)}}return u},i.parseLevelPlaylist=function(g,h,o,n,d){var u=new R.LevelDetails(h),m=u.fragments,x=null,D=0,P=0,_=0,F=0,U=null,k=new L.Fragment(n,h),N,w,V,W=-1,Y=!1;for(T.lastIndex=0,u.m3u8=g;(N=T.exec(g))!==null;){Y&&(Y=!1,k=new L.Fragment(n,h),k.start=_,k.sn=D,k.cc=F,k.level=o,x&&(k.initSegment=x,k.rawProgramDateTime=x.rawProgramDateTime));var j=N[1];if(j){k.duration=parseFloat(j);var X=(" "+N[2]).slice(1);k.title=X||null,k.tagList.push(X?["INF",j,X]:["INF",j])}else if(N[3])Object(M.isFiniteNumber)(k.duration)&&(k.start=_,V&&(k.levelkey=V),k.sn=D,k.level=o,k.cc=F,k.urlId=d,m.push(k),k.relurl=(" "+N[3]).slice(1),a(k,U),U=k,_+=k.duration,D++,P=0,Y=!0);else if(N[4]){var $=(" "+N[4]).slice(1);U?k.setByteRange($,U):k.setByteRange($)}else if(N[5])k.rawProgramDateTime=(" "+N[5]).slice(1),k.tagList.push(["PROGRAM-DATE-TIME",k.rawProgramDateTime]),W===-1&&(W=m.length);else{if(N=N[0].match(p),!N){A.logger.warn("No matches on slow regex match for level playlist!");continue}for(w=1;w<N.length&&typeof N[w]=="undefined";w++);var Q=(" "+N[w]).slice(1),z=(" "+N[w+1]).slice(1),J=N[w+2]?(" "+N[w+2]).slice(1):"";switch(Q){case"PLAYLIST-TYPE":u.type=z.toUpperCase();break;case"MEDIA-SEQUENCE":D=u.startSN=parseInt(z);break;case"SKIP":{var Z=new b.AttrList(z),q=Z.decimalInteger("SKIPPED-SEGMENTS");if(Object(M.isFiniteNumber)(q)){u.skippedSegments=q;for(var ee=q;ee--;)m.unshift(null);D+=q}var ne=Z.enumeratedString("RECENTLY-REMOVED-DATERANGES");ne&&(u.recentlyRemovedDateranges=ne.split("	"));break}case"TARGETDURATION":u.targetduration=parseFloat(z);break;case"VERSION":u.version=parseInt(z);break;case"EXTM3U":break;case"ENDLIST":u.live=!1;break;case"#":(z||J)&&k.tagList.push(J?[z,J]:[z]);break;case"DIS":F++;case"GAP":k.tagList.push([Q]);break;case"BITRATE":k.tagList.push([Q,z]);break;case"DISCONTINUITY-SEQ":F=parseInt(z);break;case"KEY":{var te,ie=new b.AttrList(z),ue=ie.enumeratedString("METHOD"),se=ie.URI,fe=ie.hexadecimalInteger("IV"),oe=ie.enumeratedString("KEYFORMATVERSIONS"),ce=ie.enumeratedString("KEYID"),re=(te=ie.enumeratedString("KEYFORMAT"))!=null?te:"identity",Le=["com.apple.streamingkeydelivery","com.microsoft.playready","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine"];if(Le.indexOf(re)>-1){A.logger.warn("Keyformat "+re+" is not supported from the manifest");continue}else if(re!=="identity")continue;ue&&(V=I.LevelKey.fromURL(h,se),se&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(ue)>=0&&(V.method=ue,V.keyFormat=re,ce&&(V.keyID=ce),oe&&(V.keyFormatVersions=oe),V.iv=fe));break}case"START":{var Oe=new b.AttrList(z),xe=Oe.decimalFloatingPoint("TIME-OFFSET");Object(M.isFiniteNumber)(xe)&&(u.startTimeOffset=xe);break}case"MAP":{var ve=new b.AttrList(z);k.relurl=ve.URI,ve.BYTERANGE&&k.setByteRange(ve.BYTERANGE),k.level=o,k.sn="initSegment",V&&(k.levelkey=V),k.initSegment=null,x=k,Y=!0;break}case"SERVER-CONTROL":{var ge=new b.AttrList(z);u.canBlockReload=ge.bool("CAN-BLOCK-RELOAD"),u.canSkipUntil=ge.optionalFloat("CAN-SKIP-UNTIL",0),u.canSkipDateRanges=u.canSkipUntil>0&&ge.bool("CAN-SKIP-DATERANGES"),u.partHoldBack=ge.optionalFloat("PART-HOLD-BACK",0),u.holdBack=ge.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{var Te=new b.AttrList(z);u.partTarget=Te.decimalFloatingPoint("PART-TARGET");break}case"PART":{var me=u.partList;me||(me=u.partList=[]);var he=P>0?me[me.length-1]:void 0,pe=P++,Re=new L.Part(new b.AttrList(z),k,h,pe,he);me.push(Re),k.duration+=Re.duration;break}case"PRELOAD-HINT":{var Ie=new b.AttrList(z);u.preloadHint=Ie;break}case"RENDITION-REPORT":{var be=new b.AttrList(z);u.renditionReports=u.renditionReports||[],u.renditionReports.push(be);break}default:A.logger.warn("line parsed but not handled: "+N);break}}}U&&!U.relurl?(m.pop(),_-=U.duration,u.partList&&(u.fragmentHint=U)):u.partList&&(a(k,U),k.cc=F,u.fragmentHint=k);var Pe=m.length,Se=m[0],Ee=m[Pe-1];if(_+=u.skippedSegments*u.targetduration,_>0&&Pe&&Ee){u.averagetargetduration=_/Pe;var Ce=Ee.sn;u.endSN=Ce!=="initSegment"?Ce:0,Se&&(u.startCC=Se.cc,Se.initSegment||u.fragments.every(function(Ue){return Ue.relurl&&s(Ue.relurl)})&&(A.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),k=new L.Fragment(n,h),k.relurl=Ee.relurl,k.level=o,k.sn="initSegment",Se.initSegment=k,u.needSidxRanges=!0))}else u.endSN=0,u.startCC=0;return u.fragmentHint&&(_+=u.fragmentHint.duration),u.totalduration=_,u.endCC=F,W>0&&f(m,W),u},i}();function r(i,l){["video","audio","text"].forEach(function(g){var h=i.filter(function(n){return Object(c.isCodecType)(n,g)});if(h.length){var o=h.filter(function(n){return n.lastIndexOf("avc1",0)===0||n.lastIndexOf("mp4a",0)===0});l[g+"Codec"]=o.length>0?o[0]:h[0],i=i.filter(function(n){return h.indexOf(n)===-1})}}),l.unknownCodecs=i}function e(i,l,g){var h=l[g];h&&(i[g]=h)}function f(i,l){for(var g=i[l],h=l;h--;){var o=i[h];if(!o)return;o.programDateTime=g.programDateTime-o.duration*1e3,g=o}}function a(i,l){i.rawProgramDateTime?i.programDateTime=Date.parse(i.rawProgramDateTime):l!=null&&l.programDateTime&&(i.programDateTime=l.endProgramDateTime),Object(M.isFiniteNumber)(i.programDateTime)||(i.programDateTime=null,i.rawProgramDateTime=null)}},"./src/loader/playlist-loader.ts":function(K,C,E){E.r(C);var M=E("./src/polyfills/number.ts"),O=E("./src/events.ts"),L=E("./src/errors.ts"),R=E("./src/utils/logger.ts"),I=E("./src/utils/mp4-tools.ts"),b=E("./src/loader/m3u8-parser.ts"),A=E("./src/types/loader.ts"),c=E("./src/utils/attr-list.ts");function S(p){var v=p.type;switch(v){case A.PlaylistContextType.AUDIO_TRACK:return A.PlaylistLevelType.AUDIO;case A.PlaylistContextType.SUBTITLE_TRACK:return A.PlaylistLevelType.SUBTITLE;default:return A.PlaylistLevelType.MAIN}}function y(p,v){var s=p.url;return(s===void 0||s.indexOf("data:")===0)&&(s=v.url),s}var T=function(){function p(s){this.hls=void 0,this.loaders=Object.create(null),this.hls=s,this.registerListeners()}var v=p.prototype;return v.registerListeners=function(){var t=this.hls;t.on(O.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(O.Events.LEVEL_LOADING,this.onLevelLoading,this),t.on(O.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),t.on(O.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},v.unregisterListeners=function(){var t=this.hls;t.off(O.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(O.Events.LEVEL_LOADING,this.onLevelLoading,this),t.off(O.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),t.off(O.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},v.createInternalLoader=function(t){var r=this.hls.config,e=r.pLoader,f=r.loader,a=e||f,i=new a(r);return t.loader=i,this.loaders[t.type]=i,i},v.getInternalLoader=function(t){return this.loaders[t.type]},v.resetInternalLoader=function(t){this.loaders[t]&&delete this.loaders[t]},v.destroyInternalLoaders=function(){for(var t in this.loaders){var r=this.loaders[t];r&&r.destroy(),this.resetInternalLoader(t)}},v.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},v.onManifestLoading=function(t,r){var e=r.url;this.load({id:null,groupId:null,level:0,responseType:"text",type:A.PlaylistContextType.MANIFEST,url:e,deliveryDirectives:null})},v.onLevelLoading=function(t,r){var e=r.id,f=r.level,a=r.url,i=r.deliveryDirectives;this.load({id:e,groupId:null,level:f,responseType:"text",type:A.PlaylistContextType.LEVEL,url:a,deliveryDirectives:i})},v.onAudioTrackLoading=function(t,r){var e=r.id,f=r.groupId,a=r.url,i=r.deliveryDirectives;this.load({id:e,groupId:f,level:null,responseType:"text",type:A.PlaylistContextType.AUDIO_TRACK,url:a,deliveryDirectives:i})},v.onSubtitleTrackLoading=function(t,r){var e=r.id,f=r.groupId,a=r.url,i=r.deliveryDirectives;this.load({id:e,groupId:f,level:null,responseType:"text",type:A.PlaylistContextType.SUBTITLE_TRACK,url:a,deliveryDirectives:i})},v.load=function(t){var r,e=this.hls.config,f=this.getInternalLoader(t);if(f){var a=f.context;if(a&&a.url===t.url){R.logger.trace("[playlist-loader]: playlist request ongoing");return}R.logger.log("[playlist-loader]: aborting previous loader for type: "+t.type),f.abort()}var i,l,g,h;switch(t.type){case A.PlaylistContextType.MANIFEST:i=e.manifestLoadingMaxRetry,l=e.manifestLoadingTimeOut,g=e.manifestLoadingRetryDelay,h=e.manifestLoadingMaxRetryTimeout;break;case A.PlaylistContextType.LEVEL:case A.PlaylistContextType.AUDIO_TRACK:case A.PlaylistContextType.SUBTITLE_TRACK:i=0,l=e.levelLoadingTimeOut;break;default:i=e.levelLoadingMaxRetry,l=e.levelLoadingTimeOut,g=e.levelLoadingRetryDelay,h=e.levelLoadingMaxRetryTimeout;break}if(f=this.createInternalLoader(t),(r=t.deliveryDirectives)!==null&&r!==void 0&&r.part){var o;if(t.type===A.PlaylistContextType.LEVEL&&t.level!==null?o=this.hls.levels[t.level].details:t.type===A.PlaylistContextType.AUDIO_TRACK&&t.id!==null?o=this.hls.audioTracks[t.id].details:t.type===A.PlaylistContextType.SUBTITLE_TRACK&&t.id!==null&&(o=this.hls.subtitleTracks[t.id].details),o){var n=o.partTarget,d=o.targetduration;n&&d&&(l=Math.min(Math.max(n*3,d*.8)*1e3,l))}}var u={timeout:l,maxRetry:i,retryDelay:g,maxRetryDelay:h,highWaterMark:0},m={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};f.load(t,u,m)},v.loadsuccess=function(t,r,e,f){if(f===void 0&&(f=null),e.isSidxRequest){this.handleSidxRequest(t,e),this.handlePlaylistLoaded(t,r,e,f);return}this.resetInternalLoader(e.type);var a=t.data;if(a.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(t,e,"no EXTM3U delimiter",f);return}r.parsing.start=performance.now(),a.indexOf("#EXTINF:")>0||a.indexOf("#EXT-X-TARGETDURATION:")>0?this.handleTrackOrLevelPlaylist(t,r,e,f):this.handleMasterPlaylist(t,r,e,f)},v.loaderror=function(t,r,e){e===void 0&&(e=null),this.handleNetworkError(r,e,!1,t)},v.loadtimeout=function(t,r,e){e===void 0&&(e=null),this.handleNetworkError(r,e,!0)},v.handleMasterPlaylist=function(t,r,e,f){var a=this.hls,i=t.data,l=y(t,e),g=b.default.parseMasterPlaylist(i,l),h=g.levels,o=g.sessionData;if(!h.length){this.handleManifestParsingError(t,e,"no level found in manifest",f);return}var n=h.map(function(P){return{id:P.attrs.AUDIO,audioCodec:P.audioCodec}}),d=h.map(function(P){return{id:P.attrs.SUBTITLES,textCodec:P.textCodec}}),u=b.default.parseMasterPlaylistMedia(i,l,"AUDIO",n),m=b.default.parseMasterPlaylistMedia(i,l,"SUBTITLES",d),x=b.default.parseMasterPlaylistMedia(i,l,"CLOSED-CAPTIONS");if(u.length){var D=u.some(function(P){return!P.url});!D&&h[0].audioCodec&&!h[0].attrs.AUDIO&&(R.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),u.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new c.AttrList({}),bitrate:0,url:""}))}a.trigger(O.Events.MANIFEST_LOADED,{levels:h,audioTracks:u,subtitles:m,captions:x,url:l,stats:r,networkDetails:f,sessionData:o})},v.handleTrackOrLevelPlaylist=function(t,r,e,f){var a=this.hls,i=e.id,l=e.level,g=e.type,h=y(t,e),o=Object(M.isFiniteNumber)(i)?i:0,n=Object(M.isFiniteNumber)(l)?l:o,d=S(e),u=b.default.parseLevelPlaylist(t.data,h,n,d,o);if(!u.fragments.length){a.trigger(O.Events.ERROR,{type:L.ErrorTypes.NETWORK_ERROR,details:L.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:h,reason:"no fragments found in level",level:typeof e.level=="number"?e.level:void 0});return}if(g===A.PlaylistContextType.MANIFEST){var m={attrs:new c.AttrList({}),bitrate:0,details:u,name:"",url:h};a.trigger(O.Events.MANIFEST_LOADED,{levels:[m],audioTracks:[],url:h,stats:r,networkDetails:f,sessionData:null})}if(r.parsing.end=performance.now(),u.needSidxRanges){var x,D=(x=u.fragments[0].initSegment)===null||x===void 0?void 0:x.url;this.load({url:D,isSidxRequest:!0,type:g,level:l,levelDetails:u,id:i,groupId:null,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer",deliveryDirectives:null});return}e.levelDetails=u,this.handlePlaylistLoaded(t,r,e,f)},v.handleSidxRequest=function(t,r){var e=Object(I.parseSegmentIndex)(new Uint8Array(t.data));if(!!e){var f=e.references,a=r.levelDetails;f.forEach(function(i,l){var g=i.info,h=a.fragments[l];h.byteRange.length===0&&h.setByteRange(String(1+g.end-g.start)+"@"+String(g.start)),h.initSegment&&h.initSegment.setByteRange(String(e.moovEndOffset)+"@0")})}},v.handleManifestParsingError=function(t,r,e,f){this.hls.trigger(O.Events.ERROR,{type:L.ErrorTypes.NETWORK_ERROR,details:L.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:r.type===A.PlaylistContextType.MANIFEST,url:t.url,reason:e,response:t,context:r,networkDetails:f})},v.handleNetworkError=function(t,r,e,f){e===void 0&&(e=!1),R.logger.warn("[playlist-loader]: A network "+(e?"timeout":"error")+" occurred while loading "+t.type+" level: "+t.level+" id: "+t.id+' group-id: "'+t.groupId+'"');var a=L.ErrorDetails.UNKNOWN,i=!1,l=this.getInternalLoader(t);switch(t.type){case A.PlaylistContextType.MANIFEST:a=e?L.ErrorDetails.MANIFEST_LOAD_TIMEOUT:L.ErrorDetails.MANIFEST_LOAD_ERROR,i=!0;break;case A.PlaylistContextType.LEVEL:a=e?L.ErrorDetails.LEVEL_LOAD_TIMEOUT:L.ErrorDetails.LEVEL_LOAD_ERROR,i=!1;break;case A.PlaylistContextType.AUDIO_TRACK:a=e?L.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:L.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,i=!1;break;case A.PlaylistContextType.SUBTITLE_TRACK:a=e?L.ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:L.ErrorDetails.SUBTITLE_LOAD_ERROR,i=!1;break}l&&this.resetInternalLoader(t.type);var g={type:L.ErrorTypes.NETWORK_ERROR,details:a,fatal:i,url:t.url,loader:l,context:t,networkDetails:r};f&&(g.response=f),this.hls.trigger(O.Events.ERROR,g)},v.handlePlaylistLoaded=function(t,r,e,f){var a=e.type,i=e.level,l=e.id,g=e.groupId,h=e.loader,o=e.levelDetails,n=e.deliveryDirectives;if(!(o!=null&&o.targetduration)){this.handleManifestParsingError(t,e,"invalid target duration",f);return}if(!!h)switch(o.live&&(h.getCacheAge&&(o.ageHeader=h.getCacheAge()||0),(!h.getCacheAge||isNaN(o.ageHeader))&&(o.ageHeader=0)),a){case A.PlaylistContextType.MANIFEST:case A.PlaylistContextType.LEVEL:this.hls.trigger(O.Events.LEVEL_LOADED,{details:o,level:i||0,id:l||0,stats:r,networkDetails:f,deliveryDirectives:n});break;case A.PlaylistContextType.AUDIO_TRACK:this.hls.trigger(O.Events.AUDIO_TRACK_LOADED,{details:o,id:l||0,groupId:g||"",stats:r,networkDetails:f,deliveryDirectives:n});break;case A.PlaylistContextType.SUBTITLE_TRACK:this.hls.trigger(O.Events.SUBTITLE_TRACK_LOADED,{details:o,id:l||0,groupId:g||"",stats:r,networkDetails:f,deliveryDirectives:n});break}},p}();C.default=T},"./src/polyfills/number.ts":function(K,C,E){E.r(C),E.d(C,"isFiniteNumber",function(){return M}),E.d(C,"MAX_SAFE_INTEGER",function(){return O});var M=Number.isFinite||function(L){return typeof L=="number"&&isFinite(L)},O=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/remux/aac-helper.ts":function(K,C,E){E.r(C);var M=function(){function O(){}return O.getSilentFrame=function(R,I){switch(R){case"mp4a.40.2":if(I===1)return new Uint8Array([0,200,0,128,35,128]);if(I===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(I===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(I===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(I===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(I===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(I===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(I===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(I===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}},O}();C.default=M},"./src/remux/mp4-generator.ts":function(K,C,E){E.r(C);var M=Math.pow(2,32)-1,O=function(){function L(){}return L.init=function(){L.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var I;for(I in L.types)L.types.hasOwnProperty(I)&&(L.types[I]=[I.charCodeAt(0),I.charCodeAt(1),I.charCodeAt(2),I.charCodeAt(3)]);var b=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),A=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);L.HDLR_TYPES={video:b,audio:A};var c=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),S=new Uint8Array([0,0,0,0,0,0,0,0]);L.STTS=L.STSC=L.STCO=S,L.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),L.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),L.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),L.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var y=new Uint8Array([105,115,111,109]),T=new Uint8Array([97,118,99,49]),p=new Uint8Array([0,0,0,1]);L.FTYP=L.box(L.types.ftyp,y,p,y,T),L.DINF=L.box(L.types.dinf,L.box(L.types.dref,c))},L.box=function(I){for(var b=8,A=arguments.length,c=new Array(A>1?A-1:0),S=1;S<A;S++)c[S-1]=arguments[S];for(var y=c.length,T=y;y--;)b+=c[y].byteLength;var p=new Uint8Array(b);for(p[0]=b>>24&255,p[1]=b>>16&255,p[2]=b>>8&255,p[3]=b&255,p.set(I,4),y=0,b=8;y<T;y++)p.set(c[y],b),b+=c[y].byteLength;return p},L.hdlr=function(I){return L.box(L.types.hdlr,L.HDLR_TYPES[I])},L.mdat=function(I){return L.box(L.types.mdat,I)},L.mdhd=function(I,b){b*=I;var A=Math.floor(b/(M+1)),c=Math.floor(b%(M+1));return L.box(L.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,I>>24&255,I>>16&255,I>>8&255,I&255,A>>24,A>>16&255,A>>8&255,A&255,c>>24,c>>16&255,c>>8&255,c&255,85,196,0,0]))},L.mdia=function(I){return L.box(L.types.mdia,L.mdhd(I.timescale,I.duration),L.hdlr(I.type),L.minf(I))},L.mfhd=function(I){return L.box(L.types.mfhd,new Uint8Array([0,0,0,0,I>>24,I>>16&255,I>>8&255,I&255]))},L.minf=function(I){return I.type==="audio"?L.box(L.types.minf,L.box(L.types.smhd,L.SMHD),L.DINF,L.stbl(I)):L.box(L.types.minf,L.box(L.types.vmhd,L.VMHD),L.DINF,L.stbl(I))},L.moof=function(I,b,A){return L.box(L.types.moof,L.mfhd(I),L.traf(A,b))},L.moov=function(I){for(var b=I.length,A=[];b--;)A[b]=L.trak(I[b]);return L.box.apply(null,[L.types.moov,L.mvhd(I[0].timescale,I[0].duration)].concat(A).concat(L.mvex(I)))},L.mvex=function(I){for(var b=I.length,A=[];b--;)A[b]=L.trex(I[b]);return L.box.apply(null,[L.types.mvex].concat(A))},L.mvhd=function(I,b){b*=I;var A=Math.floor(b/(M+1)),c=Math.floor(b%(M+1)),S=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,I>>24&255,I>>16&255,I>>8&255,I&255,A>>24,A>>16&255,A>>8&255,A&255,c>>24,c>>16&255,c>>8&255,c&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return L.box(L.types.mvhd,S)},L.sdtp=function(I){var b=I.samples||[],A=new Uint8Array(4+b.length),c,S;for(c=0;c<b.length;c++)S=b[c].flags,A[c+4]=S.dependsOn<<4|S.isDependedOn<<2|S.hasRedundancy;return L.box(L.types.sdtp,A)},L.stbl=function(I){return L.box(L.types.stbl,L.stsd(I),L.box(L.types.stts,L.STTS),L.box(L.types.stsc,L.STSC),L.box(L.types.stsz,L.STSZ),L.box(L.types.stco,L.STCO))},L.avc1=function(I){var b=[],A=[],c,S,y;for(c=0;c<I.sps.length;c++)S=I.sps[c],y=S.byteLength,b.push(y>>>8&255),b.push(y&255),b=b.concat(Array.prototype.slice.call(S));for(c=0;c<I.pps.length;c++)S=I.pps[c],y=S.byteLength,A.push(y>>>8&255),A.push(y&255),A=A.concat(Array.prototype.slice.call(S));var T=L.box(L.types.avcC,new Uint8Array([1,b[3],b[4],b[5],255,224|I.sps.length].concat(b).concat([I.pps.length]).concat(A))),p=I.width,v=I.height,s=I.pixelRatio[0],t=I.pixelRatio[1];return L.box(L.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,p>>8&255,p&255,v>>8&255,v&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),T,L.box(L.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),L.box(L.types.pasp,new Uint8Array([s>>24,s>>16&255,s>>8&255,s&255,t>>24,t>>16&255,t>>8&255,t&255])))},L.esds=function(I){var b=I.config.length;return new Uint8Array([0,0,0,0,3,23+b,0,1,0,4,15+b,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([b]).concat(I.config).concat([6,1,2]))},L.mp4a=function(I){var b=I.samplerate;return L.box(L.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,I.channelCount,0,16,0,0,0,0,b>>8&255,b&255,0,0]),L.box(L.types.esds,L.esds(I)))},L.mp3=function(I){var b=I.samplerate;return L.box(L.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,I.channelCount,0,16,0,0,0,0,b>>8&255,b&255,0,0]))},L.stsd=function(I){return I.type==="audio"?!I.isAAC&&I.codec==="mp3"?L.box(L.types.stsd,L.STSD,L.mp3(I)):L.box(L.types.stsd,L.STSD,L.mp4a(I)):L.box(L.types.stsd,L.STSD,L.avc1(I))},L.tkhd=function(I){var b=I.id,A=I.duration*I.timescale,c=I.width,S=I.height,y=Math.floor(A/(M+1)),T=Math.floor(A%(M+1));return L.box(L.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,b>>24&255,b>>16&255,b>>8&255,b&255,0,0,0,0,y>>24,y>>16&255,y>>8&255,y&255,T>>24,T>>16&255,T>>8&255,T&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,c>>8&255,c&255,0,0,S>>8&255,S&255,0,0]))},L.traf=function(I,b){var A=L.sdtp(I),c=I.id,S=Math.floor(b/(M+1)),y=Math.floor(b%(M+1));return L.box(L.types.traf,L.box(L.types.tfhd,new Uint8Array([0,0,0,0,c>>24,c>>16&255,c>>8&255,c&255])),L.box(L.types.tfdt,new Uint8Array([1,0,0,0,S>>24,S>>16&255,S>>8&255,S&255,y>>24,y>>16&255,y>>8&255,y&255])),L.trun(I,A.length+16+20+8+16+8+8),A)},L.trak=function(I){return I.duration=I.duration||4294967295,L.box(L.types.trak,L.tkhd(I),L.mdia(I))},L.trex=function(I){var b=I.id;return L.box(L.types.trex,new Uint8Array([0,0,0,0,b>>24,b>>16&255,b>>8&255,b&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},L.trun=function(I,b){var A=I.samples||[],c=A.length,S=12+16*c,y=new Uint8Array(S),T,p,v,s,t,r;for(b+=8+S,y.set([0,0,15,1,c>>>24&255,c>>>16&255,c>>>8&255,c&255,b>>>24&255,b>>>16&255,b>>>8&255,b&255],0),T=0;T<c;T++)p=A[T],v=p.duration,s=p.size,t=p.flags,r=p.cts,y.set([v>>>24&255,v>>>16&255,v>>>8&255,v&255,s>>>24&255,s>>>16&255,s>>>8&255,s&255,t.isLeading<<2|t.dependsOn,t.isDependedOn<<6|t.hasRedundancy<<4|t.paddingValue<<1|t.isNonSync,t.degradPrio&240<<8,t.degradPrio&15,r>>>24&255,r>>>16&255,r>>>8&255,r&255],12+16*T);return L.box(L.types.trun,y)},L.initSegment=function(I){L.types||L.init();var b=L.moov(I),A=new Uint8Array(L.FTYP.byteLength+b.byteLength);return A.set(L.FTYP),A.set(b,L.FTYP.byteLength),A},L}();O.types=void 0,O.HDLR_TYPES=void 0,O.STTS=void 0,O.STSC=void 0,O.STCO=void 0,O.STSZ=void 0,O.VMHD=void 0,O.SMHD=void 0,O.STSD=void 0,O.FTYP=void 0,O.DINF=void 0,C.default=O},"./src/remux/mp4-remuxer.ts":function(K,C,E){E.r(C),E.d(C,"default",function(){return r}),E.d(C,"normalizePts",function(){return e});var M=E("./src/polyfills/number.ts"),O=E("./src/remux/aac-helper.ts"),L=E("./src/remux/mp4-generator.ts"),R=E("./src/events.ts"),I=E("./src/errors.ts"),b=E("./src/utils/logger.ts"),A=E("./src/types/loader.ts"),c=E("./src/utils/timescale-conversion.ts");function S(){return S=Object.assign||function(l){for(var g=1;g<arguments.length;g++){var h=arguments[g];for(var o in h)Object.prototype.hasOwnProperty.call(h,o)&&(l[o]=h[o])}return l},S.apply(this,arguments)}var y=10*1e3,T=1024,p=1152,v=null,s=null,t=!1,r=function(){function l(h,o,n,d){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=h,this.config=o,this.typeSupported=n,this.ISGenerated=!1,v===null){var u=navigator.userAgent||"",m=u.match(/Chrome\/(\d+)/i);v=m?parseInt(m[1]):0}if(s===null){var x=navigator.userAgent.match(/Safari\/(\d+)/i);s=x?parseInt(x[1]):0}t=!!v&&v<75||!!s&&s<600}var g=l.prototype;return g.destroy=function(){},g.resetTimeStamp=function(o){b.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=o},g.resetNextTimestamp=function(){b.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},g.resetInitSegment=function(){b.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},g.getVideoStartPts=function(o){var n=!1,d=o.reduce(function(u,m){var x=m.pts-u;return x<-4294967296?(n=!0,e(u,m.pts)):x>0?u:m.pts},o[0].pts);return n&&b.logger.debug("PTS rollover detected"),d},g.remux=function(o,n,d,u,m,x,D,P){var _,F,U,k,N,w,V=m,W=m,Y=o.pid>-1,j=n.pid>-1,X=n.samples.length,$=o.samples.length>0,Q=X>1,z=(!Y||$)&&(!j||Q)||this.ISGenerated||D;if(z){this.ISGenerated||(U=this.generateIS(o,n,m));var J=this.isVideoContiguous,Z=-1;if(Q&&(Z=f(n.samples),!J&&this.config.forceKeyFrameOnDiscontinuity))if(w=!0,Z>0){b.logger.warn("[mp4-remuxer]: Dropped "+Z+" out of "+X+" video samples due to a missing keyframe");var q=this.getVideoStartPts(n.samples);n.samples=n.samples.slice(Z),n.dropped+=Z,W+=(n.samples[0].pts-q)/(n.timescale||9e4)}else Z===-1&&(b.logger.warn("[mp4-remuxer]: No keyframe found out of "+X+" video samples"),w=!1);if(this.ISGenerated){if($&&Q){var ee=this.getVideoStartPts(n.samples),ne=e(o.samples[0].pts,ee)-ee,te=ne/n.inputTimeScale;V+=Math.max(0,te),W+=Math.max(0,-te)}if($){if(o.samplerate||(b.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),U=this.generateIS(o,n,m)),F=this.remuxAudio(o,V,this.isAudioContiguous,x,j||Q||P===A.PlaylistLevelType.AUDIO?W:void 0),Q){var ie=F?F.endPTS-F.startPTS:0;n.inputTimeScale||(b.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),U=this.generateIS(o,n,m)),_=this.remuxVideo(n,W,J,ie)}}else Q&&(_=this.remuxVideo(n,W,J,0));_&&(_.firstKeyFrame=Z,_.independent=Z!==-1)}}return this.ISGenerated&&(d.samples.length&&(N=this.remuxID3(d,m)),u.samples.length&&(k=this.remuxText(u,m))),{audio:F,video:_,initSegment:U,independent:w,text:k,id3:N}},g.generateIS=function(o,n,d){var u=o.samples,m=n.samples,x=this.typeSupported,D={},P=!Object(M.isFiniteNumber)(this._initPTS),_="audio/mp4",F,U,k;if(P&&(F=U=1/0),o.config&&u.length&&(o.timescale=o.samplerate,o.isAAC||(x.mpeg?(_="audio/mpeg",o.codec=""):x.mp3&&(o.codec="mp3")),D.audio={id:"audio",container:_,codec:o.codec,initSegment:!o.isAAC&&x.mpeg?new Uint8Array(0):L.default.initSegment([o]),metadata:{channelCount:o.channelCount}},P&&(k=o.inputTimeScale,F=U=u[0].pts-Math.round(k*d))),n.sps&&n.pps&&m.length&&(n.timescale=n.inputTimeScale,D.video={id:"main",container:"video/mp4",codec:n.codec,initSegment:L.default.initSegment([n]),metadata:{width:n.width,height:n.height}},P)){k=n.inputTimeScale;var N=this.getVideoStartPts(m),w=Math.round(k*d);U=Math.min(U,e(m[0].dts,N)-w),F=Math.min(F,N-w)}if(Object.keys(D).length)return this.ISGenerated=!0,P&&(this._initPTS=F,this._initDTS=U),{tracks:D,initPTS:F,timescale:k}},g.remuxVideo=function(o,n,d,u){var m=o.inputTimeScale,x=o.samples,D=[],P=x.length,_=this._initPTS,F=this.nextAvcDts,U=8,k,N,w,V=Number.POSITIVE_INFINITY,W=Number.NEGATIVE_INFINITY,Y=0,j=!1;if(!d||F===null){var X=n*m,$=x[0].pts-e(x[0].dts,x[0].pts);F=X-$}for(var Q=0;Q<P;Q++){var z=x[Q];if(z.pts=e(z.pts-_,F),z.dts=e(z.dts-_,F),z.dts>z.pts){var J=18e3;Y=Math.max(Math.min(Y,z.pts-z.dts),-1*J)}z.dts<x[Q>0?Q-1:Q].dts&&(j=!0)}j&&x.sort(function(Ye,qe){var Pr=Ye.dts-qe.dts,Cr=Ye.pts-qe.pts;return Pr||Cr}),N=x[0].dts,w=x[x.length-1].dts;var Z=Math.round((w-N)/(P-1));if(Y<0){if(Y<Z*-2){b.logger.warn("PTS < DTS detected in video samples, offsetting DTS from PTS by "+Object(c.toMsFromMpegTsClock)(-Z,!0)+" ms");for(var q=Y,ee=0;ee<P;ee++)x[ee].dts=q=Math.max(q,x[ee].pts-Z),x[ee].pts=Math.max(q,x[ee].pts)}else{b.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+Object(c.toMsFromMpegTsClock)(Y,!0)+" ms to overcome this issue");for(var ne=0;ne<P;ne++)x[ne].dts=x[ne].dts+Y}N=x[0].dts}if(d){var te=N-F,ie=te>Z,ue=te<-1;if(ie||ue){ie?b.logger.warn("AVC: "+Object(c.toMsFromMpegTsClock)(te,!0)+" ms ("+te+"dts) hole between fragments detected, filling it"):b.logger.warn("AVC: "+Object(c.toMsFromMpegTsClock)(-te,!0)+" ms ("+te+"dts) overlapping between fragments detected"),N=F;var se=x[0].pts-te;x[0].dts=N,x[0].pts=se,b.logger.log("Video: First PTS/DTS adjusted: "+Object(c.toMsFromMpegTsClock)(se,!0)+"/"+Object(c.toMsFromMpegTsClock)(N,!0)+", delta: "+Object(c.toMsFromMpegTsClock)(te,!0)+" ms")}}t&&(N=Math.max(0,N));for(var fe=0,oe=0,ce=0;ce<P;ce++){for(var re=x[ce],Le=re.units,Oe=Le.length,xe=0,ve=0;ve<Oe;ve++)xe+=Le[ve].data.length;oe+=xe,fe+=Oe,re.length=xe,re.dts=Math.max(re.dts,N),re.pts=Math.max(re.pts,re.dts,0),V=Math.min(re.pts,V),W=Math.max(re.pts,W)}w=x[P-1].dts;var ge=oe+4*fe+8,Te;try{Te=new Uint8Array(ge)}catch{this.observer.emit(R.Events.ERROR,R.Events.ERROR,{type:I.ErrorTypes.MUX_ERROR,details:I.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:ge,reason:"fail allocating video mdat "+ge});return}var me=new DataView(Te.buffer);me.setUint32(0,ge),Te.set(L.default.types.mdat,4);for(var he=0;he<P;he++){for(var pe=x[he],Re=pe.units,Ie=0,be=0,Pe=Re.length;be<Pe;be++){var Se=Re[be],Ee=Se.data,Ce=Se.data.byteLength;me.setUint32(U,Ce),U+=4,Te.set(Ee,U),U+=Ce,Ie+=4+Ce}if(he<P-1)k=x[he+1].dts-pe.dts;else{var Ue=this.config,we=pe.dts-x[he>0?he-1:he].dts;if(Ue.stretchShortVideoTrack&&this.nextAudioPts!==null){var br=Math.floor(Ue.maxBufferHole*m),je=(u?V+u*m:this.nextAudioPts)-pe.pts;je>br?(k=je-we,k<0&&(k=we),b.logger.log("[mp4-remuxer]: It is approximately "+je/90+" ms to the next segment; using duration "+k/90+" ms for the last video frame.")):k=we}else k=we}var Dr=Math.round(pe.pts-pe.dts);D.push(new a(pe.key,k,Ie,Dr))}if(D.length&&v&&v<70){var Je=D[0].flags;Je.dependsOn=2,Je.isNonSync=0}console.assert(k!==void 0,"mp4SampleDuration must be computed"),this.nextAvcDts=F=w+k,this.isVideoContiguous=!0;var Or=L.default.moof(o.sequenceNumber++,N,S({},o,{samples:D})),Rr="video",Ir={data1:Or,data2:Te,startPTS:V/m,endPTS:(W+k)/m,startDTS:N/m,endDTS:F/m,type:Rr,hasAudio:!1,hasVideo:!0,nb:D.length,dropped:o.dropped};return o.samples=[],o.dropped=0,console.assert(Te.length,"MDAT length must not be zero"),Ir},g.remuxAudio=function(o,n,d,u,m){var x=o.inputTimeScale,D=o.samplerate?o.samplerate:x,P=x/D,_=o.isAAC?T:p,F=_*P,U=this._initPTS,k=!o.isAAC&&this.typeSupported.mpeg,N=[],w=o.samples,V=k?0:8,W=this.nextAudioPts||-1,Y=n*x;if(this.isAudioContiguous=d=d||w.length&&W>0&&(u&&Math.abs(Y-W)<9e3||Math.abs(e(w[0].pts-U,Y)-W)<20*F),w.forEach(function(Ee){Ee.pts=e(Ee.pts-U,Y)}),!d||W<0){if(w=w.filter(function(Ee){return Ee.pts>=0}),!w.length)return;m===0?W=0:u?W=Math.max(0,Y):W=w[0].pts}if(o.isAAC)for(var j=m!==void 0,X=this.config.maxAudioFramesDrift,$=0,Q=W;$<w.length;$++){var z=w[$],J=z.pts,Z=J-Q,q=Math.abs(1e3*Z/x);if(Z<=-X*F&&j)$===0&&(b.logger.warn("Audio frame @ "+(J/x).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*Z/x)+" ms."),this.nextAudioPts=W=Q=J);else if(Z>=X*F&&q<y&&j){var ee=Math.round(Z/F);Q=J-ee*F,Q<0&&(ee--,Q+=F),$===0&&(this.nextAudioPts=W=Q),b.logger.warn("[mp4-remuxer]: Injecting "+ee+" audio frame @ "+(Q/x).toFixed(3)+"s due to "+Math.round(1e3*Z/x)+" ms gap.");for(var ne=0;ne<ee;ne++){var te=Math.max(Q,0),ie=O.default.getSilentFrame(o.manifestCodec||o.codec,o.channelCount);ie||(b.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),ie=z.unit.subarray()),w.splice($,0,{unit:ie,pts:te}),Q+=F,$++}}z.pts=Q,Q+=F}for(var ue=null,se=null,fe,oe=0,ce=w.length;ce--;)oe+=w[ce].unit.byteLength;for(var re=0,Le=w.length;re<Le;re++){var Oe=w[re],xe=Oe.unit,ve=Oe.pts;if(se!==null){var ge=N[re-1];ge.duration=Math.round((ve-se)/P)}else if(d&&o.isAAC&&(ve=W),ue=ve,oe>0){oe+=V;try{fe=new Uint8Array(oe)}catch{this.observer.emit(R.Events.ERROR,R.Events.ERROR,{type:I.ErrorTypes.MUX_ERROR,details:I.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:oe,reason:"fail allocating audio mdat "+oe});return}if(!k){var Te=new DataView(fe.buffer);Te.setUint32(0,oe),fe.set(L.default.types.mdat,4)}}else return;fe.set(xe,V);var me=xe.byteLength;V+=me,N.push(new a(!0,_,me,0)),se=ve}var he=N.length;if(!!he){var pe=N[N.length-1];this.nextAudioPts=W=se+P*pe.duration;var Re=k?new Uint8Array(0):L.default.moof(o.sequenceNumber++,ue/P,S({},o,{samples:N}));o.samples=[];var Ie=ue/x,be=W/x,Pe="audio",Se={data1:Re,data2:fe,startPTS:Ie,endPTS:be,startDTS:Ie,endDTS:be,type:Pe,hasAudio:!0,hasVideo:!1,nb:he};return this.isAudioContiguous=!0,console.assert(fe.length,"MDAT length must not be zero"),Se}},g.remuxEmptyAudio=function(o,n,d,u){var m=o.inputTimeScale,x=o.samplerate?o.samplerate:m,D=m/x,P=this.nextAudioPts,_=(P!==null?P:u.startDTS*m)+this._initDTS,F=u.endDTS*m+this._initDTS,U=D*T,k=Math.ceil((F-_)/U),N=O.default.getSilentFrame(o.manifestCodec||o.codec,o.channelCount);if(b.logger.warn("[mp4-remuxer]: remux empty Audio"),!N){b.logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");return}for(var w=[],V=0;V<k;V++){var W=_+V*U;w.push({unit:N,pts:W,dts:W})}return o.samples=w,this.remuxAudio(o,n,d,!1)},g.remuxID3=function(o,n){var d=o.samples.length;if(!!d){for(var u=o.inputTimeScale,m=this._initPTS,x=this._initDTS,D=0;D<d;D++){var P=o.samples[D];P.pts=e(P.pts-m,n*u)/u,P.dts=e(P.dts-x,n*u)/u}var _=o.samples;return o.samples=[],{samples:_}}},g.remuxText=function(o,n){var d=o.samples.length;if(!!d){for(var u=o.inputTimeScale,m=this._initPTS,x=0;x<d;x++){var D=o.samples[x];D.pts=e(D.pts-m,n*u)/u}o.samples.sort(function(_,F){return _.pts-F.pts});var P=o.samples;return o.samples=[],{samples:P}}},l}();function e(l,g){var h;if(g===null)return l;for(g<l?h=-8589934592:h=8589934592;Math.abs(l-g)>4294967296;)l+=h;return l}function f(l){for(var g=0;g<l.length;g++)if(l[g].key)return g;return-1}var a=function(g,h,o,n){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=h,this.size=o,this.cts=n,this.flags=new i(g)},i=function(g){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=g?2:1,this.isNonSync=g?0:1}},"./src/remux/passthrough-remuxer.ts":function(K,C,E){E.r(C);var M=E("./src/polyfills/number.ts"),O=E("./src/utils/mp4-tools.ts"),L=E("./src/loader/fragment.ts"),R=E("./src/utils/logger.ts"),I=function(){function c(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndDTS=null}var S=c.prototype;return S.destroy=function(){},S.resetTimeStamp=function(T){this.initPTS=T,this.lastEndDTS=null},S.resetNextTimestamp=function(){this.lastEndDTS=null},S.resetInitSegment=function(T,p,v){this.audioCodec=p,this.videoCodec=v,this.generateInitSegment(T),this.emitInitSegment=!0},S.generateInitSegment=function(T){var p=this.audioCodec,v=this.videoCodec;if(!T||!T.byteLength){this.initTracks=void 0,this.initData=void 0;return}var s=this.initData=Object(O.parseInitSegment)(T);p||(p=A(s.audio,L.ElementaryStreamTypes.AUDIO)),v||(v=A(s.video,L.ElementaryStreamTypes.VIDEO));var t={};s.audio&&s.video?t.audiovideo={container:"video/mp4",codec:p+","+v,initSegment:T,id:"main"}:s.audio?t.audio={container:"audio/mp4",codec:p,initSegment:T,id:"audio"}:s.video?t.video={container:"video/mp4",codec:v,initSegment:T,id:"main"}:R.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=t},S.remux=function(T,p,v,s,t){var r=this.initPTS,e=this.lastEndDTS,f={audio:void 0,video:void 0,text:s,id3:v,initSegment:void 0};Object(M.isFiniteNumber)(e)||(e=this.lastEndDTS=t||0);var a=p.samples;if(!a||!a.length)return f;var i={initPTS:void 0,timescale:1},l=this.initData;if((!l||!l.length)&&(this.generateInitSegment(a),l=this.initData),!l||!l.length)return R.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),f;this.emitInitSegment&&(i.tracks=this.initTracks,this.emitInitSegment=!1),Object(M.isFiniteNumber)(r)||(this.initPTS=i.initPTS=r=b(l,a,e));var g=Object(O.getDuration)(a,l),h=e,o=g+h;Object(O.offsetStartDTS)(l,a,r),g>0?this.lastEndDTS=o:(R.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var n=!!l.audio,d=!!l.video,u="";n&&(u+="audio"),d&&(u+="video");var m={data1:a,startPTS:h,startDTS:h,endPTS:o,endDTS:o,type:u,hasAudio:n,hasVideo:d,nb:1,dropped:0};return f.audio=m.type==="audio"?m:void 0,f.video=m.type!=="audio"?m:void 0,f.text=s,f.id3=v,f.initSegment=i,f},c}(),b=function(S,y,T){return Object(O.getStartDTS)(S,y)-T};function A(c,S){var y=c==null?void 0:c.codec;return y&&y.length>4?y:y==="hvc1"?"hvc1.1.c.L120.90":y==="av01"?"av01.0.04M.08":y==="avc1"||S===L.ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}C.default=I},"./src/task-loop.ts":function(K,C,E){E.r(C),E.d(C,"default",function(){return M});var M=function(){function O(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var L=O.prototype;return L.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},L.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},L.onHandlerDestroyed=function(){},L.hasInterval=function(){return!!this._tickInterval},L.hasNextTick=function(){return!!this._tickTimer},L.setInterval=function(I){return this._tickInterval?!1:(this._tickInterval=self.setInterval(this._boundTick,I),!0)},L.clearInterval=function(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1},L.clearNextTick=function(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1},L.tick=function(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},L.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},L.doTick=function(){},O}()},"./src/types/level.ts":function(K,C,E){E.r(C),E.d(C,"HlsSkip",function(){return L}),E.d(C,"getSkipValue",function(){return R}),E.d(C,"HlsUrlParameters",function(){return I}),E.d(C,"Level",function(){return b});function M(A,c){for(var S=0;S<c.length;S++){var y=c[S];y.enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(A,y.key,y)}}function O(A,c,S){return c&&M(A.prototype,c),S&&M(A,S),A}var L;(function(A){A.No="",A.Yes="YES",A.v2="v2"})(L||(L={}));function R(A,c){var S=A.canSkipUntil,y=A.canSkipDateRanges,T=A.endSN,p=c!==void 0?c-T:0;return S&&p<S?y?L.v2:L.Yes:L.No}var I=function(){function A(S,y,T){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=S,this.part=y,this.skip=T}var c=A.prototype;return c.addDirectives=function(y){var T=new self.URL(y);return this.msn!==void 0&&T.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&T.searchParams.set("_HLS_part",this.part.toString()),this.skip&&T.searchParams.set("_HLS_skip",this.skip),T.toString()},A}(),b=function(){function A(c){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[c.url],this.attrs=c.attrs,this.bitrate=c.bitrate,c.details&&(this.details=c.details),this.id=c.id||0,this.name=c.name,this.width=c.width||0,this.height=c.height||0,this.audioCodec=c.audioCodec,this.videoCodec=c.videoCodec,this.unknownCodecs=c.unknownCodecs,this.codecSet=[c.videoCodec,c.audioCodec].filter(function(S){return S}).join(",").replace(/\.[^.,]+/g,"")}return O(A,[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(S){var y=S%this.url.length;this._urlId!==y&&(this.details=void 0,this._urlId=y)}}]),A}()},"./src/types/loader.ts":function(K,C,E){E.r(C),E.d(C,"PlaylistContextType",function(){return M}),E.d(C,"PlaylistLevelType",function(){return O});var M;(function(L){L.MANIFEST="manifest",L.LEVEL="level",L.AUDIO_TRACK="audioTrack",L.SUBTITLE_TRACK="subtitleTrack"})(M||(M={}));var O;(function(L){L.MAIN="main",L.AUDIO="audio",L.SUBTITLE="subtitle"})(O||(O={}))},"./src/types/transmuxer.ts":function(K,C,E){E.r(C),E.d(C,"ChunkMetadata",function(){return M});var M=function(R,I,b,A,c,S){A===void 0&&(A=0),c===void 0&&(c=-1),S===void 0&&(S=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=O(),this.buffering={audio:O(),video:O(),audiovideo:O()},this.level=R,this.sn=I,this.id=b,this.size=A,this.part=c,this.partial=S};function O(){return{start:0,executeStart:0,executeEnd:0,end:0}}},"./src/utils/attr-list.ts":function(K,C,E){E.r(C),E.d(C,"AttrList",function(){return L});var M=/^(\d+)x(\d+)$/,O=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,L=function(){function R(b){typeof b=="string"&&(b=R.parseAttrList(b));for(var A in b)b.hasOwnProperty(A)&&(this[A]=b[A])}var I=R.prototype;return I.decimalInteger=function(A){var c=parseInt(this[A],10);return c>Number.MAX_SAFE_INTEGER?1/0:c},I.hexadecimalInteger=function(A){if(this[A]){var c=(this[A]||"0x").slice(2);c=(c.length&1?"0":"")+c;for(var S=new Uint8Array(c.length/2),y=0;y<c.length/2;y++)S[y]=parseInt(c.slice(y*2,y*2+2),16);return S}else return null},I.hexadecimalIntegerAsNumber=function(A){var c=parseInt(this[A],16);return c>Number.MAX_SAFE_INTEGER?1/0:c},I.decimalFloatingPoint=function(A){return parseFloat(this[A])},I.optionalFloat=function(A,c){var S=this[A];return S?parseFloat(S):c},I.enumeratedString=function(A){return this[A]},I.bool=function(A){return this[A]==="YES"},I.decimalResolution=function(A){var c=M.exec(this[A]);if(c!==null)return{width:parseInt(c[1],10),height:parseInt(c[2],10)}},R.parseAttrList=function(A){var c,S={},y='"';for(O.lastIndex=0;(c=O.exec(A))!==null;){var T=c[2];T.indexOf(y)===0&&T.lastIndexOf(y)===T.length-1&&(T=T.slice(1,-1)),S[c[1]]=T}return S},R}()},"./src/utils/binary-search.ts":function(K,C,E){E.r(C);var M={search:function(L,R){for(var I=0,b=L.length-1,A=null,c=null;I<=b;){A=(I+b)/2|0,c=L[A];var S=R(c);if(S>0)I=A+1;else if(S<0)b=A-1;else return c}return null}};C.default=M},"./src/utils/buffer-helper.ts":function(K,C,E){E.r(C),E.d(C,"BufferHelper",function(){return L});var M=E("./src/utils/logger.ts"),O={length:0,start:function(){return 0},end:function(){return 0}},L=function(){function R(){}return R.isBuffered=function(b,A){try{if(b){for(var c=R.getBuffered(b),S=0;S<c.length;S++)if(A>=c.start(S)&&A<=c.end(S))return!0}}catch{}return!1},R.bufferInfo=function(b,A,c){try{if(b){var S=R.getBuffered(b),y=[],T;for(T=0;T<S.length;T++)y.push({start:S.start(T),end:S.end(T)});return this.bufferedInfo(y,A,c)}}catch{}return{len:0,start:A,end:A,nextStart:void 0}},R.bufferedInfo=function(b,A,c){A=Math.max(0,A),b.sort(function(i,l){var g=i.start-l.start;return g||l.end-i.end});var S=[];if(c)for(var y=0;y<b.length;y++){var T=S.length;if(T){var p=S[T-1].end;b[y].start-p<c?b[y].end>p&&(S[T-1].end=b[y].end):S.push(b[y])}else S.push(b[y])}else S=b;for(var v=0,s,t=A,r=A,e=0;e<S.length;e++){var f=S[e].start,a=S[e].end;if(A+c>=f&&A<a)t=f,r=a,v=r-A;else if(A+c<f){s=f;break}}return{len:v,start:t||0,end:r||0,nextStart:s}},R.getBuffered=function(b){try{return b.buffered}catch(A){return M.logger.log("failed to get media.buffered",A),O}},R}()},"./src/utils/cea-608-parser.ts":function(K,C,E){E.r(C),E.d(C,"Row",function(){return r}),E.d(C,"CaptionScreen",function(){return e});var M=E("./src/utils/logger.ts"),O={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},L=function(o){var n=o;return O.hasOwnProperty(o)&&(n=O[o]),String.fromCharCode(n)},R=15,I=100,b={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},A={17:2,18:4,21:6,22:8,23:10,19:13,20:15},c={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},S={25:2,26:4,29:6,30:8,31:10,27:13,28:15},y=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],T;(function(h){h[h.ERROR=0]="ERROR",h[h.TEXT=1]="TEXT",h[h.WARNING=2]="WARNING",h[h.INFO=2]="INFO",h[h.DEBUG=3]="DEBUG",h[h.DATA=3]="DATA"})(T||(T={}));var p=function(){function h(){this.time=null,this.verboseLevel=T.ERROR}var o=h.prototype;return o.log=function(d,u){this.verboseLevel>=d&&M.logger.log(this.time+" ["+d+"] "+u)},h}(),v=function(o){for(var n=[],d=0;d<o.length;d++)n.push(o[d].toString(16));return n},s=function(){function h(n,d,u,m,x){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=n||"white",this.underline=d||!1,this.italics=u||!1,this.background=m||"black",this.flash=x||!1}var o=h.prototype;return o.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},o.setStyles=function(d){for(var u=["foreground","underline","italics","background","flash"],m=0;m<u.length;m++){var x=u[m];d.hasOwnProperty(x)&&(this[x]=d[x])}},o.isDefault=function(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash},o.equals=function(d){return this.foreground===d.foreground&&this.underline===d.underline&&this.italics===d.italics&&this.background===d.background&&this.flash===d.flash},o.copy=function(d){this.foreground=d.foreground,this.underline=d.underline,this.italics=d.italics,this.background=d.background,this.flash=d.flash},o.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},h}(),t=function(){function h(n,d,u,m,x,D){this.uchar=void 0,this.penState=void 0,this.uchar=n||" ",this.penState=new s(d,u,m,x,D)}var o=h.prototype;return o.reset=function(){this.uchar=" ",this.penState.reset()},o.setChar=function(d,u){this.uchar=d,this.penState.copy(u)},o.setPenState=function(d){this.penState.copy(d)},o.equals=function(d){return this.uchar===d.uchar&&this.penState.equals(d.penState)},o.copy=function(d){this.uchar=d.uchar,this.penState.copy(d.penState)},o.isEmpty=function(){return this.uchar===" "&&this.penState.isDefault()},h}(),r=function(){function h(n){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var d=0;d<I;d++)this.chars.push(new t);this.logger=n,this.pos=0,this.currPenState=new s}var o=h.prototype;return o.equals=function(d){for(var u=!0,m=0;m<I;m++)if(!this.chars[m].equals(d.chars[m])){u=!1;break}return u},o.copy=function(d){for(var u=0;u<I;u++)this.chars[u].copy(d.chars[u])},o.isEmpty=function(){for(var d=!0,u=0;u<I;u++)if(!this.chars[u].isEmpty()){d=!1;break}return d},o.setCursor=function(d){this.pos!==d&&(this.pos=d),this.pos<0?(this.logger.log(T.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>I&&(this.logger.log(T.DEBUG,"Too large cursor position "+this.pos),this.pos=I)},o.moveCursor=function(d){var u=this.pos+d;if(d>1)for(var m=this.pos+1;m<u+1;m++)this.chars[m].setPenState(this.currPenState);this.setCursor(u)},o.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},o.insertChar=function(d){d>=144&&this.backSpace();var u=L(d);if(this.pos>=I){this.logger.log(T.ERROR,"Cannot insert "+d.toString(16)+" ("+u+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(u,this.currPenState),this.moveCursor(1)},o.clearFromPos=function(d){var u;for(u=d;u<I;u++)this.chars[u].reset()},o.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},o.clearToEndOfRow=function(){this.clearFromPos(this.pos)},o.getTextString=function(){for(var d=[],u=!0,m=0;m<I;m++){var x=this.chars[m].uchar;x!==" "&&(u=!1),d.push(x)}return u?"":d.join("")},o.setPenStyles=function(d){this.currPenState.setStyles(d);var u=this.chars[this.pos];u.setPenState(this.currPenState)},h}(),e=function(){function h(n){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var d=0;d<R;d++)this.rows.push(new r(n));this.logger=n,this.currRow=R-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var o=h.prototype;return o.reset=function(){for(var d=0;d<R;d++)this.rows[d].clear();this.currRow=R-1},o.equals=function(d){for(var u=!0,m=0;m<R;m++)if(!this.rows[m].equals(d.rows[m])){u=!1;break}return u},o.copy=function(d){for(var u=0;u<R;u++)this.rows[u].copy(d.rows[u])},o.isEmpty=function(){for(var d=!0,u=0;u<R;u++)if(!this.rows[u].isEmpty()){d=!1;break}return d},o.backSpace=function(){var d=this.rows[this.currRow];d.backSpace()},o.clearToEndOfRow=function(){var d=this.rows[this.currRow];d.clearToEndOfRow()},o.insertChar=function(d){var u=this.rows[this.currRow];u.insertChar(d)},o.setPen=function(d){var u=this.rows[this.currRow];u.setPenStyles(d)},o.moveCursor=function(d){var u=this.rows[this.currRow];u.moveCursor(d)},o.setCursor=function(d){this.logger.log(T.INFO,"setCursor: "+d);var u=this.rows[this.currRow];u.setCursor(d)},o.setPAC=function(d){this.logger.log(T.INFO,"pacData = "+JSON.stringify(d));var u=d.row-1;if(this.nrRollUpRows&&u<this.nrRollUpRows-1&&(u=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==u){for(var m=0;m<R;m++)this.rows[m].clear();var x=this.currRow+1-this.nrRollUpRows,D=this.lastOutputScreen;if(D){var P=D.rows[x].cueStartTime,_=this.logger.time;if(P&&_!==null&&P<_)for(var F=0;F<this.nrRollUpRows;F++)this.rows[u-this.nrRollUpRows+F+1].copy(D.rows[x+F])}}this.currRow=u;var U=this.rows[this.currRow];if(d.indent!==null){var k=d.indent,N=Math.max(k-1,0);U.setCursor(d.indent),d.color=U.chars[N].penState.foreground}var w={foreground:d.color,underline:d.underline,italics:d.italics,background:"black",flash:!1};this.setPen(w)},o.setBkgData=function(d){this.logger.log(T.INFO,"bkgData = "+JSON.stringify(d)),this.backSpace(),this.setPen(d),this.insertChar(32)},o.setRollUpRows=function(d){this.nrRollUpRows=d},o.rollUp=function(){if(this.nrRollUpRows===null){this.logger.log(T.DEBUG,"roll_up but nrRollUpRows not set yet");return}this.logger.log(T.TEXT,this.getDisplayText());var d=this.currRow+1-this.nrRollUpRows,u=this.rows.splice(d,1)[0];u.clear(),this.rows.splice(this.currRow,0,u),this.logger.log(T.INFO,"Rolling up")},o.getDisplayText=function(d){d=d||!1;for(var u=[],m="",x=-1,D=0;D<R;D++){var P=this.rows[D].getTextString();P&&(x=D+1,d?u.push("Row "+x+": '"+P+"'"):u.push(P.trim()))}return u.length>0&&(d?m="["+u.join(" | ")+"]":m=u.join(`
`)),m},o.getTextAndFormat=function(){return this.rows},h}(),f=function(){function h(n,d,u){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=n,this.outputFilter=d,this.mode=null,this.verbose=0,this.displayedMemory=new e(u),this.nonDisplayedMemory=new e(u),this.lastOutputScreen=new e(u),this.currRollUpRow=this.displayedMemory.rows[R-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=u}var o=h.prototype;return o.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[R-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},o.getHandler=function(){return this.outputFilter},o.setHandler=function(d){this.outputFilter=d},o.setPAC=function(d){this.writeScreen.setPAC(d)},o.setBkgData=function(d){this.writeScreen.setBkgData(d)},o.setMode=function(d){d!==this.mode&&(this.mode=d,this.logger.log(T.INFO,"MODE="+d),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=d)},o.insertChars=function(d){for(var u=0;u<d.length;u++)this.writeScreen.insertChar(d[u]);var m=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(T.INFO,m+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(T.TEXT,"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},o.ccRCL=function(){this.logger.log(T.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},o.ccBS=function(){this.logger.log(T.INFO,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},o.ccAOF=function(){},o.ccAON=function(){},o.ccDER=function(){this.logger.log(T.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},o.ccRU=function(d){this.logger.log(T.INFO,"RU("+d+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(d)},o.ccFON=function(){this.logger.log(T.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},o.ccRDC=function(){this.logger.log(T.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},o.ccTR=function(){this.logger.log(T.INFO,"TR"),this.setMode("MODE_TEXT")},o.ccRTD=function(){this.logger.log(T.INFO,"RTD"),this.setMode("MODE_TEXT")},o.ccEDM=function(){this.logger.log(T.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},o.ccCR=function(){this.logger.log(T.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},o.ccENM=function(){this.logger.log(T.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},o.ccEOC=function(){if(this.logger.log(T.INFO,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){var d=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=d,this.writeScreen=this.nonDisplayedMemory,this.logger.log(T.TEXT,"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},o.ccTO=function(d){this.logger.log(T.INFO,"TO("+d+") - Tab Offset"),this.writeScreen.moveCursor(d)},o.ccMIDROW=function(d){var u={flash:!1};if(u.underline=d%2===1,u.italics=d>=46,u.italics)u.foreground="white";else{var m=Math.floor(d/2)-16,x=["white","green","blue","cyan","red","yellow","magenta"];u.foreground=x[m]}this.logger.log(T.INFO,"MIDROW: "+JSON.stringify(u)),this.writeScreen.setPen(u)},o.outputDataUpdate=function(d){d===void 0&&(d=!1);var u=this.logger.time;u!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=u:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,u,this.lastOutputScreen),d&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:u),this.lastOutputScreen.copy(this.displayedMemory))},o.cueSplitAtTime=function(d){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,d,this.displayedMemory),this.cueStartTime=d))},h}(),a=function(){function h(n,d,u){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var m=new p;this.channels=[null,new f(n,d,m),new f(n+1,u,m)],this.cmdHistory=g(),this.logger=m}var o=h.prototype;return o.getHandler=function(d){return this.channels[d].getHandler()},o.setHandler=function(d,u){this.channels[d].setHandler(u)},o.addData=function(d,u){var m,x,D,P=!1;this.logger.time=d;for(var _=0;_<u.length;_+=2)if(x=u[_]&127,D=u[_+1]&127,!(x===0&&D===0)){if(this.logger.log(T.DATA,"["+v([u[_],u[_+1]])+"] -> ("+v([x,D])+")"),m=this.parseCmd(x,D),m||(m=this.parseMidrow(x,D)),m||(m=this.parsePAC(x,D)),m||(m=this.parseBackgroundAttributes(x,D)),!m&&(P=this.parseChars(x,D),P)){var F=this.currentChannel;if(F&&F>0){var U=this.channels[F];U.insertChars(P)}else this.logger.log(T.WARNING,"No channel found yet. TEXT-MODE?")}!m&&!P&&this.logger.log(T.WARNING,"Couldn't parse cleaned data "+v([x,D])+" orig: "+v([u[_],u[_+1]]))}},o.parseCmd=function(d,u){var m=this.cmdHistory,x=(d===20||d===28||d===21||d===29)&&u>=32&&u<=47,D=(d===23||d===31)&&u>=33&&u<=35;if(!(x||D))return!1;if(l(d,u,m))return i(null,null,m),this.logger.log(T.DEBUG,"Repeated command ("+v([d,u])+") is dropped"),!0;var P=d===20||d===21||d===23?1:2,_=this.channels[P];return d===20||d===21||d===28||d===29?u===32?_.ccRCL():u===33?_.ccBS():u===34?_.ccAOF():u===35?_.ccAON():u===36?_.ccDER():u===37?_.ccRU(2):u===38?_.ccRU(3):u===39?_.ccRU(4):u===40?_.ccFON():u===41?_.ccRDC():u===42?_.ccTR():u===43?_.ccRTD():u===44?_.ccEDM():u===45?_.ccCR():u===46?_.ccENM():u===47&&_.ccEOC():_.ccTO(u-32),i(d,u,m),this.currentChannel=P,!0},o.parseMidrow=function(d,u){var m=0;if((d===17||d===25)&&u>=32&&u<=47){if(d===17?m=1:m=2,m!==this.currentChannel)return this.logger.log(T.ERROR,"Mismatch channel in midrow parsing"),!1;var x=this.channels[m];return x?(x.ccMIDROW(u),this.logger.log(T.DEBUG,"MIDROW ("+v([d,u])+")"),!0):!1}return!1},o.parsePAC=function(d,u){var m,x=this.cmdHistory,D=(d>=17&&d<=23||d>=25&&d<=31)&&u>=64&&u<=127,P=(d===16||d===24)&&u>=64&&u<=95;if(!(D||P))return!1;if(l(d,u,x))return i(null,null,x),!0;var _=d<=23?1:2;u>=64&&u<=95?m=_===1?b[d]:c[d]:m=_===1?A[d]:S[d];var F=this.channels[_];return F?(F.setPAC(this.interpretPAC(m,u)),i(d,u,x),this.currentChannel=_,!0):!1},o.interpretPAC=function(d,u){var m,x={color:null,italics:!1,indent:null,underline:!1,row:d};return u>95?m=u-96:m=u-64,x.underline=(m&1)===1,m<=13?x.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(m/2)]:m<=15?(x.italics=!0,x.color="white"):x.indent=Math.floor((m-16)/2)*4,x},o.parseChars=function(d,u){var m,x=null,D=null;if(d>=25?(m=2,D=d-8):(m=1,D=d),D>=17&&D<=19){var P;D===17?P=u+80:D===18?P=u+112:P=u+144,this.logger.log(T.INFO,"Special char '"+L(P)+"' in channel "+m),x=[P]}else d>=32&&d<=127&&(x=u===0?[d]:[d,u]);if(x){var _=v(x);this.logger.log(T.DEBUG,"Char codes =  "+_.join(",")),i(d,u,this.cmdHistory)}return x},o.parseBackgroundAttributes=function(d,u){var m=(d===16||d===24)&&u>=32&&u<=47,x=(d===23||d===31)&&u>=45&&u<=47;if(!(m||x))return!1;var D,P={};d===16||d===24?(D=Math.floor((u-32)/2),P.background=y[D],u%2===1&&(P.background=P.background+"_semi")):u===45?P.background="transparent":(P.foreground="black",u===47&&(P.underline=!0));var _=d<=23?1:2,F=this.channels[_];return F.setBkgData(P),i(d,u,this.cmdHistory),!0},o.reset=function(){for(var d=0;d<Object.keys(this.channels).length;d++){var u=this.channels[d];u&&u.reset()}this.cmdHistory=g()},o.cueSplitAtTime=function(d){for(var u=0;u<this.channels.length;u++){var m=this.channels[u];m&&m.cueSplitAtTime(d)}},h}();function i(h,o,n){n.a=h,n.b=o}function l(h,o,n){return n.a===h&&n.b===o}function g(){return{a:null,b:null}}C.default=a},"./src/utils/codecs.ts":function(K,C,E){E.r(C),E.d(C,"isCodecType",function(){return O}),E.d(C,"isCodecSupportedInMp4",function(){return L});var M={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function O(R,I){var b=M[I];return!!b&&b[R.slice(0,4)]===!0}function L(R,I){return MediaSource.isTypeSupported((I||"video")+'/mp4;codecs="'+R+'"')}},"./src/utils/cues.ts":function(K,C,E){E.r(C);var M=E("./src/utils/vttparser.ts"),O=E("./src/utils/webvtt-parser.ts"),L=E("./src/utils/texttrack-utils.ts"),R=/\s/,I={newCue:function(A,c,S,y){for(var T=[],p,v,s,t,r,e=self.VTTCue||self.TextTrackCue,f=0;f<y.rows.length;f++)if(p=y.rows[f],s=!0,t=0,r="",!p.isEmpty()){for(var a=0;a<p.chars.length;a++)R.test(p.chars[a].uchar)&&s?t++:(r+=p.chars[a].uchar,s=!1);p.cueStartTime=c,c===S&&(S+=1e-4),t>=16?t--:t++;var i=Object(M.fixLineBreaks)(r.trim()),l=Object(O.generateCueId)(c,S,i);(!A||!A.cues||!A.cues.getCueById(l))&&(v=new e(c,S,i),v.id=l,v.line=f+1,v.align="left",v.position=10+Math.min(80,Math.floor(t*8/32)*10),T.push(v))}return A&&T.length&&(T.sort(function(g,h){return g.line==="auto"||h.line==="auto"?0:g.line>8&&h.line>8?h.line-g.line:g.line-h.line}),T.forEach(function(g){return Object(L.addCueToTrack)(A,g)})),T}};C.default=I},"./src/utils/discontinuities.ts":function(K,C,E){E.r(C),E.d(C,"findFirstFragWithCC",function(){return R}),E.d(C,"shouldAlignOnDiscontinuities",function(){return I}),E.d(C,"findDiscontinuousReferenceFrag",function(){return b}),E.d(C,"adjustSlidingStart",function(){return c}),E.d(C,"alignStream",function(){return S}),E.d(C,"alignPDT",function(){return T});var M=E("./src/polyfills/number.ts"),O=E("./src/utils/logger.ts"),L=E("./src/controller/level-helper.ts");function R(p,v){for(var s=null,t=0,r=p.length;t<r;t++){var e=p[t];if(e&&e.cc===v){s=e;break}}return s}function I(p,v,s){return!!(v.details&&(s.endCC>s.startCC||p&&p.cc<s.startCC))}function b(p,v){var s=p.fragments,t=v.fragments;if(!t.length||!s.length){O.logger.log("No fragments to align");return}var r=R(s,t[0].cc);if(!r||r&&!r.startPTS){O.logger.log("No frag in previous level to align on");return}return r}function A(p,v){if(p){var s=p.start+v;p.start=p.startPTS=s,p.endPTS=s+p.duration}}function c(p,v){for(var s=v.fragments,t=0,r=s.length;t<r;t++)A(s[t],p);v.fragmentHint&&A(v.fragmentHint,p),v.alignedSliding=!0}function S(p,v,s){!v||(y(p,s,v),!s.alignedSliding&&v.details&&T(s,v.details),!s.alignedSliding&&v.details&&!s.skippedSegments&&Object(L.adjustSliding)(v.details,s))}function y(p,v,s){if(I(p,s,v)){var t=b(s.details,v);t&&Object(M.isFiniteNumber)(t.start)&&(O.logger.log("Adjusting PTS using last level due to CC increase within current level "+v.url),c(t.start,v))}}function T(p,v){if(!(!v.fragments.length||!p.hasProgramDateTime||!v.hasProgramDateTime)){var s=v.fragments[0].programDateTime,t=p.fragments[0].programDateTime,r=(t-s)/1e3+v.fragments[0].start;r&&Object(M.isFiniteNumber)(r)&&(O.logger.log("Adjusting PTS using programDateTime delta "+(t-s)+"ms, sliding:"+r.toFixed(3)+" "+p.url+" "),c(r,p))}}},"./src/utils/ewma-bandwidth-estimator.ts":function(K,C,E){E.r(C);var M=E("./src/utils/ewma.ts"),O=function(){function L(I,b,A){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=A,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new M.default(I),this.fast_=new M.default(b)}var R=L.prototype;return R.update=function(b,A){var c=this.slow_,S=this.fast_;this.slow_.halfLife!==b&&(this.slow_=new M.default(b,c.getEstimate(),c.getTotalWeight())),this.fast_.halfLife!==A&&(this.fast_=new M.default(A,S.getEstimate(),S.getTotalWeight()))},R.sample=function(b,A){b=Math.max(b,this.minDelayMs_);var c=8*A,S=b/1e3,y=c/S;this.fast_.sample(S,y),this.slow_.sample(S,y)},R.canEstimate=function(){var b=this.fast_;return b&&b.getTotalWeight()>=this.minWeight_},R.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},R.destroy=function(){},L}();C.default=O},"./src/utils/ewma.ts":function(K,C,E){E.r(C);var M=function(){function O(R,I,b){I===void 0&&(I=0),b===void 0&&(b=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=R,this.alpha_=R?Math.exp(Math.log(.5)/R):0,this.estimate_=I,this.totalWeight_=b}var L=O.prototype;return L.sample=function(I,b){var A=Math.pow(this.alpha_,I);this.estimate_=b*(1-A)+A*this.estimate_,this.totalWeight_+=I},L.getTotalWeight=function(){return this.totalWeight_},L.getEstimate=function(){if(this.alpha_){var I=1-Math.pow(this.alpha_,this.totalWeight_);if(I)return this.estimate_/I}return this.estimate_},O}();C.default=M},"./src/utils/fetch-loader.ts":function(K,C,E){E.r(C),E.d(C,"fetchSupported",function(){return T});var M=E("./src/polyfills/number.ts"),O=E("./src/loader/load-stats.ts"),L=E("./src/demux/chunk-cache.ts");function R(r,e){r.prototype=Object.create(e.prototype),r.prototype.constructor=r,S(r,e)}function I(r){var e=typeof Map=="function"?new Map:void 0;return I=function(a){if(a===null||!c(a))return a;if(typeof a!="function")throw new TypeError("Super expression must either be null or a function");if(typeof e!="undefined"){if(e.has(a))return e.get(a);e.set(a,i)}function i(){return b(a,arguments,y(this).constructor)}return i.prototype=Object.create(a.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),S(i,a)},I(r)}function b(r,e,f){return A()?b=Reflect.construct:b=function(i,l,g){var h=[null];h.push.apply(h,l);var o=Function.bind.apply(i,h),n=new o;return g&&S(n,g.prototype),n},b.apply(null,arguments)}function A(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function c(r){return Function.toString.call(r).indexOf("[native code]")!==-1}function S(r,e){return S=Object.setPrototypeOf||function(a,i){return a.__proto__=i,a},S(r,e)}function y(r){return y=Object.setPrototypeOf?Object.getPrototypeOf:function(f){return f.__proto__||Object.getPrototypeOf(f)},y(r)}function T(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}var p=function(){function r(f){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=f.fetchSetup||s,this.controller=new self.AbortController,this.stats=new O.LoadStats}var e=r.prototype;return e.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},e.abortInternal=function(){var a=this.response;(!a||!a.ok)&&(this.stats.aborted=!0,this.controller.abort())},e.abort=function(){var a;this.abortInternal(),(a=this.callbacks)!==null&&a!==void 0&&a.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},e.load=function(a,i,l){var g=this,h=this.stats;if(h.loading.start)throw new Error("Loader can only be used once.");h.loading.start=self.performance.now();var o=v(a,this.controller.signal),n=l.onProgress,d=a.responseType==="arraybuffer",u=d?"byteLength":"length";this.context=a,this.config=i,this.callbacks=l,this.request=this.fetchSetup(a,o),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(function(){g.abortInternal(),l.onTimeout(h,a,g.response)},i.timeout),self.fetch(this.request).then(function(m){if(g.response=g.loader=m,!m.ok){var x=m.status,D=m.statusText;throw new t(D||"fetch, bad network response",x,m)}return h.loading.first=Math.max(self.performance.now(),h.loading.start),h.total=parseInt(m.headers.get("Content-Length")||"0"),n&&Object(M.isFiniteNumber)(i.highWaterMark)?g.loadProgressively(m,h,a,i.highWaterMark,n):d?m.arrayBuffer():m.text()}).then(function(m){var x=g.response;self.clearTimeout(g.requestTimeout),h.loading.end=Math.max(self.performance.now(),h.loading.first),h.loaded=h.total=m[u];var D={url:x.url,data:m};n&&!Object(M.isFiniteNumber)(i.highWaterMark)&&n(h,a,m,x),l.onSuccess(D,h,a,x)}).catch(function(m){if(self.clearTimeout(g.requestTimeout),!h.aborted){var x=m.code||0;l.onError({code:x,text:m.message},a,m.details)}})},e.getCacheAge=function(){var a=null;if(this.response){var i=this.response.headers.get("age");a=i?parseFloat(i):null}return a},e.loadProgressively=function(a,i,l,g,h){g===void 0&&(g=0);var o=new L.default,n=a.body.getReader(),d=function u(){return n.read().then(function(m){if(m.done)return o.dataLength&&h(i,l,o.flush(),a),Promise.resolve(new ArrayBuffer(0));var x=m.value,D=x.length;return i.loaded+=D,D<g||o.dataLength?(o.push(x),o.dataLength>=g&&h(i,l,o.flush(),a)):h(i,l,x,a),u()}).catch(function(){return Promise.reject()})};return d()},r}();function v(r,e){var f={method:"GET",mode:"cors",credentials:"same-origin",signal:e};return r.rangeEnd&&(f.headers=new self.Headers({Range:"bytes="+r.rangeStart+"-"+String(r.rangeEnd-1)})),f}function s(r,e){return new self.Request(r.url,e)}var t=function(r){R(e,r);function e(f,a,i){var l;return l=r.call(this,f)||this,l.code=void 0,l.details=void 0,l.code=a,l.details=i,l}return e}(I(Error));C.default=p},"./src/utils/imsc1-ttml-parser.ts":function(K,C,E){E.r(C),E.d(C,"IMSC1_CODEC",function(){return c}),E.d(C,"parseIMSC1",function(){return p});var M=E("./src/utils/mp4-tools.ts"),O=E("./src/utils/vttparser.ts"),L=E("./src/utils/vttcue.ts"),R=E("./src/demux/id3.ts"),I=E("./src/utils/timescale-conversion.ts"),b=E("./src/utils/webvtt-parser.ts");function A(){return A=Object.assign||function(h){for(var o=1;o<arguments.length;o++){var n=arguments[o];for(var d in n)Object.prototype.hasOwnProperty.call(n,d)&&(h[d]=n[d])}return h},A.apply(this,arguments)}var c="stpp.ttml.im1t",S=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,y=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,T={left:"start",center:"center",right:"end",start:"start",end:"end"};function p(h,o,n,d,u){var m=Object(M.findBox)(new Uint8Array(h),["mdat"]);if(m.length===0){u(new Error("Could not parse IMSC1 mdat"));return}var x=m[0],D=Object(R.utf8ArrayToStr)(new Uint8Array(h,x.start,x.end-x.start)),P=Object(I.toTimescaleFromScale)(o,1,n);try{d(v(D,P))}catch(_){u(_)}}function v(h,o){var n=new DOMParser,d=n.parseFromString(h,"text/xml"),u=d.getElementsByTagName("tt")[0];if(!u)throw new Error("Invalid ttml");var m={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},x=Object.keys(m).reduce(function(U,k){return U[k]=u.getAttribute("ttp:"+k)||m[k],U},{}),D=u.getAttribute("xml:space")!=="preserve",P=t(s(u,"styling","style")),_=t(s(u,"layout","region")),F=s(u,"body","[begin]");return[].map.call(F,function(U){var k=r(U,D);if(!k||!U.hasAttribute("begin"))return null;var N=i(U.getAttribute("begin"),x),w=i(U.getAttribute("dur"),x),V=i(U.getAttribute("end"),x);if(N===null)throw a(U);if(V===null){if(w===null)throw a(U);V=N+w}var W=new L.default(N-o,V-o,k);W.id=Object(b.generateCueId)(W.startTime,W.endTime,W.text);var Y=_[U.getAttribute("region")],j=P[U.getAttribute("style")];W.position=10,W.size=80;var X=e(Y,j),$=X.textAlign;if($){var Q=T[$];Q&&(W.lineAlign=Q),W.align=$}return A(W,X),W}).filter(function(U){return U!==null})}function s(h,o,n){var d=h.getElementsByTagName(o)[0];return d?[].slice.call(d.querySelectorAll(n)):[]}function t(h){return h.reduce(function(o,n){var d=n.getAttribute("xml:id");return d&&(o[d]=n),o},{})}function r(h,o){return[].slice.call(h.childNodes).reduce(function(n,d,u){var m;return d.nodeName==="br"&&u?n+`
`:(m=d.childNodes)!==null&&m!==void 0&&m.length?r(d,o):o?n+d.textContent.trim().replace(/\s+/g," "):n+d.textContent},"")}function e(h,o){var n="http://www.w3.org/ns/ttml#styling",d=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"];return d.reduce(function(u,m){var x=f(o,n,m)||f(h,n,m);return x&&(u[m]=x),u},{})}function f(h,o,n){return h.hasAttributeNS(o,n)?h.getAttributeNS(o,n):null}function a(h){return new Error("Could not parse ttml timestamp "+h)}function i(h,o){if(!h)return null;var n=Object(O.parseTimeStamp)(h);return n===null&&(S.test(h)?n=l(h,o):y.test(h)&&(n=g(h,o))),n}function l(h,o){var n=S.exec(h),d=(n[4]|0)+(n[5]|0)/o.subFrameRate;return(n[1]|0)*3600+(n[2]|0)*60+(n[3]|0)+d/o.frameRate}function g(h,o){var n=y.exec(h),d=Number(n[1]),u=n[2];switch(u){case"h":return d*3600;case"m":return d*60;case"ms":return d*1e3;case"f":return d/o.frameRate;case"t":return d/o.tickRate}return d}},"./src/utils/logger.ts":function(K,C,E){E.r(C),E.d(C,"enableLogs",function(){return b}),E.d(C,"logger",function(){return A});var M=function(){},O={trace:M,debug:M,log:M,warn:M,info:M,error:M},L=O;function R(c){var S=self.console[c];return S?S.bind(self.console,"["+c+"] >"):M}function I(c){for(var S=arguments.length,y=new Array(S>1?S-1:0),T=1;T<S;T++)y[T-1]=arguments[T];y.forEach(function(p){L[p]=c[p]?c[p].bind(c):R(p)})}function b(c){if(self.console&&c===!0||typeof c=="object"){I(c,"debug","log","info","warn","error");try{L.log()}catch{L=O}}else L=O}var A=L},"./src/utils/mediakeys-helper.ts":function(K,C,E){E.r(C),E.d(C,"KeySystems",function(){return M}),E.d(C,"requestMediaKeySystemAccess",function(){return O});var M;(function(L){L.WIDEVINE="com.widevine.alpha",L.PLAYREADY="com.microsoft.playready"})(M||(M={}));var O=function(){return typeof self!="undefined"&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}()},"./src/utils/mediasource-helper.ts":function(K,C,E){E.r(C),E.d(C,"getMediaSource",function(){return M});function M(){return self.MediaSource||self.WebKitMediaSource}},"./src/utils/mp4-tools.ts":function(K,C,E){E.r(C),E.d(C,"bin2str",function(){return I}),E.d(C,"readUint16",function(){return b}),E.d(C,"readUint32",function(){return A}),E.d(C,"writeUint32",function(){return c}),E.d(C,"findBox",function(){return S}),E.d(C,"parseSegmentIndex",function(){return y}),E.d(C,"parseInitSegment",function(){return T}),E.d(C,"getStartDTS",function(){return p}),E.d(C,"getDuration",function(){return v}),E.d(C,"computeRawDurationFromSamples",function(){return s}),E.d(C,"offsetStartDTS",function(){return t}),E.d(C,"segmentValidRange",function(){return r}),E.d(C,"appendUint8Array",function(){return e});var M=E("./src/utils/typed-array.ts"),O=E("./src/loader/fragment.ts"),L=Math.pow(2,32)-1,R=[].push;function I(f){return String.fromCharCode.apply(null,f)}function b(f,a){"data"in f&&(a+=f.start,f=f.data);var i=f[a]<<8|f[a+1];return i<0?65536+i:i}function A(f,a){"data"in f&&(a+=f.start,f=f.data);var i=f[a]<<24|f[a+1]<<16|f[a+2]<<8|f[a+3];return i<0?4294967296+i:i}function c(f,a,i){"data"in f&&(a+=f.start,f=f.data),f[a]=i>>24,f[a+1]=i>>16&255,f[a+2]=i>>8&255,f[a+3]=i&255}function S(f,a){var i=[];if(!a.length)return i;var l,g,h;"data"in f?(l=f.data,g=f.start,h=f.end):(l=f,g=0,h=l.byteLength);for(var o=g;o<h;){var n=A(l,o),d=I(l.subarray(o+4,o+8)),u=n>1?o+n:h;if(d===a[0])if(a.length===1)i.push({data:l,start:o+8,end:u});else{var m=S({data:l,start:o+8,end:u},a.slice(1));m.length&&R.apply(i,m)}o=u}return i}function y(f){var a=S(f,["moov"]),i=a[0],l=i?i.end:null,g=S(f,["sidx"]);if(!g||!g[0])return null;var h=[],o=g[0],n=o.data[0],d=n===0?8:16,u=A(o,d);d+=4;var m=0,x=0;n===0?d+=8:d+=16,d+=2;var D=o.end+x,P=b(o,d);d+=2;for(var _=0;_<P;_++){var F=d,U=A(o,F);F+=4;var k=U&2147483647,N=(U&2147483648)>>>31;if(N===1)return console.warn("SIDX has hierarchical references (not supported)"),null;var w=A(o,F);F+=4,h.push({referenceSize:k,subsegmentDuration:w,info:{duration:w/u,start:D,end:D+k-1}}),D+=k,F+=4,d=F}return{earliestPresentationTime:m,timescale:u,version:n,referencesCount:P,references:h,moovEndOffset:l}}function T(f){for(var a=[],i=S(f,["moov","trak"]),l=0;l<i.length;l++){var g=i[l],h=S(g,["tkhd"])[0];if(h){var o=h.data[h.start],n=o===0?12:20,d=A(h,n),u=S(g,["mdia","mdhd"])[0];if(u){o=u.data[u.start],n=o===0?12:20;var m=A(u,n),x=S(g,["mdia","hdlr"])[0];if(x){var D=I(x.data.subarray(x.start+8,x.start+12)),P={soun:O.ElementaryStreamTypes.AUDIO,vide:O.ElementaryStreamTypes.VIDEO}[D];if(P){var _=S(g,["mdia","minf","stbl","stsd"])[0],F=void 0;_&&(F=I(_.data.subarray(_.start+12,_.start+16))),a[d]={timescale:m,type:P},a[P]={timescale:m,id:d,codec:F}}}}}}var U=S(f,["moov","mvex","trex"]);return U.forEach(function(k){var N=A(k,4),w=a[N];w&&(w.default={duration:A(k,12),flags:A(k,20)})}),a}function p(f,a){return S(a,["moof","traf"]).reduce(function(i,l){var g=S(l,["tfdt"])[0],h=g.data[g.start],o=S(l,["tfhd"]).reduce(function(n,d){var u=A(d,4),m=f[u];if(m){var x=A(g,4);h===1&&(x*=Math.pow(2,32),x+=A(g,8));var D=m.timescale||9e4,P=x/D;if(isFinite(P)&&(n===null||P<n))return P}return n},null);return o!==null&&isFinite(o)&&(i===null||o<i)?o:i},null)||0}function v(f,a){for(var i=0,l=0,g=0,h=S(f,["moof","traf"]),o=0;o<h.length;o++){var n=h[o],d=S(n,["tfhd"])[0],u=A(d,4),m=a[u];if(!!m){var x=m.default,D=A(d,0)|(x==null?void 0:x.flags),P=x==null?void 0:x.duration;D&8&&(D&2?P=A(d,12):P=A(d,8));for(var _=m.timescale||9e4,F=S(n,["trun"]),U=0;U<F.length;U++){if(P){var k=A(F[U],4);i=P*k}else i=s(F[U]);m.type===O.ElementaryStreamTypes.VIDEO?l+=i/_:m.type===O.ElementaryStreamTypes.AUDIO&&(g+=i/_)}}}if(l===0&&g===0){var N=y(f);if(N!=null&&N.references)return N.references.reduce(function(w,V){return w+V.info.duration||0},0)}return l||g}function s(f){var a=A(f,0),i=8;a&1&&(i+=4),a&4&&(i+=4);for(var l=0,g=A(f,4),h=0;h<g;h++){if(a&256){var o=A(f,i);l+=o,i+=4}a&512&&(i+=4),a&1024&&(i+=4),a&2048&&(i+=4)}return l}function t(f,a,i){S(a,["moof","traf"]).forEach(function(l){S(l,["tfhd"]).forEach(function(g){var h=A(g,4),o=f[h];if(!!o){var n=o.timescale||9e4;S(l,["tfdt"]).forEach(function(d){var u=d.data[d.start],m=A(d,4);if(u===0)c(d,4,m-i*n);else{m*=Math.pow(2,32),m+=A(d,8),m-=i*n,m=Math.max(m,0);var x=Math.floor(m/(L+1)),D=Math.floor(m%(L+1));c(d,4,x),c(d,8,D)}})}})})}function r(f){var a={valid:null,remainder:null},i=S(f,["moof"]);if(i){if(i.length<2)return a.remainder=f,a}else return a;var l=i[i.length-1];return a.valid=Object(M.sliceUint8)(f,0,l.start-8),a.remainder=Object(M.sliceUint8)(f,l.start-8),a}function e(f,a){var i=new Uint8Array(f.length+a.length);return i.set(f),i.set(a,f.length),i}},"./src/utils/output-filter.ts":function(K,C,E){E.r(C),E.d(C,"default",function(){return M});var M=function(){function O(R,I){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=R,this.trackName=I}var L=O.prototype;return L.dispatchCue=function(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},L.newCue=function(I,b,A){(this.startTime===null||this.startTime>I)&&(this.startTime=I),this.endTime=b,this.screen=A,this.timelineController.createCaptionsTrack(this.trackName)},L.reset=function(){this.cueRanges=[]},O}()},"./src/utils/texttrack-utils.ts":function(K,C,E){E.r(C),E.d(C,"sendAddTrackEvent",function(){return O}),E.d(C,"addCueToTrack",function(){return L}),E.d(C,"clearCurrentCues",function(){return R}),E.d(C,"removeCuesInRange",function(){return I}),E.d(C,"getCuesInRange",function(){return A});var M=E("./src/utils/logger.ts");function O(c,S){var y;try{y=new Event("addtrack")}catch{y=document.createEvent("Event"),y.initEvent("addtrack",!1,!1)}y.track=c,S.dispatchEvent(y)}function L(c,S){var y=c.mode;if(y==="disabled"&&(c.mode="hidden"),c.cues&&!c.cues.getCueById(S.id))try{if(c.addCue(S),!c.cues.getCueById(S.id))throw new Error("addCue is failed for: "+S)}catch(p){M.logger.debug("[texttrack-utils]: "+p);var T=new self.TextTrackCue(S.startTime,S.endTime,S.text);T.id=S.id,c.addCue(T)}y==="disabled"&&(c.mode=y)}function R(c){var S=c.mode;if(S==="disabled"&&(c.mode="hidden"),c.cues)for(var y=c.cues.length;y--;)c.removeCue(c.cues[y]);S==="disabled"&&(c.mode=S)}function I(c,S,y){var T=c.mode;if(T==="disabled"&&(c.mode="hidden"),c.cues&&c.cues.length>0)for(var p=A(c.cues,S,y),v=0;v<p.length;v++)c.removeCue(p[v]);T==="disabled"&&(c.mode=T)}function b(c,S){if(S<c[0].startTime)return 0;var y=c.length-1;if(S>c[y].endTime)return-1;for(var T=0,p=y;T<=p;){var v=Math.floor((p+T)/2);if(S<c[v].startTime)p=v-1;else if(S>c[v].startTime&&T<y)T=v+1;else return v}return c[T].startTime-S<S-c[p].startTime?T:p}function A(c,S,y){var T=[],p=b(c,S);if(p>-1)for(var v=p,s=c.length;v<s;v++){var t=c[v];if(t.startTime>=S&&t.endTime<=y)T.push(t);else if(t.startTime>y)return T}return T}},"./src/utils/time-ranges.ts":function(K,C,E){E.r(C);var M={toString:function(L){for(var R="",I=L.length,b=0;b<I;b++)R+="["+L.start(b).toFixed(3)+","+L.end(b).toFixed(3)+"]";return R}};C.default=M},"./src/utils/timescale-conversion.ts":function(K,C,E){E.r(C),E.d(C,"toTimescaleFromBase",function(){return O}),E.d(C,"toTimescaleFromScale",function(){return L}),E.d(C,"toMsFromMpegTsClock",function(){return R}),E.d(C,"toMpegTsClockFromTimescale",function(){return I});var M=9e4;function O(b,A,c,S){c===void 0&&(c=1),S===void 0&&(S=!1);var y=b*A*c;return S?Math.round(y):y}function L(b,A,c,S){return c===void 0&&(c=1),S===void 0&&(S=!1),O(b,A,1/c,S)}function R(b,A){return A===void 0&&(A=!1),O(b,1e3,1/M,A)}function I(b,A){return A===void 0&&(A=1),O(b,M,1/A)}},"./src/utils/typed-array.ts":function(K,C,E){E.r(C),E.d(C,"sliceUint8",function(){return M});function M(O,L,R){return Uint8Array.prototype.slice?O.slice(L,R):new Uint8Array(Array.prototype.slice.call(O,L,R))}},"./src/utils/vttcue.ts":function(K,C,E){E.r(C),C.default=function(){if(typeof self!="undefined"&&self.VTTCue)return self.VTTCue;var M=["","lr","rl"],O=["start","middle","end","left","right"];function L(c,S){if(typeof S!="string"||!Array.isArray(c))return!1;var y=S.toLowerCase();return~c.indexOf(y)?y:!1}function R(c){return L(M,c)}function I(c){return L(O,c)}function b(c){for(var S=arguments.length,y=new Array(S>1?S-1:0),T=1;T<S;T++)y[T-1]=arguments[T];for(var p=1;p<arguments.length;p++){var v=arguments[p];for(var s in v)c[s]=v[s]}return c}function A(c,S,y){var T=this,p={enumerable:!0};T.hasBeenReset=!1;var v="",s=!1,t=c,r=S,e=y,f=null,a="",i=!0,l="auto",g="start",h=50,o="middle",n=50,d="middle";Object.defineProperty(T,"id",b({},p,{get:function(){return v},set:function(m){v=""+m}})),Object.defineProperty(T,"pauseOnExit",b({},p,{get:function(){return s},set:function(m){s=!!m}})),Object.defineProperty(T,"startTime",b({},p,{get:function(){return t},set:function(m){if(typeof m!="number")throw new TypeError("Start time must be set to a number.");t=m,this.hasBeenReset=!0}})),Object.defineProperty(T,"endTime",b({},p,{get:function(){return r},set:function(m){if(typeof m!="number")throw new TypeError("End time must be set to a number.");r=m,this.hasBeenReset=!0}})),Object.defineProperty(T,"text",b({},p,{get:function(){return e},set:function(m){e=""+m,this.hasBeenReset=!0}})),Object.defineProperty(T,"region",b({},p,{get:function(){return f},set:function(m){f=m,this.hasBeenReset=!0}})),Object.defineProperty(T,"vertical",b({},p,{get:function(){return a},set:function(m){var x=R(m);if(x===!1)throw new SyntaxError("An invalid or illegal string was specified.");a=x,this.hasBeenReset=!0}})),Object.defineProperty(T,"snapToLines",b({},p,{get:function(){return i},set:function(m){i=!!m,this.hasBeenReset=!0}})),Object.defineProperty(T,"line",b({},p,{get:function(){return l},set:function(m){if(typeof m!="number"&&m!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");l=m,this.hasBeenReset=!0}})),Object.defineProperty(T,"lineAlign",b({},p,{get:function(){return g},set:function(m){var x=I(m);if(!x)throw new SyntaxError("An invalid or illegal string was specified.");g=x,this.hasBeenReset=!0}})),Object.defineProperty(T,"position",b({},p,{get:function(){return h},set:function(m){if(m<0||m>100)throw new Error("Position must be between 0 and 100.");h=m,this.hasBeenReset=!0}})),Object.defineProperty(T,"positionAlign",b({},p,{get:function(){return o},set:function(m){var x=I(m);if(!x)throw new SyntaxError("An invalid or illegal string was specified.");o=x,this.hasBeenReset=!0}})),Object.defineProperty(T,"size",b({},p,{get:function(){return n},set:function(m){if(m<0||m>100)throw new Error("Size must be between 0 and 100.");n=m,this.hasBeenReset=!0}})),Object.defineProperty(T,"align",b({},p,{get:function(){return d},set:function(m){var x=I(m);if(!x)throw new SyntaxError("An invalid or illegal string was specified.");d=x,this.hasBeenReset=!0}})),T.displayState=void 0}return A.prototype.getCueAsHTML=function(){var c=self.WebVTT;return c.convertCueToDOMTree(self,this.text)},A}()},"./src/utils/vttparser.ts":function(K,C,E){E.r(C),E.d(C,"parseTimeStamp",function(){return L}),E.d(C,"fixLineBreaks",function(){return S}),E.d(C,"VTTParser",function(){return y});var M=E("./src/utils/vttcue.ts"),O=function(){function T(){}var p=T.prototype;return p.decode=function(s,t){if(!s)return"";if(typeof s!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(s))},T}();function L(T){function p(s,t,r,e){return(s|0)*3600+(t|0)*60+(r|0)+parseFloat(e||0)}var v=T.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return v?parseFloat(v[2])>59?p(v[2],v[3],0,v[4]):p(v[1],v[2],v[3],v[4]):null}var R=function(){function T(){this.values=Object.create(null)}var p=T.prototype;return p.set=function(s,t){!this.get(s)&&t!==""&&(this.values[s]=t)},p.get=function(s,t,r){return r?this.has(s)?this.values[s]:t[r]:this.has(s)?this.values[s]:t},p.has=function(s){return s in this.values},p.alt=function(s,t,r){for(var e=0;e<r.length;++e)if(t===r[e]){this.set(s,t);break}},p.integer=function(s,t){/^-?\d+$/.test(t)&&this.set(s,parseInt(t,10))},p.percent=function(s,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){var r=parseFloat(t);if(r>=0&&r<=100)return this.set(s,r),!0}return!1},T}();function I(T,p,v,s){var t=s?T.split(s):[T];for(var r in t)if(typeof t[r]=="string"){var e=t[r].split(v);if(e.length===2){var f=e[0],a=e[1];p(f,a)}}}var b=new M.default(0,0,""),A=b.align==="middle"?"middle":"center";function c(T,p,v){var s=T;function t(){var f=L(T);if(f===null)throw new Error("Malformed timestamp: "+s);return T=T.replace(/^[^\sa-zA-Z-]+/,""),f}function r(f,a){var i=new R;I(f,function(h,o){var n;switch(h){case"region":for(var d=v.length-1;d>=0;d--)if(v[d].id===o){i.set(h,v[d].region);break}break;case"vertical":i.alt(h,o,["rl","lr"]);break;case"line":n=o.split(","),i.integer(h,n[0]),i.percent(h,n[0])&&i.set("snapToLines",!1),i.alt(h,n[0],["auto"]),n.length===2&&i.alt("lineAlign",n[1],["start",A,"end"]);break;case"position":n=o.split(","),i.percent(h,n[0]),n.length===2&&i.alt("positionAlign",n[1],["start",A,"end","line-left","line-right","auto"]);break;case"size":i.percent(h,o);break;case"align":i.alt(h,o,["start",A,"end","left","right"]);break}},/:/,/\s/),a.region=i.get("region",null),a.vertical=i.get("vertical","");var l=i.get("line","auto");l==="auto"&&b.line===-1&&(l=-1),a.line=l,a.lineAlign=i.get("lineAlign","start"),a.snapToLines=i.get("snapToLines",!0),a.size=i.get("size",100),a.align=i.get("align",A);var g=i.get("position","auto");g==="auto"&&b.position===50&&(g=a.align==="start"||a.align==="left"?0:a.align==="end"||a.align==="right"?100:50),a.position=g}function e(){T=T.replace(/^\s+/,"")}if(e(),p.startTime=t(),e(),T.substr(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+s);T=T.substr(3),e(),p.endTime=t(),e(),r(T,p)}function S(T){return T.replace(/<br(?: \/)?>/gi,`
`)}var y=function(){function T(){this.state="INITIAL",this.buffer="",this.decoder=new O,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var p=T.prototype;return p.parse=function(s){var t=this;s&&(t.buffer+=t.decoder.decode(s,{stream:!0}));function r(){var g=t.buffer,h=0;for(g=S(g);h<g.length&&g[h]!=="\r"&&g[h]!==`
`;)++h;var o=g.substr(0,h);return g[h]==="\r"&&++h,g[h]===`
`&&++h,t.buffer=g.substr(h),o}function e(g){I(g,function(h,o){},/:/)}try{var f="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;f=r();var a=f.match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!a||!a[0])throw new Error("Malformed WebVTT signature.");t.state="HEADER"}for(var i=!1;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(i?i=!1:f=r(),t.state){case"HEADER":/:/.test(f)?e(f):f||(t.state="ID");continue;case"NOTE":f||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(f)){t.state="NOTE";break}if(!f)continue;if(t.cue=new M.default(0,0,""),t.state="CUE",f.indexOf("-->")===-1){t.cue.id=f;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{c(f,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{var l=f.indexOf("-->")!==-1;if(!f||l&&(i=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=f}continue;case"BADCUE":f||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},p.flush=function(){var s=this;try{if((s.cue||s.state==="HEADER")&&(s.buffer+=`

`,s.parse()),s.state==="INITIAL"||s.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){s.onparsingerror&&s.onparsingerror(t)}return s.onflush&&s.onflush(),this},T}()},"./src/utils/webvtt-parser.ts":function(K,C,E){E.r(C),E.d(C,"generateCueId",function(){return y}),E.d(C,"parseWebVTT",function(){return p});var M=E("./src/polyfills/number.ts"),O=E("./src/utils/vttparser.ts"),L=E("./src/demux/id3.ts"),R=E("./src/utils/timescale-conversion.ts"),I=E("./src/remux/mp4-remuxer.ts"),b=/\r\n|\n\r|\n|\r/g,A=function(s,t,r){return r===void 0&&(r=0),s.substr(r,t.length)===t},c=function(s){var t=parseInt(s.substr(-3)),r=parseInt(s.substr(-6,2)),e=parseInt(s.substr(-9,2)),f=s.length>9?parseInt(s.substr(0,s.indexOf(":"))):0;if(!Object(M.isFiniteNumber)(t)||!Object(M.isFiniteNumber)(r)||!Object(M.isFiniteNumber)(e)||!Object(M.isFiniteNumber)(f))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+s);return t+=1e3*r,t+=60*1e3*e,t+=60*60*1e3*f,t},S=function(s){for(var t=5381,r=s.length;r;)t=t*33^s.charCodeAt(--r);return(t>>>0).toString()};function y(v,s,t){return S(v.toString())+S(s.toString())+S(t)}var T=function(s,t,r){var e=s[t],f=s[e.prevCC];if(!f||!f.new&&e.new){s.ccOffset=s.presentationOffset=e.start,e.new=!1;return}for(;(a=f)!==null&&a!==void 0&&a.new;){var a;s.ccOffset+=e.start-f.start,e.new=!1,e=f,f=s[e.prevCC]}s.presentationOffset=r};function p(v,s,t,r,e,f,a,i){var l=new O.VTTParser,g=Object(L.utf8ArrayToStr)(new Uint8Array(v)).trim().replace(b,`
`).split(`
`),h=[],o=Object(R.toMpegTsClockFromTimescale)(s,t),n="00:00.000",d=0,u=0,m,x=!0,D=!1;l.oncue=function(P){var _=r[e],F=r.ccOffset,U=(d-o)/9e4;if(_!=null&&_.new&&(u!==void 0?F=r.ccOffset=_.start:T(r,e,U)),U&&(F=U-r.presentationOffset),D){var k=P.endTime-P.startTime,N=Object(I.normalizePts)((P.startTime+F-u)*9e4,f*9e4)/9e4;P.startTime=N,P.endTime=N+k}var w=P.text.trim();P.text=decodeURIComponent(encodeURIComponent(w)),P.id||(P.id=y(P.startTime,P.endTime,w)),P.endTime>0&&h.push(P)},l.onparsingerror=function(P){m=P},l.onflush=function(){if(m){i(m);return}a(h)},g.forEach(function(P){if(x)if(A(P,"X-TIMESTAMP-MAP=")){x=!1,D=!0,P.substr(16).split(",").forEach(function(_){A(_,"LOCAL:")?n=_.substr(6):A(_,"MPEGTS:")&&(d=parseInt(_.substr(7)))});try{u=c(n)/1e3}catch(_){D=!1,m=_}return}else P===""&&(x=!1);l.parse(P+`
`)}),l.flush()}},"./src/utils/xhr-loader.ts":function(K,C,E){E.r(C);var M=E("./src/utils/logger.ts"),O=E("./src/loader/load-stats.ts"),L=/^age:\s*[\d.]+\s*$/m,R=function(){function I(A){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=A?A.xhrSetup:null,this.stats=new O.LoadStats,this.retryDelay=0}var b=I.prototype;return b.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},b.abortInternal=function(){var c=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),c&&(c.onreadystatechange=null,c.onprogress=null,c.readyState!==4&&(this.stats.aborted=!0,c.abort()))},b.abort=function(){var c;this.abortInternal(),(c=this.callbacks)!==null&&c!==void 0&&c.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},b.load=function(c,S,y){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=c,this.config=S,this.callbacks=y,this.retryDelay=S.retryDelay,this.loadInternal()},b.loadInternal=function(){var c=this.config,S=this.context;if(!!c){var y=this.loader=new self.XMLHttpRequest,T=this.stats;T.loading.first=0,T.loaded=0;var p=this.xhrSetup;try{if(p)try{p(y,S.url)}catch{y.open("GET",S.url,!0),p(y,S.url)}y.readyState||y.open("GET",S.url,!0)}catch(v){this.callbacks.onError({code:y.status,text:v.message},S,y);return}S.rangeEnd&&y.setRequestHeader("Range","bytes="+S.rangeStart+"-"+(S.rangeEnd-1)),y.onreadystatechange=this.readystatechange.bind(this),y.onprogress=this.loadprogress.bind(this),y.responseType=S.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),c.timeout),y.send()}},b.readystatechange=function(){var c=this.context,S=this.loader,y=this.stats;if(!(!c||!S)){var T=S.readyState,p=this.config;if(!y.aborted&&T>=2)if(self.clearTimeout(this.requestTimeout),y.loading.first===0&&(y.loading.first=Math.max(self.performance.now(),y.loading.start)),T===4){S.onreadystatechange=null,S.onprogress=null;var v=S.status;if(v>=200&&v<300){y.loading.end=Math.max(self.performance.now(),y.loading.first);var s,t;if(c.responseType==="arraybuffer"?(s=S.response,t=s.byteLength):(s=S.responseText,t=s.length),y.loaded=y.total=t,!this.callbacks)return;var r=this.callbacks.onProgress;if(r&&r(y,c,s,S),!this.callbacks)return;var e={url:S.responseURL,data:s};this.callbacks.onSuccess(e,y,c,S)}else y.retry>=p.maxRetry||v>=400&&v<499?(M.logger.error(v+" while loading "+c.url),this.callbacks.onError({code:v,text:S.statusText},c,S)):(M.logger.warn(v+" while loading "+c.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,p.maxRetryDelay),y.retry++)}else self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),p.timeout)}},b.loadtimeout=function(){M.logger.warn("timeout while loading "+this.context.url);var c=this.callbacks;c&&(this.abortInternal(),c.onTimeout(this.stats,this.context,this.loader))},b.loadprogress=function(c){var S=this.stats;S.loaded=c.loaded,c.lengthComputable&&(S.total=c.total)},b.getCacheAge=function(){var c=null;if(this.loader&&L.test(this.loader.getAllResponseHeaders())){var S=this.loader.getResponseHeader("age");c=S?parseFloat(S):null}return c},I}();C.default=R}}).default})})(Xe);var Ve=it(Xe.exports),kr=(()=>`@font-face{font-family:iconfont;src:url(data:font/woff2;base64,d09GMgABAAAAAAf8AAsAAAAAD4AAAAesAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHFQGYACENAqQFI0gATYCJAMwCxoABCAFhGcHgRgbMA2jopRwhpH9xYEN7tEpwmIWXYlFbb0abbZI79LiOw8i759JE179cG04wTl4/lv73fdGdx1R7dBpePptO1IS0ROpEcucKY175977I5ZAEaYoB0Q+Sa9AyUuuH/ScmnFzExLIzqhN/27WA9pOSYBUSFMxoWIeqfuqJXeerBhQVrSma0bPHPxEe3/ryvP/O+8/vROmlEQSRRMb+GBOkyUgmdUv+7V8hmli/aG/EQqjplPxhHhyzZqoot6oROqNaqXSKgZrk2NVhFlY/ZvcBwGlU5v65uH5PUwdTjXMG8CGCvxoOVnCYeQmYnMKReR61X3j5QMHvfVHAO926uUnuiIo12AXut4HEbykIr8L6H/aqH1DN1cH6ytwwIDDgUnkzVf9Mi7j0GaVaYnWE2DczO1k+hWpS8cpyCzf5CG/v3tHvNa6IaYQ47zm7FpAEBVKVWcVleX4f16HsmrgftwVUiERBKQaQURqmOSxWwgowe5AqsY+hgAD9hkQCPIqAkW+QWCRBwQO+b0zfkj7zAJ2gT5gJrCcEZcy6q0k3pSWkWHj8nBmZvSUUTb8osN2s7NDvrdXy9Nj4OEpqIEIvRY3HgSKcZQwjtJS3DAytmYBP1FU9L3/95QyIMBkIg04lxMG42lHgjNnKzFOrpIelGoMuImUo5gYJWZmUln8gHHvebdwWjfAxMiUA08YhQPUsgelIOQoXHGTqgkpVLI6d55j9PHwK3FoAKBNZegLJupaYE4OgIPZDEU4VcoVnJw+yCoYJen8nooeZg8xh1dw1+lr7A1GPcBNDk+wU8z0R01PQJedZwEdOML6T/GY+RYOlQNVsVO4MJiynUNHad+DrMMYE6DECxPPp6YsmfmLfp2jszO+HSMX5vo5LbCgYXV9bicOrFDPI+TcNONAwuZOU5CInQB8k9z0KgEz9ZSDFCihUQLabhIWc9NrYIEIVIt5EDeskrA3qt9YDSPcdWDh2noLxHILj1c9ftyZVExBrBQf8ycPXZmJm19yxEd8SYWUnZDiw0f9KkHFyBEnQj4Jcxg16keoLs9e4FUXajyAkA/hOBh1+Jg/Tl5LwCHyShpOUqd85NsS6mQKJi6nUgR+0pNoYU0mxmzmjEZAGzSGurFL12bo2euXuavqeWbuxpUtKbNGQ2iq2mxKa2AdyOXblidgpmGYUnKTwMpEF0wUhCW+Sl/MlhKt0VCRaqbMpInEKxD6pEgh8IGMIZ3sKPbsO/4vhZPlndlsfQomL4051Z+cnFZpte02mX84Q8W1f5S7vYclBFYebq0HtaA4rCgkWDBKvPeaGbmxvnFjdCbI3Zqgv6QTvUUL7L0a5TmVoBTsSRkYStwLSjNLLKTOxQPr9mdUgALwUWxvm3tmT8FIqQ+I/vy5X6tMeE7iu1gRZnVOOLPKskb4PWbpek46J8lysdRZnctd0dXPIVtIdd8P3BB4TlLsQCz/PvQXdA4U+IFAO6tPRJy+kcbtFQmnbWZsp/HBt5RDf6N/299F71a8L1l2XHZ56PjwpMl5c/zm2L74vuE4iUzk6ypzk+373pWIJ+O74jvzg5EPfTfYIJQ3ZXfEednV2RMJQTydXZdZZ5sf/kT5rD/LR//8IYRA7yIxyJ3gO4hMcpcWSq+GXQu8FnYVaAqGXFcy2/8J325tba7MrARhjwNI/0h/srSLqLq+97+wSqPbAeMXczfUk+457lOffTaLYMcchIfgiDVCuOeqGCGCv/VzN25M3YXuk5nY3BWAekcGABlLarWx7FJG+g7amXCWcpWaZn8xiOP1ODp96TF4tnjHdo0tvL/UKaXIpjyuBFNgKXlIeV1KsfP+E7aa7cU7Tg+4X4w657FNCafER/j7IWTtLjju2vlB35b76OphdNX9lsqnaAdZwjBkmd14UtyqdBkVE0P1CLzF7HEvIPN3zSPyXP3S9y7nhMvCc5Zl9s1AdHTIS719PVb38Nacx0bnzXtO9YhVj54Yxd7iDEk3etkq57gf05ckk19/MyKOOSlZAnFV26xDvZQBytrbGblYPVZrz+eiIbVgcUszxV+IP038VPwFSOM9+nE1q2/0OVTdhzPtuA8A8O6xMQtEAACCXfwXYdxOlYz/1C6O4D8pXsl/IKQFVVxL5oIgA7hu3A+of8ma1Hq23rt8sxlJeWINH7gm/VW87WtqfLfUIqiHESmuJC3JjV0Ax6AOMHUdckh2cyWpsqb29qd0KCh5J9CJdON+u+BMKJP1P86EDypYACNaR1ncPjiVc/CiCygdODi4MkHrJymAbU8ERO8ZVOsPjN4ryuLewJn2B17vH0qPNXm8ynYNewY5YcREj2VS1bHgkr3UW0yakpsk+yMam8HKAtePeo+wRlPHDradhEQxi42q2OHlYliWimmjcpTkpkR61fPitB1cqSrYYyCOzIoRRuhVz0hKLe6Ywp/vFko0SpxRRD0qDHsi0qUzAZevgDpi1UoNDiTRakuEiCpiTDIMZVQu5/CjQCV3KYxOXyuHJOJKKzi0VR7tKFZlud1zqt09CyixV65LxYgVJ16CRCmklEpqafAX6pL3+nWmh0vFo6xOBiLnGNS8sThkpUGsxzooHM8xYpGowAF2vK3KpkInUp169CVtdEpQ1RACAAAAAA==) format("woff2")}.iconfont[data-v-0c690e66]{font-family:iconfont!important;font-size:16px;font-style:normal;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.icon-replay[data-v-0c690e66]:before{content:"\\e631"}.icon-pip[data-v-0c690e66]:before{content:"\\e820"}.icon-loading[data-v-0c690e66]:before{content:"\\e62e"}.icon-play[data-v-0c690e66]:before{content:"\\e851"}.icon-pause[data-v-0c690e66]:before{content:"\\e863"}.icon-screen[data-v-0c690e66]:before{content:"\\e88f"}.icon-web-screen[data-v-0c690e66]:before{content:"\\e609"}.icon-settings[data-v-0c690e66]:before{content:"\\e60c"}.icon-volume-down[data-v-0c690e66]:before{content:"\\e60d"}.icon-volume-up[data-v-0c690e66]:before{content:"\\e60e"}.icon-volume-mute[data-v-0c690e66]:before{content:"\\e60f"}.d-icon[data-v-0c690e66]{display:inline-block;cursor:pointer;overflow:hidden}
`)(),Ae=(G,H)=>{const K=G.__vccOpts||G;for(const[C,E]of H)K[C]=E;return K},ye=Ae(Object.assign({name:"d-icon"},{props:{icon:String,size:[Number,String]},setup(G){const H=G,K=B.computed(()=>({fontSize:/^\d+$/.test(H.size)?H.size+"px":H.size}));return(C,E)=>(B.openBlock(),B.createElementBlock("i",{class:B.normalizeClass(["d-icon iconfont",G.icon]),style:B.normalizeStyle(B.unref(K))},null,6))}}),[["__scopeId","data-v-0c690e66"]]),Kr=(()=>`.d-player-top[data-v-4cb76d59]{position:absolute;font-size:16px;left:0px;top:0;right:0px;color:#fff;display:flex;padding:0 20px;height:60px;background-image:linear-gradient(rgba(0,0,0,.6),transparent);justify-content:space-between}
`)();const nt={class:"d-player-top"},at={class:"top-title"},st={class:"top-title"};var ot=Ae({__name:"d-player-top",props:{title:{default:""}},setup(G){Date.prototype.format=function(C){let E={"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds()};for(var M in E)new RegExp("("+M+")").test(C)&&(C=C.replace(RegExp.$1,RegExp.$1.length==1?E[M]:("00"+E[M]).substr((""+E[M]).length)));return C};let H=B.ref("00:00:00");H.value=new Date().format("hh:mm:ss");let K=null;return K=setInterval(()=>{H.value=new Date().format("hh:mm:ss")},1e3),B.onUnmounted(()=>{clearInterval(K)}),(C,E)=>(B.openBlock(),B.createElementBlock("div",nt,[B.createElementVNode("p",at,B.toDisplayString(G.title||""),1),B.createElementVNode("p",st,B.toDisplayString(B.unref(H)),1)]))}},[["__scopeId","data-v-4cb76d59"]]),Vr=(()=>`.iconfont[data-v-ac2469ec]{display:inline-block}.d-flex-x[data-v-ac2469ec],.d-flex-y[data-v-ac2469ec],.d-flex-center[data-v-ac2469ec]{display:flex}.d-flex-x[data-v-ac2469ec]{align-items:center}.d-flex-y[data-v-ac2469ec]{justify-content:center}.d-flex-center[data-v-ac2469ec]{justify-content:center;align-items:center}.mr5[data-v-ac2469ec]{margin-right:5px}.mr10[data-v-ac2469ec]{margin-right:10px}.ml5[data-v-ac2469ec]{margin-left:5px}.ml10[data-v-ac2469ec]{margin-left:10px}.d-pointer[data-v-ac2469ec]{cursor:pointer}.d-status[data-v-ac2469ec]{text-align:center;font-size:14px;vertical-align:middle;background:rgba(0,0,0,.8);padding:0 8px;height:30px;border-radius:5px;display:flex;align-items:center;color:#fffffff2}.d-status .d-status-icon[data-v-ac2469ec]{width:24px!important;display:inline-block;margin-right:5px}
`)();const lt={class:"d-status"},dt={class:"d-flex-center"},ut={class:"d-flex-center"},ft=B.createTextVNode("5X\u901F\u64AD\u653E\u4E2D ");var ct=Ae(B.defineComponent({__name:"d-status",props:["state"],setup(G){return(H,K)=>B.withDirectives((B.openBlock(),B.createElementBlock("div",lt,[B.withDirectives(B.createElementVNode("li",dt,[B.createVNode(ye,{size:"18",class:"d-status-icon",icon:`icon-volume-${G.state.volume==0?"mute":G.state.volume>.5?"up":"down"}`},null,8,["icon"]),B.createTextVNode(" "+B.toDisplayString(~~(G.state.volume*100))+"% ",1)],512),[[B.vShow,G.state.handleType=="volume"]]),B.withDirectives(B.createElementVNode("li",ut,[B.createVNode(ye,{size:"12",icon:"icon-play"}),B.createVNode(ye,{size:"12",icon:"icon-play",style:{"margin-right":"5px"}}),ft],512),[[B.vShow,G.state.handleType=="playbackRate"||G.state.isMultiplesPlay]])],512)),[[B.vShow,G.state.handleType||G.state.isMultiplesPlay]])}}),[["__scopeId","data-v-ac2469ec"]]),Hr=(()=>`.d-switch[data-v-385f7870]{position:relative;height:18px;transition:background .2s;width:var(--014e5dc0);background:#757575;border-radius:10px;display:inline-flex;align-items:center;vertical-align:middle}.d-switch .d-switch__input[data-v-385f7870]{position:relative;z-index:1;margin:0;width:100%;height:100%;opacity:0}.d-switch .d-switch_action[data-v-385f7870]{position:absolute;transition:.2s;left:2px;top:2px;z-index:0;height:14px;width:14px;background:#fff;border-radius:50%}.d-switch.is-checked[data-v-385f7870]{background:var(--e4e32852)}.d-switch.is-checked .d-switch_action[data-v-385f7870]{left:100%;background:#fff;margin-left:-18px}
`)();const ht=G=>(B.pushScopeId("data-v-385f7870"),G=G(),B.popScopeId(),G),vt=["checked","true-value","false-value"],gt=ht(()=>B.createElementVNode("span",{class:"d-switch_action"},null,-1));var Ge=Ae(B.defineComponent({__name:"d-switch",props:{modelValue:{type:[Number,String,Boolean]},width:{type:String,default:"40px"},trueValue:{type:[Number,String,Boolean],default:!0},falseValue:{type:[Number,String,Boolean],default:!0},activeColor:{type:[String],default:"#409EFF"}},emits:["update:modelValue","change"],setup(G,{emit:H}){const K=G;B.useCssVars(O=>({"014e5dc0":G.width,e4e32852:G.activeColor}));const C=B.ref(null),E=B.computed(()=>K.modelValue===K.trueValue),M=()=>{B.nextTick(()=>{const O=C.value.checked;H("update:modelValue",O),H("change",O)})};return(O,L)=>(B.openBlock(),B.createElementBlock("div",{class:B.normalizeClass(["d-switch",{"is-checked":B.unref(E)}])},[B.createElementVNode("input",{class:"d-switch__input",ref_key:"input",ref:C,type:"checkbox",checked:B.unref(E),onChange:M,"true-value":G.trueValue,"false-value":G.falseValue},null,40,vt),gt],2))}}),[["__scopeId","data-v-385f7870"]]),Yr=(()=>`@font-face{font-family:iconfont;src:url(data:font/woff2;base64,d09GMgABAAAAAAf8AAsAAAAAD4AAAAesAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHFQGYACENAqQFI0gATYCJAMwCxoABCAFhGcHgRgbMA2jopRwhpH9xYEN7tEpwmIWXYlFbb0abbZI79LiOw8i759JE179cG04wTl4/lv73fdGdx1R7dBpePptO1IS0ROpEcucKY175977I5ZAEaYoB0Q+Sa9AyUuuH/ScmnFzExLIzqhN/27WA9pOSYBUSFMxoWIeqfuqJXeerBhQVrSma0bPHPxEe3/ryvP/O+8/vROmlEQSRRMb+GBOkyUgmdUv+7V8hmli/aG/EQqjplPxhHhyzZqoot6oROqNaqXSKgZrk2NVhFlY/ZvcBwGlU5v65uH5PUwdTjXMG8CGCvxoOVnCYeQmYnMKReR61X3j5QMHvfVHAO926uUnuiIo12AXut4HEbykIr8L6H/aqH1DN1cH6ytwwIDDgUnkzVf9Mi7j0GaVaYnWE2DczO1k+hWpS8cpyCzf5CG/v3tHvNa6IaYQ47zm7FpAEBVKVWcVleX4f16HsmrgftwVUiERBKQaQURqmOSxWwgowe5AqsY+hgAD9hkQCPIqAkW+QWCRBwQO+b0zfkj7zAJ2gT5gJrCcEZcy6q0k3pSWkWHj8nBmZvSUUTb8osN2s7NDvrdXy9Nj4OEpqIEIvRY3HgSKcZQwjtJS3DAytmYBP1FU9L3/95QyIMBkIg04lxMG42lHgjNnKzFOrpIelGoMuImUo5gYJWZmUln8gHHvebdwWjfAxMiUA08YhQPUsgelIOQoXHGTqgkpVLI6d55j9PHwK3FoAKBNZegLJupaYE4OgIPZDEU4VcoVnJw+yCoYJen8nooeZg8xh1dw1+lr7A1GPcBNDk+wU8z0R01PQJedZwEdOML6T/GY+RYOlQNVsVO4MJiynUNHad+DrMMYE6DECxPPp6YsmfmLfp2jszO+HSMX5vo5LbCgYXV9bicOrFDPI+TcNONAwuZOU5CInQB8k9z0KgEz9ZSDFCihUQLabhIWc9NrYIEIVIt5EDeskrA3qt9YDSPcdWDh2noLxHILj1c9ftyZVExBrBQf8ycPXZmJm19yxEd8SYWUnZDiw0f9KkHFyBEnQj4Jcxg16keoLs9e4FUXajyAkA/hOBh1+Jg/Tl5LwCHyShpOUqd85NsS6mQKJi6nUgR+0pNoYU0mxmzmjEZAGzSGurFL12bo2euXuavqeWbuxpUtKbNGQ2iq2mxKa2AdyOXblidgpmGYUnKTwMpEF0wUhCW+Sl/MlhKt0VCRaqbMpInEKxD6pEgh8IGMIZ3sKPbsO/4vhZPlndlsfQomL4051Z+cnFZpte02mX84Q8W1f5S7vYclBFYebq0HtaA4rCgkWDBKvPeaGbmxvnFjdCbI3Zqgv6QTvUUL7L0a5TmVoBTsSRkYStwLSjNLLKTOxQPr9mdUgALwUWxvm3tmT8FIqQ+I/vy5X6tMeE7iu1gRZnVOOLPKskb4PWbpek46J8lysdRZnctd0dXPIVtIdd8P3BB4TlLsQCz/PvQXdA4U+IFAO6tPRJy+kcbtFQmnbWZsp/HBt5RDf6N/299F71a8L1l2XHZ56PjwpMl5c/zm2L74vuE4iUzk6ypzk+373pWIJ+O74jvzg5EPfTfYIJQ3ZXfEednV2RMJQTydXZdZZ5sf/kT5rD/LR//8IYRA7yIxyJ3gO4hMcpcWSq+GXQu8FnYVaAqGXFcy2/8J325tba7MrARhjwNI/0h/srSLqLq+97+wSqPbAeMXczfUk+457lOffTaLYMcchIfgiDVCuOeqGCGCv/VzN25M3YXuk5nY3BWAekcGABlLarWx7FJG+g7amXCWcpWaZn8xiOP1ODp96TF4tnjHdo0tvL/UKaXIpjyuBFNgKXlIeV1KsfP+E7aa7cU7Tg+4X4w657FNCafER/j7IWTtLjju2vlB35b76OphdNX9lsqnaAdZwjBkmd14UtyqdBkVE0P1CLzF7HEvIPN3zSPyXP3S9y7nhMvCc5Zl9s1AdHTIS719PVb38Nacx0bnzXtO9YhVj54Yxd7iDEk3etkq57gf05ckk19/MyKOOSlZAnFV26xDvZQBytrbGblYPVZrz+eiIbVgcUszxV+IP038VPwFSOM9+nE1q2/0OVTdhzPtuA8A8O6xMQtEAACCXfwXYdxOlYz/1C6O4D8pXsl/IKQFVVxL5oIgA7hu3A+of8ma1Hq23rt8sxlJeWINH7gm/VW87WtqfLfUIqiHESmuJC3JjV0Ax6AOMHUdckh2cyWpsqb29qd0KCh5J9CJdON+u+BMKJP1P86EDypYACNaR1ncPjiVc/CiCygdODi4MkHrJymAbU8ERO8ZVOsPjN4ryuLewJn2B17vH0qPNXm8ynYNewY5YcREj2VS1bHgkr3UW0yakpsk+yMam8HKAtePeo+wRlPHDradhEQxi42q2OHlYliWimmjcpTkpkR61fPitB1cqSrYYyCOzIoRRuhVz0hKLe6Ywp/vFko0SpxRRD0qDHsi0qUzAZevgDpi1UoNDiTRakuEiCpiTDIMZVQu5/CjQCV3KYxOXyuHJOJKKzi0VR7tKFZlud1zqt09CyixV65LxYgVJ16CRCmklEpqafAX6pL3+nWmh0vFo6xOBiLnGNS8sThkpUGsxzooHM8xYpGowAF2vK3KpkInUp169CVtdEpQ1RACAAAAAA==) format("woff2")}.iconfont[data-v-b2384226]{font-family:iconfont!important;font-size:16px;font-style:normal;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.icon-replay[data-v-b2384226]:before{content:"\\e631"}.icon-pip[data-v-b2384226]:before{content:"\\e820"}.icon-loading[data-v-b2384226]:before{content:"\\e62e"}.icon-play[data-v-b2384226]:before{content:"\\e851"}.icon-pause[data-v-b2384226]:before{content:"\\e863"}.icon-screen[data-v-b2384226]:before{content:"\\e88f"}.icon-web-screen[data-v-b2384226]:before{content:"\\e609"}.icon-settings[data-v-b2384226]:before{content:"\\e60c"}.icon-volume-down[data-v-b2384226]:before{content:"\\e60d"}.icon-volume-up[data-v-b2384226]:before{content:"\\e60e"}.icon-volume-mute[data-v-b2384226]:before{content:"\\e60f"}html[data-v-b2384226],body[data-v-b2384226],div[data-v-b2384226],span[data-v-b2384226],applet[data-v-b2384226],object[data-v-b2384226],iframe[data-v-b2384226],h1[data-v-b2384226],h2[data-v-b2384226],h3[data-v-b2384226],h4[data-v-b2384226],h5[data-v-b2384226],h6[data-v-b2384226],p[data-v-b2384226],blockquote[data-v-b2384226],pre[data-v-b2384226],a[data-v-b2384226],abbr[data-v-b2384226],acronym[data-v-b2384226],address[data-v-b2384226],big[data-v-b2384226],cite[data-v-b2384226],code[data-v-b2384226],del[data-v-b2384226],dfn[data-v-b2384226],em[data-v-b2384226],img[data-v-b2384226],ins[data-v-b2384226],kbd[data-v-b2384226],q[data-v-b2384226],s[data-v-b2384226],samp[data-v-b2384226],small[data-v-b2384226],strike[data-v-b2384226],strong[data-v-b2384226],sub[data-v-b2384226],sup[data-v-b2384226],tt[data-v-b2384226],var[data-v-b2384226],b[data-v-b2384226],u[data-v-b2384226],i[data-v-b2384226],center[data-v-b2384226],dl[data-v-b2384226],dt[data-v-b2384226],dd[data-v-b2384226],ol[data-v-b2384226],ul[data-v-b2384226],li[data-v-b2384226],fieldset[data-v-b2384226],form[data-v-b2384226],label[data-v-b2384226],legend[data-v-b2384226],table[data-v-b2384226],caption[data-v-b2384226],tbody[data-v-b2384226],tfoot[data-v-b2384226],thead[data-v-b2384226],tr[data-v-b2384226],th[data-v-b2384226],td[data-v-b2384226],article[data-v-b2384226],aside[data-v-b2384226],canvas[data-v-b2384226],details[data-v-b2384226],embed[data-v-b2384226],figure[data-v-b2384226],figcaption[data-v-b2384226],footer[data-v-b2384226],header[data-v-b2384226],hgroup[data-v-b2384226],menu[data-v-b2384226],nav[data-v-b2384226],output[data-v-b2384226],ruby[data-v-b2384226],section[data-v-b2384226],summary[data-v-b2384226],time[data-v-b2384226],mark[data-v-b2384226],audio[data-v-b2384226],video[data-v-b2384226]{margin:0;padding:0;border:0;font-size:100%;font:inherit;vertical-align:baseline}article[data-v-b2384226],aside[data-v-b2384226],details[data-v-b2384226],figcaption[data-v-b2384226],figure[data-v-b2384226],footer[data-v-b2384226],header[data-v-b2384226],hgroup[data-v-b2384226],menu[data-v-b2384226],nav[data-v-b2384226],section[data-v-b2384226]{display:block}body[data-v-b2384226]{line-height:1}ol[data-v-b2384226],ul[data-v-b2384226]{list-style:none}blockquote[data-v-b2384226],q[data-v-b2384226]{quotes:none}blockquote[data-v-b2384226]:before,blockquote[data-v-b2384226]:after,q[data-v-b2384226]:before,q[data-v-b2384226]:after{content:"";content:none}table[data-v-b2384226]{border-collapse:collapse;border-spacing:0}textarea[data-v-b2384226]{font-family:inherit}.iconfont[data-v-b2384226]{display:inline-block}.d-flex-x[data-v-b2384226],.d-flex-y[data-v-b2384226],.d-flex-center[data-v-b2384226]{display:flex}.d-flex-x[data-v-b2384226]{align-items:center}.d-flex-y[data-v-b2384226]{justify-content:center}.d-flex-center[data-v-b2384226]{justify-content:center;align-items:center}.mr5[data-v-b2384226]{margin-right:5px}.mr10[data-v-b2384226]{margin-right:10px}.ml5[data-v-b2384226]{margin-left:5px}.ml10[data-v-b2384226]{margin-left:10px}.d-pointer[data-v-b2384226]{cursor:pointer}.rotating[data-v-b2384226]{animation:rotating-b2384226 2s linear infinite}@keyframes rotating-b2384226{to{-webkit-transform:rotate(360deg)}}.d-fade-in-enter-active[data-v-b2384226],.d-fade-in-leave-active[data-v-b2384226]{transition:.5s}.d-fade-in-enter-from[data-v-b2384226],.d-fade-in-leave-to[data-v-b2384226]{opacity:0}.d-scale-out-enter-active[data-v-b2384226],.d-scale-out-leave-active[data-v-b2384226]{transition:.3s}.d-scale-out-leave-to[data-v-b2384226]{transform:scale(1.3);opacity:0}.rotateHover[data-v-b2384226]{transition:.2s}.rotateHover[data-v-b2384226]:hover{transform:rotate(90deg)}.f50[data-v-b2384226]{font-size:50px}.f24[data-v-b2384226]{font-size:24px}.d-loading[data-v-b2384226]{position:absolute;left:0;right:0;bottom:0px;top:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.3);z-index:2;color:#efefef;text-align:center;font-size:13px}
`)();const Me=G=>(B.pushScopeId("data-v-b2384226"),G=G(),B.popScopeId(),G),mt={key:0},pt=Me(()=>B.createElementVNode("i",{class:"rotating iconfont icon-loading f50"},null,-1)),Et=[Me(()=>B.createElementVNode("i",{class:"rotating iconfont icon-loading f50"},null,-1)),Me(()=>B.createElementVNode("p",null,"\u6B63\u5728\u7F13\u51B2...",-1))],yt=[Me(()=>B.createElementVNode("i",{class:"iconfont icon-replay f24 mr5"},null,-1)),B.createTextVNode("\u91CD\u65B0\u64AD\u653E ")],Tt=[Me(()=>B.createElementVNode("i",{class:"iconfont icon-replay f24 mr5"},null,-1)),B.createTextVNode("\u8BF7\u6C42\u9519\u8BEF ")];var xt=Ae(B.defineComponent({__name:"d-loading",props:{loadType:String,text:{type:String,default:""}},setup(G){const H=G,{proxy:K}=B.getCurrentInstance(),C=["loadstart","waiting","ended","error","stalled"],E=()=>{K.$parent.play()},M=B.computed(()=>{let O="background: rgba(0, 0, 0, .1);z-index:1";return H.loadType=="loadstart"&&(O="background: rgba(0, 0, 0, 1);;z-index:3"),O});return(O,L)=>B.withDirectives((B.openBlock(),B.createElementBlock("div",{class:"d-loading",style:B.normalizeStyle(B.unref(M))},[B.createElementVNode("div",null,[G.loadType=="loadstart"?(B.openBlock(),B.createElementBlock("span",mt,[pt,B.createElementVNode("p",null,B.toDisplayString(G.text),1)])):B.createCommentVNode("",!0),B.withDirectives(B.createElementVNode("span",null,Et,512),[[B.vShow,G.loadType=="waiting"]]),B.withDirectives(B.createElementVNode("span",null,[B.createElementVNode("p",{onClick:E,class:"d-flex-x d-pointer"},yt)],512),[[B.vShow,G.loadType=="ended"]]),B.withDirectives(B.createElementVNode("span",null,[B.createElementVNode("p",{onClick:E,class:"d-flex-x d-pointer"},Tt)],512),[[B.vShow,G.loadType=="error"||G.loadType=="stalled"]])])],4)),[[B.vShow,C.includes(G.loadType)]])}}),[["__scopeId","data-v-b2384226"]]);const De=function(G,H,K,C=!1){G&&H&&K&&G.addEventListener(H,K,C)},de=function(G,H,K,C=!1){G&&H&&K&&G.removeEventListener(H,K,C)};var ei=(()=>`.d-slider[data-v-c064cea8]{position:relative}.d-slider .d-slider__runway[data-v-c064cea8]{width:100%;height:var(--06c9fefb);background-color:#333;position:relative;cursor:pointer;vertical-align:middle}.d-slider .d-slider__runway .d-slider__cursor[data-v-c064cea8],.d-slider .d-slider__runway .d-slider__preload[data-v-c064cea8],.d-slider .d-slider__runway .d-slider__bar[data-v-c064cea8]{position:absolute;top:0;left:0;height:100%}.d-slider .d-slider__runway .d-slider__cursor[data-v-c064cea8]{display:none;z-index:1;width:1px;background:#fff;pointer-events:none}.d-slider .d-slider__runway .d-slider__cursor .d-slider__tips[data-v-c064cea8]{pointer-events:none;color:#fff;position:absolute;white-space:nowrap;z-index:2;bottom:14px;left:50%;padding:4px;box-sizing:border-box;display:block;font-size:12px;background:rgba(0,0,0,.6);border-radius:3px;transform:translate(-50%)}.d-slider .d-slider__runway:hover .d-slider__cursor[data-v-c064cea8]{display:block}.d-slider .d-slider__runway .d-slider__preload[data-v-c064cea8]{background:#717171}.d-slider .d-slider__runway .d-slider__bar[data-v-c064cea8]{background:linear-gradient(to right,#52a0fd 0%,#00e2fa 80%,#00e2fa 100%)}.d-slider .d-slider__runway .d-slider__bar[data-v-c064cea8]:before{display:block;content:"";position:absolute;right:-6px;top:50%;width:12px;height:12px;transition:.2s;transform:translateY(-50%) scale(1);border-radius:50%;background:#fff;box-shadow:0 0 0 5px #409eff}.d-slider.is-vertical[data-v-c064cea8]{height:100%;display:inline-block}.d-slider.is-vertical .d-slider__runway[data-v-c064cea8]{position:relative;height:100%;width:var(--06c9fefb);margin:0 6px}.d-slider.is-vertical .d-slider__runway .d-slider__preload[data-v-c064cea8],.d-slider.is-vertical .d-slider__runway .d-slider__bar[data-v-c064cea8],.d-slider.is-vertical .d-slider__runway .d-slider__cursor[data-v-c064cea8]{bottom:0;top:auto;width:100%}.d-slider.is-vertical .d-slider__runway .d-slider__cursor[data-v-c064cea8]{height:1px}.d-slider.is-vertical .d-slider__runway .d-slider__bar[data-v-c064cea8]:before{top:-6px;left:50%;width:12px;height:12px;transform:translate(-50%) scale(1)}
`)();const St=["onMousedown"],At={name:"DSlider"},Lt=B.defineComponent(We(Ke({},At),{props:{modelValue:{required:!0,type:Number,default:0},disabled:{type:Boolean,default:!1},vertical:{type:Boolean,default:!1},hover:{type:Boolean,default:!0},hoverText:{type:String,default:""},preload:{type:Number,default:0},size:{type:String,default:"10px"}},emits:["update:modelValue","change","onMousemove"],setup(G,{emit:H}){const K=G;B.useCssVars(p=>({"06c9fefb":G.size}));const C=B.ref(null),E=B.ref(null),M=B.reactive({dragging:!1,hoverPosition:0,hoverTipsLeft:"50%"}),O=B.computed(()=>{let p=K.modelValue<0?0:K.modelValue>1?1:K.modelValue;return K.vertical?`height:${p*100}%`:`width:${p*100}%`}),L=B.computed(()=>{let p=K.preload<0?0:K.preload>1?1:K.preload;return K.vertical?`height:${p*100}%`:`width:${p*100}%`}),R=B.computed(()=>{let p=M.hoverPosition<0?0:M.hoverPosition>1?1:M.hoverPosition;return K.vertical?`bottom:${p*100}%`:`left:${p*100}%`}),I=p=>{p.preventDefault()},b=p=>{K.disabled||(p.preventDefault(),M.dragging=!0,c(p),De(window,"mousemove",y),De(window,"touchmove",y),De(window,"mouseup",T),De(window,"touchend",T))},A=p=>{if(!K.hover)return;let v=S(p);if(H("onMousemove",p,v),M.hoverPosition=v,K.vertical)return;let s=C.value,t=E.value.clientWidth/2,r=p.clientX-s.getBoundingClientRect().left;r<t?M.hoverTipsLeft=t-r+"px":s.clientWidth-r<t?M.hoverTipsLeft=s.clientWidth-r-t+"px":M.hoverTipsLeft="50%"},c=p=>{let v=S(p);H("update:modelValue",v),H("change",p,v)},S=p=>{let v=C.value,s=0;if(K.vertical){let t=v.clientHeight;s=(v.getBoundingClientRect().bottom-p.clientY)/t}else s=(p.clientX-v.getBoundingClientRect().left)/v.clientWidth;return s<0?0:s>1?1:s},y=p=>{c(p)},T=p=>{M.dragging&&(de(window,"mousemove",y),de(window,"touchmove",y),de(window,"mouseup",T),de(window,"touchend",T),de(window,"contextmenu",T),setTimeout(()=>{M.dragging=!1},0))};return(p,v)=>(B.openBlock(),B.createElementBlock("div",{ref_key:"refSlider",ref:C,class:B.normalizeClass(["d-slider",{"is-vertical":K.vertical}]),onMousedown:B.withModifiers(b,["stop"]),onContextmenu:I},[B.createElementVNode("div",{class:"d-slider__runway",onMousemove:A},[B.withDirectives(B.createElementVNode("div",{class:"d-slider__cursor",style:B.normalizeStyle(B.unref(R))},[B.withDirectives(B.createElementVNode("div",{class:"d-slider__tips",ref_key:"refTips",ref:E,style:B.normalizeStyle({left:M.hoverTipsLeft})},B.toDisplayString(K.hoverText),5),[[B.vShow,K.hoverText]])],4),[[B.vShow,K.hover]]),B.createElementVNode("div",{class:"d-slider__preload",style:B.normalizeStyle(B.unref(L))},null,4),B.createElementVNode("div",{class:"d-slider__bar",style:B.normalizeStyle(B.unref(O))},null,4)],32)],42,St))}}));var _e=Ae(Lt,[["__scopeId","data-v-c064cea8"]]);const Qe="1.3.1-beta.5";var ti=(()=>`html[data-v-74b5bddc],body[data-v-74b5bddc],div[data-v-74b5bddc],span[data-v-74b5bddc],applet[data-v-74b5bddc],object[data-v-74b5bddc],iframe[data-v-74b5bddc],h1[data-v-74b5bddc],h2[data-v-74b5bddc],h3[data-v-74b5bddc],h4[data-v-74b5bddc],h5[data-v-74b5bddc],h6[data-v-74b5bddc],p[data-v-74b5bddc],blockquote[data-v-74b5bddc],pre[data-v-74b5bddc],a[data-v-74b5bddc],abbr[data-v-74b5bddc],acronym[data-v-74b5bddc],address[data-v-74b5bddc],big[data-v-74b5bddc],cite[data-v-74b5bddc],code[data-v-74b5bddc],del[data-v-74b5bddc],dfn[data-v-74b5bddc],em[data-v-74b5bddc],img[data-v-74b5bddc],ins[data-v-74b5bddc],kbd[data-v-74b5bddc],q[data-v-74b5bddc],s[data-v-74b5bddc],samp[data-v-74b5bddc],small[data-v-74b5bddc],strike[data-v-74b5bddc],strong[data-v-74b5bddc],sub[data-v-74b5bddc],sup[data-v-74b5bddc],tt[data-v-74b5bddc],var[data-v-74b5bddc],b[data-v-74b5bddc],u[data-v-74b5bddc],i[data-v-74b5bddc],center[data-v-74b5bddc],dl[data-v-74b5bddc],dt[data-v-74b5bddc],dd[data-v-74b5bddc],ol[data-v-74b5bddc],ul[data-v-74b5bddc],li[data-v-74b5bddc],fieldset[data-v-74b5bddc],form[data-v-74b5bddc],label[data-v-74b5bddc],legend[data-v-74b5bddc],table[data-v-74b5bddc],caption[data-v-74b5bddc],tbody[data-v-74b5bddc],tfoot[data-v-74b5bddc],thead[data-v-74b5bddc],tr[data-v-74b5bddc],th[data-v-74b5bddc],td[data-v-74b5bddc],article[data-v-74b5bddc],aside[data-v-74b5bddc],canvas[data-v-74b5bddc],details[data-v-74b5bddc],embed[data-v-74b5bddc],figure[data-v-74b5bddc],figcaption[data-v-74b5bddc],footer[data-v-74b5bddc],header[data-v-74b5bddc],hgroup[data-v-74b5bddc],menu[data-v-74b5bddc],nav[data-v-74b5bddc],output[data-v-74b5bddc],ruby[data-v-74b5bddc],section[data-v-74b5bddc],summary[data-v-74b5bddc],time[data-v-74b5bddc],mark[data-v-74b5bddc],audio[data-v-74b5bddc],video[data-v-74b5bddc]{margin:0;padding:0;border:0;font-size:100%;font:inherit;vertical-align:baseline}article[data-v-74b5bddc],aside[data-v-74b5bddc],details[data-v-74b5bddc],figcaption[data-v-74b5bddc],figure[data-v-74b5bddc],footer[data-v-74b5bddc],header[data-v-74b5bddc],hgroup[data-v-74b5bddc],menu[data-v-74b5bddc],nav[data-v-74b5bddc],section[data-v-74b5bddc]{display:block}body[data-v-74b5bddc]{line-height:1}ol[data-v-74b5bddc],ul[data-v-74b5bddc]{list-style:none}blockquote[data-v-74b5bddc],q[data-v-74b5bddc]{quotes:none}blockquote[data-v-74b5bddc]:before,blockquote[data-v-74b5bddc]:after,q[data-v-74b5bddc]:before,q[data-v-74b5bddc]:after{content:"";content:none}table[data-v-74b5bddc]{border-collapse:collapse;border-spacing:0}textarea[data-v-74b5bddc]{font-family:inherit}.iconfont[data-v-74b5bddc]{display:inline-block}.d-flex-x[data-v-74b5bddc],.d-flex-y[data-v-74b5bddc],.d-flex-center[data-v-74b5bddc]{display:flex}.d-flex-x[data-v-74b5bddc]{align-items:center}.d-flex-y[data-v-74b5bddc]{justify-content:center}.d-flex-center[data-v-74b5bddc]{justify-content:center;align-items:center}.mr5[data-v-74b5bddc]{margin-right:5px}.mr10[data-v-74b5bddc]{margin-right:10px}.ml5[data-v-74b5bddc]{margin-left:5px}.ml10[data-v-74b5bddc]{margin-left:10px}.d-pointer[data-v-74b5bddc]{cursor:pointer}.rotating[data-v-74b5bddc]{animation:rotating-74b5bddc 2s linear infinite}@keyframes rotating-74b5bddc{to{-webkit-transform:rotate(360deg)}}.d-fade-in-enter-active[data-v-74b5bddc],.d-fade-in-leave-active[data-v-74b5bddc]{transition:.5s}.d-fade-in-enter-from[data-v-74b5bddc],.d-fade-in-leave-to[data-v-74b5bddc]{opacity:0}.d-scale-out-enter-active[data-v-74b5bddc],.d-scale-out-leave-active[data-v-74b5bddc]{transition:.3s}.d-scale-out-leave-to[data-v-74b5bddc]{transform:scale(1.3);opacity:0}.rotateHover[data-v-74b5bddc]{transition:.2s}.rotateHover[data-v-74b5bddc]:hover{transform:rotate(90deg)}.d-player-contextmenu[data-v-74b5bddc],.d-player-dialog[data-v-74b5bddc]{position:absolute;left:0;top:0;bottom:50px;width:100%;z-index:5}.d-player-contextmenu .d-player-copyText[data-v-74b5bddc]{opacity:0}.d-player-contextmenu .d-player-contextmenu-body[data-v-74b5bddc]{position:absolute;border-radius:5px;font-size:12px;background:rgba(0,0,0,.8);color:#efefef;text-align:left;width:130px;box-sizing:border-box;padding:5px 0}.d-player-contextmenu .d-player-contextmenu-body li[data-v-74b5bddc]{padding:8px 20px;margin:0;cursor:pointer;transition:.2s}.d-player-contextmenu .d-player-contextmenu-body li[data-v-74b5bddc]:hover{background-color:#ffffff1a}.d-player-dialog[data-v-74b5bddc]{display:flex;justify-content:center;align-items:center}.d-player-dialog .d-player-dialog-body[data-v-74b5bddc]{background-color:#212121e6;border-radius:5px;color:#fff;min-width:200px;padding:0 0 10px}.d-player-dialog .d-player-dialog-body .d-player-dialog-title[data-v-74b5bddc]{position:relative;font-size:14px;font-weight:400;margin:0 0 10px;padding:12px 0;border-bottom:1px solid rgba(255,255,255,.15)}.d-player-dialog .d-player-dialog-body .d-player-dialog-title .icon-close[data-v-74b5bddc]{position:absolute;right:0px;top:0px;width:40px;height:40px;line-height:40px;text-align:center;cursor:pointer}.d-player-dialog .d-player-dialog-body .d-player-hotkey-panel[data-v-74b5bddc]{font-size:12px;color:#eee;padding-right:40px}.d-player-dialog .d-player-dialog-body .d-player-hotkey-panel .d-player-hotkey-panel-item[data-v-74b5bddc]{line-height:26px}.d-player-dialog .d-player-dialog-body .d-player-hotkey-panel .d-player-hotkey-panel-item span[data-v-74b5bddc]{text-align:center;display:inline-block;width:120px}.d-player-dialog .d-player-dialog-body .d-player-hotkey-panel .d-player-hotkey-panel-item span[data-v-74b5bddc]:nth-child(2){color:#999;width:160px}.d-player-dialog .d-player-dialog-body .d-player-filter-panel[data-v-74b5bddc]{width:320px;padding:0 20px}.d-player-dialog .d-player-dialog-body .d-player-filter-panel .d-player-filter-reset[data-v-74b5bddc]{cursor:pointer;margin-top:10px;padding:3px 20px;display:inline-block;border-radius:2px;font-size:12px;background:rgba(133,133,133,.5)}.d-player-dialog .d-player-dialog-body .d-player-filter-panel .d-player-filter-reset[data-v-74b5bddc]:hover{background:rgba(255,255,255,.3)}.d-player-dialog .d-player-dialog-body .d-player-filter-panel .d-player-filter-panel-item[data-v-74b5bddc]{height:32px;display:flex;align-items:center}.d-player-dialog .d-player-dialog-body .d-player-filter-panel .d-player-filter-panel-item .filter-panel-slider[data-v-74b5bddc]{width:100%}.d-player-dialog .d-player-dialog-body .d-player-filter-panel .d-player-filter-panel-item .filter-panel-slider[data-v-74b5bddc] .d-slider__runway{background-color:#999}.d-player-dialog .d-player-dialog-body .d-player-filter-panel .d-player-filter-panel-item .filter-panel-slider[data-v-74b5bddc] .d-slider__runway .d-slider__bar:before{width:8px;height:8px;box-shadow:0 0 0 5px #ffffff80}.d-player-dialog .d-player-dialog-body .d-player-filter-panel .d-player-filter-panel-item span[data-v-74b5bddc]{font-size:12px;display:block;width:80px;text-align:center}
`)();const ke=G=>(B.pushScopeId("data-v-74b5bddc"),G=G(),B.popScopeId(),G),bt={key:0,class:"d-player-dialog"},Dt={class:"d-player-dialog-body"},Ot={class:"d-player-dialog-title"},Rt={class:"d-player-hotkey-panel"},It={class:"d-player-filter-panel"},Pt={class:"d-player-filter-panel-item"},Ct=ke(()=>B.createElementVNode("span",null,"\u9971\u548C\u5EA6",-1)),Mt={class:"d-player-filter-panel-item"},_t=ke(()=>B.createElementVNode("span",null,"\u4EAE\u5EA6",-1)),Ft={class:"d-player-filter-panel-item"},Bt=ke(()=>B.createElementVNode("span",null,"\u5BF9\u6BD4\u5EA6",-1)),Ut={key:0,class:"d-player-contextmenu"},kt=["dplayerKeyCode"],Nt=ke(()=>B.createElementVNode("input",{class:"d-player-copyText"},null,-1));var wt=Ae(B.defineComponent({__name:"d-contextmenu",setup(G){const H=B.reactive({show:!1,dialogType:"",dialogTitle:"",version:Qe,mouseX:0,mouseY:0}),K=[{label:"\u89C6\u9891\u8272\u5F69\u8C03\u6574",key:"filter"},{label:"\u5FEB\u6377\u952E\u8BF4\u660E",key:"hotkey"},{label:"\u7248\u672C\uFF1A"+Qe,key:"version"}],C=[{key:"Space",label:"\u64AD\u653E/\u6682\u505C"},{key:"\u2192",label:"\u5355\u6B21\u5FEB\u8FDB10s\uFF0C\u957F\u63095\u500D\u901F\u64AD\u653E"},{key:"\u2190",label:"\u5FEB\u90005s"},{key:"\u2191",label:"\u97F3\u91CF\u589E\u52A010%"},{key:"\u2193",label:"\u97F3\u91CF\u589E\u52A0\u964D\u4F4E10%"},{key:"Esc",label:"\u9000\u51FA\u5168\u5C4F/\u9000\u51FA\u7F51\u9875\u5168\u5C4F"},{key:"F",label:"\u5168\u5C4F/\u9000\u51FA\u5168\u5C4F"}],E=B.reactive({saturate:.392,brightness:.392,contrast:.392}),M=B.computed(()=>({left:H.mouseX+"px",top:H.mouseY+"px"}));B.watch(E,b=>{let A=document.querySelector("#dPlayerVideo"),c=(b.saturate*2.55).toFixed(2),S=(b.brightness*2.55).toFixed(2),y=(b.contrast*2.55).toFixed(2);A.style.filter=`saturate(${c}) brightness(${S}) contrast(${y})`});const O=()=>{E.saturate=.392,E.brightness=.392,E.contrast=.392},L=b=>{b.key=="Escape"&&I(0)},R=b=>{b.preventDefault(),De(window,"keydown",L),De(window,"click",I);let A=document.querySelector("#refPlayerWrap"),c=A.clientWidth;A.clientHeight,H.mouseX=b.clientX-A.getBoundingClientRect().left,c-H.mouseX<130&&(H.mouseX=H.mouseX+(c-H.mouseX-130)),H.mouseY=b.clientY-A.getBoundingClientRect().top,H.show=!0},I=b=>{let A=b.path[0].tagName=="LI",c=b.path[0].attributes.dplayerKeyCode&&b.path[0].attributes.dplayerKeyCode.value,S=K.map(y=>y.key);A&&S.includes(c)&&(H.dialogTitle=b.path[0].innerText,H.dialogType=c,(c=="copy"||c=="version")&&(H.dialogType="")),H.show=!1,de(window,"keydown",L),de(window,"click",I)};return B.onMounted(()=>{let b=document.querySelector("#refPlayerWrap");de(window,"keydown",L),de(window,"click",I),de(b,"contextmenu",R),De(b,"contextmenu",R)}),B.onUnmounted(()=>{let b=document.querySelector("#refPlayerWrap");de(window,"keydown",L),de(window,"click",I),de(b,"contextmenu",R)}),(b,A)=>(B.openBlock(),B.createElementBlock("div",null,[B.createVNode(B.Transition,{name:"d-fade-in"},{default:B.withCtx(()=>[H.dialogType?(B.openBlock(),B.createElementBlock("div",bt,[B.createElementVNode("div",Dt,[B.createElementVNode("h5",Ot,[B.createTextVNode(B.toDisplayString(H.dialogTitle)+" ",1),B.createElementVNode("i",{onClick:A[0]||(A[0]=c=>H.dialogType=!1),class:"icon icon-close"},"X")]),B.withDirectives(B.createElementVNode("ul",Rt,[(B.openBlock(),B.createElementBlock(B.Fragment,null,B.renderList(C,c=>B.createElementVNode("li",{class:"d-player-hotkey-panel-item",key:c.key},[B.createElementVNode("span",null,B.toDisplayString(c.key),1),B.createElementVNode("span",null,B.toDisplayString(c.label),1)])),64))],512),[[B.vShow,H.dialogType=="hotkey"]]),B.withDirectives(B.createElementVNode("ul",It,[B.createElementVNode("li",Pt,[Ct,B.createVNode(_e,{class:"filter-panel-slider",size:"5px",modelValue:E.saturate,"onUpdate:modelValue":A[1]||(A[1]=c=>E.saturate=c)},null,8,["modelValue"]),B.createElementVNode("span",null,B.toDisplayString(Math.round(E.saturate*255)),1)]),B.createElementVNode("li",Mt,[_t,B.createVNode(_e,{class:"filter-panel-slider",size:"5px",modelValue:E.brightness,"onUpdate:modelValue":A[2]||(A[2]=c=>E.brightness=c)},null,8,["modelValue"]),B.createElementVNode("span",null,B.toDisplayString(Math.round(E.brightness*255)),1)]),B.createElementVNode("li",Ft,[Bt,B.createVNode(_e,{class:"filter-panel-slider",size:"5px",modelValue:E.contrast,"onUpdate:modelValue":A[3]||(A[3]=c=>E.contrast=c)},null,8,["modelValue"]),B.createElementVNode("span",null,B.toDisplayString(Math.round(E.contrast*255)),1)]),B.createElementVNode("span",{onClick:O,title:"\u91CD\u7F6E","aria-label":"\u91CD\u7F6E",class:"d-player-filter-reset"},"\u91CD\u7F6E")],512),[[B.vShow,H.dialogType=="filter"]])])])):B.createCommentVNode("",!0)]),_:1}),H.show?(B.openBlock(),B.createElementBlock("div",Ut,[B.createElementVNode("ul",{class:"d-player-contextmenu-body",style:B.normalizeStyle(B.unref(M))},[(B.openBlock(),B.createElementBlock(B.Fragment,null,B.renderList(K,c=>B.createElementVNode("li",{dplayerKeyCode:c.key,key:c.key},B.toDisplayString(c.label),9,kt)),64))],4),Nt])):B.createCommentVNode("",!0)]))}}),[["__scopeId","data-v-74b5bddc"]]);const Kt=G=>`${parseInt("0x"+G.slice(1,3))},${parseInt("0x"+G.slice(3,5))},${parseInt("0x"+G.slice(5,7))}`,Wt=G=>G.charAt(0).toUpperCase()+G.slice(1),He=G=>{let H=~~(G/3600),K=~~(G%3600/60),C=~~(G%60);return H=H<10?"0"+H:H,K=K<10?"0"+K:K,C=C<10?"0"+C:C,`${H}:${K}:${C}`},Fe="ontouchstart"in window,Vt=G=>{let H=document,K=H.webkitIsFullScreen||H.fullscreen;return K?(document.exitFullscreen||H.webkitExitFullScreen).call(H):(G.requestFullscreen||G.webkitRequestFullScreen).call(G),!K},Gt=G=>{document.pictureInPictureElement?document.exitPictureInPicture().catch(H=>{console.log(H,"Video failed to leave Picture-in-Picture mode.")}):G.requestPictureInPicture().catch(H=>{console.log(H,"Video failed to enter Picture-in-Picture mode.")})},$e=["loadstart","play","pause","playing","seeking","seeked","waiting","durationchange","progress","canplay","timeupdate","ended","error","stalled"],Ht={width:{type:String,default:"800px"},height:{type:String,default:"450px"},color:{type:String,default:"#409eff"},src:{required:!0,type:String,default:""},title:{type:String,default:""},type:{type:String,default:"video/mp4"},poster:{type:String,default:""},webFullScreen:{type:Boolean,default:!1},speed:{type:Boolean,default:!0},currentTime:{type:Number,default:0},playsinline:{type:Boolean,default:!1},muted:{type:Boolean,default:!1},speedRate:{type:Array,default:()=>["2.0","1.5","1.25","1.0","0.75","0.5"]},autoPlay:{type:Boolean,default:!1},loop:{type:Boolean,default:!1},mirror:{type:Boolean,default:!1},ligthOff:{type:Boolean,default:!1},volume:{type:[String,Number],default:.3},control:{type:Boolean,default:!0},controlBtns:{type:Array,default:["audioTrack","quality","speedRate","volume","setting","pip","pageFullScreen","fullScreen"]},preload:{type:String,default:"none"}};var ii=(()=>`html[data-v-1ba07096],body[data-v-1ba07096],div[data-v-1ba07096],span[data-v-1ba07096],applet[data-v-1ba07096],object[data-v-1ba07096],iframe[data-v-1ba07096],h1[data-v-1ba07096],h2[data-v-1ba07096],h3[data-v-1ba07096],h4[data-v-1ba07096],h5[data-v-1ba07096],h6[data-v-1ba07096],p[data-v-1ba07096],blockquote[data-v-1ba07096],pre[data-v-1ba07096],a[data-v-1ba07096],abbr[data-v-1ba07096],acronym[data-v-1ba07096],address[data-v-1ba07096],big[data-v-1ba07096],cite[data-v-1ba07096],code[data-v-1ba07096],del[data-v-1ba07096],dfn[data-v-1ba07096],em[data-v-1ba07096],img[data-v-1ba07096],ins[data-v-1ba07096],kbd[data-v-1ba07096],q[data-v-1ba07096],s[data-v-1ba07096],samp[data-v-1ba07096],small[data-v-1ba07096],strike[data-v-1ba07096],strong[data-v-1ba07096],sub[data-v-1ba07096],sup[data-v-1ba07096],tt[data-v-1ba07096],var[data-v-1ba07096],b[data-v-1ba07096],u[data-v-1ba07096],i[data-v-1ba07096],center[data-v-1ba07096],dl[data-v-1ba07096],dt[data-v-1ba07096],dd[data-v-1ba07096],ol[data-v-1ba07096],ul[data-v-1ba07096],li[data-v-1ba07096],fieldset[data-v-1ba07096],form[data-v-1ba07096],label[data-v-1ba07096],legend[data-v-1ba07096],table[data-v-1ba07096],caption[data-v-1ba07096],tbody[data-v-1ba07096],tfoot[data-v-1ba07096],thead[data-v-1ba07096],tr[data-v-1ba07096],th[data-v-1ba07096],td[data-v-1ba07096],article[data-v-1ba07096],aside[data-v-1ba07096],canvas[data-v-1ba07096],details[data-v-1ba07096],embed[data-v-1ba07096],figure[data-v-1ba07096],figcaption[data-v-1ba07096],footer[data-v-1ba07096],header[data-v-1ba07096],hgroup[data-v-1ba07096],menu[data-v-1ba07096],nav[data-v-1ba07096],output[data-v-1ba07096],ruby[data-v-1ba07096],section[data-v-1ba07096],summary[data-v-1ba07096],time[data-v-1ba07096],mark[data-v-1ba07096],audio[data-v-1ba07096],video[data-v-1ba07096]{margin:0;padding:0;border:0;font-size:100%;font:inherit;vertical-align:baseline}article[data-v-1ba07096],aside[data-v-1ba07096],details[data-v-1ba07096],figcaption[data-v-1ba07096],figure[data-v-1ba07096],footer[data-v-1ba07096],header[data-v-1ba07096],hgroup[data-v-1ba07096],menu[data-v-1ba07096],nav[data-v-1ba07096],section[data-v-1ba07096]{display:block}body[data-v-1ba07096]{line-height:1}ol[data-v-1ba07096],ul[data-v-1ba07096]{list-style:none}blockquote[data-v-1ba07096],q[data-v-1ba07096]{quotes:none}blockquote[data-v-1ba07096]:before,blockquote[data-v-1ba07096]:after,q[data-v-1ba07096]:before,q[data-v-1ba07096]:after{content:"";content:none}table[data-v-1ba07096]{border-collapse:collapse;border-spacing:0}textarea[data-v-1ba07096]{font-family:inherit}.d-fade-in-enter-active[data-v-1ba07096],.d-fade-in-leave-active[data-v-1ba07096]{transition:.5s}.d-fade-in-enter-from[data-v-1ba07096],.d-fade-in-leave-to[data-v-1ba07096]{opacity:0}.d-scale-out-enter-active[data-v-1ba07096],.d-scale-out-leave-active[data-v-1ba07096]{transition:.3s}.d-scale-out-leave-to[data-v-1ba07096]{transform:scale(1.3);opacity:0}.rotateHover[data-v-1ba07096]{transition:.2s}.rotateHover[data-v-1ba07096]:hover{transform:rotate(90deg)}.rotating[data-v-1ba07096]{animation:rotating-1ba07096 2s linear infinite}@keyframes rotating-1ba07096{to{-webkit-transform:rotate(360deg)}}.iconfont[data-v-1ba07096]{display:inline-block}.d-flex-x[data-v-1ba07096],.d-flex-y[data-v-1ba07096],.d-flex-center[data-v-1ba07096]{display:flex}.d-flex-x[data-v-1ba07096]{align-items:center}.d-flex-y[data-v-1ba07096]{justify-content:center}.d-flex-center[data-v-1ba07096]{justify-content:center;align-items:center}.mr5[data-v-1ba07096]{margin-right:5px}.mr10[data-v-1ba07096]{margin-right:10px}.ml5[data-v-1ba07096]{margin-left:5px}.ml10[data-v-1ba07096]{margin-left:10px}.d-pointer[data-v-1ba07096]{cursor:pointer}.d-player-wrap[data-v-1ba07096]{--primary-color: var(--152bb236);width:var(--ab6e34cc);height:var(--f5f6585a)}.d-player-wrap[data-v-1ba07096]{position:relative;overflow:hidden;background-color:#000}.d-player-wrap.web-full-screen[data-v-1ba07096]{z-index:9999999;position:fixed;left:0;top:0;width:100vw!important;height:100vh!important}.d-player-wrap .d-player-video[data-v-1ba07096]{position:relative;z-index:1;width:100%;height:100%}.d-player-wrap .d-player-video .d-player-video-poster[data-v-1ba07096]{position:absolute;height:100%;width:100%;top:0;left:0}.d-player-wrap .d-player-video .d-player-video-poster img[data-v-1ba07096]{display:block;width:100%;height:100%;object-fit:cover}.d-player-wrap .d-player-video .d-player-video-main[data-v-1ba07096]{width:100%;height:100%;transition:.2s}.d-player-wrap .d-player-video .d-player-video-main.video-mirror[data-v-1ba07096]{transform:rotateY(180deg)}.d-player-wrap .d-player-control[data-v-1ba07096]{transition:.1s;transform:translateY(40px);position:absolute;z-index:2;left:0;bottom:0;height:50px;width:100%;color:#fff}.d-player-wrap .d-player-control .d-control-progress[data-v-1ba07096]{width:100%;position:relative;height:10px;cursor:pointer}.d-player-wrap .d-player-control .d-control-progress .d-progress-bar[data-v-1ba07096]{position:absolute;left:0;right:0;bottom:0;width:100%;transition:height .1s;height:3px;z-index:1}.d-player-wrap .d-player-control .d-control-progress .d-progress-bar[data-v-1ba07096] .d-slider__runway{transition:height .1s;height:100%}.d-player-wrap .d-player-control .d-control-progress .d-progress-bar[data-v-1ba07096] .d-slider__runway .d-slider__bar:before{transform:translateY(-50%) scale(0)}.d-player-wrap .d-player-control .d-control-progress:hover .d-progress-bar[data-v-1ba07096]{height:100%}.d-player-wrap .d-player-control .d-control-progress:hover .d-progress-bar[data-v-1ba07096] .d-slider__bar:before{transform:translateY(-50%) scale(1)!important}.d-player-wrap .d-player-control .d-control-tool[data-v-1ba07096]{position:absolute;padding:0 10px;background:rgba(0,0,0,.8);display:flex;justify-content:space-between;align-items:center;top:10px;left:0;bottom:0;width:100%;box-sizing:border-box}.d-player-wrap .d-player-control .d-control-tool .d-tool-bar[data-v-1ba07096]{display:flex;height:100%}.d-player-wrap .d-player-control .d-control-tool .d-tool-bar .d-tool-item[data-v-1ba07096]{position:relative;height:100%;cursor:pointer;text-align:center;padding:0 8px;display:flex;align-items:center;font-size:13px}.d-player-wrap .d-player-control .d-control-tool .d-tool-bar .d-tool-item .d-tool-item-main[data-v-1ba07096]{position:absolute;white-space:nowrap;z-index:2;bottom:98%;left:50%;padding:6px 16px;box-sizing:border-box;display:none;background:rgba(0,0,0,.95);border-radius:5px;transform:translate(-50%)}.d-player-wrap .d-player-control .d-control-tool .d-tool-bar .d-tool-item:hover .d-tool-item-main[data-v-1ba07096]{display:flex}.d-player-wrap .d-player-control .d-control-tool .d-tool-time[data-v-1ba07096]{font-size:12px;color:#fff;font-weight:300}.d-player-wrap .d-player-control .d-control-tool .d-tool-time .total-time[data-v-1ba07096]{color:#fffc}.d-player-wrap .d-player-control .d-control-tool .volume-box[data-v-1ba07096]{height:160px;width:50px;display:flex;align-items:center;justify-content:center}.d-player-wrap .d-player-control .d-control-tool .volume-box .volume-main[data-v-1ba07096]{height:90%;display:flex;width:60px;flex-direction:column;align-items:center}.d-player-wrap .d-player-control .d-control-tool .volume-box .volume-main .volume-text-size[data-v-1ba07096]{margin-bottom:10px;font-size:12px;font-weight:400}.d-player-wrap .d-player-control .d-control-tool .volume-box .volume-main.is-muted[data-v-1ba07096] .d-slider__bar{height:0!important}.d-player-wrap .d-player-control .d-control-tool .speed-main[data-v-1ba07096]{padding:0 10px}.d-player-wrap .d-player-control .d-control-tool .speed-main li[data-v-1ba07096]{cursor:pointer;line-height:34px;font-size:12px;color:#fff}.d-player-wrap .d-player-control .d-control-tool .speed-main li[data-v-1ba07096]:hover{opacity:.8}.d-player-wrap .d-player-control .d-control-tool .speed-main li.speed-active[data-v-1ba07096]{color:rgba(var(--primary-color),1);font-weight:700}.d-player-wrap.d-player-wrap-hover .d-player-control[data-v-1ba07096]{transform:translateY(0)}.d-player-state[data-v-1ba07096],.d-player-input[data-v-1ba07096]{position:absolute;left:0;top:0;right:0;bottom:40px;display:flex;justify-content:center;align-items:center;overflow:hidden;z-index:1}.d-player-input[data-v-1ba07096]{width:100%;border:none;opacity:0;cursor:default}.d-play-btn[data-v-1ba07096]{width:90px;height:90px;color:#fff;display:flex;align-items:center;justify-content:center;background-color:#000000b3;border-radius:50%}.d-player-lightoff[data-v-1ba07096]{position:fixed;left:0;top:0;width:100vw;height:100vh;background-color:#000000e6}.is-lightoff[data-v-1ba07096]{z-index:999998}
`)();const Ne=G=>(B.pushScopeId("data-v-1ba07096"),G=G(),B.popScopeId(),G),jt={class:"d-player-video",id:"dPlayerVideo"},Yt=["controls","webkit-playsinline","playsinline","volume","muted","loop","preload","src","poster"],zt={class:"d-player-lightoff"},Xt={key:1,class:"d-player-state"},Qt={class:"d-play-btn"},$t=["onKeyup","onKeydown"],Zt={class:"d-control-progress"},Jt={class:"d-tool-bar"},qt={key:0,class:"d-tool-item d-tool-time audioTrack-btn"},er=Ne(()=>B.createElementVNode("span",{style:{margin:"0 3px"}},"/",-1)),tr={class:"total-time"},rr={class:"d-tool-bar"},ir={key:0,class:"d-tool-item quality-btn"},nr={class:"d-tool-item-main"},ar={class:"speed-main",style:{"text-align":"center"}},sr=["onClick"],or={key:1,class:"d-tool-item speedRate-btn"},lr={class:"d-tool-item-main"},dr={class:"speed-main"},ur=["onClick"],fr={key:2,class:"d-tool-item volume-btn"},cr={class:"d-tool-item-main volume-box",style:{width:"52px"}},hr={class:"volume-text-size"},vr={key:3,class:"d-tool-item setting-btn"},gr={class:"d-tool-item-main"},mr={class:"speed-main"},pr=B.createTextVNode(" \u955C\u50CF\u753B\u9762 "),Er=B.createTextVNode(" \u5FAA\u73AF\u64AD\u653E "),yr=B.createTextVNode(" \u5173\u706F\u6A21\u5F0F "),Tr=Ne(()=>B.createElementVNode("div",{class:"d-tool-item-main"},"\u753B\u4E2D\u753B",-1)),xr=Ne(()=>B.createElementVNode("div",{class:"d-tool-item-main"},"\u7F51\u9875\u5168\u5C4F",-1)),Sr=Ne(()=>B.createElementVNode("div",{class:"d-tool-item-main"},"\u5168\u5C4F",-1)),Ar={name:"vue3VideoPlay",inheritAttrs:!1},Lr=B.defineComponent(We(Ke({},Ar),{props:Ht,emits:[...$e,"mirrorChange","loopChange","lightOffChange"],setup(G,{expose:H,emit:K}){const C=G;B.useCssVars(D=>({"152bb236":B.unref(c),ab6e34cc:D.width,f5f6585a:D.height}));const E=B.ref(null),M=B.ref(null),O=B.ref(null),L=B.ref(null),R=B.reactive(We(Ke({dVideo:null},C),{muted:C.muted,playBtnState:C.autoPlay?"pause":"play",loadStateType:"loadstart",fullScreen:!1,handleType:"",currentTime:"00:00:00",preloadBar:0,totalTime:"00:00:00",isVideoHovering:!0,speedActive:"1.0",playProgress:0,isMultiplesPlay:!1,longPressTimeout:null,progressCursorTime:"00:00:00",qualityLevels:[],currentLevel:0})),I=(...D)=>P=>D.reverse().reduce((_,F)=>F(_),P),b=$e.reduce((D,P)=>{let _=`on${Wt(P)}`;return D[_]=F=>{R.loadStateType=P,K(P,F)},D},{});b.onCanplay=I(b.onCanplay,()=>{R.playBtnState!="play"&&R.dVideo.play(),R.autoPlay&&(R.dVideo.play(),R.playBtnState="pause")}),b.onEnded=I(b.onEnded,()=>{R.playBtnState="replay"}),b.onDurationchange=D=>{K("durationchange",D),C.currentTime!=0&&(R.dVideo.currentTime=C.currentTime),b.onTimeupdate(D)},b.onProgress=D=>{K("progress",D);let P=D.target.duration,_=D.target.buffered,F=D.target.buffered.length&&D.target.buffered.end(_-1);R.preloadBar=F/P},b.onTimeupdate=D=>{K("timeupdate",D);let P=D.duration||D.target.duration||0,_=D.currentTime||D.target.currentTime;R.playProgress=_/P,R.currentTime=He(_),R.totalTime=He(P)},b.onError=I(b.onError,()=>{R.playBtnState="replay"});let A=B.useAttrs();for(let D in A)b[D]=A[D];const c=Kt(R.color),S=ze(500,()=>{R.handleType=""}),y=D=>{D.preventDefault(),D.code=="ArrowUp"?R.volume=R.volume+.1>1?1:R.volume+.1:R.volume=R.volume-.1<0?0:R.volume-.1,R.muted=!1,R.handleType="volume",S()},T=D=>{!C.speed||(R.dVideo.currentTime=R.dVideo.currentTime<10?.1:R.dVideo.currentTime-10,b.onTimeupdate(R.dVideo),s())},p=D=>{D.preventDefault();let P=D.type;if(D.key=="ArrowRight"){if(s(),P=="keyup"){if(clearTimeout(R.longPressTimeout),!C.speed&&!R.longPressTimeout)return;R.isMultiplesPlay?(R.dVideo.playbackRate=R.speedActive,R.isMultiplesPlay=!1):(R.dVideo.currentTime=R.dVideo.currentTime+10,b.onTimeupdate(R.dVideo))}else if(P=="keydown"){if(!C.speed)return;R.isMultiplesPlay&&clearTimeout(R.longPressTimeout),R.longPressTimeout=setTimeout(()=>{R.isMultiplesPlay=!0,R.dVideo.playbackRate=5,R.handleType="playbackRate",S()},500)}}},v=()=>{Fe||L.value.focus()},s=()=>{R.loadStateType="play",R.dVideo.play().catch(()=>{setTimeout(()=>{R.playBtnState="replay",R.loadStateType="error"},500)}),R.playBtnState="pause"},t=()=>{R.dVideo.pause(),R.playBtnState="play"},r=D=>{D&&D.preventDefault(),R.playBtnState=="play"||R.playBtnState=="replay"?s():R.playBtnState=="pause"&&t()},e=()=>{R.muted=!R.muted,R.volume==0&&(R.volume=.05)},f=(D,P)=>{let _=R.dVideo.duration||R.dVideo.target.duration;R.dVideo.currentTime=_*P,R.playBtnState=="play"&&(R.dVideo.play(),R.playBtnState="pause")},a=(D,P)=>{R.progressCursorTime=He(R.dVideo.duration*P)},i=ze(2500,()=>{R.isVideoHovering=!1}),l=D=>{R.isVideoHovering=!0,i()},g=(D,P)=>{Hls.currentLevel=P,R.currentLevel=P},h=D=>{R.speedActive=D,R.dVideo.playbackRate=D},o=D=>{K("mirrorChange",D,R.dVideo)},n=D=>{K("loopChange",D,R.dVideo)},d=D=>{K("lightOffChange",D,R.dVideo)},u=()=>{Gt(R.dVideo)},m=()=>{R.fullScreen=Vt(E.value)},x=()=>{if(R.dVideo.canPlayType(C.type)||R.dVideo.canPlayType("application/vnd.apple.mpegurl"))R.muted=C.autoPlay;else if(Ve.isSupported()){const D=new Ve({fragLoadingTimeOut:2e3});D.detachMedia(),D.attachMedia(R.dVideo),D.on(Ve.Events.MEDIA_ATTACHED,()=>{D.loadSource(C.src),D.on("hlsManifestParsed",(P,_)=>{R.currentLevel=_.level,R.qualityLevels=_.levels||[]})}),D.on("hlsLevelSwitching",(P,_)=>{}),D.on("hlsLevelSwitched",(P,_)=>{R.currentLevel=_.level})}};return B.watch(()=>C.src,()=>{B.nextTick(()=>{x()})},{immediate:!0}),B.onMounted(()=>{R.dVideo=M}),H({play:s,pause:t,togglePlay:r}),(D,P)=>(B.openBlock(),B.createElementBlock("div",{ref_key:"refPlayerWrap",ref:E,id:"refPlayerWrap",class:B.normalizeClass(["d-player-wrap",{"web-full-screen":R.webFullScreen,"is-lightoff":R.lightOff,"d-player-wrap-hover":R.playBtnState=="play"||R.isVideoHovering}]),onMousemove:l},[B.createElementVNode("div",jt,[B.createElementVNode("video",B.mergeProps({ref_key:"refdVideo",ref:M,class:["d-player-video-main",{"video-mirror":R.mirror}],id:"dPlayerVideoMain",controls:!!(B.unref(Fe)&&R.speed),"webkit-playsinline":C.playsinline,playsinline:C.playsinline},B.unref(b),{volume:R.volume,muted:R.muted,loop:R.loop,preload:D.preload,width:"100%",height:"100%",src:C.src,poster:C.poster}),"\u60A8\u7684\u6D4F\u89C8\u5668\u4E0D\u652F\u6301Video\u6807\u7B7E\u3002",16,Yt)]),B.createVNode(B.Transition,{name:"d-fade-in"},{default:B.withCtx(()=>[B.withDirectives(B.createElementVNode("div",zt,null,512),[[B.vShow,R.lightOff]])]),_:1}),R.fullScreen?(B.openBlock(),B.createBlock(ot,{key:0,title:C.title},null,8,["title"])):B.createCommentVNode("",!0),B.unref(Fe)?B.createCommentVNode("",!0):(B.openBlock(),B.createElementBlock("div",Xt,[B.createVNode(B.Transition,{name:"d-scale-out"},{default:B.withCtx(()=>[B.withDirectives(B.createElementVNode("div",Qt,[B.createVNode(ye,{icon:"icon-play",size:40})],512),[[B.vShow,R.playBtnState=="play"]])]),_:1}),B.createVNode(ct,{state:R},null,8,["state"])])),B.unref(Fe)?B.createCommentVNode("",!0):(B.openBlock(),B.createElementBlock("input",{key:2,type:"input",readonly:"readonly",ref_key:"refInput",ref:L,onDblclick:m,onKeyup:[B.withKeys(m,["f"]),P[0]||(P[0]=B.withKeys(_=>R.webFullScreen=!1,["esc"])),p],onClick:r,onKeydown:[B.withKeys(r,["space"]),B.withKeys(T,["arrow-left"]),B.withKeys(y,["arrow-up","arrow-down"]),p],class:"d-player-input",maxlength:"0"},null,40,$t)),B.createVNode(xt,{loadType:R.loadStateType},null,8,["loadType"]),B.createVNode(wt),!B.unref(Fe)&&R.control?(B.openBlock(),B.createElementBlock("div",{key:3,class:"d-player-control",ref_key:"refPlayerControl",ref:O},[B.createElementVNode("div",Zt,[B.createVNode(_e,{class:"d-progress-bar",onOnMousemove:a,onChange:f,disabled:!R.speed,hoverText:R.progressCursorTime,modelValue:R.playProgress,"onUpdate:modelValue":P[1]||(P[1]=_=>R.playProgress=_),preload:R.preloadBar},null,8,["disabled","hoverText","modelValue","preload"])]),B.createElementVNode("div",{class:"d-control-tool",onClick:v},[B.createElementVNode("div",Jt,[B.createElementVNode("div",{class:"d-tool-item",onClick:r},[B.createVNode(ye,{size:"24",icon:`icon-${R.playBtnState}`},null,8,["icon"])]),C.controlBtns.includes("audioTrack")?(B.openBlock(),B.createElementBlock("div",qt,[B.createElementVNode("span",null,B.toDisplayString(R.currentTime),1),er,B.createElementVNode("span",tr,B.toDisplayString(R.totalTime),1)])):B.createCommentVNode("",!0)]),B.createElementVNode("div",rr,[R.qualityLevels.length&&C.controlBtns.includes("quality")?(B.openBlock(),B.createElementBlock("div",ir,[B.createTextVNode(B.toDisplayString(R.qualityLevels.length&&(R.qualityLevels[R.currentLevel]||{}).height)+"P ",1),B.createElementVNode("div",nr,[B.createElementVNode("ul",ar,[(B.openBlock(!0),B.createElementBlock(B.Fragment,null,B.renderList(R.qualityLevels,(_,F)=>(B.openBlock(),B.createElementBlock("li",{class:B.normalizeClass({"speed-active":R.currentLevel==F}),onClick:U=>g(_,F),key:_},B.toDisplayString(_.height)+"P",11,sr))),128))])])])):B.createCommentVNode("",!0),C.controlBtns.includes("speedRate")?(B.openBlock(),B.createElementBlock("div",or,[B.createTextVNode(B.toDisplayString(R.speedActive=="1.0"?"\u500D\u901F":R.speedActive+"x")+" ",1),B.createElementVNode("div",lr,[B.createElementVNode("ul",dr,[(B.openBlock(!0),B.createElementBlock(B.Fragment,null,B.renderList(R.speedRate,_=>(B.openBlock(),B.createElementBlock("li",{class:B.normalizeClass({"speed-active":R.speedActive==_}),onClick:F=>h(_),key:_},B.toDisplayString(_)+"x",11,ur))),128))])])])):B.createCommentVNode("",!0),C.controlBtns.includes("volume")?(B.openBlock(),B.createElementBlock("div",fr,[B.createElementVNode("div",cr,[B.createElementVNode("div",{class:B.normalizeClass(["volume-main",{"is-muted":R.muted}])},[B.createElementVNode("span",hr,B.toDisplayString(R.muted?0:~~(R.volume*100))+"%",1),B.createVNode(_e,{onChange:P[2]||(P[2]=_=>R.muted=!1),hover:!1,size:"5px",vertical:!0,modelValue:R.volume,"onUpdate:modelValue":P[3]||(P[3]=_=>R.volume=_)},null,8,["modelValue"])],2)]),B.createElementVNode("span",{onClick:e,style:{display:"flex"}},[B.createVNode(ye,{size:"20",icon:`icon-volume-${R.volume==0||R.muted?"mute":R.volume>.5?"up":"down"}`},null,8,["icon"])])])):B.createCommentVNode("",!0),C.controlBtns.includes("setting")?(B.openBlock(),B.createElementBlock("div",vr,[B.createVNode(ye,{size:"20",class:"rotateHover",icon:"icon-settings"}),B.createElementVNode("div",gr,[B.createElementVNode("ul",mr,[B.createElementVNode("li",null,[pr,B.createVNode(Ge,{onChange:o,modelValue:R.mirror,"onUpdate:modelValue":P[4]||(P[4]=_=>R.mirror=_)},null,8,["modelValue"])]),B.createElementVNode("li",null,[Er,B.createVNode(Ge,{onChange:n,modelValue:R.loop,"onUpdate:modelValue":P[5]||(P[5]=_=>R.loop=_)},null,8,["modelValue"])]),B.createElementVNode("li",null,[yr,B.createVNode(Ge,{onChange:d,modelValue:R.lightOff,"onUpdate:modelValue":P[6]||(P[6]=_=>R.lightOff=_)},null,8,["modelValue"])])])])])):B.createCommentVNode("",!0),C.controlBtns.includes("pip")?(B.openBlock(),B.createElementBlock("div",{key:4,class:"d-tool-item pip-btn",onClick:u},[B.createVNode(ye,{size:"20",icon:"icon-pip"}),Tr])):B.createCommentVNode("",!0),C.controlBtns.includes("pageFullScreen")?(B.openBlock(),B.createElementBlock("div",{key:5,class:"d-tool-item pip-btn",onClick:P[7]||(P[7]=_=>R.webFullScreen=!R.webFullScreen)},[B.createVNode(ye,{size:"20",icon:"icon-web-screen"}),xr])):B.createCommentVNode("",!0),C.controlBtns.includes("fullScreen")?(B.openBlock(),B.createElementBlock("div",{key:6,class:"d-tool-item fullScreen-btn",onClick:m},[Sr,B.createVNode(ye,{size:"20",icon:"icon-screen"})])):B.createCommentVNode("",!0)])])],512)):B.createCommentVNode("",!0)],34))}}));var Be=Ae(Lr,[["__scopeId","data-v-1ba07096"]]);function Ze(G){G.component(Be.name,Be)}Be.install=Ze,ae.default=Be,ae.install=Ze,ae.videoPlay=Be,Object.defineProperties(ae,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
